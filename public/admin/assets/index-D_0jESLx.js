var SQ=Object.defineProperty;var _Q=(t,e,n)=>e in t?SQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var n_=(t,e,n)=>_Q(t,typeof e!="symbol"?e+"":e,n);function jQ(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Bo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var N$={exports:{}},D1={},S$={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gy=Symbol.for("react.element"),EQ=Symbol.for("react.portal"),CQ=Symbol.for("react.fragment"),TQ=Symbol.for("react.strict_mode"),AQ=Symbol.for("react.profiler"),kQ=Symbol.for("react.provider"),IQ=Symbol.for("react.context"),PQ=Symbol.for("react.forward_ref"),OQ=Symbol.for("react.suspense"),DQ=Symbol.for("react.memo"),RQ=Symbol.for("react.lazy"),ED=Symbol.iterator;function MQ(t){return t===null||typeof t!="object"?null:(t=ED&&t[ED]||t["@@iterator"],typeof t=="function"?t:null)}var _$={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j$=Object.assign,E$={};function Tp(t,e,n){this.props=t,this.context=e,this.refs=E$,this.updater=n||_$}Tp.prototype.isReactComponent={};Tp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Tp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function C$(){}C$.prototype=Tp.prototype;function oA(t,e,n){this.props=t,this.context=e,this.refs=E$,this.updater=n||_$}var lA=oA.prototype=new C$;lA.constructor=oA;j$(lA,Tp.prototype);lA.isPureReactComponent=!0;var CD=Array.isArray,T$=Object.prototype.hasOwnProperty,cA={current:null},A$={key:!0,ref:!0,__self:!0,__source:!0};function k$(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)T$.call(e,r)&&!A$.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Gy,type:t,key:i,ref:a,props:s,_owner:cA.current}}function LQ(t,e){return{$$typeof:Gy,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function uA(t){return typeof t=="object"&&t!==null&&t.$$typeof===Gy}function FQ(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var TD=/\/+/g;function r_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?FQ(""+t.key):e.toString(36)}function g0(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Gy:case EQ:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+r_(a,0):r,CD(s)?(n="",t!=null&&(n=t.replace(TD,"$&/")+"/"),g0(s,e,n,"",function(u){return u})):s!=null&&(uA(s)&&(s=LQ(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(TD,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",CD(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+r_(i,l);a+=g0(i,e,n,c,s)}else if(c=MQ(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+r_(i,l++),a+=g0(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function lx(t,e,n){if(t==null)return t;var r=[],s=0;return g0(t,r,"","",function(i){return e.call(n,i,s++)}),r}function BQ(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qs={current:null},y0={transition:null},VQ={ReactCurrentDispatcher:Qs,ReactCurrentBatchConfig:y0,ReactCurrentOwner:cA};function I$(){throw Error("act(...) is not supported in production builds of React.")}It.Children={map:lx,forEach:function(t,e,n){lx(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return lx(t,function(){e++}),e},toArray:function(t){return lx(t,function(e){return e})||[]},only:function(t){if(!uA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};It.Component=Tp;It.Fragment=CQ;It.Profiler=AQ;It.PureComponent=oA;It.StrictMode=TQ;It.Suspense=OQ;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VQ;It.act=I$;It.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=j$({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=cA.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)T$.call(e,c)&&!A$.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:Gy,type:t.type,key:s,ref:i,props:r,_owner:a}};It.createContext=function(t){return t={$$typeof:IQ,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kQ,_context:t},t.Consumer=t};It.createElement=k$;It.createFactory=function(t){var e=k$.bind(null,t);return e.type=t,e};It.createRef=function(){return{current:null}};It.forwardRef=function(t){return{$$typeof:PQ,render:t}};It.isValidElement=uA;It.lazy=function(t){return{$$typeof:RQ,_payload:{_status:-1,_result:t},_init:BQ}};It.memo=function(t,e){return{$$typeof:DQ,type:t,compare:e===void 0?null:e}};It.startTransition=function(t){var e=y0.transition;y0.transition={};try{t()}finally{y0.transition=e}};It.unstable_act=I$;It.useCallback=function(t,e){return Qs.current.useCallback(t,e)};It.useContext=function(t){return Qs.current.useContext(t)};It.useDebugValue=function(){};It.useDeferredValue=function(t){return Qs.current.useDeferredValue(t)};It.useEffect=function(t,e){return Qs.current.useEffect(t,e)};It.useId=function(){return Qs.current.useId()};It.useImperativeHandle=function(t,e,n){return Qs.current.useImperativeHandle(t,e,n)};It.useInsertionEffect=function(t,e){return Qs.current.useInsertionEffect(t,e)};It.useLayoutEffect=function(t,e){return Qs.current.useLayoutEffect(t,e)};It.useMemo=function(t,e){return Qs.current.useMemo(t,e)};It.useReducer=function(t,e,n){return Qs.current.useReducer(t,e,n)};It.useRef=function(t){return Qs.current.useRef(t)};It.useState=function(t){return Qs.current.useState(t)};It.useSyncExternalStore=function(t,e,n){return Qs.current.useSyncExternalStore(t,e,n)};It.useTransition=function(){return Qs.current.useTransition()};It.version="18.3.1";S$.exports=It;var b=S$.exports;const Fr=Bo(b),P$=jQ({__proto__:null,default:Fr},[b]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $Q=b,UQ=Symbol.for("react.element"),zQ=Symbol.for("react.fragment"),HQ=Object.prototype.hasOwnProperty,WQ=$Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qQ={key:!0,ref:!0,__self:!0,__source:!0};function O$(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)HQ.call(e,r)&&!qQ.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:UQ,type:t,key:i,ref:a,props:s,_owner:WQ.current}}D1.Fragment=zQ;D1.jsx=O$;D1.jsxs=O$;N$.exports=D1;var o=N$.exports,eE={},D$={exports:{}},Yi={},R$={exports:{}},M$={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(B,$){var q=B.length;B.push($);e:for(;0<q;){var Y=q-1>>>1,R=B[Y];if(0<s(R,$))B[Y]=$,B[q]=R,q=Y;else break e}}function n(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var $=B[0],q=B.pop();if(q!==$){B[0]=q;e:for(var Y=0,R=B.length,G=R>>>1;Y<G;){var Z=2*(Y+1)-1,W=B[Z],Q=Z+1,U=B[Q];if(0>s(W,q))Q<R&&0>s(U,W)?(B[Y]=U,B[Q]=q,Y=Q):(B[Y]=W,B[Z]=q,Y=Z);else if(Q<R&&0>s(U,q))B[Y]=U,B[Q]=q,Y=Q;else break e}}return $}function s(B,$){var q=B.sortIndex-$.sortIndex;return q!==0?q:B.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(B){for(var $=n(u);$!==null;){if($.callback===null)r(u);else if($.startTime<=B)r(u),$.sortIndex=$.expirationTime,e(c,$);else break;$=n(u)}}function S(B){if(g=!1,N(B),!m)if(n(c)!==null)m=!0,se(C);else{var $=n(u);$!==null&&L(S,$.startTime-B)}}function C(B,$){m=!1,g&&(g=!1,x(_),_=-1),p=!0;var q=f;try{for(N($),h=n(c);h!==null&&(!(h.expirationTime>$)||B&&!T());){var Y=h.callback;if(typeof Y=="function"){h.callback=null,f=h.priorityLevel;var R=Y(h.expirationTime<=$);$=t.unstable_now(),typeof R=="function"?h.callback=R:h===n(c)&&r(c),N($)}else r(c);h=n(c)}if(h!==null)var G=!0;else{var Z=n(u);Z!==null&&L(S,Z.startTime-$),G=!1}return G}finally{h=null,f=q,p=!1}}var A=!1,j=null,_=-1,E=5,I=-1;function T(){return!(t.unstable_now()-I<E)}function P(){if(j!==null){var B=t.unstable_now();I=B;var $=!0;try{$=j(!0,B)}finally{$?O():(A=!1,j=null)}}else A=!1}var O;if(typeof w=="function")O=function(){w(P)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,X=H.port2;H.port1.onmessage=P,O=function(){X.postMessage(null)}}else O=function(){y(P,0)};function se(B){j=B,A||(A=!0,O())}function L(B,$){_=y(function(){B(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(B){B.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,se(C))},t.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<B?Math.floor(1e3/B):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(B){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var q=f;f=$;try{return B()}finally{f=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(B,$){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var q=f;f=B;try{return $()}finally{f=q}},t.unstable_scheduleCallback=function(B,$,q){var Y=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?Y+q:Y):q=Y,B){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=q+R,B={id:d++,callback:$,priorityLevel:B,startTime:q,expirationTime:R,sortIndex:-1},q>Y?(B.sortIndex=q,e(u,B),n(c)===null&&B===n(u)&&(g?(x(_),_=-1):g=!0,L(S,q-Y))):(B.sortIndex=R,e(c,B),m||p||(m=!0,se(C))),B},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(B){var $=f;return function(){var q=f;f=$;try{return B.apply(this,arguments)}finally{f=q}}}})(M$);R$.exports=M$;var GQ=R$.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KQ=b,Ui=GQ;function je(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var L$=new Set,Lg={};function ph(t,e){Ff(t,e),Ff(t+"Capture",e)}function Ff(t,e){for(Lg[t]=e,t=0;t<e.length;t++)L$.add(e[t])}var Sl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tE=Object.prototype.hasOwnProperty,YQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,AD={},kD={};function QQ(t){return tE.call(kD,t)?!0:tE.call(AD,t)?!1:YQ.test(t)?kD[t]=!0:(AD[t]=!0,!1)}function XQ(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function JQ(t,e,n,r){if(e===null||typeof e>"u"||XQ(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xs(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var ys={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ys[t]=new Xs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ys[e]=new Xs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ys[t]=new Xs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ys[t]=new Xs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ys[t]=new Xs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ys[t]=new Xs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ys[t]=new Xs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ys[t]=new Xs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ys[t]=new Xs(t,5,!1,t.toLowerCase(),null,!1,!1)});var dA=/[\-:]([a-z])/g;function hA(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(dA,hA);ys[e]=new Xs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(dA,hA);ys[e]=new Xs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(dA,hA);ys[e]=new Xs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ys[t]=new Xs(t,1,!1,t.toLowerCase(),null,!1,!1)});ys.xlinkHref=new Xs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ys[t]=new Xs(t,1,!1,t.toLowerCase(),null,!0,!0)});function fA(t,e,n,r){var s=ys.hasOwnProperty(e)?ys[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(JQ(e,n,s,r)&&(n=null),r||s===null?QQ(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Vl=KQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cx=Symbol.for("react.element"),ef=Symbol.for("react.portal"),tf=Symbol.for("react.fragment"),pA=Symbol.for("react.strict_mode"),nE=Symbol.for("react.profiler"),F$=Symbol.for("react.provider"),B$=Symbol.for("react.context"),mA=Symbol.for("react.forward_ref"),rE=Symbol.for("react.suspense"),sE=Symbol.for("react.suspense_list"),gA=Symbol.for("react.memo"),cc=Symbol.for("react.lazy"),V$=Symbol.for("react.offscreen"),ID=Symbol.iterator;function hm(t){return t===null||typeof t!="object"?null:(t=ID&&t[ID]||t["@@iterator"],typeof t=="function"?t:null)}var Ln=Object.assign,s_;function Um(t){if(s_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);s_=e&&e[1]||""}return`
`+s_+t}var i_=!1;function a_(t,e){if(!t||i_)return"";i_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{i_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Um(t):""}function ZQ(t){switch(t.tag){case 5:return Um(t.type);case 16:return Um("Lazy");case 13:return Um("Suspense");case 19:return Um("SuspenseList");case 0:case 2:case 15:return t=a_(t.type,!1),t;case 11:return t=a_(t.type.render,!1),t;case 1:return t=a_(t.type,!0),t;default:return""}}function iE(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case tf:return"Fragment";case ef:return"Portal";case nE:return"Profiler";case pA:return"StrictMode";case rE:return"Suspense";case sE:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case B$:return(t.displayName||"Context")+".Consumer";case F$:return(t._context.displayName||"Context")+".Provider";case mA:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case gA:return e=t.displayName||null,e!==null?e:iE(t.type)||"Memo";case cc:e=t._payload,t=t._init;try{return iE(t(e))}catch{}}return null}function eX(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return iE(e);case 8:return e===pA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function nu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function $$(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tX(t){var e=$$(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ux(t){t._valueTracker||(t._valueTracker=tX(t))}function U$(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=$$(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function J0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function aE(t,e){var n=e.checked;return Ln({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function PD(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=nu(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function z$(t,e){e=e.checked,e!=null&&fA(t,"checked",e,!1)}function oE(t,e){z$(t,e);var n=nu(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?lE(t,e.type,n):e.hasOwnProperty("defaultValue")&&lE(t,e.type,nu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function OD(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function lE(t,e,n){(e!=="number"||J0(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zm=Array.isArray;function xf(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+nu(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function cE(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(je(91));return Ln({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function DD(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(je(92));if(zm(n)){if(1<n.length)throw Error(je(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:nu(n)}}function H$(t,e){var n=nu(e.value),r=nu(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function RD(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function W$(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function uE(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?W$(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var dx,q$=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(dx=dx||document.createElement("div"),dx.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=dx.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Fg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ig={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nX=["Webkit","ms","Moz","O"];Object.keys(ig).forEach(function(t){nX.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ig[e]=ig[t]})});function G$(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ig.hasOwnProperty(t)&&ig[t]?(""+e).trim():e+"px"}function K$(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=G$(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var rX=Ln({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function dE(t,e){if(e){if(rX[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(je(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(je(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(je(61))}if(e.style!=null&&typeof e.style!="object")throw Error(je(62))}}function hE(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fE=null;function yA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var pE=null,bf=null,wf=null;function MD(t){if(t=Qy(t)){if(typeof pE!="function")throw Error(je(280));var e=t.stateNode;e&&(e=B1(e),pE(t.stateNode,t.type,e))}}function Y$(t){bf?wf?wf.push(t):wf=[t]:bf=t}function Q$(){if(bf){var t=bf,e=wf;if(wf=bf=null,MD(t),e)for(t=0;t<e.length;t++)MD(e[t])}}function X$(t,e){return t(e)}function J$(){}var o_=!1;function Z$(t,e,n){if(o_)return t(e,n);o_=!0;try{return X$(t,e,n)}finally{o_=!1,(bf!==null||wf!==null)&&(J$(),Q$())}}function Bg(t,e){var n=t.stateNode;if(n===null)return null;var r=B1(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(je(231,e,typeof n));return n}var mE=!1;if(Sl)try{var fm={};Object.defineProperty(fm,"passive",{get:function(){mE=!0}}),window.addEventListener("test",fm,fm),window.removeEventListener("test",fm,fm)}catch{mE=!1}function sX(t,e,n,r,s,i,a,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var ag=!1,Z0=null,eb=!1,gE=null,iX={onError:function(t){ag=!0,Z0=t}};function aX(t,e,n,r,s,i,a,l,c){ag=!1,Z0=null,sX.apply(iX,arguments)}function oX(t,e,n,r,s,i,a,l,c){if(aX.apply(this,arguments),ag){if(ag){var u=Z0;ag=!1,Z0=null}else throw Error(je(198));eb||(eb=!0,gE=u)}}function mh(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function eU(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function LD(t){if(mh(t)!==t)throw Error(je(188))}function lX(t){var e=t.alternate;if(!e){if(e=mh(t),e===null)throw Error(je(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return LD(s),t;if(i===r)return LD(s),e;i=i.sibling}throw Error(je(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(je(189))}}if(n.alternate!==r)throw Error(je(190))}if(n.tag!==3)throw Error(je(188));return n.stateNode.current===n?t:e}function tU(t){return t=lX(t),t!==null?nU(t):null}function nU(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=nU(t);if(e!==null)return e;t=t.sibling}return null}var rU=Ui.unstable_scheduleCallback,FD=Ui.unstable_cancelCallback,cX=Ui.unstable_shouldYield,uX=Ui.unstable_requestPaint,er=Ui.unstable_now,dX=Ui.unstable_getCurrentPriorityLevel,vA=Ui.unstable_ImmediatePriority,sU=Ui.unstable_UserBlockingPriority,tb=Ui.unstable_NormalPriority,hX=Ui.unstable_LowPriority,iU=Ui.unstable_IdlePriority,R1=null,wo=null;function fX(t){if(wo&&typeof wo.onCommitFiberRoot=="function")try{wo.onCommitFiberRoot(R1,t,void 0,(t.current.flags&128)===128)}catch{}}var Ha=Math.clz32?Math.clz32:gX,pX=Math.log,mX=Math.LN2;function gX(t){return t>>>=0,t===0?32:31-(pX(t)/mX|0)|0}var hx=64,fx=4194304;function Hm(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function nb(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Hm(l):(i&=a,i!==0&&(r=Hm(i)))}else a=n&~s,a!==0?r=Hm(a):i!==0&&(r=Hm(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ha(e),s=1<<n,r|=t[n],e&=~s;return r}function yX(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vX(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Ha(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=yX(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function yE(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function aU(){var t=hx;return hx<<=1,!(hx&4194240)&&(hx=64),t}function l_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ky(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ha(e),t[e]=n}function xX(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Ha(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function xA(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ha(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Zt=0;function oU(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var lU,bA,cU,uU,dU,vE=!1,px=[],Fc=null,Bc=null,Vc=null,Vg=new Map,$g=new Map,gc=[],bX="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function BD(t,e){switch(t){case"focusin":case"focusout":Fc=null;break;case"dragenter":case"dragleave":Bc=null;break;case"mouseover":case"mouseout":Vc=null;break;case"pointerover":case"pointerout":Vg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":$g.delete(e.pointerId)}}function pm(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Qy(e),e!==null&&bA(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function wX(t,e,n,r,s){switch(e){case"focusin":return Fc=pm(Fc,t,e,n,r,s),!0;case"dragenter":return Bc=pm(Bc,t,e,n,r,s),!0;case"mouseover":return Vc=pm(Vc,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Vg.set(i,pm(Vg.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,$g.set(i,pm($g.get(i)||null,t,e,n,r,s)),!0}return!1}function hU(t){var e=od(t.target);if(e!==null){var n=mh(e);if(n!==null){if(e=n.tag,e===13){if(e=eU(n),e!==null){t.blockedOn=e,dU(t.priority,function(){cU(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function v0(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);fE=r,n.target.dispatchEvent(r),fE=null}else return e=Qy(n),e!==null&&bA(e),t.blockedOn=n,!1;e.shift()}return!0}function VD(t,e,n){v0(t)&&n.delete(e)}function NX(){vE=!1,Fc!==null&&v0(Fc)&&(Fc=null),Bc!==null&&v0(Bc)&&(Bc=null),Vc!==null&&v0(Vc)&&(Vc=null),Vg.forEach(VD),$g.forEach(VD)}function mm(t,e){t.blockedOn===e&&(t.blockedOn=null,vE||(vE=!0,Ui.unstable_scheduleCallback(Ui.unstable_NormalPriority,NX)))}function Ug(t){function e(s){return mm(s,t)}if(0<px.length){mm(px[0],t);for(var n=1;n<px.length;n++){var r=px[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Fc!==null&&mm(Fc,t),Bc!==null&&mm(Bc,t),Vc!==null&&mm(Vc,t),Vg.forEach(e),$g.forEach(e),n=0;n<gc.length;n++)r=gc[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<gc.length&&(n=gc[0],n.blockedOn===null);)hU(n),n.blockedOn===null&&gc.shift()}var Nf=Vl.ReactCurrentBatchConfig,rb=!0;function SX(t,e,n,r){var s=Zt,i=Nf.transition;Nf.transition=null;try{Zt=1,wA(t,e,n,r)}finally{Zt=s,Nf.transition=i}}function _X(t,e,n,r){var s=Zt,i=Nf.transition;Nf.transition=null;try{Zt=4,wA(t,e,n,r)}finally{Zt=s,Nf.transition=i}}function wA(t,e,n,r){if(rb){var s=xE(t,e,n,r);if(s===null)v_(t,e,r,sb,n),BD(t,r);else if(wX(s,t,e,n,r))r.stopPropagation();else if(BD(t,r),e&4&&-1<bX.indexOf(t)){for(;s!==null;){var i=Qy(s);if(i!==null&&lU(i),i=xE(t,e,n,r),i===null&&v_(t,e,r,sb,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else v_(t,e,r,null,n)}}var sb=null;function xE(t,e,n,r){if(sb=null,t=yA(r),t=od(t),t!==null)if(e=mh(t),e===null)t=null;else if(n=e.tag,n===13){if(t=eU(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return sb=t,null}function fU(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dX()){case vA:return 1;case sU:return 4;case tb:case hX:return 16;case iU:return 536870912;default:return 16}default:return 16}}var Ac=null,NA=null,x0=null;function pU(){if(x0)return x0;var t,e=NA,n=e.length,r,s="value"in Ac?Ac.value:Ac.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return x0=s.slice(t,1<r?1-r:void 0)}function b0(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mx(){return!0}function $D(){return!1}function Qi(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?mx:$D,this.isPropagationStopped=$D,this}return Ln(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=mx)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=mx)},persist:function(){},isPersistent:mx}),e}var Ap={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SA=Qi(Ap),Yy=Ln({},Ap,{view:0,detail:0}),jX=Qi(Yy),c_,u_,gm,M1=Ln({},Yy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_A,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gm&&(gm&&t.type==="mousemove"?(c_=t.screenX-gm.screenX,u_=t.screenY-gm.screenY):u_=c_=0,gm=t),c_)},movementY:function(t){return"movementY"in t?t.movementY:u_}}),UD=Qi(M1),EX=Ln({},M1,{dataTransfer:0}),CX=Qi(EX),TX=Ln({},Yy,{relatedTarget:0}),d_=Qi(TX),AX=Ln({},Ap,{animationName:0,elapsedTime:0,pseudoElement:0}),kX=Qi(AX),IX=Ln({},Ap,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),PX=Qi(IX),OX=Ln({},Ap,{data:0}),zD=Qi(OX),DX={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RX={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MX={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LX(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=MX[t])?!!e[t]:!1}function _A(){return LX}var FX=Ln({},Yy,{key:function(t){if(t.key){var e=DX[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=b0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?RX[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_A,charCode:function(t){return t.type==="keypress"?b0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?b0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BX=Qi(FX),VX=Ln({},M1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),HD=Qi(VX),$X=Ln({},Yy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_A}),UX=Qi($X),zX=Ln({},Ap,{propertyName:0,elapsedTime:0,pseudoElement:0}),HX=Qi(zX),WX=Ln({},M1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),qX=Qi(WX),GX=[9,13,27,32],jA=Sl&&"CompositionEvent"in window,og=null;Sl&&"documentMode"in document&&(og=document.documentMode);var KX=Sl&&"TextEvent"in window&&!og,mU=Sl&&(!jA||og&&8<og&&11>=og),WD=" ",qD=!1;function gU(t,e){switch(t){case"keyup":return GX.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yU(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nf=!1;function YX(t,e){switch(t){case"compositionend":return yU(e);case"keypress":return e.which!==32?null:(qD=!0,WD);case"textInput":return t=e.data,t===WD&&qD?null:t;default:return null}}function QX(t,e){if(nf)return t==="compositionend"||!jA&&gU(t,e)?(t=pU(),x0=NA=Ac=null,nf=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return mU&&e.locale!=="ko"?null:e.data;default:return null}}var XX={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function GD(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!XX[t.type]:e==="textarea"}function vU(t,e,n,r){Y$(r),e=ib(e,"onChange"),0<e.length&&(n=new SA("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var lg=null,zg=null;function JX(t){AU(t,0)}function L1(t){var e=af(t);if(U$(e))return t}function ZX(t,e){if(t==="change")return e}var xU=!1;if(Sl){var h_;if(Sl){var f_="oninput"in document;if(!f_){var KD=document.createElement("div");KD.setAttribute("oninput","return;"),f_=typeof KD.oninput=="function"}h_=f_}else h_=!1;xU=h_&&(!document.documentMode||9<document.documentMode)}function YD(){lg&&(lg.detachEvent("onpropertychange",bU),zg=lg=null)}function bU(t){if(t.propertyName==="value"&&L1(zg)){var e=[];vU(e,zg,t,yA(t)),Z$(JX,e)}}function eJ(t,e,n){t==="focusin"?(YD(),lg=e,zg=n,lg.attachEvent("onpropertychange",bU)):t==="focusout"&&YD()}function tJ(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return L1(zg)}function nJ(t,e){if(t==="click")return L1(e)}function rJ(t,e){if(t==="input"||t==="change")return L1(e)}function sJ(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ka=typeof Object.is=="function"?Object.is:sJ;function Hg(t,e){if(Ka(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!tE.call(e,s)||!Ka(t[s],e[s]))return!1}return!0}function QD(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function XD(t,e){var n=QD(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=QD(n)}}function wU(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?wU(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function NU(){for(var t=window,e=J0();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=J0(t.document)}return e}function EA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function iJ(t){var e=NU(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&wU(n.ownerDocument.documentElement,n)){if(r!==null&&EA(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=XD(n,i);var a=XD(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var aJ=Sl&&"documentMode"in document&&11>=document.documentMode,rf=null,bE=null,cg=null,wE=!1;function JD(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;wE||rf==null||rf!==J0(r)||(r=rf,"selectionStart"in r&&EA(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),cg&&Hg(cg,r)||(cg=r,r=ib(bE,"onSelect"),0<r.length&&(e=new SA("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=rf)))}function gx(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var sf={animationend:gx("Animation","AnimationEnd"),animationiteration:gx("Animation","AnimationIteration"),animationstart:gx("Animation","AnimationStart"),transitionend:gx("Transition","TransitionEnd")},p_={},SU={};Sl&&(SU=document.createElement("div").style,"AnimationEvent"in window||(delete sf.animationend.animation,delete sf.animationiteration.animation,delete sf.animationstart.animation),"TransitionEvent"in window||delete sf.transitionend.transition);function F1(t){if(p_[t])return p_[t];if(!sf[t])return t;var e=sf[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in SU)return p_[t]=e[n];return t}var _U=F1("animationend"),jU=F1("animationiteration"),EU=F1("animationstart"),CU=F1("transitionend"),TU=new Map,ZD="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xu(t,e){TU.set(t,e),ph(e,[t])}for(var m_=0;m_<ZD.length;m_++){var g_=ZD[m_],oJ=g_.toLowerCase(),lJ=g_[0].toUpperCase()+g_.slice(1);xu(oJ,"on"+lJ)}xu(_U,"onAnimationEnd");xu(jU,"onAnimationIteration");xu(EU,"onAnimationStart");xu("dblclick","onDoubleClick");xu("focusin","onFocus");xu("focusout","onBlur");xu(CU,"onTransitionEnd");Ff("onMouseEnter",["mouseout","mouseover"]);Ff("onMouseLeave",["mouseout","mouseover"]);Ff("onPointerEnter",["pointerout","pointerover"]);Ff("onPointerLeave",["pointerout","pointerover"]);ph("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ph("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ph("onBeforeInput",["compositionend","keypress","textInput","paste"]);ph("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ph("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ph("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wm));function e2(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,oX(r,e,void 0,t),t.currentTarget=null}function AU(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;e2(s,l,u),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,u=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;e2(s,l,u),i=c}}}if(eb)throw t=gE,eb=!1,gE=null,t}function vn(t,e){var n=e[EE];n===void 0&&(n=e[EE]=new Set);var r=t+"__bubble";n.has(r)||(kU(e,t,2,!1),n.add(r))}function y_(t,e,n){var r=0;e&&(r|=4),kU(n,t,r,e)}var yx="_reactListening"+Math.random().toString(36).slice(2);function Wg(t){if(!t[yx]){t[yx]=!0,L$.forEach(function(n){n!=="selectionchange"&&(cJ.has(n)||y_(n,!1,t),y_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[yx]||(e[yx]=!0,y_("selectionchange",!1,e))}}function kU(t,e,n,r){switch(fU(e)){case 1:var s=SX;break;case 4:s=_X;break;default:s=wA}n=s.bind(null,e,n,t),s=void 0,!mE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function v_(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=od(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}Z$(function(){var u=i,d=yA(n),h=[];e:{var f=TU.get(t);if(f!==void 0){var p=SA,m=t;switch(t){case"keypress":if(b0(n)===0)break e;case"keydown":case"keyup":p=BX;break;case"focusin":m="focus",p=d_;break;case"focusout":m="blur",p=d_;break;case"beforeblur":case"afterblur":p=d_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=UD;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=CX;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=UX;break;case _U:case jU:case EU:p=kX;break;case CU:p=HX;break;case"scroll":p=jX;break;case"wheel":p=qX;break;case"copy":case"cut":case"paste":p=PX;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=HD}var g=(e&4)!==0,y=!g&&t==="scroll",x=g?f!==null?f+"Capture":null:f;g=[];for(var w=u,N;w!==null;){N=w;var S=N.stateNode;if(N.tag===5&&S!==null&&(N=S,x!==null&&(S=Bg(w,x),S!=null&&g.push(qg(w,S,N)))),y)break;w=w.return}0<g.length&&(f=new p(f,m,null,n,d),h.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==fE&&(m=n.relatedTarget||n.fromElement)&&(od(m)||m[_l]))break e;if((p||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?od(m):null,m!==null&&(y=mh(m),m!==y||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(g=UD,S="onMouseLeave",x="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(g=HD,S="onPointerLeave",x="onPointerEnter",w="pointer"),y=p==null?f:af(p),N=m==null?f:af(m),f=new g(S,w+"leave",p,n,d),f.target=y,f.relatedTarget=N,S=null,od(d)===u&&(g=new g(x,w+"enter",m,n,d),g.target=N,g.relatedTarget=y,S=g),y=S,p&&m)t:{for(g=p,x=m,w=0,N=g;N;N=kh(N))w++;for(N=0,S=x;S;S=kh(S))N++;for(;0<w-N;)g=kh(g),w--;for(;0<N-w;)x=kh(x),N--;for(;w--;){if(g===x||x!==null&&g===x.alternate)break t;g=kh(g),x=kh(x)}g=null}else g=null;p!==null&&t2(h,f,p,g,!1),m!==null&&y!==null&&t2(h,y,m,g,!0)}}e:{if(f=u?af(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var C=ZX;else if(GD(f))if(xU)C=rJ;else{C=tJ;var A=eJ}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=nJ);if(C&&(C=C(t,u))){vU(h,C,n,d);break e}A&&A(t,f,u),t==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&lE(f,"number",f.value)}switch(A=u?af(u):window,t){case"focusin":(GD(A)||A.contentEditable==="true")&&(rf=A,bE=u,cg=null);break;case"focusout":cg=bE=rf=null;break;case"mousedown":wE=!0;break;case"contextmenu":case"mouseup":case"dragend":wE=!1,JD(h,n,d);break;case"selectionchange":if(aJ)break;case"keydown":case"keyup":JD(h,n,d)}var j;if(jA)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else nf?gU(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(mU&&n.locale!=="ko"&&(nf||_!=="onCompositionStart"?_==="onCompositionEnd"&&nf&&(j=pU()):(Ac=d,NA="value"in Ac?Ac.value:Ac.textContent,nf=!0)),A=ib(u,_),0<A.length&&(_=new zD(_,t,null,n,d),h.push({event:_,listeners:A}),j?_.data=j:(j=yU(n),j!==null&&(_.data=j)))),(j=KX?YX(t,n):QX(t,n))&&(u=ib(u,"onBeforeInput"),0<u.length&&(d=new zD("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=j))}AU(h,e)})}function qg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ib(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Bg(t,n),i!=null&&r.unshift(qg(t,i,s)),i=Bg(t,e),i!=null&&r.push(qg(t,i,s))),t=t.return}return r}function kh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function t2(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&u!==null&&(l=u,s?(c=Bg(n,i),c!=null&&a.unshift(qg(n,c,l))):s||(c=Bg(n,i),c!=null&&a.push(qg(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var uJ=/\r\n?/g,dJ=/\u0000|\uFFFD/g;function n2(t){return(typeof t=="string"?t:""+t).replace(uJ,`
`).replace(dJ,"")}function vx(t,e,n){if(e=n2(e),n2(t)!==e&&n)throw Error(je(425))}function ab(){}var NE=null,SE=null;function _E(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jE=typeof setTimeout=="function"?setTimeout:void 0,hJ=typeof clearTimeout=="function"?clearTimeout:void 0,r2=typeof Promise=="function"?Promise:void 0,fJ=typeof queueMicrotask=="function"?queueMicrotask:typeof r2<"u"?function(t){return r2.resolve(null).then(t).catch(pJ)}:jE;function pJ(t){setTimeout(function(){throw t})}function x_(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Ug(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Ug(e)}function $c(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function s2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var kp=Math.random().toString(36).slice(2),ho="__reactFiber$"+kp,Gg="__reactProps$"+kp,_l="__reactContainer$"+kp,EE="__reactEvents$"+kp,mJ="__reactListeners$"+kp,gJ="__reactHandles$"+kp;function od(t){var e=t[ho];if(e)return e;for(var n=t.parentNode;n;){if(e=n[_l]||n[ho]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=s2(t);t!==null;){if(n=t[ho])return n;t=s2(t)}return e}t=n,n=t.parentNode}return null}function Qy(t){return t=t[ho]||t[_l],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function af(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(je(33))}function B1(t){return t[Gg]||null}var CE=[],of=-1;function bu(t){return{current:t}}function Sn(t){0>of||(t.current=CE[of],CE[of]=null,of--)}function fn(t,e){of++,CE[of]=t.current,t.current=e}var ru={},Rs=bu(ru),vi=bu(!1),Pd=ru;function Bf(t,e){var n=t.type.contextTypes;if(!n)return ru;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function xi(t){return t=t.childContextTypes,t!=null}function ob(){Sn(vi),Sn(Rs)}function i2(t,e,n){if(Rs.current!==ru)throw Error(je(168));fn(Rs,e),fn(vi,n)}function IU(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(je(108,eX(t)||"Unknown",s));return Ln({},n,r)}function lb(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ru,Pd=Rs.current,fn(Rs,t),fn(vi,vi.current),!0}function a2(t,e,n){var r=t.stateNode;if(!r)throw Error(je(169));n?(t=IU(t,e,Pd),r.__reactInternalMemoizedMergedChildContext=t,Sn(vi),Sn(Rs),fn(Rs,t)):Sn(vi),fn(vi,n)}var tl=null,V1=!1,b_=!1;function PU(t){tl===null?tl=[t]:tl.push(t)}function yJ(t){V1=!0,PU(t)}function wu(){if(!b_&&tl!==null){b_=!0;var t=0,e=Zt;try{var n=tl;for(Zt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}tl=null,V1=!1}catch(s){throw tl!==null&&(tl=tl.slice(t+1)),rU(vA,wu),s}finally{Zt=e,b_=!1}}return null}var lf=[],cf=0,cb=null,ub=0,ha=[],fa=0,Od=null,il=1,al="";function qu(t,e){lf[cf++]=ub,lf[cf++]=cb,cb=t,ub=e}function OU(t,e,n){ha[fa++]=il,ha[fa++]=al,ha[fa++]=Od,Od=t;var r=il;t=al;var s=32-Ha(r)-1;r&=~(1<<s),n+=1;var i=32-Ha(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,il=1<<32-Ha(e)+s|n<<s|r,al=i+t}else il=1<<i|n<<s|r,al=t}function CA(t){t.return!==null&&(qu(t,1),OU(t,1,0))}function TA(t){for(;t===cb;)cb=lf[--cf],lf[cf]=null,ub=lf[--cf],lf[cf]=null;for(;t===Od;)Od=ha[--fa],ha[fa]=null,al=ha[--fa],ha[fa]=null,il=ha[--fa],ha[fa]=null}var Bi=null,Ri=null,Tn=!1,Fa=null;function DU(t,e){var n=ma(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function o2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Bi=t,Ri=$c(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Bi=t,Ri=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Od!==null?{id:il,overflow:al}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ma(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Bi=t,Ri=null,!0):!1;default:return!1}}function TE(t){return(t.mode&1)!==0&&(t.flags&128)===0}function AE(t){if(Tn){var e=Ri;if(e){var n=e;if(!o2(t,e)){if(TE(t))throw Error(je(418));e=$c(n.nextSibling);var r=Bi;e&&o2(t,e)?DU(r,n):(t.flags=t.flags&-4097|2,Tn=!1,Bi=t)}}else{if(TE(t))throw Error(je(418));t.flags=t.flags&-4097|2,Tn=!1,Bi=t}}}function l2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Bi=t}function xx(t){if(t!==Bi)return!1;if(!Tn)return l2(t),Tn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_E(t.type,t.memoizedProps)),e&&(e=Ri)){if(TE(t))throw RU(),Error(je(418));for(;e;)DU(t,e),e=$c(e.nextSibling)}if(l2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(je(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ri=$c(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ri=null}}else Ri=Bi?$c(t.stateNode.nextSibling):null;return!0}function RU(){for(var t=Ri;t;)t=$c(t.nextSibling)}function Vf(){Ri=Bi=null,Tn=!1}function AA(t){Fa===null?Fa=[t]:Fa.push(t)}var vJ=Vl.ReactCurrentBatchConfig;function ym(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(je(309));var r=n.stateNode}if(!r)throw Error(je(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(je(284));if(!n._owner)throw Error(je(290,t))}return t}function bx(t,e){throw t=Object.prototype.toString.call(e),Error(je(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function c2(t){var e=t._init;return e(t._payload)}function MU(t){function e(x,w){if(t){var N=x.deletions;N===null?(x.deletions=[w],x.flags|=16):N.push(w)}}function n(x,w){if(!t)return null;for(;w!==null;)e(x,w),w=w.sibling;return null}function r(x,w){for(x=new Map;w!==null;)w.key!==null?x.set(w.key,w):x.set(w.index,w),w=w.sibling;return x}function s(x,w){return x=Wc(x,w),x.index=0,x.sibling=null,x}function i(x,w,N){return x.index=N,t?(N=x.alternate,N!==null?(N=N.index,N<w?(x.flags|=2,w):N):(x.flags|=2,w)):(x.flags|=1048576,w)}function a(x){return t&&x.alternate===null&&(x.flags|=2),x}function l(x,w,N,S){return w===null||w.tag!==6?(w=C_(N,x.mode,S),w.return=x,w):(w=s(w,N),w.return=x,w)}function c(x,w,N,S){var C=N.type;return C===tf?d(x,w,N.props.children,S,N.key):w!==null&&(w.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===cc&&c2(C)===w.type)?(S=s(w,N.props),S.ref=ym(x,w,N),S.return=x,S):(S=C0(N.type,N.key,N.props,null,x.mode,S),S.ref=ym(x,w,N),S.return=x,S)}function u(x,w,N,S){return w===null||w.tag!==4||w.stateNode.containerInfo!==N.containerInfo||w.stateNode.implementation!==N.implementation?(w=T_(N,x.mode,S),w.return=x,w):(w=s(w,N.children||[]),w.return=x,w)}function d(x,w,N,S,C){return w===null||w.tag!==7?(w=xd(N,x.mode,S,C),w.return=x,w):(w=s(w,N),w.return=x,w)}function h(x,w,N){if(typeof w=="string"&&w!==""||typeof w=="number")return w=C_(""+w,x.mode,N),w.return=x,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case cx:return N=C0(w.type,w.key,w.props,null,x.mode,N),N.ref=ym(x,null,w),N.return=x,N;case ef:return w=T_(w,x.mode,N),w.return=x,w;case cc:var S=w._init;return h(x,S(w._payload),N)}if(zm(w)||hm(w))return w=xd(w,x.mode,N,null),w.return=x,w;bx(x,w)}return null}function f(x,w,N,S){var C=w!==null?w.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return C!==null?null:l(x,w,""+N,S);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case cx:return N.key===C?c(x,w,N,S):null;case ef:return N.key===C?u(x,w,N,S):null;case cc:return C=N._init,f(x,w,C(N._payload),S)}if(zm(N)||hm(N))return C!==null?null:d(x,w,N,S,null);bx(x,N)}return null}function p(x,w,N,S,C){if(typeof S=="string"&&S!==""||typeof S=="number")return x=x.get(N)||null,l(w,x,""+S,C);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case cx:return x=x.get(S.key===null?N:S.key)||null,c(w,x,S,C);case ef:return x=x.get(S.key===null?N:S.key)||null,u(w,x,S,C);case cc:var A=S._init;return p(x,w,N,A(S._payload),C)}if(zm(S)||hm(S))return x=x.get(N)||null,d(w,x,S,C,null);bx(w,S)}return null}function m(x,w,N,S){for(var C=null,A=null,j=w,_=w=0,E=null;j!==null&&_<N.length;_++){j.index>_?(E=j,j=null):E=j.sibling;var I=f(x,j,N[_],S);if(I===null){j===null&&(j=E);break}t&&j&&I.alternate===null&&e(x,j),w=i(I,w,_),A===null?C=I:A.sibling=I,A=I,j=E}if(_===N.length)return n(x,j),Tn&&qu(x,_),C;if(j===null){for(;_<N.length;_++)j=h(x,N[_],S),j!==null&&(w=i(j,w,_),A===null?C=j:A.sibling=j,A=j);return Tn&&qu(x,_),C}for(j=r(x,j);_<N.length;_++)E=p(j,x,_,N[_],S),E!==null&&(t&&E.alternate!==null&&j.delete(E.key===null?_:E.key),w=i(E,w,_),A===null?C=E:A.sibling=E,A=E);return t&&j.forEach(function(T){return e(x,T)}),Tn&&qu(x,_),C}function g(x,w,N,S){var C=hm(N);if(typeof C!="function")throw Error(je(150));if(N=C.call(N),N==null)throw Error(je(151));for(var A=C=null,j=w,_=w=0,E=null,I=N.next();j!==null&&!I.done;_++,I=N.next()){j.index>_?(E=j,j=null):E=j.sibling;var T=f(x,j,I.value,S);if(T===null){j===null&&(j=E);break}t&&j&&T.alternate===null&&e(x,j),w=i(T,w,_),A===null?C=T:A.sibling=T,A=T,j=E}if(I.done)return n(x,j),Tn&&qu(x,_),C;if(j===null){for(;!I.done;_++,I=N.next())I=h(x,I.value,S),I!==null&&(w=i(I,w,_),A===null?C=I:A.sibling=I,A=I);return Tn&&qu(x,_),C}for(j=r(x,j);!I.done;_++,I=N.next())I=p(j,x,_,I.value,S),I!==null&&(t&&I.alternate!==null&&j.delete(I.key===null?_:I.key),w=i(I,w,_),A===null?C=I:A.sibling=I,A=I);return t&&j.forEach(function(P){return e(x,P)}),Tn&&qu(x,_),C}function y(x,w,N,S){if(typeof N=="object"&&N!==null&&N.type===tf&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case cx:e:{for(var C=N.key,A=w;A!==null;){if(A.key===C){if(C=N.type,C===tf){if(A.tag===7){n(x,A.sibling),w=s(A,N.props.children),w.return=x,x=w;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===cc&&c2(C)===A.type){n(x,A.sibling),w=s(A,N.props),w.ref=ym(x,A,N),w.return=x,x=w;break e}n(x,A);break}else e(x,A);A=A.sibling}N.type===tf?(w=xd(N.props.children,x.mode,S,N.key),w.return=x,x=w):(S=C0(N.type,N.key,N.props,null,x.mode,S),S.ref=ym(x,w,N),S.return=x,x=S)}return a(x);case ef:e:{for(A=N.key;w!==null;){if(w.key===A)if(w.tag===4&&w.stateNode.containerInfo===N.containerInfo&&w.stateNode.implementation===N.implementation){n(x,w.sibling),w=s(w,N.children||[]),w.return=x,x=w;break e}else{n(x,w);break}else e(x,w);w=w.sibling}w=T_(N,x.mode,S),w.return=x,x=w}return a(x);case cc:return A=N._init,y(x,w,A(N._payload),S)}if(zm(N))return m(x,w,N,S);if(hm(N))return g(x,w,N,S);bx(x,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,w!==null&&w.tag===6?(n(x,w.sibling),w=s(w,N),w.return=x,x=w):(n(x,w),w=C_(N,x.mode,S),w.return=x,x=w),a(x)):n(x,w)}return y}var $f=MU(!0),LU=MU(!1),db=bu(null),hb=null,uf=null,kA=null;function IA(){kA=uf=hb=null}function PA(t){var e=db.current;Sn(db),t._currentValue=e}function kE(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Sf(t,e){hb=t,kA=uf=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(di=!0),t.firstContext=null)}function _a(t){var e=t._currentValue;if(kA!==t)if(t={context:t,memoizedValue:e,next:null},uf===null){if(hb===null)throw Error(je(308));uf=t,hb.dependencies={lanes:0,firstContext:t}}else uf=uf.next=t;return e}var ld=null;function OA(t){ld===null?ld=[t]:ld.push(t)}function FU(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,OA(e)):(n.next=s.next,s.next=n),e.interleaved=n,jl(t,r)}function jl(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var uc=!1;function DA(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BU(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Uc(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Vt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,jl(t,n)}return s=r.interleaved,s===null?(e.next=e,OA(r)):(e.next=s.next,s.next=e),r.interleaved=e,jl(t,n)}function w0(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,xA(t,n)}}function u2(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function fb(t,e,n,r){var s=t.updateQueue;uc=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,u=c.next;c.next=null,a===null?i=u:a.next=u,a=c;var d=t.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==a&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;a=0,d=u=c=null,l=i;do{var f=l.lane,p=l.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=t,g=l;switch(f=e,p=n,g.tag){case 1:if(m=g.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=Ln({},h,f);break e;case 2:uc=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=p,c=h):d=d.next=p,a|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(d===null&&(c=h),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Rd|=a,t.lanes=a,t.memoizedState=h}}function d2(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(je(191,s));s.call(r)}}}var Xy={},No=bu(Xy),Kg=bu(Xy),Yg=bu(Xy);function cd(t){if(t===Xy)throw Error(je(174));return t}function RA(t,e){switch(fn(Yg,e),fn(Kg,t),fn(No,Xy),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:uE(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=uE(e,t)}Sn(No),fn(No,e)}function Uf(){Sn(No),Sn(Kg),Sn(Yg)}function VU(t){cd(Yg.current);var e=cd(No.current),n=uE(e,t.type);e!==n&&(fn(Kg,t),fn(No,n))}function MA(t){Kg.current===t&&(Sn(No),Sn(Kg))}var Dn=bu(0);function pb(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var w_=[];function LA(){for(var t=0;t<w_.length;t++)w_[t]._workInProgressVersionPrimary=null;w_.length=0}var N0=Vl.ReactCurrentDispatcher,N_=Vl.ReactCurrentBatchConfig,Dd=0,Rn=null,Sr=null,Mr=null,mb=!1,ug=!1,Qg=0,xJ=0;function js(){throw Error(je(321))}function FA(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ka(t[n],e[n]))return!1;return!0}function BA(t,e,n,r,s,i){if(Dd=i,Rn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,N0.current=t===null||t.memoizedState===null?SJ:_J,t=n(r,s),ug){i=0;do{if(ug=!1,Qg=0,25<=i)throw Error(je(301));i+=1,Mr=Sr=null,e.updateQueue=null,N0.current=jJ,t=n(r,s)}while(ug)}if(N0.current=gb,e=Sr!==null&&Sr.next!==null,Dd=0,Mr=Sr=Rn=null,mb=!1,e)throw Error(je(300));return t}function VA(){var t=Qg!==0;return Qg=0,t}function ao(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mr===null?Rn.memoizedState=Mr=t:Mr=Mr.next=t,Mr}function ja(){if(Sr===null){var t=Rn.alternate;t=t!==null?t.memoizedState:null}else t=Sr.next;var e=Mr===null?Rn.memoizedState:Mr.next;if(e!==null)Mr=e,Sr=t;else{if(t===null)throw Error(je(310));Sr=t,t={memoizedState:Sr.memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},Mr===null?Rn.memoizedState=Mr=t:Mr=Mr.next=t}return Mr}function Xg(t,e){return typeof e=="function"?e(t):e}function S_(t){var e=ja(),n=e.queue;if(n===null)throw Error(je(311));n.lastRenderedReducer=t;var r=Sr,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,u=i;do{var d=u.lane;if((Dd&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,a=r):c=c.next=h,Rn.lanes|=d,Rd|=d}u=u.next}while(u!==null&&u!==i);c===null?a=r:c.next=l,Ka(r,e.memoizedState)||(di=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Rn.lanes|=i,Rd|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function __(t){var e=ja(),n=e.queue;if(n===null)throw Error(je(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Ka(i,e.memoizedState)||(di=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function $U(){}function UU(t,e){var n=Rn,r=ja(),s=e(),i=!Ka(r.memoizedState,s);if(i&&(r.memoizedState=s,di=!0),r=r.queue,$A(WU.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Mr!==null&&Mr.memoizedState.tag&1){if(n.flags|=2048,Jg(9,HU.bind(null,n,r,s,e),void 0,null),$r===null)throw Error(je(349));Dd&30||zU(n,e,s)}return s}function zU(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Rn.updateQueue,e===null?(e={lastEffect:null,stores:null},Rn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function HU(t,e,n,r){e.value=n,e.getSnapshot=r,qU(e)&&GU(t)}function WU(t,e,n){return n(function(){qU(e)&&GU(t)})}function qU(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ka(t,n)}catch{return!0}}function GU(t){var e=jl(t,1);e!==null&&Wa(e,t,1,-1)}function h2(t){var e=ao();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xg,lastRenderedState:t},e.queue=t,t=t.dispatch=NJ.bind(null,Rn,t),[e.memoizedState,t]}function Jg(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Rn.updateQueue,e===null?(e={lastEffect:null,stores:null},Rn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function KU(){return ja().memoizedState}function S0(t,e,n,r){var s=ao();Rn.flags|=t,s.memoizedState=Jg(1|e,n,void 0,r===void 0?null:r)}function $1(t,e,n,r){var s=ja();r=r===void 0?null:r;var i=void 0;if(Sr!==null){var a=Sr.memoizedState;if(i=a.destroy,r!==null&&FA(r,a.deps)){s.memoizedState=Jg(e,n,i,r);return}}Rn.flags|=t,s.memoizedState=Jg(1|e,n,i,r)}function f2(t,e){return S0(8390656,8,t,e)}function $A(t,e){return $1(2048,8,t,e)}function YU(t,e){return $1(4,2,t,e)}function QU(t,e){return $1(4,4,t,e)}function XU(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function JU(t,e,n){return n=n!=null?n.concat([t]):null,$1(4,4,XU.bind(null,e,t),n)}function UA(){}function ZU(t,e){var n=ja();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&FA(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function e3(t,e){var n=ja();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&FA(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function t3(t,e,n){return Dd&21?(Ka(n,e)||(n=aU(),Rn.lanes|=n,Rd|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,di=!0),t.memoizedState=n)}function bJ(t,e){var n=Zt;Zt=n!==0&&4>n?n:4,t(!0);var r=N_.transition;N_.transition={};try{t(!1),e()}finally{Zt=n,N_.transition=r}}function n3(){return ja().memoizedState}function wJ(t,e,n){var r=Hc(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},r3(t))s3(e,n);else if(n=FU(t,e,n,r),n!==null){var s=qs();Wa(n,t,r,s),i3(n,e,r)}}function NJ(t,e,n){var r=Hc(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(r3(t))s3(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Ka(l,a)){var c=e.interleaved;c===null?(s.next=s,OA(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=FU(t,e,s,r),n!==null&&(s=qs(),Wa(n,t,r,s),i3(n,e,r))}}function r3(t){var e=t.alternate;return t===Rn||e!==null&&e===Rn}function s3(t,e){ug=mb=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function i3(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,xA(t,n)}}var gb={readContext:_a,useCallback:js,useContext:js,useEffect:js,useImperativeHandle:js,useInsertionEffect:js,useLayoutEffect:js,useMemo:js,useReducer:js,useRef:js,useState:js,useDebugValue:js,useDeferredValue:js,useTransition:js,useMutableSource:js,useSyncExternalStore:js,useId:js,unstable_isNewReconciler:!1},SJ={readContext:_a,useCallback:function(t,e){return ao().memoizedState=[t,e===void 0?null:e],t},useContext:_a,useEffect:f2,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,S0(4194308,4,XU.bind(null,e,t),n)},useLayoutEffect:function(t,e){return S0(4194308,4,t,e)},useInsertionEffect:function(t,e){return S0(4,2,t,e)},useMemo:function(t,e){var n=ao();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ao();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=wJ.bind(null,Rn,t),[r.memoizedState,t]},useRef:function(t){var e=ao();return t={current:t},e.memoizedState=t},useState:h2,useDebugValue:UA,useDeferredValue:function(t){return ao().memoizedState=t},useTransition:function(){var t=h2(!1),e=t[0];return t=bJ.bind(null,t[1]),ao().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Rn,s=ao();if(Tn){if(n===void 0)throw Error(je(407));n=n()}else{if(n=e(),$r===null)throw Error(je(349));Dd&30||zU(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,f2(WU.bind(null,r,i,t),[t]),r.flags|=2048,Jg(9,HU.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=ao(),e=$r.identifierPrefix;if(Tn){var n=al,r=il;n=(r&~(1<<32-Ha(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Qg++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=xJ++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_J={readContext:_a,useCallback:ZU,useContext:_a,useEffect:$A,useImperativeHandle:JU,useInsertionEffect:YU,useLayoutEffect:QU,useMemo:e3,useReducer:S_,useRef:KU,useState:function(){return S_(Xg)},useDebugValue:UA,useDeferredValue:function(t){var e=ja();return t3(e,Sr.memoizedState,t)},useTransition:function(){var t=S_(Xg)[0],e=ja().memoizedState;return[t,e]},useMutableSource:$U,useSyncExternalStore:UU,useId:n3,unstable_isNewReconciler:!1},jJ={readContext:_a,useCallback:ZU,useContext:_a,useEffect:$A,useImperativeHandle:JU,useInsertionEffect:YU,useLayoutEffect:QU,useMemo:e3,useReducer:__,useRef:KU,useState:function(){return __(Xg)},useDebugValue:UA,useDeferredValue:function(t){var e=ja();return Sr===null?e.memoizedState=t:t3(e,Sr.memoizedState,t)},useTransition:function(){var t=__(Xg)[0],e=ja().memoizedState;return[t,e]},useMutableSource:$U,useSyncExternalStore:UU,useId:n3,unstable_isNewReconciler:!1};function Ma(t,e){if(t&&t.defaultProps){e=Ln({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function IE(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ln({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var U1={isMounted:function(t){return(t=t._reactInternals)?mh(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=qs(),s=Hc(t),i=gl(r,s);i.payload=e,n!=null&&(i.callback=n),e=Uc(t,i,s),e!==null&&(Wa(e,t,s,r),w0(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=qs(),s=Hc(t),i=gl(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Uc(t,i,s),e!==null&&(Wa(e,t,s,r),w0(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=qs(),r=Hc(t),s=gl(n,r);s.tag=2,e!=null&&(s.callback=e),e=Uc(t,s,r),e!==null&&(Wa(e,t,r,n),w0(e,t,r))}};function p2(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Hg(n,r)||!Hg(s,i):!0}function a3(t,e,n){var r=!1,s=ru,i=e.contextType;return typeof i=="object"&&i!==null?i=_a(i):(s=xi(e)?Pd:Rs.current,r=e.contextTypes,i=(r=r!=null)?Bf(t,s):ru),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=U1,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function m2(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&U1.enqueueReplaceState(e,e.state,null)}function PE(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},DA(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=_a(i):(i=xi(e)?Pd:Rs.current,s.context=Bf(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(IE(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&U1.enqueueReplaceState(s,s.state,null),fb(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function zf(t,e){try{var n="",r=e;do n+=ZQ(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function j_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function OE(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var EJ=typeof WeakMap=="function"?WeakMap:Map;function o3(t,e,n){n=gl(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){vb||(vb=!0,zE=r),OE(t,e)},n}function l3(t,e,n){n=gl(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){OE(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){OE(t,e),typeof r!="function"&&(zc===null?zc=new Set([this]):zc.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function g2(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new EJ;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=VJ.bind(null,t,e,n),e.then(t,t))}function y2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function v2(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=gl(-1,1),e.tag=2,Uc(n,e,1))),n.lanes|=1),t)}var CJ=Vl.ReactCurrentOwner,di=!1;function zs(t,e,n,r){e.child=t===null?LU(e,null,n,r):$f(e,t.child,n,r)}function x2(t,e,n,r,s){n=n.render;var i=e.ref;return Sf(e,s),r=BA(t,e,n,r,i,s),n=VA(),t!==null&&!di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,El(t,e,s)):(Tn&&n&&CA(e),e.flags|=1,zs(t,e,r,s),e.child)}function b2(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!QA(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,c3(t,e,i,r,s)):(t=C0(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Hg,n(a,r)&&t.ref===e.ref)return El(t,e,s)}return e.flags|=1,t=Wc(i,r),t.ref=e.ref,t.return=e,e.child=t}function c3(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Hg(i,r)&&t.ref===e.ref)if(di=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(di=!0);else return e.lanes=t.lanes,El(t,e,s)}return DE(t,e,n,r,s)}function u3(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},fn(hf,ki),ki|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,fn(hf,ki),ki|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,fn(hf,ki),ki|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,fn(hf,ki),ki|=r;return zs(t,e,s,n),e.child}function d3(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function DE(t,e,n,r,s){var i=xi(n)?Pd:Rs.current;return i=Bf(e,i),Sf(e,s),n=BA(t,e,n,r,i,s),r=VA(),t!==null&&!di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,El(t,e,s)):(Tn&&r&&CA(e),e.flags|=1,zs(t,e,n,s),e.child)}function w2(t,e,n,r,s){if(xi(n)){var i=!0;lb(e)}else i=!1;if(Sf(e,s),e.stateNode===null)_0(t,e),a3(e,n,r),PE(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=_a(u):(u=xi(n)?Pd:Rs.current,u=Bf(e,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==u)&&m2(e,a,r,u),uc=!1;var f=e.memoizedState;a.state=f,fb(e,r,a,s),c=e.memoizedState,l!==r||f!==c||vi.current||uc?(typeof d=="function"&&(IE(e,n,d,r),c=e.memoizedState),(l=uc||p2(e,n,l,r,f,c,u))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=u,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,BU(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:Ma(e.type,l),a.props=u,h=e.pendingProps,f=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=_a(c):(c=xi(n)?Pd:Rs.current,c=Bf(e,c));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==h||f!==c)&&m2(e,a,r,c),uc=!1,f=e.memoizedState,a.state=f,fb(e,r,a,s);var m=e.memoizedState;l!==h||f!==m||vi.current||uc?(typeof p=="function"&&(IE(e,n,p,r),m=e.memoizedState),(u=uc||p2(e,n,u,r,f,m,c)||!1)?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=c,r=u):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return RE(t,e,n,r,i,s)}function RE(t,e,n,r,s,i){d3(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&a2(e,n,!1),El(t,e,i);r=e.stateNode,CJ.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=$f(e,t.child,null,i),e.child=$f(e,null,l,i)):zs(t,e,l,i),e.memoizedState=r.state,s&&a2(e,n,!0),e.child}function h3(t){var e=t.stateNode;e.pendingContext?i2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&i2(t,e.context,!1),RA(t,e.containerInfo)}function N2(t,e,n,r,s){return Vf(),AA(s),e.flags|=256,zs(t,e,n,r),e.child}var ME={dehydrated:null,treeContext:null,retryLane:0};function LE(t){return{baseLanes:t,cachePool:null,transitions:null}}function f3(t,e,n){var r=e.pendingProps,s=Dn.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),fn(Dn,s&1),t===null)return AE(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=W1(a,r,0,null),t=xd(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=LE(n),e.memoizedState=ME,t):zA(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return TJ(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Wc(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Wc(l,i):(i=xd(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?LE(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=ME,r}return i=t.child,t=i.sibling,r=Wc(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function zA(t,e){return e=W1({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wx(t,e,n,r){return r!==null&&AA(r),$f(e,t.child,null,n),t=zA(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function TJ(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=j_(Error(je(422))),wx(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=W1({mode:"visible",children:r.children},s,0,null),i=xd(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&$f(e,t.child,null,a),e.child.memoizedState=LE(a),e.memoizedState=ME,i);if(!(e.mode&1))return wx(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(je(419)),r=j_(i,r,void 0),wx(t,e,a,r)}if(l=(a&t.childLanes)!==0,di||l){if(r=$r,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,jl(t,s),Wa(r,t,s,-1))}return YA(),r=j_(Error(je(421))),wx(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=$J.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Ri=$c(s.nextSibling),Bi=e,Tn=!0,Fa=null,t!==null&&(ha[fa++]=il,ha[fa++]=al,ha[fa++]=Od,il=t.id,al=t.overflow,Od=e),e=zA(e,r.children),e.flags|=4096,e)}function S2(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),kE(t.return,e,n)}function E_(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function p3(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(zs(t,e,r.children,n),r=Dn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&S2(t,n,e);else if(t.tag===19)S2(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(fn(Dn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&pb(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),E_(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&pb(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}E_(e,!0,n,null,i);break;case"together":E_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _0(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function El(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Rd|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(je(153));if(e.child!==null){for(t=e.child,n=Wc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Wc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function AJ(t,e,n){switch(e.tag){case 3:h3(e),Vf();break;case 5:VU(e);break;case 1:xi(e.type)&&lb(e);break;case 4:RA(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;fn(db,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(fn(Dn,Dn.current&1),e.flags|=128,null):n&e.child.childLanes?f3(t,e,n):(fn(Dn,Dn.current&1),t=El(t,e,n),t!==null?t.sibling:null);fn(Dn,Dn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return p3(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),fn(Dn,Dn.current),r)break;return null;case 22:case 23:return e.lanes=0,u3(t,e,n)}return El(t,e,n)}var m3,FE,g3,y3;m3=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};FE=function(){};g3=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,cd(No.current);var i=null;switch(n){case"input":s=aE(t,s),r=aE(t,r),i=[];break;case"select":s=Ln({},s,{value:void 0}),r=Ln({},r,{value:void 0}),i=[];break;case"textarea":s=cE(t,s),r=cE(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ab)}dE(n,r);var a;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var l=s[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Lg.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Lg.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&vn("scroll",t),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};y3=function(t,e,n,r){n!==r&&(e.flags|=4)};function vm(t,e){if(!Tn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Es(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function kJ(t,e,n){var r=e.pendingProps;switch(TA(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Es(e),null;case 1:return xi(e.type)&&ob(),Es(e),null;case 3:return r=e.stateNode,Uf(),Sn(vi),Sn(Rs),LA(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xx(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Fa!==null&&(qE(Fa),Fa=null))),FE(t,e),Es(e),null;case 5:MA(e);var s=cd(Yg.current);if(n=e.type,t!==null&&e.stateNode!=null)g3(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(je(166));return Es(e),null}if(t=cd(No.current),xx(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[ho]=e,r[Gg]=i,t=(e.mode&1)!==0,n){case"dialog":vn("cancel",r),vn("close",r);break;case"iframe":case"object":case"embed":vn("load",r);break;case"video":case"audio":for(s=0;s<Wm.length;s++)vn(Wm[s],r);break;case"source":vn("error",r);break;case"img":case"image":case"link":vn("error",r),vn("load",r);break;case"details":vn("toggle",r);break;case"input":PD(r,i),vn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},vn("invalid",r);break;case"textarea":DD(r,i),vn("invalid",r)}dE(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&vx(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&vx(r.textContent,l,t),s=["children",""+l]):Lg.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&vn("scroll",r)}switch(n){case"input":ux(r),OD(r,i,!0);break;case"textarea":ux(r),RD(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ab)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=W$(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[ho]=e,t[Gg]=r,m3(t,e,!1,!1),e.stateNode=t;e:{switch(a=hE(n,r),n){case"dialog":vn("cancel",t),vn("close",t),s=r;break;case"iframe":case"object":case"embed":vn("load",t),s=r;break;case"video":case"audio":for(s=0;s<Wm.length;s++)vn(Wm[s],t);s=r;break;case"source":vn("error",t),s=r;break;case"img":case"image":case"link":vn("error",t),vn("load",t),s=r;break;case"details":vn("toggle",t),s=r;break;case"input":PD(t,r),s=aE(t,r),vn("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ln({},r,{value:void 0}),vn("invalid",t);break;case"textarea":DD(t,r),s=cE(t,r),vn("invalid",t);break;default:s=r}dE(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?K$(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&q$(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Fg(t,c):typeof c=="number"&&Fg(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Lg.hasOwnProperty(i)?c!=null&&i==="onScroll"&&vn("scroll",t):c!=null&&fA(t,i,c,a))}switch(n){case"input":ux(t),OD(t,r,!1);break;case"textarea":ux(t),RD(t);break;case"option":r.value!=null&&t.setAttribute("value",""+nu(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?xf(t,!!r.multiple,i,!1):r.defaultValue!=null&&xf(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=ab)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Es(e),null;case 6:if(t&&e.stateNode!=null)y3(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(je(166));if(n=cd(Yg.current),cd(No.current),xx(e)){if(r=e.stateNode,n=e.memoizedProps,r[ho]=e,(i=r.nodeValue!==n)&&(t=Bi,t!==null))switch(t.tag){case 3:vx(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&vx(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ho]=e,e.stateNode=r}return Es(e),null;case 13:if(Sn(Dn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Tn&&Ri!==null&&e.mode&1&&!(e.flags&128))RU(),Vf(),e.flags|=98560,i=!1;else if(i=xx(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(je(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(je(317));i[ho]=e}else Vf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Es(e),i=!1}else Fa!==null&&(qE(Fa),Fa=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Dn.current&1?jr===0&&(jr=3):YA())),e.updateQueue!==null&&(e.flags|=4),Es(e),null);case 4:return Uf(),FE(t,e),t===null&&Wg(e.stateNode.containerInfo),Es(e),null;case 10:return PA(e.type._context),Es(e),null;case 17:return xi(e.type)&&ob(),Es(e),null;case 19:if(Sn(Dn),i=e.memoizedState,i===null)return Es(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)vm(i,!1);else{if(jr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=pb(t),a!==null){for(e.flags|=128,vm(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return fn(Dn,Dn.current&1|2),e.child}t=t.sibling}i.tail!==null&&er()>Hf&&(e.flags|=128,r=!0,vm(i,!1),e.lanes=4194304)}else{if(!r)if(t=pb(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vm(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Tn)return Es(e),null}else 2*er()-i.renderingStartTime>Hf&&n!==1073741824&&(e.flags|=128,r=!0,vm(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=er(),e.sibling=null,n=Dn.current,fn(Dn,r?n&1|2:n&1),e):(Es(e),null);case 22:case 23:return KA(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ki&1073741824&&(Es(e),e.subtreeFlags&6&&(e.flags|=8192)):Es(e),null;case 24:return null;case 25:return null}throw Error(je(156,e.tag))}function IJ(t,e){switch(TA(e),e.tag){case 1:return xi(e.type)&&ob(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Uf(),Sn(vi),Sn(Rs),LA(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return MA(e),null;case 13:if(Sn(Dn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(je(340));Vf()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Sn(Dn),null;case 4:return Uf(),null;case 10:return PA(e.type._context),null;case 22:case 23:return KA(),null;case 24:return null;default:return null}}var Nx=!1,Is=!1,PJ=typeof WeakSet=="function"?WeakSet:Set,ze=null;function df(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qn(t,e,r)}else n.current=null}function BE(t,e,n){try{n()}catch(r){qn(t,e,r)}}var _2=!1;function OJ(t,e){if(NE=rb,t=NU(),EA(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var p;h!==n||s!==0&&h.nodeType!==3||(l=a+s),h!==i||r!==0&&h.nodeType!==3||(c=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===t)break t;if(f===n&&++u===s&&(l=a),f===i&&++d===r&&(c=a),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(SE={focusedElem:t,selectionRange:n},rb=!1,ze=e;ze!==null;)if(e=ze,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ze=t;else for(;ze!==null;){e=ze;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,y=m.memoizedState,x=e.stateNode,w=x.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ma(e.type,g),y);x.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(je(163))}}catch(S){qn(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,ze=t;break}ze=e.return}return m=_2,_2=!1,m}function dg(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&BE(e,n,i)}s=s.next}while(s!==r)}}function z1(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function VE(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function v3(t){var e=t.alternate;e!==null&&(t.alternate=null,v3(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ho],delete e[Gg],delete e[EE],delete e[mJ],delete e[gJ])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function x3(t){return t.tag===5||t.tag===3||t.tag===4}function j2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||x3(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $E(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ab));else if(r!==4&&(t=t.child,t!==null))for($E(t,e,n),t=t.sibling;t!==null;)$E(t,e,n),t=t.sibling}function UE(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(UE(t,e,n),t=t.sibling;t!==null;)UE(t,e,n),t=t.sibling}var ss=null,La=!1;function nc(t,e,n){for(n=n.child;n!==null;)b3(t,e,n),n=n.sibling}function b3(t,e,n){if(wo&&typeof wo.onCommitFiberUnmount=="function")try{wo.onCommitFiberUnmount(R1,n)}catch{}switch(n.tag){case 5:Is||df(n,e);case 6:var r=ss,s=La;ss=null,nc(t,e,n),ss=r,La=s,ss!==null&&(La?(t=ss,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ss.removeChild(n.stateNode));break;case 18:ss!==null&&(La?(t=ss,n=n.stateNode,t.nodeType===8?x_(t.parentNode,n):t.nodeType===1&&x_(t,n),Ug(t)):x_(ss,n.stateNode));break;case 4:r=ss,s=La,ss=n.stateNode.containerInfo,La=!0,nc(t,e,n),ss=r,La=s;break;case 0:case 11:case 14:case 15:if(!Is&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&BE(n,e,a),s=s.next}while(s!==r)}nc(t,e,n);break;case 1:if(!Is&&(df(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){qn(n,e,l)}nc(t,e,n);break;case 21:nc(t,e,n);break;case 22:n.mode&1?(Is=(r=Is)||n.memoizedState!==null,nc(t,e,n),Is=r):nc(t,e,n);break;default:nc(t,e,n)}}function E2(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new PJ),e.forEach(function(r){var s=UJ.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Ra(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:ss=l.stateNode,La=!1;break e;case 3:ss=l.stateNode.containerInfo,La=!0;break e;case 4:ss=l.stateNode.containerInfo,La=!0;break e}l=l.return}if(ss===null)throw Error(je(160));b3(i,a,s),ss=null,La=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){qn(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)w3(e,t),e=e.sibling}function w3(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ra(e,t),to(t),r&4){try{dg(3,t,t.return),z1(3,t)}catch(g){qn(t,t.return,g)}try{dg(5,t,t.return)}catch(g){qn(t,t.return,g)}}break;case 1:Ra(e,t),to(t),r&512&&n!==null&&df(n,n.return);break;case 5:if(Ra(e,t),to(t),r&512&&n!==null&&df(n,n.return),t.flags&32){var s=t.stateNode;try{Fg(s,"")}catch(g){qn(t,t.return,g)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&z$(s,i),hE(l,a);var u=hE(l,i);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];d==="style"?K$(s,h):d==="dangerouslySetInnerHTML"?q$(s,h):d==="children"?Fg(s,h):fA(s,d,h,u)}switch(l){case"input":oE(s,i);break;case"textarea":H$(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?xf(s,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?xf(s,!!i.multiple,i.defaultValue,!0):xf(s,!!i.multiple,i.multiple?[]:"",!1))}s[Gg]=i}catch(g){qn(t,t.return,g)}}break;case 6:if(Ra(e,t),to(t),r&4){if(t.stateNode===null)throw Error(je(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(g){qn(t,t.return,g)}}break;case 3:if(Ra(e,t),to(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ug(e.containerInfo)}catch(g){qn(t,t.return,g)}break;case 4:Ra(e,t),to(t);break;case 13:Ra(e,t),to(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(qA=er())),r&4&&E2(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(Is=(u=Is)||d,Ra(e,t),Is=u):Ra(e,t),to(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(ze=t,d=t.child;d!==null;){for(h=ze=d;ze!==null;){switch(f=ze,p=f.child,f.tag){case 0:case 11:case 14:case 15:dg(4,f,f.return);break;case 1:df(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){qn(r,n,g)}}break;case 5:df(f,f.return);break;case 22:if(f.memoizedState!==null){T2(h);continue}}p!==null?(p.return=f,ze=p):T2(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=G$("display",a))}catch(g){qn(t,t.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){qn(t,t.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ra(e,t),to(t),r&4&&E2(t);break;case 21:break;default:Ra(e,t),to(t)}}function to(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(x3(n)){var r=n;break e}n=n.return}throw Error(je(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Fg(s,""),r.flags&=-33);var i=j2(t);UE(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=j2(t);$E(t,l,a);break;default:throw Error(je(161))}}catch(c){qn(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function DJ(t,e,n){ze=t,N3(t)}function N3(t,e,n){for(var r=(t.mode&1)!==0;ze!==null;){var s=ze,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Nx;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Is;l=Nx;var u=Is;if(Nx=a,(Is=c)&&!u)for(ze=s;ze!==null;)a=ze,c=a.child,a.tag===22&&a.memoizedState!==null?A2(s):c!==null?(c.return=a,ze=c):A2(s);for(;i!==null;)ze=i,N3(i),i=i.sibling;ze=s,Nx=l,Is=u}C2(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ze=i):C2(t)}}function C2(t){for(;ze!==null;){var e=ze;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Is||z1(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Is)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Ma(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&d2(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}d2(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&Ug(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(je(163))}Is||e.flags&512&&VE(e)}catch(f){qn(e,e.return,f)}}if(e===t){ze=null;break}if(n=e.sibling,n!==null){n.return=e.return,ze=n;break}ze=e.return}}function T2(t){for(;ze!==null;){var e=ze;if(e===t){ze=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ze=n;break}ze=e.return}}function A2(t){for(;ze!==null;){var e=ze;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{z1(4,e)}catch(c){qn(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){qn(e,s,c)}}var i=e.return;try{VE(e)}catch(c){qn(e,i,c)}break;case 5:var a=e.return;try{VE(e)}catch(c){qn(e,a,c)}}}catch(c){qn(e,e.return,c)}if(e===t){ze=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ze=l;break}ze=e.return}}var RJ=Math.ceil,yb=Vl.ReactCurrentDispatcher,HA=Vl.ReactCurrentOwner,va=Vl.ReactCurrentBatchConfig,Vt=0,$r=null,ur=null,gs=0,ki=0,hf=bu(0),jr=0,Zg=null,Rd=0,H1=0,WA=0,hg=null,ci=null,qA=0,Hf=1/0,Zo=null,vb=!1,zE=null,zc=null,Sx=!1,kc=null,xb=0,fg=0,HE=null,j0=-1,E0=0;function qs(){return Vt&6?er():j0!==-1?j0:j0=er()}function Hc(t){return t.mode&1?Vt&2&&gs!==0?gs&-gs:vJ.transition!==null?(E0===0&&(E0=aU()),E0):(t=Zt,t!==0||(t=window.event,t=t===void 0?16:fU(t.type)),t):1}function Wa(t,e,n,r){if(50<fg)throw fg=0,HE=null,Error(je(185));Ky(t,n,r),(!(Vt&2)||t!==$r)&&(t===$r&&(!(Vt&2)&&(H1|=n),jr===4&&yc(t,gs)),bi(t,r),n===1&&Vt===0&&!(e.mode&1)&&(Hf=er()+500,V1&&wu()))}function bi(t,e){var n=t.callbackNode;vX(t,e);var r=nb(t,t===$r?gs:0);if(r===0)n!==null&&FD(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&FD(n),e===1)t.tag===0?yJ(k2.bind(null,t)):PU(k2.bind(null,t)),fJ(function(){!(Vt&6)&&wu()}),n=null;else{switch(oU(r)){case 1:n=vA;break;case 4:n=sU;break;case 16:n=tb;break;case 536870912:n=iU;break;default:n=tb}n=k3(n,S3.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function S3(t,e){if(j0=-1,E0=0,Vt&6)throw Error(je(327));var n=t.callbackNode;if(_f()&&t.callbackNode!==n)return null;var r=nb(t,t===$r?gs:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=bb(t,r);else{e=r;var s=Vt;Vt|=2;var i=j3();($r!==t||gs!==e)&&(Zo=null,Hf=er()+500,vd(t,e));do try{FJ();break}catch(l){_3(t,l)}while(!0);IA(),yb.current=i,Vt=s,ur!==null?e=0:($r=null,gs=0,e=jr)}if(e!==0){if(e===2&&(s=yE(t),s!==0&&(r=s,e=WE(t,s))),e===1)throw n=Zg,vd(t,0),yc(t,r),bi(t,er()),n;if(e===6)yc(t,r);else{if(s=t.current.alternate,!(r&30)&&!MJ(s)&&(e=bb(t,r),e===2&&(i=yE(t),i!==0&&(r=i,e=WE(t,i))),e===1))throw n=Zg,vd(t,0),yc(t,r),bi(t,er()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(je(345));case 2:Gu(t,ci,Zo);break;case 3:if(yc(t,r),(r&130023424)===r&&(e=qA+500-er(),10<e)){if(nb(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){qs(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=jE(Gu.bind(null,t,ci,Zo),e);break}Gu(t,ci,Zo);break;case 4:if(yc(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Ha(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=er()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*RJ(r/1960))-r,10<r){t.timeoutHandle=jE(Gu.bind(null,t,ci,Zo),r);break}Gu(t,ci,Zo);break;case 5:Gu(t,ci,Zo);break;default:throw Error(je(329))}}}return bi(t,er()),t.callbackNode===n?S3.bind(null,t):null}function WE(t,e){var n=hg;return t.current.memoizedState.isDehydrated&&(vd(t,e).flags|=256),t=bb(t,e),t!==2&&(e=ci,ci=n,e!==null&&qE(e)),t}function qE(t){ci===null?ci=t:ci.push.apply(ci,t)}function MJ(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Ka(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function yc(t,e){for(e&=~WA,e&=~H1,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ha(e),r=1<<n;t[n]=-1,e&=~r}}function k2(t){if(Vt&6)throw Error(je(327));_f();var e=nb(t,0);if(!(e&1))return bi(t,er()),null;var n=bb(t,e);if(t.tag!==0&&n===2){var r=yE(t);r!==0&&(e=r,n=WE(t,r))}if(n===1)throw n=Zg,vd(t,0),yc(t,e),bi(t,er()),n;if(n===6)throw Error(je(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Gu(t,ci,Zo),bi(t,er()),null}function GA(t,e){var n=Vt;Vt|=1;try{return t(e)}finally{Vt=n,Vt===0&&(Hf=er()+500,V1&&wu())}}function Md(t){kc!==null&&kc.tag===0&&!(Vt&6)&&_f();var e=Vt;Vt|=1;var n=va.transition,r=Zt;try{if(va.transition=null,Zt=1,t)return t()}finally{Zt=r,va.transition=n,Vt=e,!(Vt&6)&&wu()}}function KA(){ki=hf.current,Sn(hf)}function vd(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hJ(n)),ur!==null)for(n=ur.return;n!==null;){var r=n;switch(TA(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ob();break;case 3:Uf(),Sn(vi),Sn(Rs),LA();break;case 5:MA(r);break;case 4:Uf();break;case 13:Sn(Dn);break;case 19:Sn(Dn);break;case 10:PA(r.type._context);break;case 22:case 23:KA()}n=n.return}if($r=t,ur=t=Wc(t.current,null),gs=ki=e,jr=0,Zg=null,WA=H1=Rd=0,ci=hg=null,ld!==null){for(e=0;e<ld.length;e++)if(n=ld[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}ld=null}return t}function _3(t,e){do{var n=ur;try{if(IA(),N0.current=gb,mb){for(var r=Rn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}mb=!1}if(Dd=0,Mr=Sr=Rn=null,ug=!1,Qg=0,HA.current=null,n===null||n.return===null){jr=1,Zg=e,ur=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=gs,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=y2(a);if(p!==null){p.flags&=-257,v2(p,a,l,i,e),p.mode&1&&g2(i,u,e),e=p,c=u;var m=e.updateQueue;if(m===null){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break e}else{if(!(e&1)){g2(i,u,e),YA();break e}c=Error(je(426))}}else if(Tn&&l.mode&1){var y=y2(a);if(y!==null){!(y.flags&65536)&&(y.flags|=256),v2(y,a,l,i,e),AA(zf(c,l));break e}}i=c=zf(c,l),jr!==4&&(jr=2),hg===null?hg=[i]:hg.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=o3(i,c,e);u2(i,x);break e;case 1:l=c;var w=i.type,N=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(zc===null||!zc.has(N)))){i.flags|=65536,e&=-e,i.lanes|=e;var S=l3(i,l,e);u2(i,S);break e}}i=i.return}while(i!==null)}C3(n)}catch(C){e=C,ur===n&&n!==null&&(ur=n=n.return);continue}break}while(!0)}function j3(){var t=yb.current;return yb.current=gb,t===null?gb:t}function YA(){(jr===0||jr===3||jr===2)&&(jr=4),$r===null||!(Rd&268435455)&&!(H1&268435455)||yc($r,gs)}function bb(t,e){var n=Vt;Vt|=2;var r=j3();($r!==t||gs!==e)&&(Zo=null,vd(t,e));do try{LJ();break}catch(s){_3(t,s)}while(!0);if(IA(),Vt=n,yb.current=r,ur!==null)throw Error(je(261));return $r=null,gs=0,jr}function LJ(){for(;ur!==null;)E3(ur)}function FJ(){for(;ur!==null&&!cX();)E3(ur)}function E3(t){var e=A3(t.alternate,t,ki);t.memoizedProps=t.pendingProps,e===null?C3(t):ur=e,HA.current=null}function C3(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=IJ(n,e),n!==null){n.flags&=32767,ur=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{jr=6,ur=null;return}}else if(n=kJ(n,e,ki),n!==null){ur=n;return}if(e=e.sibling,e!==null){ur=e;return}ur=e=t}while(e!==null);jr===0&&(jr=5)}function Gu(t,e,n){var r=Zt,s=va.transition;try{va.transition=null,Zt=1,BJ(t,e,n,r)}finally{va.transition=s,Zt=r}return null}function BJ(t,e,n,r){do _f();while(kc!==null);if(Vt&6)throw Error(je(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(je(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(xX(t,i),t===$r&&(ur=$r=null,gs=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Sx||(Sx=!0,k3(tb,function(){return _f(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=va.transition,va.transition=null;var a=Zt;Zt=1;var l=Vt;Vt|=4,HA.current=null,OJ(t,n),w3(n,t),iJ(SE),rb=!!NE,SE=NE=null,t.current=n,DJ(n),uX(),Vt=l,Zt=a,va.transition=i}else t.current=n;if(Sx&&(Sx=!1,kc=t,xb=s),i=t.pendingLanes,i===0&&(zc=null),fX(n.stateNode),bi(t,er()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(vb)throw vb=!1,t=zE,zE=null,t;return xb&1&&t.tag!==0&&_f(),i=t.pendingLanes,i&1?t===HE?fg++:(fg=0,HE=t):fg=0,wu(),null}function _f(){if(kc!==null){var t=oU(xb),e=va.transition,n=Zt;try{if(va.transition=null,Zt=16>t?16:t,kc===null)var r=!1;else{if(t=kc,kc=null,xb=0,Vt&6)throw Error(je(331));var s=Vt;for(Vt|=4,ze=t.current;ze!==null;){var i=ze,a=i.child;if(ze.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(ze=u;ze!==null;){var d=ze;switch(d.tag){case 0:case 11:case 15:dg(8,d,i)}var h=d.child;if(h!==null)h.return=d,ze=h;else for(;ze!==null;){d=ze;var f=d.sibling,p=d.return;if(v3(d),d===u){ze=null;break}if(f!==null){f.return=p,ze=f;break}ze=p}}}var m=i.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}ze=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ze=a;else e:for(;ze!==null;){if(i=ze,i.flags&2048)switch(i.tag){case 0:case 11:case 15:dg(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,ze=x;break e}ze=i.return}}var w=t.current;for(ze=w;ze!==null;){a=ze;var N=a.child;if(a.subtreeFlags&2064&&N!==null)N.return=a,ze=N;else e:for(a=w;ze!==null;){if(l=ze,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:z1(9,l)}}catch(C){qn(l,l.return,C)}if(l===a){ze=null;break e}var S=l.sibling;if(S!==null){S.return=l.return,ze=S;break e}ze=l.return}}if(Vt=s,wu(),wo&&typeof wo.onPostCommitFiberRoot=="function")try{wo.onPostCommitFiberRoot(R1,t)}catch{}r=!0}return r}finally{Zt=n,va.transition=e}}return!1}function I2(t,e,n){e=zf(n,e),e=o3(t,e,1),t=Uc(t,e,1),e=qs(),t!==null&&(Ky(t,1,e),bi(t,e))}function qn(t,e,n){if(t.tag===3)I2(t,t,n);else for(;e!==null;){if(e.tag===3){I2(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(zc===null||!zc.has(r))){t=zf(n,t),t=l3(e,t,1),e=Uc(e,t,1),t=qs(),e!==null&&(Ky(e,1,t),bi(e,t));break}}e=e.return}}function VJ(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=qs(),t.pingedLanes|=t.suspendedLanes&n,$r===t&&(gs&n)===n&&(jr===4||jr===3&&(gs&130023424)===gs&&500>er()-qA?vd(t,0):WA|=n),bi(t,e)}function T3(t,e){e===0&&(t.mode&1?(e=fx,fx<<=1,!(fx&130023424)&&(fx=4194304)):e=1);var n=qs();t=jl(t,e),t!==null&&(Ky(t,e,n),bi(t,n))}function $J(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),T3(t,n)}function UJ(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(je(314))}r!==null&&r.delete(e),T3(t,n)}var A3;A3=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||vi.current)di=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return di=!1,AJ(t,e,n);di=!!(t.flags&131072)}else di=!1,Tn&&e.flags&1048576&&OU(e,ub,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;_0(t,e),t=e.pendingProps;var s=Bf(e,Rs.current);Sf(e,n),s=BA(null,e,r,t,s,n);var i=VA();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xi(r)?(i=!0,lb(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,DA(e),s.updater=U1,e.stateNode=s,s._reactInternals=e,PE(e,r,t,n),e=RE(null,e,r,!0,i,n)):(e.tag=0,Tn&&i&&CA(e),zs(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(_0(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=HJ(r),t=Ma(r,t),s){case 0:e=DE(null,e,r,t,n);break e;case 1:e=w2(null,e,r,t,n);break e;case 11:e=x2(null,e,r,t,n);break e;case 14:e=b2(null,e,r,Ma(r.type,t),n);break e}throw Error(je(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ma(r,s),DE(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ma(r,s),w2(t,e,r,s,n);case 3:e:{if(h3(e),t===null)throw Error(je(387));r=e.pendingProps,i=e.memoizedState,s=i.element,BU(t,e),fb(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=zf(Error(je(423)),e),e=N2(t,e,r,n,s);break e}else if(r!==s){s=zf(Error(je(424)),e),e=N2(t,e,r,n,s);break e}else for(Ri=$c(e.stateNode.containerInfo.firstChild),Bi=e,Tn=!0,Fa=null,n=LU(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Vf(),r===s){e=El(t,e,n);break e}zs(t,e,r,n)}e=e.child}return e;case 5:return VU(e),t===null&&AE(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,_E(r,s)?a=null:i!==null&&_E(r,i)&&(e.flags|=32),d3(t,e),zs(t,e,a,n),e.child;case 6:return t===null&&AE(e),null;case 13:return f3(t,e,n);case 4:return RA(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=$f(e,null,r,n):zs(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ma(r,s),x2(t,e,r,s,n);case 7:return zs(t,e,e.pendingProps,n),e.child;case 8:return zs(t,e,e.pendingProps.children,n),e.child;case 12:return zs(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,fn(db,r._currentValue),r._currentValue=a,i!==null)if(Ka(i.value,a)){if(i.children===s.children&&!vi.current){e=El(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=gl(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),kE(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(je(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),kE(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}zs(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Sf(e,n),s=_a(s),r=r(s),e.flags|=1,zs(t,e,r,n),e.child;case 14:return r=e.type,s=Ma(r,e.pendingProps),s=Ma(r.type,s),b2(t,e,r,s,n);case 15:return c3(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ma(r,s),_0(t,e),e.tag=1,xi(r)?(t=!0,lb(e)):t=!1,Sf(e,n),a3(e,r,s),PE(e,r,s,n),RE(null,e,r,!0,t,n);case 19:return p3(t,e,n);case 22:return u3(t,e,n)}throw Error(je(156,e.tag))};function k3(t,e){return rU(t,e)}function zJ(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ma(t,e,n,r){return new zJ(t,e,n,r)}function QA(t){return t=t.prototype,!(!t||!t.isReactComponent)}function HJ(t){if(typeof t=="function")return QA(t)?1:0;if(t!=null){if(t=t.$$typeof,t===mA)return 11;if(t===gA)return 14}return 2}function Wc(t,e){var n=t.alternate;return n===null?(n=ma(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function C0(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")QA(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case tf:return xd(n.children,s,i,e);case pA:a=8,s|=8;break;case nE:return t=ma(12,n,e,s|2),t.elementType=nE,t.lanes=i,t;case rE:return t=ma(13,n,e,s),t.elementType=rE,t.lanes=i,t;case sE:return t=ma(19,n,e,s),t.elementType=sE,t.lanes=i,t;case V$:return W1(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case F$:a=10;break e;case B$:a=9;break e;case mA:a=11;break e;case gA:a=14;break e;case cc:a=16,r=null;break e}throw Error(je(130,t==null?t:typeof t,""))}return e=ma(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function xd(t,e,n,r){return t=ma(7,t,r,e),t.lanes=n,t}function W1(t,e,n,r){return t=ma(22,t,r,e),t.elementType=V$,t.lanes=n,t.stateNode={isHidden:!1},t}function C_(t,e,n){return t=ma(6,t,null,e),t.lanes=n,t}function T_(t,e,n){return e=ma(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function WJ(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l_(0),this.expirationTimes=l_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l_(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function XA(t,e,n,r,s,i,a,l,c){return t=new WJ(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ma(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},DA(i),t}function qJ(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ef,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function I3(t){if(!t)return ru;t=t._reactInternals;e:{if(mh(t)!==t||t.tag!==1)throw Error(je(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(je(171))}if(t.tag===1){var n=t.type;if(xi(n))return IU(t,n,e)}return e}function P3(t,e,n,r,s,i,a,l,c){return t=XA(n,r,!0,t,s,i,a,l,c),t.context=I3(null),n=t.current,r=qs(),s=Hc(n),i=gl(r,s),i.callback=e??null,Uc(n,i,s),t.current.lanes=s,Ky(t,s,r),bi(t,r),t}function q1(t,e,n,r){var s=e.current,i=qs(),a=Hc(s);return n=I3(n),e.context===null?e.context=n:e.pendingContext=n,e=gl(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Uc(s,e,a),t!==null&&(Wa(t,s,a,i),w0(t,s,a)),a}function wb(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function P2(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function JA(t,e){P2(t,e),(t=t.alternate)&&P2(t,e)}function GJ(){return null}var O3=typeof reportError=="function"?reportError:function(t){console.error(t)};function ZA(t){this._internalRoot=t}G1.prototype.render=ZA.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(je(409));q1(t,e,null,null)};G1.prototype.unmount=ZA.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Md(function(){q1(null,t,null,null)}),e[_l]=null}};function G1(t){this._internalRoot=t}G1.prototype.unstable_scheduleHydration=function(t){if(t){var e=uU();t={blockedOn:null,target:t,priority:e};for(var n=0;n<gc.length&&e!==0&&e<gc[n].priority;n++);gc.splice(n,0,t),n===0&&hU(t)}};function ek(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function K1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function O2(){}function KJ(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=wb(a);i.call(u)}}var a=P3(e,r,t,0,null,!1,!1,"",O2);return t._reactRootContainer=a,t[_l]=a.current,Wg(t.nodeType===8?t.parentNode:t),Md(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var u=wb(c);l.call(u)}}var c=XA(t,0,!1,null,null,!1,!1,"",O2);return t._reactRootContainer=c,t[_l]=c.current,Wg(t.nodeType===8?t.parentNode:t),Md(function(){q1(e,c,n,r)}),c}function Y1(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=wb(a);l.call(c)}}q1(e,a,t,s)}else a=KJ(n,e,t,s,r);return wb(a)}lU=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Hm(e.pendingLanes);n!==0&&(xA(e,n|1),bi(e,er()),!(Vt&6)&&(Hf=er()+500,wu()))}break;case 13:Md(function(){var r=jl(t,1);if(r!==null){var s=qs();Wa(r,t,1,s)}}),JA(t,1)}};bA=function(t){if(t.tag===13){var e=jl(t,134217728);if(e!==null){var n=qs();Wa(e,t,134217728,n)}JA(t,134217728)}};cU=function(t){if(t.tag===13){var e=Hc(t),n=jl(t,e);if(n!==null){var r=qs();Wa(n,t,e,r)}JA(t,e)}};uU=function(){return Zt};dU=function(t,e){var n=Zt;try{return Zt=t,e()}finally{Zt=n}};pE=function(t,e,n){switch(e){case"input":if(oE(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=B1(r);if(!s)throw Error(je(90));U$(r),oE(r,s)}}}break;case"textarea":H$(t,n);break;case"select":e=n.value,e!=null&&xf(t,!!n.multiple,e,!1)}};X$=GA;J$=Md;var YJ={usingClientEntryPoint:!1,Events:[Qy,af,B1,Y$,Q$,GA]},xm={findFiberByHostInstance:od,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QJ={bundleType:xm.bundleType,version:xm.version,rendererPackageName:xm.rendererPackageName,rendererConfig:xm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vl.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=tU(t),t===null?null:t.stateNode},findFiberByHostInstance:xm.findFiberByHostInstance||GJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_x.isDisabled&&_x.supportsFiber)try{R1=_x.inject(QJ),wo=_x}catch{}}Yi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YJ;Yi.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ek(e))throw Error(je(200));return qJ(t,e,null,n)};Yi.createRoot=function(t,e){if(!ek(t))throw Error(je(299));var n=!1,r="",s=O3;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=XA(t,1,!1,null,null,n,!1,r,s),t[_l]=e.current,Wg(t.nodeType===8?t.parentNode:t),new ZA(e)};Yi.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(je(188)):(t=Object.keys(t).join(","),Error(je(268,t)));return t=tU(e),t=t===null?null:t.stateNode,t};Yi.flushSync=function(t){return Md(t)};Yi.hydrate=function(t,e,n){if(!K1(e))throw Error(je(200));return Y1(null,t,e,!0,n)};Yi.hydrateRoot=function(t,e,n){if(!ek(t))throw Error(je(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=O3;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=P3(e,null,t,1,n??null,s,!1,i,a),t[_l]=e.current,Wg(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new G1(e)};Yi.render=function(t,e,n){if(!K1(e))throw Error(je(200));return Y1(null,t,e,!1,n)};Yi.unmountComponentAtNode=function(t){if(!K1(t))throw Error(je(40));return t._reactRootContainer?(Md(function(){Y1(null,null,t,!1,function(){t._reactRootContainer=null,t[_l]=null})}),!0):!1};Yi.unstable_batchedUpdates=GA;Yi.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!K1(n))throw Error(je(200));if(t==null||t._reactInternals===void 0)throw Error(je(38));return Y1(t,e,n,!1,r)};Yi.version="18.3.1-next-f1338f8080-20240426";function D3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D3)}catch(t){console.error(t)}}D3(),D$.exports=Yi;var Q1=D$.exports;const XJ=Bo(Q1);var D2=Q1;eE.createRoot=D2.createRoot,eE.hydrateRoot=D2.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ey(){return ey=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ey.apply(this,arguments)}var Ic;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ic||(Ic={}));const R2="popstate";function JJ(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return GE("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Nb(s)}return eZ(e,n,null,t)}function Mn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function tk(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ZJ(){return Math.random().toString(36).substr(2,8)}function M2(t,e){return{usr:t.state,key:t.key,idx:e}}function GE(t,e,n,r){return n===void 0&&(n=null),ey({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ip(e):e,{state:n,key:e&&e.key||r||ZJ()})}function Nb(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ip(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function eZ(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l=Ic.Pop,c=null,u=d();u==null&&(u=0,a.replaceState(ey({},a.state,{idx:u}),""));function d(){return(a.state||{idx:null}).idx}function h(){l=Ic.Pop;let y=d(),x=y==null?null:y-u;u=y,c&&c({action:l,location:g.location,delta:x})}function f(y,x){l=Ic.Push;let w=GE(g.location,y,x);u=d()+1;let N=M2(w,u),S=g.createHref(w);try{a.pushState(N,"",S)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;s.location.assign(S)}i&&c&&c({action:l,location:g.location,delta:1})}function p(y,x){l=Ic.Replace;let w=GE(g.location,y,x);u=d();let N=M2(w,u),S=g.createHref(w);a.replaceState(N,"",S),i&&c&&c({action:l,location:g.location,delta:0})}function m(y){let x=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof y=="string"?y:Nb(y);return w=w.replace(/ $/,"%20"),Mn(x,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,x)}let g={get action(){return l},get location(){return t(s,a)},listen(y){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(R2,h),c=y,()=>{s.removeEventListener(R2,h),c=null}},createHref(y){return e(s,y)},createURL:m,encodeLocation(y){let x=m(y);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:p,go(y){return a.go(y)}};return g}var L2;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(L2||(L2={}));function tZ(t,e,n){return n===void 0&&(n="/"),nZ(t,e,n)}function nZ(t,e,n,r){let s=typeof e=="string"?Ip(e):e,i=Wf(s.pathname||"/",n);if(i==null)return null;let a=R3(t);rZ(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let u=pZ(i);l=hZ(a[c],u)}return l}function R3(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,a,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};c.relativePath.startsWith("/")&&(Mn(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let u=qc([r,c.relativePath]),d=n.concat(c);i.children&&i.children.length>0&&(Mn(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),R3(i.children,e,d,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:uZ(u,i.index),routesMeta:d})};return t.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,a);else for(let c of M3(i.path))s(i,a,c)}),e}function M3(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=M3(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function rZ(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:dZ(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const sZ=/^:[\w-]+$/,iZ=3,aZ=2,oZ=1,lZ=10,cZ=-2,F2=t=>t==="*";function uZ(t,e){let n=t.split("/"),r=n.length;return n.some(F2)&&(r+=cZ),e&&(r+=aZ),n.filter(s=>!F2(s)).reduce((s,i)=>s+(sZ.test(i)?iZ:i===""?oZ:lZ),r)}function dZ(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function hZ(t,e,n){let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],u=l===r.length-1,d=i==="/"?e:e.slice(i.length)||"/",h=KE({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),f=c.route;if(!h)return null;Object.assign(s,h.params),a.push({params:s,pathname:qc([i,h.pathname]),pathnameBase:xZ(qc([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=qc([i,h.pathnameBase]))}return a}function KE(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=fZ(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((u,d,h)=>{let{paramName:f,isOptional:p}=d;if(f==="*"){let g=l[h]||"";a=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const m=l[h];return p&&!m?u[f]=void 0:u[f]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:a,pattern:t}}function fZ(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),tk(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function pZ(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return tk(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Wf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}const mZ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gZ=t=>mZ.test(t);function yZ(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Ip(t):t,i;if(n)if(gZ(n))i=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),tk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+n))}n.startsWith("/")?i=B2(n.substring(1),"/"):i=B2(n,e)}else i=e;return{pathname:i,search:bZ(r),hash:wZ(s)}}function B2(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function A_(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function vZ(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function nk(t,e){let n=vZ(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function rk(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Ip(t):(s=ey({},t),Mn(!s.pathname||!s.pathname.includes("?"),A_("?","pathname","search",s)),Mn(!s.pathname||!s.pathname.includes("#"),A_("#","pathname","hash",s)),Mn(!s.search||!s.search.includes("#"),A_("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let h=e.length-1;if(!r&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),h-=1;s.pathname=f.join("/")}l=h>=0?e[h]:"/"}let c=yZ(s,l),u=a&&a!=="/"&&a.endsWith("/"),d=(i||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const qc=t=>t.join("/").replace(/\/\/+/g,"/"),xZ=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),bZ=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,wZ=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function NZ(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const L3=["post","put","patch","delete"];new Set(L3);const SZ=["get",...L3];new Set(SZ);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ty(){return ty=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ty.apply(this,arguments)}const X1=b.createContext(null),F3=b.createContext(null),$l=b.createContext(null),J1=b.createContext(null),Vo=b.createContext({outlet:null,matches:[],isDataRoute:!1}),B3=b.createContext(null);function _Z(t,e){let{relative:n}=e===void 0?{}:e;Pp()||Mn(!1);let{basename:r,navigator:s}=b.useContext($l),{hash:i,pathname:a,search:l}=Z1(t,{relative:n}),c=a;return r!=="/"&&(c=a==="/"?r:qc([r,a])),s.createHref({pathname:c,search:l,hash:i})}function Pp(){return b.useContext(J1)!=null}function Ul(){return Pp()||Mn(!1),b.useContext(J1).location}function V3(t){b.useContext($l).static||b.useLayoutEffect(t)}function rr(){let{isDataRoute:t}=b.useContext(Vo);return t?BZ():jZ()}function jZ(){Pp()||Mn(!1);let t=b.useContext(X1),{basename:e,future:n,navigator:r}=b.useContext($l),{matches:s}=b.useContext(Vo),{pathname:i}=Ul(),a=JSON.stringify(nk(s,n.v7_relativeSplatPath)),l=b.useRef(!1);return V3(()=>{l.current=!0}),b.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){r.go(u);return}let h=rk(u,JSON.parse(a),i,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:qc([e,h.pathname])),(d.replace?r.replace:r.push)(h,d.state,d)},[e,r,a,i,t])}const EZ=b.createContext(null);function CZ(t){let e=b.useContext(Vo).outlet;return e&&b.createElement(EZ.Provider,{value:t},e)}function Op(){let{matches:t}=b.useContext(Vo),e=t[t.length-1];return e?e.params:{}}function Z1(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=b.useContext($l),{matches:s}=b.useContext(Vo),{pathname:i}=Ul(),a=JSON.stringify(nk(s,r.v7_relativeSplatPath));return b.useMemo(()=>rk(t,JSON.parse(a),i,n==="path"),[t,a,i,n])}function TZ(t,e){return AZ(t,e)}function AZ(t,e,n,r){Pp()||Mn(!1);let{navigator:s}=b.useContext($l),{matches:i}=b.useContext(Vo),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let u=Ul(),d;if(e){var h;let y=typeof e=="string"?Ip(e):e;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||Mn(!1),d=y}else d=u;let f=d.pathname||"/",p=f;if(c!=="/"){let y=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let m=tZ(t,{pathname:p}),g=DZ(m&&m.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:qc([c,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:qc([c,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),i,n,r);return e&&g?b.createElement(J1.Provider,{value:{location:ty({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Ic.Pop}},g):g}function kZ(){let t=FZ(),e=NZ(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),n?b.createElement("pre",{style:s},n):null,null)}const IZ=b.createElement(kZ,null);class PZ extends b.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?b.createElement(Vo.Provider,{value:this.props.routeContext},b.createElement(B3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function OZ(t){let{routeContext:e,match:n,children:r}=t,s=b.useContext(X1);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),b.createElement(Vo.Provider,{value:e},r)}function DZ(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let d=a.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);d>=0||Mn(!1),a=a.slice(0,Math.min(a.length,d+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<a.length;d++){let h=a[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:p}=n,m=h.route.loader&&f[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){c=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((d,h,f)=>{let p,m=!1,g=null,y=null;n&&(p=l&&h.route.id?l[h.route.id]:void 0,g=h.route.errorElement||IZ,c&&(u<0&&f===0?(VZ("route-fallback"),m=!0,y=null):u===f&&(m=!0,y=h.route.hydrateFallbackElement||null)));let x=e.concat(a.slice(0,f+1)),w=()=>{let N;return p?N=g:m?N=y:h.route.Component?N=b.createElement(h.route.Component,null):h.route.element?N=h.route.element:N=d,b.createElement(OZ,{match:h,routeContext:{outlet:d,matches:x,isDataRoute:n!=null},children:N})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?b.createElement(PZ,{location:n.location,revalidation:n.revalidation,component:g,error:p,children:w(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):w()},null)}var $3=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}($3||{}),U3=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(U3||{});function RZ(t){let e=b.useContext(X1);return e||Mn(!1),e}function MZ(t){let e=b.useContext(F3);return e||Mn(!1),e}function LZ(t){let e=b.useContext(Vo);return e||Mn(!1),e}function z3(t){let e=LZ(),n=e.matches[e.matches.length-1];return n.route.id||Mn(!1),n.route.id}function FZ(){var t;let e=b.useContext(B3),n=MZ(),r=z3();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function BZ(){let{router:t}=RZ($3.UseNavigateStable),e=z3(U3.UseNavigateStable),n=b.useRef(!1);return V3(()=>{n.current=!0}),b.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,ty({fromRouteId:e},i)))},[t,e])}const V2={};function VZ(t,e,n){V2[t]||(V2[t]=!0)}function $Z(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function jf(t){let{to:e,replace:n,state:r,relative:s}=t;Pp()||Mn(!1);let{future:i,static:a}=b.useContext($l),{matches:l}=b.useContext(Vo),{pathname:c}=Ul(),u=rr(),d=rk(e,nk(l,i.v7_relativeSplatPath),c,s==="path"),h=JSON.stringify(d);return b.useEffect(()=>u(JSON.parse(h),{replace:n,state:r,relative:s}),[u,h,s,n,r]),null}function H3(t){return CZ(t.context)}function Yt(t){Mn(!1)}function UZ(t){let{basename:e="/",children:n=null,location:r,navigationType:s=Ic.Pop,navigator:i,static:a=!1,future:l}=t;Pp()&&Mn(!1);let c=e.replace(/^\/*/,"/"),u=b.useMemo(()=>({basename:c,navigator:i,static:a,future:ty({v7_relativeSplatPath:!1},l)}),[c,l,i,a]);typeof r=="string"&&(r=Ip(r));let{pathname:d="/",search:h="",hash:f="",state:p=null,key:m="default"}=r,g=b.useMemo(()=>{let y=Wf(d,c);return y==null?null:{location:{pathname:y,search:h,hash:f,state:p,key:m},navigationType:s}},[c,d,h,f,p,m,s]);return g==null?null:b.createElement($l.Provider,{value:u},b.createElement(J1.Provider,{children:n,value:g}))}function zZ(t){let{children:e,location:n}=t;return TZ(YE(e),n)}new Promise(()=>{});function YE(t,e){e===void 0&&(e=[]);let n=[];return b.Children.forEach(t,(r,s)=>{if(!b.isValidElement(r))return;let i=[...e,s];if(r.type===b.Fragment){n.push.apply(n,YE(r.props.children,i));return}r.type!==Yt&&Mn(!1),!r.props.index||!r.props.children||Mn(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=YE(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sb(){return Sb=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Sb.apply(this,arguments)}function W3(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function HZ(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function WZ(t,e){return t.button===0&&(!e||e==="_self")&&!HZ(t)}function QE(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function qZ(t,e){let n=QE(t);return e&&e.forEach((r,s)=>{n.has(s)||e.getAll(s).forEach(i=>{n.append(s,i)})}),n}const GZ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],KZ=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],YZ="6";try{window.__reactRouterVersion=YZ}catch{}const QZ=b.createContext({isTransitioning:!1}),XZ="startTransition",$2=P$[XZ];function JZ(t){let{basename:e,children:n,future:r,window:s}=t,i=b.useRef();i.current==null&&(i.current=JJ({window:s,v5Compat:!0}));let a=i.current,[l,c]=b.useState({action:a.action,location:a.location}),{v7_startTransition:u}=r||{},d=b.useCallback(h=>{u&&$2?$2(()=>c(h)):c(h)},[c,u]);return b.useLayoutEffect(()=>a.listen(d),[a,d]),b.useEffect(()=>$Z(r),[r]),b.createElement(UZ,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:r})}const ZZ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",eee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,at=b.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:l,target:c,to:u,preventScrollReset:d,viewTransition:h}=e,f=W3(e,GZ),{basename:p}=b.useContext($l),m,g=!1;if(typeof u=="string"&&eee.test(u)&&(m=u,ZZ))try{let N=new URL(window.location.href),S=u.startsWith("//")?new URL(N.protocol+u):new URL(u),C=Wf(S.pathname,p);S.origin===N.origin&&C!=null?u=C+S.search+S.hash:g=!0}catch{}let y=_Z(u,{relative:s}),x=ree(u,{replace:a,state:l,target:c,preventScrollReset:d,relative:s,viewTransition:h});function w(N){r&&r(N),N.defaultPrevented||x(N)}return b.createElement("a",Sb({},f,{href:m||y,onClick:g||i?r:w,ref:n,target:c}))}),tee=b.forwardRef(function(e,n){let{"aria-current":r="page",caseSensitive:s=!1,className:i="",end:a=!1,style:l,to:c,viewTransition:u,children:d}=e,h=W3(e,KZ),f=Z1(c,{relative:h.relative}),p=Ul(),m=b.useContext(F3),{navigator:g,basename:y}=b.useContext($l),x=m!=null&&iee(f)&&u===!0,w=g.encodeLocation?g.encodeLocation(f).pathname:f.pathname,N=p.pathname,S=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;s||(N=N.toLowerCase(),S=S?S.toLowerCase():null,w=w.toLowerCase()),S&&y&&(S=Wf(S,y)||S);const C=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let A=N===w||!a&&N.startsWith(w)&&N.charAt(C)==="/",j=S!=null&&(S===w||!a&&S.startsWith(w)&&S.charAt(w.length)==="/"),_={isActive:A,isPending:j,isTransitioning:x},E=A?r:void 0,I;typeof i=="function"?I=i(_):I=[i,A?"active":null,j?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let T=typeof l=="function"?l(_):l;return b.createElement(at,Sb({},h,{"aria-current":E,className:I,ref:n,style:T,to:c,viewTransition:u}),typeof d=="function"?d(_):d)});var XE;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(XE||(XE={}));var U2;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(U2||(U2={}));function nee(t){let e=b.useContext(X1);return e||Mn(!1),e}function ree(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:l}=e===void 0?{}:e,c=rr(),u=Ul(),d=Z1(t,{relative:a});return b.useCallback(h=>{if(WZ(h,n)){h.preventDefault();let f=r!==void 0?r:Nb(u)===Nb(d);c(t,{replace:f,state:s,preventScrollReset:i,relative:a,viewTransition:l})}},[u,c,d,r,s,n,t,i,a,l])}function see(t){let e=b.useRef(QE(t)),n=b.useRef(!1),r=Ul(),s=b.useMemo(()=>qZ(r.search,n.current?null:e.current),[r.search]),i=rr(),a=b.useCallback((l,c)=>{const u=QE(typeof l=="function"?l(s):l);n.current=!0,i("?"+u,c)},[i,s]);return[s,a]}function iee(t,e){e===void 0&&(e={});let n=b.useContext(QZ);n==null&&Mn(!1);let{basename:r}=nee(XE.useViewTransitionState),s=Z1(t,{relative:e.relative});if(!n.isTransitioning)return!1;let i=Wf(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=Wf(n.nextLocation.pathname,r)||n.nextLocation.pathname;return KE(s.pathname,a)!=null||KE(s.pathname,i)!=null}var z2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q3=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},aee=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},G3={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,d=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|u>>6,p=u&63;c||(p=64,a||(f=64)),r.push(n[d],n[h],n[f],n[p])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(q3(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):aee(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||u==null||h==null)throw new oee;const f=i<<2|l>>4;if(r.push(f),u!==64){const p=l<<4&240|u>>2;if(r.push(p),h!==64){const m=u<<6&192|h;r.push(m)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class oee extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const lee=function(t){const e=q3(t);return G3.encodeByteArray(e,!0)},_b=function(t){return lee(t).replace(/\./g,"")},K3=function(t){try{return G3.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cee(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uee=()=>cee().__FIREBASE_DEFAULTS__,dee=()=>{if(typeof process>"u"||typeof z2>"u")return;const t=z2.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},hee=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&K3(t[1]);return e&&JSON.parse(e)},eN=()=>{try{return uee()||dee()||hee()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Y3=t=>{var e,n;return(n=(e=eN())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},sk=t=>{const e=Y3(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Q3=()=>{var t;return(t=eN())===null||t===void 0?void 0:t.config},X3=t=>{var e;return(e=eN())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fee{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J3(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[_b(JSON.stringify(n)),_b(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pee(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cr())}function mee(){var t;const e=(t=eN())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function gee(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function yee(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function vee(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xee(){const t=Cr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Z3(){return!mee()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function e6(){try{return typeof indexedDB=="object"}catch{return!1}}function bee(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wee="FirebaseError";class $o extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=wee,Object.setPrototypeOf(this,$o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jy.prototype.create)}}class Jy{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Nee(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new $o(s,l,r)}}function Nee(t,e){return t.replace(See,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const See=/\{\$([^}]+)}/g;function _ee(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function su(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(H2(i)&&H2(a)){if(!su(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function H2(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zy(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function qm(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Gm(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function jee(t,e){const n=new Eee(t,e);return n.subscribe.bind(n)}class Eee{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Cee(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=k_),s.error===void 0&&(s.error=k_),s.complete===void 0&&(s.complete=k_);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Cee(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function k_(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(t){return t&&t._delegate?t._delegate:t}class Cl{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ku="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tee=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new fee;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(kee(e))try{this.getOrInitializeService({instanceIdentifier:Ku})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ku){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ku){return this.instances.has(e)}getOptions(e=Ku){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Aee(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ku){return this.component?this.component.multipleInstances?e:Ku:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Aee(t){return t===Ku?void 0:t}function kee(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iee{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Tee(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ot;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ot||(Ot={}));const Pee={debug:Ot.DEBUG,verbose:Ot.VERBOSE,info:Ot.INFO,warn:Ot.WARN,error:Ot.ERROR,silent:Ot.SILENT},Oee=Ot.INFO,Dee={[Ot.DEBUG]:"log",[Ot.VERBOSE]:"log",[Ot.INFO]:"info",[Ot.WARN]:"warn",[Ot.ERROR]:"error"},Ree=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Dee[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ik{constructor(e){this.name=e,this._logLevel=Oee,this._logHandler=Ree,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ot))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Pee[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ot.DEBUG,...e),this._logHandler(this,Ot.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ot.VERBOSE,...e),this._logHandler(this,Ot.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ot.INFO,...e),this._logHandler(this,Ot.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ot.WARN,...e),this._logHandler(this,Ot.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ot.ERROR,...e),this._logHandler(this,Ot.ERROR,...e)}}const Mee=(t,e)=>e.some(n=>t instanceof n);let W2,q2;function Lee(){return W2||(W2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fee(){return q2||(q2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const t6=new WeakMap,JE=new WeakMap,n6=new WeakMap,I_=new WeakMap,ak=new WeakMap;function Bee(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(Gc(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&t6.set(n,t)}).catch(()=>{}),ak.set(e,t),e}function Vee(t){if(JE.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});JE.set(t,e)}let ZE={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return JE.get(t);if(e==="objectStoreNames")return t.objectStoreNames||n6.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Gc(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function $ee(t){ZE=t(ZE)}function Uee(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(P_(this),e,...n);return n6.set(r,e.sort?e.sort():[e]),Gc(r)}:Fee().includes(t)?function(...e){return t.apply(P_(this),e),Gc(t6.get(this))}:function(...e){return Gc(t.apply(P_(this),e))}}function zee(t){return typeof t=="function"?Uee(t):(t instanceof IDBTransaction&&Vee(t),Mee(t,Lee())?new Proxy(t,ZE):t)}function Gc(t){if(t instanceof IDBRequest)return Bee(t);if(I_.has(t))return I_.get(t);const e=zee(t);return e!==t&&(I_.set(t,e),ak.set(e,t)),e}const P_=t=>ak.get(t);function Hee(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=Gc(a);return r&&a.addEventListener("upgradeneeded",c=>{r(Gc(a.result),c.oldVersion,c.newVersion,Gc(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const Wee=["get","getKey","getAll","getAllKeys","count"],qee=["put","add","delete","clear"],O_=new Map;function G2(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(O_.get(e))return O_.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=qee.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Wee.includes(n)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[n](...l),s&&c.done]))[0]};return O_.set(e,i),i}$ee(t=>({...t,get:(e,n,r)=>G2(e,n)||t.get(e,n,r),has:(e,n)=>!!G2(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gee{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Kee(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Kee(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const eC="@firebase/app",K2="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl=new ik("@firebase/app"),Yee="@firebase/app-compat",Qee="@firebase/analytics-compat",Xee="@firebase/analytics",Jee="@firebase/app-check-compat",Zee="@firebase/app-check",ete="@firebase/auth",tte="@firebase/auth-compat",nte="@firebase/database",rte="@firebase/data-connect",ste="@firebase/database-compat",ite="@firebase/functions",ate="@firebase/functions-compat",ote="@firebase/installations",lte="@firebase/installations-compat",cte="@firebase/messaging",ute="@firebase/messaging-compat",dte="@firebase/performance",hte="@firebase/performance-compat",fte="@firebase/remote-config",pte="@firebase/remote-config-compat",mte="@firebase/storage",gte="@firebase/storage-compat",yte="@firebase/firestore",vte="@firebase/vertexai-preview",xte="@firebase/firestore-compat",bte="firebase",wte="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb="[DEFAULT]",Nte={[eC]:"fire-core",[Yee]:"fire-core-compat",[Xee]:"fire-analytics",[Qee]:"fire-analytics-compat",[Zee]:"fire-app-check",[Jee]:"fire-app-check-compat",[ete]:"fire-auth",[tte]:"fire-auth-compat",[nte]:"fire-rtdb",[rte]:"fire-data-connect",[ste]:"fire-rtdb-compat",[ite]:"fire-fn",[ate]:"fire-fn-compat",[ote]:"fire-iid",[lte]:"fire-iid-compat",[cte]:"fire-fcm",[ute]:"fire-fcm-compat",[dte]:"fire-perf",[hte]:"fire-perf-compat",[fte]:"fire-rc",[pte]:"fire-rc-compat",[mte]:"fire-gcs",[gte]:"fire-gcs-compat",[yte]:"fire-fst",[xte]:"fire-fst-compat",[vte]:"fire-vertex","fire-js":"fire-js",[bte]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eb=new Map,Ste=new Map,tC=new Map;function Y2(t,e){try{t.container.addComponent(e)}catch(n){Tl.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function iu(t){const e=t.name;if(tC.has(e))return Tl.debug(`There were multiple attempts to register component ${e}.`),!1;tC.set(e,t);for(const n of Eb.values())Y2(n,t);for(const n of Ste.values())Y2(n,t);return!0}function gh(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function _te(t,e,n=jb){gh(t,e).clearInstance(n)}function po(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jte={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Kc=new Jy("app","Firebase",jte);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ete{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Cl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Kc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yh=wte;function r6(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:jb,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Kc.create("bad-app-name",{appName:String(s)});if(n||(n=Q3()),!n)throw Kc.create("no-options");const i=Eb.get(s);if(i){if(su(n,i.options)&&su(r,i.config))return i;throw Kc.create("duplicate-app",{appName:s})}const a=new Iee(s);for(const c of tC.values())a.addComponent(c);const l=new Ete(n,r,a);return Eb.set(s,l),l}function tN(t=jb){const e=Eb.get(t);if(!e&&t===jb&&Q3())return r6();if(!e)throw Kc.create("no-app",{appName:t});return e}function xa(t,e,n){var r;let s=(r=Nte[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Tl.warn(l.join(" "));return}iu(new Cl(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cte="firebase-heartbeat-database",Tte=1,ny="firebase-heartbeat-store";let D_=null;function s6(){return D_||(D_=Hee(Cte,Tte,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ny)}catch(n){console.warn(n)}}}}).catch(t=>{throw Kc.create("idb-open",{originalErrorMessage:t.message})})),D_}async function Ate(t){try{const n=(await s6()).transaction(ny),r=await n.objectStore(ny).get(i6(t));return await n.done,r}catch(e){if(e instanceof $o)Tl.warn(e.message);else{const n=Kc.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Tl.warn(n.message)}}}async function Q2(t,e){try{const r=(await s6()).transaction(ny,"readwrite");await r.objectStore(ny).put(e,i6(t)),await r.done}catch(n){if(n instanceof $o)Tl.warn(n.message);else{const r=Kc.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Tl.warn(r.message)}}}function i6(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kte=1024,Ite=30*24*60*60*1e3;class Pte{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Dte(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=X2();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=Ite}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Tl.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=X2(),{heartbeatsToSend:r,unsentEntries:s}=Ote(this._heartbeatsCache.heartbeats),i=_b(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Tl.warn(n),""}}}function X2(){return new Date().toISOString().substring(0,10)}function Ote(t,e=kte){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),J2(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),J2(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Dte{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return e6()?bee().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Ate(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Q2(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Q2(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function J2(t){return _b(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rte(t){iu(new Cl("platform-logger",e=>new Gee(e),"PRIVATE")),iu(new Cl("heartbeat",e=>new Pte(e),"PRIVATE")),xa(eC,K2,t),xa(eC,K2,"esm2017"),xa("fire-js","")}Rte("");function ok(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function a6(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Mte=a6,o6=new Jy("auth","Firebase",a6());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb=new ik("@firebase/auth");function Lte(t,...e){Cb.logLevel<=Ot.WARN&&Cb.warn(`Auth (${yh}): ${t}`,...e)}function T0(t,...e){Cb.logLevel<=Ot.ERROR&&Cb.error(`Auth (${yh}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ya(t,...e){throw lk(t,...e)}function So(t,...e){return lk(t,...e)}function l6(t,e,n){const r=Object.assign(Object.assign({},Mte()),{[e]:n});return new Jy("auth","Firebase",r).create(e,{appName:t.name})}function yl(t){return l6(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function lk(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return o6.create(t,...e)}function ct(t,e,...n){if(!t)throw lk(e,...n)}function ol(t){const e="INTERNAL ASSERTION FAILED: "+t;throw T0(e),new Error(e)}function Al(t,e){t||ol(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nC(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Fte(){return Z2()==="http:"||Z2()==="https:"}function Z2(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bte(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fte()||yee()||"connection"in navigator)?navigator.onLine:!0}function Vte(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e,n){this.shortDelay=e,this.longDelay=n,Al(n>e,"Short delay should be less than long delay!"),this.isMobile=pee()||vee()}get(){return Bte()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ck(t,e){Al(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ol("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ol("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ol("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $te={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ute=new ev(3e4,6e4);function zl(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Hl(t,e,n,r,s={}){return u6(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Zy(Object.assign({key:t.config.apiKey},a)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:c},i);return gee()||(u.referrerPolicy="no-referrer"),c6.fetch()(d6(t,t.config.apiHost,n,l),u)})}async function u6(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},$te),e);try{const s=new Hte(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw jx(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw jx(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw jx(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw jx(t,"user-disabled",a);const d=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw l6(t,d,u);Ya(t,d)}}catch(s){if(s instanceof $o)throw s;Ya(t,"network-request-failed",{message:String(s)})}}async function tv(t,e,n,r,s={}){const i=await Hl(t,e,n,r,s);return"mfaPendingCredential"in i&&Ya(t,"multi-factor-auth-required",{_serverResponse:i}),i}function d6(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?ck(t.config,s):`${t.config.apiScheme}://${s}`}function zte(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Hte{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(So(this.auth,"network-request-failed")),Ute.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function jx(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=So(t,e,r);return s.customData._tokenResponse=n,s}function eR(t){return t!==void 0&&t.enterprise!==void 0}class Wte{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return zte(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function qte(t,e){return Hl(t,"GET","/v2/recaptchaConfig",zl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gte(t,e){return Hl(t,"POST","/v1/accounts:delete",e)}async function h6(t,e){return Hl(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Kte(t,e=!1){const n=Mt(t),r=await n.getIdToken(e),s=uk(r);ct(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:pg(R_(s.auth_time)),issuedAtTime:pg(R_(s.iat)),expirationTime:pg(R_(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function R_(t){return Number(t)*1e3}function uk(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return T0("JWT malformed, contained fewer than 3 sections"),null;try{const s=K3(n);return s?JSON.parse(s):(T0("Failed to decode base64 JWT payload"),null)}catch(s){return T0("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function tR(t){const e=uk(t);return ct(e,"internal-error"),ct(typeof e.exp<"u","internal-error"),ct(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ry(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof $o&&Yte(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Yte({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qte{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=pg(this.lastLoginAt),this.creationTime=pg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tb(t){var e;const n=t.auth,r=await t.getIdToken(),s=await ry(t,h6(n,{idToken:r}));ct(s==null?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?f6(i.providerUserInfo):[],l=Jte(t.providerData,a),c=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(l!=null&&l.length),d=c?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new rC(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function Xte(t){const e=Mt(t);await Tb(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Jte(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function f6(t){return t.map(e=>{var{providerId:n}=e,r=ok(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zte(t,e){const n=await u6(t,{},async()=>{const r=Zy({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=d6(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",c6.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function ene(t,e){return Hl(t,"POST","/v2/accounts:revokeToken",zl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ct(e.idToken,"internal-error"),ct(typeof e.idToken<"u","internal-error"),ct(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):tR(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ct(e.length!==0,"internal-error");const n=tR(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ct(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await Zte(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new Ef;return r&&(ct(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(ct(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(ct(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ef,this.toJSON())}_performRefresh(){return ol("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(t,e){ct(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ll{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=ok(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Qte(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rC(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await ry(this,this.stsTokenManager.getToken(this.auth,e));return ct(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Kte(this,e)}reload(){return Xte(this)}_assign(e){this!==e&&(ct(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ll(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ct(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Tb(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(po(this.auth.app))return Promise.reject(yl(this.auth));const e=await this.getIdToken();return await ry(this,Gte(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,a,l,c,u,d;const h=(r=n.displayName)!==null&&r!==void 0?r:void 0,f=(s=n.email)!==null&&s!==void 0?s:void 0,p=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,m=(a=n.photoURL)!==null&&a!==void 0?a:void 0,g=(l=n.tenantId)!==null&&l!==void 0?l:void 0,y=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,x=(u=n.createdAt)!==null&&u!==void 0?u:void 0,w=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:N,emailVerified:S,isAnonymous:C,providerData:A,stsTokenManager:j}=n;ct(N&&j,e,"internal-error");const _=Ef.fromJSON(this.name,j);ct(typeof N=="string",e,"internal-error"),rc(h,e.name),rc(f,e.name),ct(typeof S=="boolean",e,"internal-error"),ct(typeof C=="boolean",e,"internal-error"),rc(p,e.name),rc(m,e.name),rc(g,e.name),rc(y,e.name),rc(x,e.name),rc(w,e.name);const E=new ll({uid:N,auth:e,email:f,emailVerified:S,displayName:h,isAnonymous:C,photoURL:m,phoneNumber:p,tenantId:g,stsTokenManager:_,createdAt:x,lastLoginAt:w});return A&&Array.isArray(A)&&(E.providerData=A.map(I=>Object.assign({},I))),y&&(E._redirectEventId=y),E}static async _fromIdTokenResponse(e,n,r=!1){const s=new Ef;s.updateFromServerResponse(n);const i=new ll({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Tb(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ct(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?f6(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Ef;l.updateFromIdToken(r);const c=new ll({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new rC(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nR=new Map;function cl(t){Al(t instanceof Function,"Expected a class definition");let e=nR.get(t);return e?(Al(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,nR.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}p6.type="NONE";const rR=p6;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A0(t,e,n){return`firebase:${t}:${e}:${n}`}class Cf{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=A0(this.userKey,s.apiKey,i),this.fullPersistenceKey=A0("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ll._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Cf(cl(rR),e,r);const s=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||cl(rR);const a=A0(r,e.config.apiKey,e.name);let l=null;for(const u of n)try{const d=await u._get(a);if(d){const h=ll._fromJSON(e,d);u!==i&&(l=h),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Cf(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(a)}catch{}})),new Cf(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sR(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(v6(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(m6(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(b6(e))return"Blackberry";if(w6(e))return"Webos";if(g6(e))return"Safari";if((e.includes("chrome/")||y6(e))&&!e.includes("edge/"))return"Chrome";if(x6(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function m6(t=Cr()){return/firefox\//i.test(t)}function g6(t=Cr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function y6(t=Cr()){return/crios\//i.test(t)}function v6(t=Cr()){return/iemobile/i.test(t)}function x6(t=Cr()){return/android/i.test(t)}function b6(t=Cr()){return/blackberry/i.test(t)}function w6(t=Cr()){return/webos/i.test(t)}function dk(t=Cr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function tne(t=Cr()){var e;return dk(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function nne(){return xee()&&document.documentMode===10}function N6(t=Cr()){return dk(t)||x6(t)||w6(t)||b6(t)||/windows phone/i.test(t)||v6(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(t,e=[]){let n;switch(t){case"Browser":n=sR(Cr());break;case"Worker":n=`${sR(Cr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${yh}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rne{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sne(t,e={}){return Hl(t,"GET","/v2/passwordPolicy",zl(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ine=6;class ane{constructor(e){var n,r,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=a.minPasswordLength)!==null&&n!==void 0?n:ine,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,i,a,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class one{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new iR(this),this.idTokenSubscription=new iR(this),this.beforeStateQueue=new rne(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=o6,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=cl(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Cf.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await h6(this,{idToken:e}),r=await ll._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(po(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(s=c.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ct(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Tb(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Vte()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(po(this.app))return Promise.reject(yl(this));const n=e?Mt(e):null;return n&&ct(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ct(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return po(this.app)?Promise.reject(yl(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return po(this.app)?Promise.reject(yl(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(cl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await sne(this),n=new ane(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Jy("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await ene(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&cl(e)||this._popupRedirectResolver;ct(n,this,"argument-error"),this.redirectPersistenceManager=await Cf.create(this,[cl(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ct(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(n);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ct(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=S6(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&Lte(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Nu(t){return Mt(t)}class iR{constructor(e){this.auth=e,this.observer=null,this.addObserver=jee(n=>this.observer=n)}get next(){return ct(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lne(t){nN=t}function _6(t){return nN.loadJS(t)}function cne(){return nN.recaptchaEnterpriseScript}function une(){return nN.gapiScript}function dne(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const hne="recaptcha-enterprise",fne="NO_RECAPTCHA";class pne{constructor(e){this.type=hne,this.auth=Nu(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{qte(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new Wte(c);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,a(u.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;eR(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(u=>{a(u)}).catch(()=>{a(fne)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&eR(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=cne();c.length!==0&&(c+=l),_6(c).then(()=>{s(l,i,a)}).catch(u=>{a(u)})}}).catch(l=>{a(l)})})}}async function aR(t,e,n,r=!1){const s=new pne(t);let i;try{i=await s.verify(n)}catch{i=await s.verify(n,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ab(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await aR(t,e,n,n==="getOobCode");return r(t,i)}else return r(t,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await aR(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mne(t,e){const n=gh(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(su(i,e??{}))return s;Ya(s,"already-initialized")}return n.initialize({options:e})}function gne(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(cl);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function yne(t,e,n){const r=Nu(t);ct(r._canInitEmulator,r,"emulator-config-failed"),ct(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=j6(e),{host:a,port:l}=vne(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),xne()}function j6(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function vne(t){const e=j6(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:oR(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:oR(a)}}}function oR(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function xne(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ol("not implemented")}_getIdTokenResponse(e){return ol("not implemented")}_linkToIdToken(e,n){return ol("not implemented")}_getReauthenticationResolver(e){return ol("not implemented")}}async function bne(t,e){return Hl(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wne(t,e){return tv(t,"POST","/v1/accounts:signInWithPassword",zl(t,e))}async function Nne(t,e){return Hl(t,"POST","/v1/accounts:sendOobCode",zl(t,e))}async function Sne(t,e){return Nne(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _ne(t,e){return tv(t,"POST","/v1/accounts:signInWithEmailLink",zl(t,e))}async function jne(t,e){return tv(t,"POST","/v1/accounts:signInWithEmailLink",zl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy extends hk{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new sy(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new sy(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ab(e,n,"signInWithPassword",wne);case"emailLink":return _ne(e,{email:this._email,oobCode:this._password});default:Ya(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ab(e,r,"signUpPassword",bne);case"emailLink":return jne(e,{idToken:n,email:this._email,oobCode:this._password});default:Ya(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tf(t,e){return tv(t,"POST","/v1/accounts:signInWithIdp",zl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ene="http://localhost";class Ld extends hk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ld(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ya("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=ok(n,["providerId","signInMethod"]);if(!r||!s)return null;const a=new Ld(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return Tf(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Tf(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Tf(e,n)}buildRequest(){const e={requestUri:Ene,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zy(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cne(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Tne(t){const e=qm(Gm(t)).link,n=e?qm(Gm(e)).deep_link_id:null,r=qm(Gm(t)).deep_link_id;return(r?qm(Gm(r)).link:null)||r||n||e||t}class fk{constructor(e){var n,r,s,i,a,l;const c=qm(Gm(e)),u=(n=c.apiKey)!==null&&n!==void 0?n:null,d=(r=c.oobCode)!==null&&r!==void 0?r:null,h=Cne((s=c.mode)!==null&&s!==void 0?s:null);ct(u&&d&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=d,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=c.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=Tne(e);try{return new fk(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(){this.providerId=Dp.PROVIDER_ID}static credential(e,n){return sy._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=fk.parseLink(n);return ct(r,"argument-error"),sy._fromEmailAndCode(e,r.code,r.tenantId)}}Dp.PROVIDER_ID="password";Dp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Dp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E6{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv extends E6{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc extends nv{constructor(){super("facebook.com")}static credential(e){return Ld._fromParams({providerId:vc.PROVIDER_ID,signInMethod:vc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vc.credentialFromTaggedObject(e)}static credentialFromError(e){return vc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vc.credential(e.oauthAccessToken)}catch{return null}}}vc.FACEBOOK_SIGN_IN_METHOD="facebook.com";vc.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends nv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ld._fromParams({providerId:xc.PROVIDER_ID,signInMethod:xc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return xc.credentialFromTaggedObject(e)}static credentialFromError(e){return xc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return xc.credential(n,r)}catch{return null}}}xc.GOOGLE_SIGN_IN_METHOD="google.com";xc.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc extends nv{constructor(){super("github.com")}static credential(e){return Ld._fromParams({providerId:bc.PROVIDER_ID,signInMethod:bc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bc.credentialFromTaggedObject(e)}static credentialFromError(e){return bc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bc.credential(e.oauthAccessToken)}catch{return null}}}bc.GITHUB_SIGN_IN_METHOD="github.com";bc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc extends nv{constructor(){super("twitter.com")}static credential(e,n){return Ld._fromParams({providerId:wc.PROVIDER_ID,signInMethod:wc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return wc.credentialFromTaggedObject(e)}static credentialFromError(e){return wc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return wc.credential(n,r)}catch{return null}}}wc.TWITTER_SIGN_IN_METHOD="twitter.com";wc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ane(t,e){return tv(t,"POST","/v1/accounts:signUp",zl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await ll._fromIdTokenResponse(e,r,s),a=lR(r);return new Fd({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=lR(r);return new Fd({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function lR(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb extends $o{constructor(e,n,r,s){var i;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,kb.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new kb(e,n,r,s)}}function C6(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?kb._fromErrorAndOperation(t,i,e,r):i})}async function kne(t,e,n=!1){const r=await ry(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Fd._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ine(t,e,n=!1){const{auth:r}=t;if(po(r.app))return Promise.reject(yl(r));const s="reauthenticate";try{const i=await ry(t,C6(r,s,e,t),n);ct(i.idToken,r,"internal-error");const a=uk(i.idToken);ct(a,r,"internal-error");const{sub:l}=a;return ct(t.uid===l,r,"user-mismatch"),Fd._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ya(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T6(t,e,n=!1){if(po(t.app))return Promise.reject(yl(t));const r="signIn",s=await C6(t,r,e),i=await Fd._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function Pne(t,e){return T6(Nu(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A6(t){const e=Nu(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function One(t,e,n){const r=Nu(t);await Ab(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Sne)}async function Dne(t,e,n){if(po(t.app))return Promise.reject(yl(t));const r=Nu(t),a=await Ab(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ane).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&A6(t),c}),l=await Fd._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Rne(t,e,n){return po(t.app)?Promise.reject(yl(t)):Pne(Mt(t),Dp.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&A6(t),r})}function Mne(t,e,n,r){return Mt(t).onIdTokenChanged(e,n,r)}function Lne(t,e,n){return Mt(t).beforeAuthStateChanged(e,n)}function Fne(t,e,n,r){return Mt(t).onAuthStateChanged(e,n,r)}function cR(t){return Mt(t).signOut()}const Ib="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ib,"1"),this.storage.removeItem(Ib),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bne=1e3,Vne=10;class I6 extends k6{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=N6(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);nne()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Vne):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Bne)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}I6.type="LOCAL";const $ne=I6;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6 extends k6{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}P6.type="SESSION";const O6=P6;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Une(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new rN(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async u=>u(n.origin,i)),c=await Une(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}rN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zne{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const u=pk("",20);s.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(d),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _o(){return window}function Hne(t){_o().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6(){return typeof _o().WorkerGlobalScope<"u"&&typeof _o().importScripts=="function"}async function Wne(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function qne(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Gne(){return D6()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R6="firebaseLocalStorageDb",Kne=1,Pb="firebaseLocalStorage",M6="fbase_key";class rv{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function sN(t,e){return t.transaction([Pb],e?"readwrite":"readonly").objectStore(Pb)}function Yne(){const t=indexedDB.deleteDatabase(R6);return new rv(t).toPromise()}function sC(){const t=indexedDB.open(R6,Kne);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Pb,{keyPath:M6})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Pb)?e(r):(r.close(),await Yne(),e(await sC()))})})}async function uR(t,e,n){const r=sN(t,!0).put({[M6]:e,value:n});return new rv(r).toPromise()}async function Qne(t,e){const n=sN(t,!1).get(e),r=await new rv(n).toPromise();return r===void 0?null:r.value}function dR(t,e){const n=sN(t,!0).delete(e);return new rv(n).toPromise()}const Xne=800,Jne=3;class L6{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sC(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Jne)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return D6()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rN._getInstance(Gne()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Wne(),!this.activeServiceWorker)return;this.sender=new zne(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||qne()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await sC();return await uR(e,Ib,"1"),await dR(e,Ib),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>uR(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>Qne(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>dR(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=sN(s,!1).getAll();return new rv(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Xne)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}L6.type="LOCAL";const Zne=L6;new ev(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ere(t,e){return e?cl(e):(ct(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk extends hk{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Tf(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Tf(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Tf(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function tre(t){return T6(t.auth,new mk(t),t.bypassAuthState)}function nre(t){const{auth:e,user:n}=t;return ct(n,e,"internal-error"),Ine(n,new mk(t),t.bypassAuthState)}async function rre(t){const{auth:e,user:n}=t;return ct(n,e,"internal-error"),kne(n,new mk(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tre;case"linkViaPopup":case"linkViaRedirect":return rre;case"reauthViaPopup":case"reauthViaRedirect":return nre;default:Ya(this.auth,"internal-error")}}resolve(e){Al(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Al(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sre=new ev(2e3,1e4);class ff extends F6{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ff.currentPopupAction&&ff.currentPopupAction.cancel(),ff.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ct(e,this.auth,"internal-error"),e}async onExecution(){Al(this.filter.length===1,"Popup operations only handle one event");const e=pk();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(So(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(So(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ff.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(So(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,sre.get())};e()}}ff.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ire="pendingRedirect",k0=new Map;class are extends F6{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=k0.get(this.auth._key());if(!e){try{const r=await ore(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}k0.set(this.auth._key(),e)}return this.bypassAuthState||k0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ore(t,e){const n=ure(e),r=cre(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function lre(t,e){k0.set(t._key(),e)}function cre(t){return cl(t._redirectPersistence)}function ure(t){return A0(ire,t.config.apiKey,t.name)}async function dre(t,e,n=!1){if(po(t.app))return Promise.reject(yl(t));const r=Nu(t),s=ere(r,e),a=await new are(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hre=10*60*1e3;class fre{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pre(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!B6(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(So(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hre&&this.cachedEventUids.clear(),this.cachedEventUids.has(hR(e))}saveEventToCache(e){this.cachedEventUids.add(hR(e)),this.lastProcessedEventTime=Date.now()}}function hR(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function B6({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pre(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return B6(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mre(t,e={}){return Hl(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gre=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yre=/^https?/;async function vre(t){if(t.config.emulator)return;const{authorizedDomains:e}=await mre(t);for(const n of e)try{if(xre(n))return}catch{}Ya(t,"unauthorized-domain")}function xre(t){const e=nC(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!yre.test(n))return!1;if(gre.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bre=new ev(3e4,6e4);function fR(){const t=_o().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function wre(t){return new Promise((e,n)=>{var r,s,i;function a(){fR(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fR(),n(So(t,"network-request-failed"))},timeout:bre.get()})}if(!((s=(r=_o().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=_o().gapi)===null||i===void 0)&&i.load)a();else{const l=dne("iframefcb");return _o()[l]=()=>{gapi.load?a():n(So(t,"network-request-failed"))},_6(`${une()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw I0=null,e})}let I0=null;function Nre(t){return I0=I0||wre(t),I0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sre=new ev(5e3,15e3),_re="__/auth/iframe",jre="emulator/auth/iframe",Ere={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Cre=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Tre(t){const e=t.config;ct(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?ck(e,jre):`https://${t.config.authDomain}/${_re}`,r={apiKey:e.apiKey,appName:t.name,v:yh},s=Cre.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Zy(r).slice(1)}`}async function Are(t){const e=await Nre(t),n=_o().gapi;return ct(n,t,"internal-error"),e.open({where:document.body,url:Tre(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ere,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=So(t,"network-request-failed"),l=_o().setTimeout(()=>{i(a)},Sre.get());function c(){_o().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kre={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ire=500,Pre=600,Ore="_blank",Dre="http://localhost";class pR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Rre(t,e,n,r=Ire,s=Pre){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},kre),{width:r.toString(),height:s.toString(),top:i,left:a}),u=Cr().toLowerCase();n&&(l=y6(u)?Ore:n),m6(u)&&(e=e||Dre,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[p,m])=>`${f}${p}=${m},`,"");if(tne(u)&&l!=="_self")return Mre(e||"",l),new pR(null);const h=window.open(e||"",l,d);ct(h,t,"popup-blocked");try{h.focus()}catch{}return new pR(h)}function Mre(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lre="__/auth/handler",Fre="emulator/auth/handler",Bre=encodeURIComponent("fac");async function mR(t,e,n,r,s,i){ct(t.config.authDomain,t,"auth-domain-config-required"),ct(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:yh,eventId:s};if(e instanceof E6){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",_ee(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))a[d]=h}if(e instanceof nv){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(a.scopes=d.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const d of Object.keys(l))l[d]===void 0&&delete l[d];const c=await t._getAppCheckToken(),u=c?`#${Bre}=${encodeURIComponent(c)}`:"";return`${Vre(t)}?${Zy(l).slice(1)}${u}`}function Vre({config:t}){return t.emulator?ck(t,Fre):`https://${t.authDomain}/${Lre}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M_="webStorageSupport";class $re{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=O6,this._completeRedirectFn=dre,this._overrideRedirectResult=lre}async _openPopup(e,n,r,s){var i;Al((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await mR(e,n,r,nC(),s);return Rre(e,a,pk())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await mR(e,n,r,nC(),s);return Hne(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Al(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Are(e),r=new fre(e);return n.register("authEvent",s=>(ct(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(M_,{type:M_},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[M_];a!==void 0&&n(!!a),Ya(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=vre(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return N6()||g6()||dk()}}const Ure=$re;var gR="@firebase/auth",yR="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zre{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ct(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hre(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Wre(t){iu(new Cl("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;ct(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:S6(t)},u=new one(r,s,i,c);return gne(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),iu(new Cl("auth-internal",e=>{const n=Nu(e.getProvider("auth").getImmediate());return(r=>new zre(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),xa(gR,yR,Hre(t)),xa(gR,yR,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qre=5*60,Gre=X3("authIdTokenMaxAge")||qre;let vR=null;const Kre=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Gre)return;const s=n==null?void 0:n.token;vR!==s&&(vR=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Yre(t=tN()){const e=gh(t,"auth");if(e.isInitialized())return e.getImmediate();const n=mne(t,{popupRedirectResolver:Ure,persistence:[Zne,$ne,O6]}),r=X3("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Kre(i.toString());Lne(n,a,()=>a(n.currentUser)),Mne(n,l=>a(l))}}const s=Y3("auth");return s&&yne(n,`http://${s}`),n}function Qre(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}lne({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=So("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",Qre().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Wre("Browser");var xR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bd,V6;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(j,_){function E(){}E.prototype=_.prototype,j.D=_.prototype,j.prototype=new E,j.prototype.constructor=j,j.C=function(I,T,P){for(var O=Array(arguments.length-2),H=2;H<arguments.length;H++)O[H-2]=arguments[H];return _.prototype[T].apply(I,O)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(j,_,E){E||(E=0);var I=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)I[T]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(T=0;16>T;++T)I[T]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=j.g[0],E=j.g[1],T=j.g[2];var P=j.g[3],O=_+(P^E&(T^P))+I[0]+3614090360&4294967295;_=E+(O<<7&4294967295|O>>>25),O=P+(T^_&(E^T))+I[1]+3905402710&4294967295,P=_+(O<<12&4294967295|O>>>20),O=T+(E^P&(_^E))+I[2]+606105819&4294967295,T=P+(O<<17&4294967295|O>>>15),O=E+(_^T&(P^_))+I[3]+3250441966&4294967295,E=T+(O<<22&4294967295|O>>>10),O=_+(P^E&(T^P))+I[4]+4118548399&4294967295,_=E+(O<<7&4294967295|O>>>25),O=P+(T^_&(E^T))+I[5]+1200080426&4294967295,P=_+(O<<12&4294967295|O>>>20),O=T+(E^P&(_^E))+I[6]+2821735955&4294967295,T=P+(O<<17&4294967295|O>>>15),O=E+(_^T&(P^_))+I[7]+4249261313&4294967295,E=T+(O<<22&4294967295|O>>>10),O=_+(P^E&(T^P))+I[8]+1770035416&4294967295,_=E+(O<<7&4294967295|O>>>25),O=P+(T^_&(E^T))+I[9]+2336552879&4294967295,P=_+(O<<12&4294967295|O>>>20),O=T+(E^P&(_^E))+I[10]+4294925233&4294967295,T=P+(O<<17&4294967295|O>>>15),O=E+(_^T&(P^_))+I[11]+2304563134&4294967295,E=T+(O<<22&4294967295|O>>>10),O=_+(P^E&(T^P))+I[12]+1804603682&4294967295,_=E+(O<<7&4294967295|O>>>25),O=P+(T^_&(E^T))+I[13]+4254626195&4294967295,P=_+(O<<12&4294967295|O>>>20),O=T+(E^P&(_^E))+I[14]+2792965006&4294967295,T=P+(O<<17&4294967295|O>>>15),O=E+(_^T&(P^_))+I[15]+1236535329&4294967295,E=T+(O<<22&4294967295|O>>>10),O=_+(T^P&(E^T))+I[1]+4129170786&4294967295,_=E+(O<<5&4294967295|O>>>27),O=P+(E^T&(_^E))+I[6]+3225465664&4294967295,P=_+(O<<9&4294967295|O>>>23),O=T+(_^E&(P^_))+I[11]+643717713&4294967295,T=P+(O<<14&4294967295|O>>>18),O=E+(P^_&(T^P))+I[0]+3921069994&4294967295,E=T+(O<<20&4294967295|O>>>12),O=_+(T^P&(E^T))+I[5]+3593408605&4294967295,_=E+(O<<5&4294967295|O>>>27),O=P+(E^T&(_^E))+I[10]+38016083&4294967295,P=_+(O<<9&4294967295|O>>>23),O=T+(_^E&(P^_))+I[15]+3634488961&4294967295,T=P+(O<<14&4294967295|O>>>18),O=E+(P^_&(T^P))+I[4]+3889429448&4294967295,E=T+(O<<20&4294967295|O>>>12),O=_+(T^P&(E^T))+I[9]+568446438&4294967295,_=E+(O<<5&4294967295|O>>>27),O=P+(E^T&(_^E))+I[14]+3275163606&4294967295,P=_+(O<<9&4294967295|O>>>23),O=T+(_^E&(P^_))+I[3]+4107603335&4294967295,T=P+(O<<14&4294967295|O>>>18),O=E+(P^_&(T^P))+I[8]+1163531501&4294967295,E=T+(O<<20&4294967295|O>>>12),O=_+(T^P&(E^T))+I[13]+2850285829&4294967295,_=E+(O<<5&4294967295|O>>>27),O=P+(E^T&(_^E))+I[2]+4243563512&4294967295,P=_+(O<<9&4294967295|O>>>23),O=T+(_^E&(P^_))+I[7]+1735328473&4294967295,T=P+(O<<14&4294967295|O>>>18),O=E+(P^_&(T^P))+I[12]+2368359562&4294967295,E=T+(O<<20&4294967295|O>>>12),O=_+(E^T^P)+I[5]+4294588738&4294967295,_=E+(O<<4&4294967295|O>>>28),O=P+(_^E^T)+I[8]+2272392833&4294967295,P=_+(O<<11&4294967295|O>>>21),O=T+(P^_^E)+I[11]+1839030562&4294967295,T=P+(O<<16&4294967295|O>>>16),O=E+(T^P^_)+I[14]+4259657740&4294967295,E=T+(O<<23&4294967295|O>>>9),O=_+(E^T^P)+I[1]+2763975236&4294967295,_=E+(O<<4&4294967295|O>>>28),O=P+(_^E^T)+I[4]+1272893353&4294967295,P=_+(O<<11&4294967295|O>>>21),O=T+(P^_^E)+I[7]+4139469664&4294967295,T=P+(O<<16&4294967295|O>>>16),O=E+(T^P^_)+I[10]+3200236656&4294967295,E=T+(O<<23&4294967295|O>>>9),O=_+(E^T^P)+I[13]+681279174&4294967295,_=E+(O<<4&4294967295|O>>>28),O=P+(_^E^T)+I[0]+3936430074&4294967295,P=_+(O<<11&4294967295|O>>>21),O=T+(P^_^E)+I[3]+3572445317&4294967295,T=P+(O<<16&4294967295|O>>>16),O=E+(T^P^_)+I[6]+76029189&4294967295,E=T+(O<<23&4294967295|O>>>9),O=_+(E^T^P)+I[9]+3654602809&4294967295,_=E+(O<<4&4294967295|O>>>28),O=P+(_^E^T)+I[12]+3873151461&4294967295,P=_+(O<<11&4294967295|O>>>21),O=T+(P^_^E)+I[15]+530742520&4294967295,T=P+(O<<16&4294967295|O>>>16),O=E+(T^P^_)+I[2]+3299628645&4294967295,E=T+(O<<23&4294967295|O>>>9),O=_+(T^(E|~P))+I[0]+4096336452&4294967295,_=E+(O<<6&4294967295|O>>>26),O=P+(E^(_|~T))+I[7]+1126891415&4294967295,P=_+(O<<10&4294967295|O>>>22),O=T+(_^(P|~E))+I[14]+2878612391&4294967295,T=P+(O<<15&4294967295|O>>>17),O=E+(P^(T|~_))+I[5]+4237533241&4294967295,E=T+(O<<21&4294967295|O>>>11),O=_+(T^(E|~P))+I[12]+1700485571&4294967295,_=E+(O<<6&4294967295|O>>>26),O=P+(E^(_|~T))+I[3]+2399980690&4294967295,P=_+(O<<10&4294967295|O>>>22),O=T+(_^(P|~E))+I[10]+4293915773&4294967295,T=P+(O<<15&4294967295|O>>>17),O=E+(P^(T|~_))+I[1]+2240044497&4294967295,E=T+(O<<21&4294967295|O>>>11),O=_+(T^(E|~P))+I[8]+1873313359&4294967295,_=E+(O<<6&4294967295|O>>>26),O=P+(E^(_|~T))+I[15]+4264355552&4294967295,P=_+(O<<10&4294967295|O>>>22),O=T+(_^(P|~E))+I[6]+2734768916&4294967295,T=P+(O<<15&4294967295|O>>>17),O=E+(P^(T|~_))+I[13]+1309151649&4294967295,E=T+(O<<21&4294967295|O>>>11),O=_+(T^(E|~P))+I[4]+4149444226&4294967295,_=E+(O<<6&4294967295|O>>>26),O=P+(E^(_|~T))+I[11]+3174756917&4294967295,P=_+(O<<10&4294967295|O>>>22),O=T+(_^(P|~E))+I[2]+718787259&4294967295,T=P+(O<<15&4294967295|O>>>17),O=E+(P^(T|~_))+I[9]+3951481745&4294967295,j.g[0]=j.g[0]+_&4294967295,j.g[1]=j.g[1]+(T+(O<<21&4294967295|O>>>11))&4294967295,j.g[2]=j.g[2]+T&4294967295,j.g[3]=j.g[3]+P&4294967295}r.prototype.u=function(j,_){_===void 0&&(_=j.length);for(var E=_-this.blockSize,I=this.B,T=this.h,P=0;P<_;){if(T==0)for(;P<=E;)s(this,j,P),P+=this.blockSize;if(typeof j=="string"){for(;P<_;)if(I[T++]=j.charCodeAt(P++),T==this.blockSize){s(this,I),T=0;break}}else for(;P<_;)if(I[T++]=j[P++],T==this.blockSize){s(this,I),T=0;break}}this.h=T,this.o+=_},r.prototype.v=function(){var j=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);j[0]=128;for(var _=1;_<j.length-8;++_)j[_]=0;var E=8*this.o;for(_=j.length-8;_<j.length;++_)j[_]=E&255,E/=256;for(this.u(j),j=Array(16),_=E=0;4>_;++_)for(var I=0;32>I;I+=8)j[E++]=this.g[_]>>>I&255;return j};function i(j,_){var E=l;return Object.prototype.hasOwnProperty.call(E,j)?E[j]:E[j]=_(j)}function a(j,_){this.h=_;for(var E=[],I=!0,T=j.length-1;0<=T;T--){var P=j[T]|0;I&&P==_||(E[T]=P,I=!1)}this.g=E}var l={};function c(j){return-128<=j&&128>j?i(j,function(_){return new a([_|0],0>_?-1:0)}):new a([j|0],0>j?-1:0)}function u(j){if(isNaN(j)||!isFinite(j))return h;if(0>j)return y(u(-j));for(var _=[],E=1,I=0;j>=E;I++)_[I]=j/E|0,E*=4294967296;return new a(_,0)}function d(j,_){if(j.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(j.charAt(0)=="-")return y(d(j.substring(1),_));if(0<=j.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(_,8)),I=h,T=0;T<j.length;T+=8){var P=Math.min(8,j.length-T),O=parseInt(j.substring(T,T+P),_);8>P?(P=u(Math.pow(_,P)),I=I.j(P).add(u(O))):(I=I.j(E),I=I.add(u(O)))}return I}var h=c(0),f=c(1),p=c(16777216);t=a.prototype,t.m=function(){if(g(this))return-y(this).m();for(var j=0,_=1,E=0;E<this.g.length;E++){var I=this.i(E);j+=(0<=I?I:4294967296+I)*_,_*=4294967296}return j},t.toString=function(j){if(j=j||10,2>j||36<j)throw Error("radix out of range: "+j);if(m(this))return"0";if(g(this))return"-"+y(this).toString(j);for(var _=u(Math.pow(j,6)),E=this,I="";;){var T=S(E,_).g;E=x(E,T.j(_));var P=((0<E.g.length?E.g[0]:E.h)>>>0).toString(j);if(E=T,m(E))return P+I;for(;6>P.length;)P="0"+P;I=P+I}},t.i=function(j){return 0>j?0:j<this.g.length?this.g[j]:this.h};function m(j){if(j.h!=0)return!1;for(var _=0;_<j.g.length;_++)if(j.g[_]!=0)return!1;return!0}function g(j){return j.h==-1}t.l=function(j){return j=x(this,j),g(j)?-1:m(j)?0:1};function y(j){for(var _=j.g.length,E=[],I=0;I<_;I++)E[I]=~j.g[I];return new a(E,~j.h).add(f)}t.abs=function(){return g(this)?y(this):this},t.add=function(j){for(var _=Math.max(this.g.length,j.g.length),E=[],I=0,T=0;T<=_;T++){var P=I+(this.i(T)&65535)+(j.i(T)&65535),O=(P>>>16)+(this.i(T)>>>16)+(j.i(T)>>>16);I=O>>>16,P&=65535,O&=65535,E[T]=O<<16|P}return new a(E,E[E.length-1]&-2147483648?-1:0)};function x(j,_){return j.add(y(_))}t.j=function(j){if(m(this)||m(j))return h;if(g(this))return g(j)?y(this).j(y(j)):y(y(this).j(j));if(g(j))return y(this.j(y(j)));if(0>this.l(p)&&0>j.l(p))return u(this.m()*j.m());for(var _=this.g.length+j.g.length,E=[],I=0;I<2*_;I++)E[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<j.g.length;T++){var P=this.i(I)>>>16,O=this.i(I)&65535,H=j.i(T)>>>16,X=j.i(T)&65535;E[2*I+2*T]+=O*X,w(E,2*I+2*T),E[2*I+2*T+1]+=P*X,w(E,2*I+2*T+1),E[2*I+2*T+1]+=O*H,w(E,2*I+2*T+1),E[2*I+2*T+2]+=P*H,w(E,2*I+2*T+2)}for(I=0;I<_;I++)E[I]=E[2*I+1]<<16|E[2*I];for(I=_;I<2*_;I++)E[I]=0;return new a(E,0)};function w(j,_){for(;(j[_]&65535)!=j[_];)j[_+1]+=j[_]>>>16,j[_]&=65535,_++}function N(j,_){this.g=j,this.h=_}function S(j,_){if(m(_))throw Error("division by zero");if(m(j))return new N(h,h);if(g(j))return _=S(y(j),_),new N(y(_.g),y(_.h));if(g(_))return _=S(j,y(_)),new N(y(_.g),_.h);if(30<j.g.length){if(g(j)||g(_))throw Error("slowDivide_ only works with positive integers.");for(var E=f,I=_;0>=I.l(j);)E=C(E),I=C(I);var T=A(E,1),P=A(I,1);for(I=A(I,2),E=A(E,2);!m(I);){var O=P.add(I);0>=O.l(j)&&(T=T.add(E),P=O),I=A(I,1),E=A(E,1)}return _=x(j,T.j(_)),new N(T,_)}for(T=h;0<=j.l(_);){for(E=Math.max(1,Math.floor(j.m()/_.m())),I=Math.ceil(Math.log(E)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),P=u(E),O=P.j(_);g(O)||0<O.l(j);)E-=I,P=u(E),O=P.j(_);m(P)&&(P=f),T=T.add(P),j=x(j,O)}return new N(T,j)}t.A=function(j){return S(this,j).h},t.and=function(j){for(var _=Math.max(this.g.length,j.g.length),E=[],I=0;I<_;I++)E[I]=this.i(I)&j.i(I);return new a(E,this.h&j.h)},t.or=function(j){for(var _=Math.max(this.g.length,j.g.length),E=[],I=0;I<_;I++)E[I]=this.i(I)|j.i(I);return new a(E,this.h|j.h)},t.xor=function(j){for(var _=Math.max(this.g.length,j.g.length),E=[],I=0;I<_;I++)E[I]=this.i(I)^j.i(I);return new a(E,this.h^j.h)};function C(j){for(var _=j.g.length+1,E=[],I=0;I<_;I++)E[I]=j.i(I)<<1|j.i(I-1)>>>31;return new a(E,j.h)}function A(j,_){var E=_>>5;_%=32;for(var I=j.g.length-E,T=[],P=0;P<I;P++)T[P]=0<_?j.i(P+E)>>>_|j.i(P+E+1)<<32-_:j.i(P+E);return new a(T,j.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,V6=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=d,bd=a}).apply(typeof xR<"u"?xR:typeof self<"u"?self:typeof window<"u"?window:{});var Ex=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $6,Km,U6,P0,iC,z6,H6,W6;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,k,D){return v==Array.prototype||v==Object.prototype||(v[k]=D.value),v};function n(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ex=="object"&&Ex];for(var k=0;k<v.length;++k){var D=v[k];if(D&&D.Math==Math)return D}throw Error("Cannot find global object")}var r=n(this);function s(v,k){if(k)e:{var D=r;v=v.split(".");for(var F=0;F<v.length-1;F++){var te=v[F];if(!(te in D))break e;D=D[te]}v=v[v.length-1],F=D[v],k=k(F),k!=F&&k!=null&&e(D,v,{configurable:!0,writable:!0,value:k})}}function i(v,k){v instanceof String&&(v+="");var D=0,F=!1,te={next:function(){if(!F&&D<v.length){var de=D++;return{value:k(de,v[de]),done:!1}}return F=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}s("Array.prototype.values",function(v){return v||function(){return i(this,function(k,D){return D})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function c(v){var k=typeof v;return k=k!="object"?k:v?Array.isArray(v)?"array":k:"null",k=="array"||k=="object"&&typeof v.length=="number"}function u(v){var k=typeof v;return k=="object"&&v!=null||k=="function"}function d(v,k,D){return v.call.apply(v.bind,arguments)}function h(v,k,D){if(!v)throw Error();if(2<arguments.length){var F=Array.prototype.slice.call(arguments,2);return function(){var te=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(te,F),v.apply(k,te)}}return function(){return v.apply(k,arguments)}}function f(v,k,D){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:h,f.apply(null,arguments)}function p(v,k){var D=Array.prototype.slice.call(arguments,1);return function(){var F=D.slice();return F.push.apply(F,arguments),v.apply(this,F)}}function m(v,k){function D(){}D.prototype=k.prototype,v.aa=k.prototype,v.prototype=new D,v.prototype.constructor=v,v.Qb=function(F,te,de){for(var Pe=Array(arguments.length-2),on=2;on<arguments.length;on++)Pe[on-2]=arguments[on];return k.prototype[te].apply(F,Pe)}}function g(v){const k=v.length;if(0<k){const D=Array(k);for(let F=0;F<k;F++)D[F]=v[F];return D}return[]}function y(v,k){for(let D=1;D<arguments.length;D++){const F=arguments[D];if(c(F)){const te=v.length||0,de=F.length||0;v.length=te+de;for(let Pe=0;Pe<de;Pe++)v[te+Pe]=F[Pe]}else v.push(F)}}class x{constructor(k,D){this.i=k,this.j=D,this.h=0,this.g=null}get(){let k;return 0<this.h?(this.h--,k=this.g,this.g=k.next,k.next=null):k=this.i(),k}}function w(v){return/^[\s\xa0]*$/.test(v)}function N(){var v=l.navigator;return v&&(v=v.userAgent)?v:""}function S(v){return S[" "](v),v}S[" "]=function(){};var C=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function A(v,k,D){for(const F in v)k.call(D,v[F],F,v)}function j(v,k){for(const D in v)k.call(void 0,v[D],D,v)}function _(v){const k={};for(const D in v)k[D]=v[D];return k}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(v,k){let D,F;for(let te=1;te<arguments.length;te++){F=arguments[te];for(D in F)v[D]=F[D];for(let de=0;de<E.length;de++)D=E[de],Object.prototype.hasOwnProperty.call(F,D)&&(v[D]=F[D])}}function T(v){var k=1;v=v.split(":");const D=[];for(;0<k&&v.length;)D.push(v.shift()),k--;return v.length&&D.push(v.join(":")),D}function P(v){l.setTimeout(()=>{throw v},0)}function O(){var v=$;let k=null;return v.g&&(k=v.g,v.g=v.g.next,v.g||(v.h=null),k.next=null),k}class H{constructor(){this.h=this.g=null}add(k,D){const F=X.get();F.set(k,D),this.h?this.h.next=F:this.g=F,this.h=F}}var X=new x(()=>new se,v=>v.reset());class se{constructor(){this.next=this.g=this.h=null}set(k,D){this.h=k,this.g=D,this.next=null}reset(){this.next=this.g=this.h=null}}let L,B=!1,$=new H,q=()=>{const v=l.Promise.resolve(void 0);L=()=>{v.then(Y)}};var Y=()=>{for(var v;v=O();){try{v.h.call(v.g)}catch(D){P(D)}var k=X;k.j(v),100>k.h&&(k.h++,v.next=k.g,k.g=v)}B=!1};function R(){this.s=this.s,this.C=this.C}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function G(v,k){this.type=v,this.g=this.target=k,this.defaultPrevented=!1}G.prototype.h=function(){this.defaultPrevented=!0};var Z=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var v=!1,k=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const D=()=>{};l.addEventListener("test",D,k),l.removeEventListener("test",D,k)}catch{}return v}();function W(v,k){if(G.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v){var D=this.type=v.type,F=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;if(this.target=v.target||v.srcElement,this.g=k,k=v.relatedTarget){if(C){e:{try{S(k.nodeName);var te=!0;break e}catch{}te=!1}te||(k=null)}}else D=="mouseover"?k=v.fromElement:D=="mouseout"&&(k=v.toElement);this.relatedTarget=k,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=typeof v.pointerType=="string"?v.pointerType:Q[v.pointerType]||"",this.state=v.state,this.i=v,v.defaultPrevented&&W.aa.h.call(this)}}m(W,G);var Q={2:"touch",3:"pen",4:"mouse"};W.prototype.h=function(){W.aa.h.call(this);var v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),pe=0;function J(v,k,D,F,te){this.listener=v,this.proxy=null,this.src=k,this.type=D,this.capture=!!F,this.ha=te,this.key=++pe,this.da=this.fa=!1}function ge(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function me(v){this.src=v,this.g={},this.h=0}me.prototype.add=function(v,k,D,F,te){var de=v.toString();v=this.g[de],v||(v=this.g[de]=[],this.h++);var Pe=st(v,k,F,te);return-1<Pe?(k=v[Pe],D||(k.fa=!1)):(k=new J(k,this.src,de,!!F,te),k.fa=D,v.push(k)),k};function ue(v,k){var D=k.type;if(D in v.g){var F=v.g[D],te=Array.prototype.indexOf.call(F,k,void 0),de;(de=0<=te)&&Array.prototype.splice.call(F,te,1),de&&(ge(k),v.g[D].length==0&&(delete v.g[D],v.h--))}}function st(v,k,D,F){for(var te=0;te<v.length;++te){var de=v[te];if(!de.da&&de.listener==k&&de.capture==!!D&&de.ha==F)return te}return-1}var Ke="closure_lm_"+(1e6*Math.random()|0),ot={};function lt(v,k,D,F,te){if(Array.isArray(k)){for(var de=0;de<k.length;de++)lt(v,k[de],D,F,te);return null}return D=Jn(D),v&&v[U]?v.K(k,D,u(F)?!!F.capture:!1,te):bt(v,k,D,!1,F,te)}function bt(v,k,D,F,te,de){if(!k)throw Error("Invalid event type");var Pe=u(te)?!!te.capture:!!te,on=Qe(v);if(on||(v[Ke]=on=new me(v)),D=on.add(k,D,F,Pe,de),D.proxy)return D;if(F=mt(),D.proxy=F,F.src=v,F.listener=D,v.addEventListener)Z||(te=Pe),te===void 0&&(te=!1),v.addEventListener(k.toString(),F,te);else if(v.attachEvent)v.attachEvent(ie(k.toString()),F);else if(v.addListener&&v.removeListener)v.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return D}function mt(){function v(D){return k.call(v.src,v.listener,D)}const k=Fe;return v}function V(v,k,D,F,te){if(Array.isArray(k))for(var de=0;de<k.length;de++)V(v,k[de],D,F,te);else F=u(F)?!!F.capture:!!F,D=Jn(D),v&&v[U]?(v=v.i,k=String(k).toString(),k in v.g&&(de=v.g[k],D=st(de,D,F,te),-1<D&&(ge(de[D]),Array.prototype.splice.call(de,D,1),de.length==0&&(delete v.g[k],v.h--)))):v&&(v=Qe(v))&&(k=v.g[k.toString()],v=-1,k&&(v=st(k,D,F,te)),(D=-1<v?k[v]:null)&&re(D))}function re(v){if(typeof v!="number"&&v&&!v.da){var k=v.src;if(k&&k[U])ue(k.i,v);else{var D=v.type,F=v.proxy;k.removeEventListener?k.removeEventListener(D,F,v.capture):k.detachEvent?k.detachEvent(ie(D),F):k.addListener&&k.removeListener&&k.removeListener(F),(D=Qe(k))?(ue(D,v),D.h==0&&(D.src=null,k[Ke]=null)):ge(v)}}}function ie(v){return v in ot?ot[v]:ot[v]="on"+v}function Fe(v,k){if(v.da)v=!0;else{k=new W(k,this);var D=v.listener,F=v.ha||v.src;v.fa&&re(v),v=D.call(F,k)}return v}function Qe(v){return v=v[Ke],v instanceof me?v:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jn(v){return typeof v=="function"?v:(v[At]||(v[At]=function(k){return v.handleEvent(k)}),v[At])}function Pt(){R.call(this),this.i=new me(this),this.M=this,this.F=null}m(Pt,R),Pt.prototype[U]=!0,Pt.prototype.removeEventListener=function(v,k,D,F){V(this,v,k,D,F)};function gt(v,k){var D,F=v.F;if(F)for(D=[];F;F=F.F)D.push(F);if(v=v.M,F=k.type||k,typeof k=="string")k=new G(k,v);else if(k instanceof G)k.target=k.target||v;else{var te=k;k=new G(F,v),I(k,te)}if(te=!0,D)for(var de=D.length-1;0<=de;de--){var Pe=k.g=D[de];te=Pn(Pe,F,!0,k)&&te}if(Pe=k.g=v,te=Pn(Pe,F,!0,k)&&te,te=Pn(Pe,F,!1,k)&&te,D)for(de=0;de<D.length;de++)Pe=k.g=D[de],te=Pn(Pe,F,!1,k)&&te}Pt.prototype.N=function(){if(Pt.aa.N.call(this),this.i){var v=this.i,k;for(k in v.g){for(var D=v.g[k],F=0;F<D.length;F++)ge(D[F]);delete v.g[k],v.h--}}this.F=null},Pt.prototype.K=function(v,k,D,F){return this.i.add(String(v),k,!1,D,F)},Pt.prototype.L=function(v,k,D,F){return this.i.add(String(v),k,!0,D,F)};function Pn(v,k,D,F){if(k=v.i.g[String(k)],!k)return!0;k=k.concat();for(var te=!0,de=0;de<k.length;++de){var Pe=k[de];if(Pe&&!Pe.da&&Pe.capture==D){var on=Pe.listener,ts=Pe.ha||Pe.src;Pe.fa&&ue(v.i,Pe),te=on.call(ts,F)!==!1&&te}}return te&&!F.defaultPrevented}function ji(v,k,D){if(typeof v=="function")D&&(v=f(v,D));else if(v&&typeof v.handleEvent=="function")v=f(v.handleEvent,v);else throw Error("Invalid listener argument");return 2147483647<Number(k)?-1:l.setTimeout(v,k||0)}function Zi(v){v.g=ji(()=>{v.g=null,v.i&&(v.i=!1,Zi(v))},v.l);const k=v.h;v.h=null,v.m.apply(null,k)}class ri extends R{constructor(k,D){super(),this.m=k,this.l=D,this.h=null,this.i=!1,this.g=null}j(k){this.h=arguments,this.g?this.i=!0:Zi(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bs(v){R.call(this),this.h=v,this.g={}}m(Bs,R);var ea=[];function he(v){A(v.g,function(k,D){this.g.hasOwnProperty(D)&&re(k)},v),v.g={}}Bs.prototype.N=function(){Bs.aa.N.call(this),he(this)},Bs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Me=l.JSON.stringify,Se=l.JSON.parse,vt=class{stringify(v){return l.JSON.stringify(v,void 0)}parse(v){return l.JSON.parse(v,void 0)}};function it(){}it.prototype.h=null;function kt(v){return v.h||(v.h=v.i())}function an(){}var wt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Lt(){G.call(this,"d")}m(Lt,G);function Vn(){G.call(this,"c")}m(Vn,G);var Zn={},si=null;function Zr(){return si=si||new Pt}Zn.La="serverreachability";function Vs(v){G.call(this,Zn.La,v)}m(Vs,G);function $n(v){const k=Zr();gt(k,new Vs(k))}Zn.STAT_EVENT="statevent";function fe(v,k){G.call(this,Zn.STAT_EVENT,v),this.stat=k}m(fe,G);function Ae(v){const k=Zr();gt(k,new fe(k,v))}Zn.Ma="timingevent";function Je(v,k){G.call(this,Zn.Ma,v),this.size=k}m(Je,G);function $t(v,k){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){v()},k)}function tn(){this.g=!0}tn.prototype.xa=function(){this.g=!1};function bs(v,k,D,F,te,de){v.info(function(){if(v.g)if(de)for(var Pe="",on=de.split("&"),ts=0;ts<on.length;ts++){var zt=on[ts].split("=");if(1<zt.length){var Ss=zt[0];zt=zt[1];var _s=Ss.split("_");Pe=2<=_s.length&&_s[1]=="type"?Pe+(Ss+"="+zt+"&"):Pe+(Ss+"=redacted&")}}else Pe=null;else Pe=de;return"XMLHTTP REQ ("+F+") [attempt "+te+"]: "+k+`
`+D+`
`+Pe})}function gr(v,k,D,F,te,de,Pe){v.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+te+"]: "+k+`
`+D+`
`+de+" "+Pe})}function ir(v,k,D,F){v.info(function(){return"XMLHTTP TEXT ("+k+"): "+ta(v,D)+(F?" "+F:"")})}function Gt(v,k){v.info(function(){return"TIMEOUT: "+k})}tn.prototype.info=function(){};function ta(v,k){if(!v.g)return k;if(!k)return null;try{var D=JSON.parse(k);if(D){for(v=0;v<D.length;v++)if(Array.isArray(D[v])){var F=D[v];if(!(2>F.length)){var te=F[1];if(Array.isArray(te)&&!(1>te.length)){var de=te[0];if(de!="noop"&&de!="stop"&&de!="close")for(var Pe=1;Pe<te.length;Pe++)te[Pe]=""}}}}return Me(D)}catch{return k}}var z={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},le={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},be;function Oe(){}m(Oe,it),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},be=new Oe;function Ue(v,k,D,F){this.j=v,this.i=k,this.l=D,this.R=F||1,this.U=new Bs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ft}function Ft(){this.i=null,this.g="",this.h=!1}var jn={},dn={};function yr(v,k,D){v.L=1,v.v=De(Te(k)),v.m=D,v.P=!0,ws(v,null)}function ws(v,k){v.F=Date.now(),na(v),v.A=Te(v.v);var D=v.A,F=v.R;Array.isArray(F)||(F=[String(F)]),Nr(D.i,"t",F),v.C=0,D=v.j.J,v.h=new Ft,v.g=ND(v.j,D?k:null,!v.m),0<v.O&&(v.M=new ri(f(v.Y,v,v.g),v.O)),k=v.U,D=v.g,F=v.ca;var te="readystatechange";Array.isArray(te)||(te&&(ea[0]=te.toString()),te=ea);for(var de=0;de<te.length;de++){var Pe=lt(D,te[de],F||k.handleEvent,!1,k.h||k);if(!Pe)break;k.g[Pe.key]=Pe}k=v.H?_(v.H):{},v.m?(v.u||(v.u="POST"),k["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.A,v.u,v.m,k)):(v.u="GET",v.g.ea(v.A,v.u,null,k)),$n(),bs(v.i,v.u,v.A,v.l,v.R,v.m)}Ue.prototype.ca=function(v){v=v.target;const k=this.M;k&&qo(v)==3?k.j():this.Y(v)},Ue.prototype.Y=function(v){try{if(v==this.g)e:{const _s=qo(this.g);var k=this.g.Ba();const Ah=this.g.Z();if(!(3>_s)&&(_s!=3||this.g&&(this.h.h||this.g.oa()||dD(this.g)))){this.J||_s!=4||k==7||(k==8||0>=Ah?$n(3):$n(2)),ec(this);var D=this.g.Z();this.X=D;t:if(vr(this)){var F=dD(this.g);v="";var te=F.length,de=qo(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ii(this),ra(this);var Pe="";break t}this.h.i=new l.TextDecoder}for(k=0;k<te;k++)this.h.h=!0,v+=this.h.i.decode(F[k],{stream:!(de&&k==te-1)});F.length=0,this.h.g+=v,this.C=0,Pe=this.h.g}else Pe=this.g.oa();if(this.o=D==200,gr(this.i,this.u,this.A,this.l,this.R,_s,D),this.o){if(this.T&&!this.K){t:{if(this.g){var on,ts=this.g;if((on=ts.g?ts.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(on)){var zt=on;break t}}zt=null}if(D=zt)ir(this.i,this.l,D,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,im(this,D);else{this.o=!1,this.s=3,Ae(12),ii(this),ra(this);break e}}if(this.P){D=!0;let Da;for(;!this.J&&this.C<Pe.length;)if(Da=xr(this,Pe),Da==dn){_s==4&&(this.s=4,Ae(14),D=!1),ir(this.i,this.l,null,"[Incomplete Response]");break}else if(Da==jn){this.s=4,Ae(15),ir(this.i,this.l,Pe,"[Invalid Chunk]"),D=!1;break}else ir(this.i,this.l,Da,null),im(this,Da);if(vr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_s!=4||Pe.length!=0||this.h.h||(this.s=1,Ae(16),D=!1),this.o=this.o&&D,!D)ir(this.i,this.l,Pe,"[Invalid Chunked Response]"),ii(this),ra(this);else if(0<Pe.length&&!this.W){this.W=!0;var Ss=this.j;Ss.g==this&&Ss.ba&&!Ss.M&&(Ss.j.info("Great, no buffering proxy detected. Bytes received: "+Pe.length),e_(Ss),Ss.M=!0,Ae(11))}}else ir(this.i,this.l,Pe,null),im(this,Pe);_s==4&&ii(this),this.o&&!this.J&&(_s==4?vD(this.j,this):(this.o=!1,na(this)))}else wQ(this.g),D==400&&0<Pe.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),ii(this),ra(this)}}}catch{}finally{}};function vr(v){return v.g?v.u=="GET"&&v.L!=2&&v.j.Ca:!1}function xr(v,k){var D=v.C,F=k.indexOf(`
`,D);return F==-1?dn:(D=Number(k.substring(D,F)),isNaN(D)?jn:(F+=1,F+D>k.length?dn:(k=k.slice(F,F+D),v.C=F+D,k)))}Ue.prototype.cancel=function(){this.J=!0,ii(this)};function na(v){v.S=Date.now()+v.I,Ei(v,v.I)}function Ei(v,k){if(v.B!=null)throw Error("WatchDog timer not null");v.B=$t(f(v.ba,v),k)}function ec(v){v.B&&(l.clearTimeout(v.B),v.B=null)}Ue.prototype.ba=function(){this.B=null;const v=Date.now();0<=v-this.S?(Gt(this.i,this.A),this.L!=2&&($n(),Ae(17)),ii(this),this.s=2,ra(this)):Ei(this,this.S-v)};function ra(v){v.j.G==0||v.J||vD(v.j,v)}function ii(v){ec(v);var k=v.M;k&&typeof k.ma=="function"&&k.ma(),v.M=null,he(v.U),v.g&&(k=v.g,v.g=null,k.abort(),k.ma())}function im(v,k){try{var D=v.j;if(D.G!=0&&(D.g==v||tc(D.h,v))){if(!v.K&&tc(D.h,v)&&D.G==3){try{var F=D.Da.g.parse(k)}catch{F=null}if(Array.isArray(F)&&F.length==3){var te=F;if(te[0]==0){e:if(!D.u){if(D.g)if(D.g.F+3e3<v.F)ix(D),rx(D);else break e;ZS(D),Ae(18)}}else D.za=te[1],0<D.za-D.T&&37500>te[2]&&D.F&&D.v==0&&!D.C&&(D.C=$t(f(D.Za,D),6e3));if(1>=Zv(D.h)&&D.ca){try{D.ca()}catch{}D.ca=void 0}}else $u(D,11)}else if((v.K||D.g==v)&&ix(D),!w(k))for(te=D.Da.g.parse(k),k=0;k<te.length;k++){let zt=te[k];if(D.T=zt[0],zt=zt[1],D.G==2)if(zt[0]=="c"){D.K=zt[1],D.ia=zt[2];const Ss=zt[3];Ss!=null&&(D.la=Ss,D.j.info("VER="+D.la));const _s=zt[4];_s!=null&&(D.Aa=_s,D.j.info("SVER="+D.Aa));const Ah=zt[5];Ah!=null&&typeof Ah=="number"&&0<Ah&&(F=1.5*Ah,D.L=F,D.j.info("backChannelRequestTimeoutMs_="+F)),F=D;const Da=v.g;if(Da){const ox=Da.g?Da.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ox){var de=F.h;de.g||ox.indexOf("spdy")==-1&&ox.indexOf("quic")==-1&&ox.indexOf("h2")==-1||(de.j=de.l,de.g=new Set,de.h&&(Ch(de,de.h),de.h=null))}if(F.D){const t_=Da.g?Da.g.getResponseHeader("X-HTTP-Session-Id"):null;t_&&(F.ya=t_,ft(F.I,F.D,t_))}}D.G=3,D.l&&D.l.ua(),D.ba&&(D.R=Date.now()-v.F,D.j.info("Handshake RTT: "+D.R+"ms")),F=D;var Pe=v;if(F.qa=wD(F,F.J?F.ia:null,F.W),Pe.K){am(F.h,Pe);var on=Pe,ts=F.L;ts&&(on.I=ts),on.B&&(ec(on),na(on)),F.g=Pe}else gD(F);0<D.i.length&&sx(D)}else zt[0]!="stop"&&zt[0]!="close"||$u(D,7);else D.G==3&&(zt[0]=="stop"||zt[0]=="close"?zt[0]=="stop"?$u(D,7):JS(D):zt[0]!="noop"&&D.l&&D.l.ta(zt),D.v=0)}}$n(4)}catch{}}var QS=class{constructor(v,k){this.g=v,this.map=k}};function Xv(v){this.l=v||10,l.PerformanceNavigationTiming?(v=l.performance.getEntriesByType("navigation"),v=0<v.length&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Jv(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Zv(v){return v.h?1:v.g?v.g.size:0}function tc(v,k){return v.h?v.h==k:v.g?v.g.has(k):!1}function Ch(v,k){v.g?v.g.add(k):v.h=k}function am(v,k){v.h&&v.h==k?v.h=null:v.g&&v.g.has(k)&&v.g.delete(k)}Xv.prototype.cancel=function(){if(this.i=M(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function M(v){if(v.h!=null)return v.i.concat(v.h.D);if(v.g!=null&&v.g.size!==0){let k=v.i;for(const D of v.g.values())k=k.concat(D.D);return k}return g(v.i)}function ne(v){if(v.V&&typeof v.V=="function")return v.V();if(typeof Map<"u"&&v instanceof Map||typeof Set<"u"&&v instanceof Set)return Array.from(v.values());if(typeof v=="string")return v.split("");if(c(v)){for(var k=[],D=v.length,F=0;F<D;F++)k.push(v[F]);return k}k=[],D=0;for(F in v)k[D++]=v[F];return k}function oe(v){if(v.na&&typeof v.na=="function")return v.na();if(!v.V||typeof v.V!="function"){if(typeof Map<"u"&&v instanceof Map)return Array.from(v.keys());if(!(typeof Set<"u"&&v instanceof Set)){if(c(v)||typeof v=="string"){var k=[];v=v.length;for(var D=0;D<v;D++)k.push(D);return k}k=[],D=0;for(const F in v)k[D++]=F;return k}}}function Ne(v,k){if(v.forEach&&typeof v.forEach=="function")v.forEach(k,void 0);else if(c(v)||typeof v=="string")Array.prototype.forEach.call(v,k,void 0);else for(var D=oe(v),F=ne(v),te=F.length,de=0;de<te;de++)k.call(void 0,F[de],D&&D[de],v)}var Le=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ee(v,k){if(v){v=v.split("&");for(var D=0;D<v.length;D++){var F=v[D].indexOf("="),te=null;if(0<=F){var de=v[D].substring(0,F);te=v[D].substring(F+1)}else de=v[D];k(de,te?decodeURIComponent(te.replace(/\+/g," ")):"")}}}function Ce(v){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,v instanceof Ce){this.h=v.h,Nt(this,v.j),this.o=v.o,this.g=v.g,Ut(this,v.s),this.l=v.l;var k=v.i,D=new nn;D.i=k.i,k.g&&(D.g=new Map(k.g),D.h=k.h),br(this,D),this.m=v.m}else v&&(k=String(v).match(Le))?(this.h=!1,Nt(this,k[1]||"",!0),this.o=Ns(k[2]||""),this.g=Ns(k[3]||"",!0),Ut(this,k[4]),this.l=Ns(k[5]||"",!0),br(this,k[6]||"",!0),this.m=Ns(k[7]||"")):(this.h=!1,this.i=new nn(null,this.h))}Ce.prototype.toString=function(){var v=[],k=this.j;k&&v.push(ar(k,Ho,!0),":");var D=this.g;return(D||k=="file")&&(v.push("//"),(k=this.o)&&v.push(ar(k,Ho,!0),"@"),v.push(encodeURIComponent(String(D)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),D=this.s,D!=null&&v.push(":",String(D))),(D=this.l)&&(this.g&&D.charAt(0)!="/"&&v.push("/"),v.push(ar(D,D.charAt(0)=="/"?or:Et,!0))),(D=this.i.toString())&&v.push("?",D),(D=this.m)&&v.push("#",ar(D,qe)),v.join("")};function Te(v){return new Ce(v)}function Nt(v,k,D){v.j=D?Ns(k,!0):k,v.j&&(v.j=v.j.replace(/:$/,""))}function Ut(v,k){if(k){if(k=Number(k),isNaN(k)||0>k)throw Error("Bad port number "+k);v.s=k}else v.s=null}function br(v,k,D){k instanceof nn?(v.i=k,Wo(v.i,v.h)):(D||(k=ar(k,Oa)),v.i=new nn(k,v.h))}function ft(v,k,D){v.i.set(k,D)}function De(v){return ft(v,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),v}function Ns(v,k){return v?k?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function ar(v,k,D){return typeof v=="string"?(v=encodeURI(v).replace(k,es),D&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function es(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var Ho=/[#\/\?@]/g,Et=/[#\?:]/g,or=/[#\?]/g,Oa=/[#\?@]/g,qe=/#/g;function nn(v,k){this.h=this.g=null,this.i=v||null,this.j=!!k}function Kt(v){v.g||(v.g=new Map,v.h=0,v.i&&Ee(v.i,function(k,D){v.add(decodeURIComponent(k.replace(/\+/g," ")),D)}))}t=nn.prototype,t.add=function(v,k){Kt(this),this.i=null,v=ai(this,v);var D=this.g.get(v);return D||this.g.set(v,D=[]),D.push(k),this.h+=1,this};function wr(v,k){Kt(v),k=ai(v,k),v.g.has(k)&&(v.i=null,v.h-=v.g.get(k).length,v.g.delete(k))}function yn(v,k){return Kt(v),k=ai(v,k),v.g.has(k)}t.forEach=function(v,k){Kt(this),this.g.forEach(function(D,F){D.forEach(function(te){v.call(k,te,F,this)},this)},this)},t.na=function(){Kt(this);const v=Array.from(this.g.values()),k=Array.from(this.g.keys()),D=[];for(let F=0;F<k.length;F++){const te=v[F];for(let de=0;de<te.length;de++)D.push(k[F])}return D},t.V=function(v){Kt(this);let k=[];if(typeof v=="string")yn(this,v)&&(k=k.concat(this.g.get(ai(this,v))));else{v=Array.from(this.g.values());for(let D=0;D<v.length;D++)k=k.concat(v[D])}return k},t.set=function(v,k){return Kt(this),this.i=null,v=ai(this,v),yn(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[k]),this.h+=1,this},t.get=function(v,k){return v?(v=this.V(v),0<v.length?String(v[0]):k):k};function Nr(v,k,D){wr(v,k),0<D.length&&(v.i=null,v.g.set(ai(v,k),g(D)),v.h+=D.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],k=Array.from(this.g.keys());for(var D=0;D<k.length;D++){var F=k[D];const de=encodeURIComponent(String(F)),Pe=this.V(F);for(F=0;F<Pe.length;F++){var te=de;Pe[F]!==""&&(te+="="+encodeURIComponent(String(Pe[F]))),v.push(te)}}return this.i=v.join("&")};function ai(v,k){return k=String(k),v.j&&(k=k.toLowerCase()),k}function Wo(v,k){k&&!v.j&&(Kt(v),v.i=null,v.g.forEach(function(D,F){var te=F.toLowerCase();F!=te&&(wr(this,F),Nr(this,te,D))},v)),v.j=k}function Ci(v,k){const D=new tn;if(l.Image){const F=new Image;F.onload=p(eo,D,"TestLoadImage: loaded",!0,k,F),F.onerror=p(eo,D,"TestLoadImage: error",!1,k,F),F.onabort=p(eo,D,"TestLoadImage: abort",!1,k,F),F.ontimeout=p(eo,D,"TestLoadImage: timeout",!1,k,F),l.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=v}else k(!1)}function om(v,k){const D=new tn,F=new AbortController,te=setTimeout(()=>{F.abort(),eo(D,"TestPingServer: timeout",!1,k)},1e4);fetch(v,{signal:F.signal}).then(de=>{clearTimeout(te),de.ok?eo(D,"TestPingServer: ok",!0,k):eo(D,"TestPingServer: server error",!1,k)}).catch(()=>{clearTimeout(te),eo(D,"TestPingServer: error",!1,k)})}function eo(v,k,D,F,te){try{te&&(te.onload=null,te.onerror=null,te.onabort=null,te.ontimeout=null),F(D)}catch{}}function yQ(){this.g=new vt}function vQ(v,k,D){const F=D||"";try{Ne(v,function(te,de){let Pe=te;u(te)&&(Pe=Me(te)),k.push(F+de+"="+encodeURIComponent(Pe))})}catch(te){throw k.push(F+"type="+encodeURIComponent("_badmap")),te}}function ex(v){this.l=v.Ub||null,this.j=v.eb||!1}m(ex,it),ex.prototype.g=function(){return new tx(this.l,this.j)},ex.prototype.i=function(v){return function(){return v}}({});function tx(v,k){Pt.call(this),this.D=v,this.o=k,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}m(tx,Pt),t=tx.prototype,t.open=function(v,k){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=v,this.A=k,this.readyState=1,cm(this)},t.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const k={headers:this.u,method:this.B,credentials:this.m,cache:void 0};v&&(k.body=v),(this.D||l).fetch(new Request(this.A,k)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,lm(this)),this.readyState=0},t.Sa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,cm(this)),this.g&&(this.readyState=3,cm(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;iD(this)}else v.text().then(this.Ra.bind(this),this.ga.bind(this))};function iD(v){v.j.read().then(v.Pa.bind(v)).catch(v.ga.bind(v))}t.Pa=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var k=v.value?v.value:new Uint8Array(0);(k=this.v.decode(k,{stream:!v.done}))&&(this.response=this.responseText+=k)}v.done?lm(this):cm(this),this.readyState==3&&iD(this)}},t.Ra=function(v){this.g&&(this.response=this.responseText=v,lm(this))},t.Qa=function(v){this.g&&(this.response=v,lm(this))},t.ga=function(){this.g&&lm(this)};function lm(v){v.readyState=4,v.l=null,v.j=null,v.v=null,cm(v)}t.setRequestHeader=function(v,k){this.u.append(v,k)},t.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],k=this.h.entries();for(var D=k.next();!D.done;)D=D.value,v.push(D[0]+": "+D[1]),D=k.next();return v.join(`\r
`)};function cm(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(tx.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function aD(v){let k="";return A(v,function(D,F){k+=F,k+=":",k+=D,k+=`\r
`}),k}function XS(v,k,D){e:{for(F in D){var F=!1;break e}F=!0}F||(D=aD(D),typeof v=="string"?D!=null&&encodeURIComponent(String(D)):ft(v,k,D))}function Un(v){Pt.call(this),this.headers=new Map,this.o=v||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}m(Un,Pt);var xQ=/^https?$/i,bQ=["POST","PUT"];t=Un.prototype,t.Ha=function(v){this.J=v},t.ea=function(v,k,D,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);k=k?k.toUpperCase():"GET",this.D=v,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():be.g(),this.v=this.o?kt(this.o):kt(be),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(k,String(v),!0),this.B=!1}catch(de){oD(this,de);return}if(v=D||"",D=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var te in F)D.set(te,F[te]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const de of F.keys())D.set(de,F.get(de));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(D.keys()).find(de=>de.toLowerCase()=="content-type"),te=l.FormData&&v instanceof l.FormData,!(0<=Array.prototype.indexOf.call(bQ,k,void 0))||F||te||D.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[de,Pe]of D)this.g.setRequestHeader(de,Pe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uD(this),this.u=!0,this.g.send(v),this.u=!1}catch(de){oD(this,de)}};function oD(v,k){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=k,v.m=5,lD(v),nx(v)}function lD(v){v.A||(v.A=!0,gt(v,"complete"),gt(v,"error"))}t.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=v||7,gt(this,"complete"),gt(this,"abort"),nx(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nx(this,!0)),Un.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?cD(this):this.bb())},t.bb=function(){cD(this)};function cD(v){if(v.h&&typeof a<"u"&&(!v.v[1]||qo(v)!=4||v.Z()!=2)){if(v.u&&qo(v)==4)ji(v.Ea,0,v);else if(gt(v,"readystatechange"),qo(v)==4){v.h=!1;try{const Pe=v.Z();e:switch(Pe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var k=!0;break e;default:k=!1}var D;if(!(D=k)){var F;if(F=Pe===0){var te=String(v.D).match(Le)[1]||null;!te&&l.self&&l.self.location&&(te=l.self.location.protocol.slice(0,-1)),F=!xQ.test(te?te.toLowerCase():"")}D=F}if(D)gt(v,"complete"),gt(v,"success");else{v.m=6;try{var de=2<qo(v)?v.g.statusText:""}catch{de=""}v.l=de+" ["+v.Z()+"]",lD(v)}}finally{nx(v)}}}}function nx(v,k){if(v.g){uD(v);const D=v.g,F=v.v[0]?()=>{}:null;v.g=null,v.v=null,k||gt(v,"ready");try{D.onreadystatechange=F}catch{}}}function uD(v){v.I&&(l.clearTimeout(v.I),v.I=null)}t.isActive=function(){return!!this.g};function qo(v){return v.g?v.g.readyState:0}t.Z=function(){try{return 2<qo(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(v){if(this.g){var k=this.g.responseText;return v&&k.indexOf(v)==0&&(k=k.substring(v.length)),Se(k)}};function dD(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.H){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function wQ(v){const k={};v=(v.g&&2<=qo(v)&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<v.length;F++){if(w(v[F]))continue;var D=T(v[F]);const te=D[0];if(D=D[1],typeof D!="string")continue;D=D.trim();const de=k[te]||[];k[te]=de,de.push(D)}j(k,function(F){return F.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function um(v,k,D){return D&&D.internalChannelParams&&D.internalChannelParams[v]||k}function hD(v){this.Aa=0,this.i=[],this.j=new tn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=um("failFast",!1,v),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=um("baseRetryDelayMs",5e3,v),this.cb=um("retryDelaySeedMs",1e4,v),this.Wa=um("forwardChannelMaxRetries",2,v),this.wa=um("forwardChannelRequestTimeoutMs",2e4,v),this.pa=v&&v.xmlHttpFactory||void 0,this.Xa=v&&v.Tb||void 0,this.Ca=v&&v.useFetchStreams||!1,this.L=void 0,this.J=v&&v.supportsCrossDomainXhr||!1,this.K="",this.h=new Xv(v&&v.concurrentRequestLimit),this.Da=new yQ,this.P=v&&v.fastHandshake||!1,this.O=v&&v.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=v&&v.Rb||!1,v&&v.xa&&this.j.xa(),v&&v.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&v&&v.detectBufferingProxy||!1,this.ja=void 0,v&&v.longPollingTimeout&&0<v.longPollingTimeout&&(this.ja=v.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=hD.prototype,t.la=8,t.G=1,t.connect=function(v,k,D,F){Ae(0),this.W=v,this.H=k||{},D&&F!==void 0&&(this.H.OSID=D,this.H.OAID=F),this.F=this.X,this.I=wD(this,null,this.W),sx(this)};function JS(v){if(fD(v),v.G==3){var k=v.U++,D=Te(v.I);if(ft(D,"SID",v.K),ft(D,"RID",k),ft(D,"TYPE","terminate"),dm(v,D),k=new Ue(v,v.j,k),k.L=2,k.v=De(Te(D)),D=!1,l.navigator&&l.navigator.sendBeacon)try{D=l.navigator.sendBeacon(k.v.toString(),"")}catch{}!D&&l.Image&&(new Image().src=k.v,D=!0),D||(k.g=ND(k.j,null),k.g.ea(k.v)),k.F=Date.now(),na(k)}bD(v)}function rx(v){v.g&&(e_(v),v.g.cancel(),v.g=null)}function fD(v){rx(v),v.u&&(l.clearTimeout(v.u),v.u=null),ix(v),v.h.cancel(),v.s&&(typeof v.s=="number"&&l.clearTimeout(v.s),v.s=null)}function sx(v){if(!Jv(v.h)&&!v.s){v.s=!0;var k=v.Ga;L||q(),B||(L(),B=!0),$.add(k,v),v.B=0}}function NQ(v,k){return Zv(v.h)>=v.h.j-(v.s?1:0)?!1:v.s?(v.i=k.D.concat(v.i),!0):v.G==1||v.G==2||v.B>=(v.Va?0:v.Wa)?!1:(v.s=$t(f(v.Ga,v,k),xD(v,v.B)),v.B++,!0)}t.Ga=function(v){if(this.s)if(this.s=null,this.G==1){if(!v){this.U=Math.floor(1e5*Math.random()),v=this.U++;const te=new Ue(this,this.j,v);let de=this.o;if(this.S&&(de?(de=_(de),I(de,this.S)):de=this.S),this.m!==null||this.O||(te.H=de,de=null),this.P)e:{for(var k=0,D=0;D<this.i.length;D++){t:{var F=this.i[D];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(k+=F,4096<k){k=D;break e}if(k===4096||D===this.i.length-1){k=D+1;break e}}k=1e3}else k=1e3;k=mD(this,te,k),D=Te(this.I),ft(D,"RID",v),ft(D,"CVER",22),this.D&&ft(D,"X-HTTP-Session-Id",this.D),dm(this,D),de&&(this.O?k="headers="+encodeURIComponent(String(aD(de)))+"&"+k:this.m&&XS(D,this.m,de)),Ch(this.h,te),this.Ua&&ft(D,"TYPE","init"),this.P?(ft(D,"$req",k),ft(D,"SID","null"),te.T=!0,yr(te,D,null)):yr(te,D,k),this.G=2}}else this.G==3&&(v?pD(this,v):this.i.length==0||Jv(this.h)||pD(this))};function pD(v,k){var D;k?D=k.l:D=v.U++;const F=Te(v.I);ft(F,"SID",v.K),ft(F,"RID",D),ft(F,"AID",v.T),dm(v,F),v.m&&v.o&&XS(F,v.m,v.o),D=new Ue(v,v.j,D,v.B+1),v.m===null&&(D.H=v.o),k&&(v.i=k.D.concat(v.i)),k=mD(v,D,1e3),D.I=Math.round(.5*v.wa)+Math.round(.5*v.wa*Math.random()),Ch(v.h,D),yr(D,F,k)}function dm(v,k){v.H&&A(v.H,function(D,F){ft(k,F,D)}),v.l&&Ne({},function(D,F){ft(k,F,D)})}function mD(v,k,D){D=Math.min(v.i.length,D);var F=v.l?f(v.l.Na,v.l,v):null;e:{var te=v.i;let de=-1;for(;;){const Pe=["count="+D];de==-1?0<D?(de=te[0].g,Pe.push("ofs="+de)):de=0:Pe.push("ofs="+de);let on=!0;for(let ts=0;ts<D;ts++){let zt=te[ts].g;const Ss=te[ts].map;if(zt-=de,0>zt)de=Math.max(0,te[ts].g-100),on=!1;else try{vQ(Ss,Pe,"req"+zt+"_")}catch{F&&F(Ss)}}if(on){F=Pe.join("&");break e}}}return v=v.i.splice(0,D),k.D=v,F}function gD(v){if(!v.g&&!v.u){v.Y=1;var k=v.Fa;L||q(),B||(L(),B=!0),$.add(k,v),v.v=0}}function ZS(v){return v.g||v.u||3<=v.v?!1:(v.Y++,v.u=$t(f(v.Fa,v),xD(v,v.v)),v.v++,!0)}t.Fa=function(){if(this.u=null,yD(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var v=2*this.R;this.j.info("BP detection timer enabled: "+v),this.A=$t(f(this.ab,this),v)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),rx(this),yD(this))};function e_(v){v.A!=null&&(l.clearTimeout(v.A),v.A=null)}function yD(v){v.g=new Ue(v,v.j,"rpc",v.Y),v.m===null&&(v.g.H=v.o),v.g.O=0;var k=Te(v.qa);ft(k,"RID","rpc"),ft(k,"SID",v.K),ft(k,"AID",v.T),ft(k,"CI",v.F?"0":"1"),!v.F&&v.ja&&ft(k,"TO",v.ja),ft(k,"TYPE","xmlhttp"),dm(v,k),v.m&&v.o&&XS(k,v.m,v.o),v.L&&(v.g.I=v.L);var D=v.g;v=v.ia,D.L=1,D.v=De(Te(k)),D.m=null,D.P=!0,ws(D,v)}t.Za=function(){this.C!=null&&(this.C=null,rx(this),ZS(this),Ae(19))};function ix(v){v.C!=null&&(l.clearTimeout(v.C),v.C=null)}function vD(v,k){var D=null;if(v.g==k){ix(v),e_(v),v.g=null;var F=2}else if(tc(v.h,k))D=k.D,am(v.h,k),F=1;else return;if(v.G!=0){if(k.o)if(F==1){D=k.m?k.m.length:0,k=Date.now()-k.F;var te=v.B;F=Zr(),gt(F,new Je(F,D)),sx(v)}else gD(v);else if(te=k.s,te==3||te==0&&0<k.X||!(F==1&&NQ(v,k)||F==2&&ZS(v)))switch(D&&0<D.length&&(k=v.h,k.i=k.i.concat(D)),te){case 1:$u(v,5);break;case 4:$u(v,10);break;case 3:$u(v,6);break;default:$u(v,2)}}}function xD(v,k){let D=v.Ta+Math.floor(Math.random()*v.cb);return v.isActive()||(D*=2),D*k}function $u(v,k){if(v.j.info("Error code "+k),k==2){var D=f(v.fb,v),F=v.Xa;const te=!F;F=new Ce(F||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Nt(F,"https"),De(F),te?Ci(F.toString(),D):om(F.toString(),D)}else Ae(2);v.G=0,v.l&&v.l.sa(k),bD(v),fD(v)}t.fb=function(v){v?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))};function bD(v){if(v.G=0,v.ka=[],v.l){const k=M(v.h);(k.length!=0||v.i.length!=0)&&(y(v.ka,k),y(v.ka,v.i),v.h.i.length=0,g(v.i),v.i.length=0),v.l.ra()}}function wD(v,k,D){var F=D instanceof Ce?Te(D):new Ce(D);if(F.g!="")k&&(F.g=k+"."+F.g),Ut(F,F.s);else{var te=l.location;F=te.protocol,k=k?k+"."+te.hostname:te.hostname,te=+te.port;var de=new Ce(null);F&&Nt(de,F),k&&(de.g=k),te&&Ut(de,te),D&&(de.l=D),F=de}return D=v.D,k=v.ya,D&&k&&ft(F,D,k),ft(F,"VER",v.la),dm(v,F),F}function ND(v,k,D){if(k&&!v.J)throw Error("Can't create secondary domain capable XhrIo object.");return k=v.Ca&&!v.pa?new Un(new ex({eb:D})):new Un(v.pa),k.Ha(v.J),k}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function SD(){}t=SD.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function ax(){}ax.prototype.g=function(v,k){return new Ti(v,k)};function Ti(v,k){Pt.call(this),this.g=new hD(k),this.l=v,this.h=k&&k.messageUrlParams||null,v=k&&k.messageHeaders||null,k&&k.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=k&&k.initMessageHeaders||null,k&&k.messageContentType&&(v?v["X-WebChannel-Content-Type"]=k.messageContentType:v={"X-WebChannel-Content-Type":k.messageContentType}),k&&k.va&&(v?v["X-WebChannel-Client-Profile"]=k.va:v={"X-WebChannel-Client-Profile":k.va}),this.g.S=v,(v=k&&k.Sb)&&!w(v)&&(this.g.m=v),this.v=k&&k.supportsCrossDomainXhr||!1,this.u=k&&k.sendRawJson||!1,(k=k&&k.httpSessionIdParam)&&!w(k)&&(this.g.D=k,v=this.h,v!==null&&k in v&&(v=this.h,k in v&&delete v[k])),this.j=new Th(this)}m(Ti,Pt),Ti.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ti.prototype.close=function(){JS(this.g)},Ti.prototype.o=function(v){var k=this.g;if(typeof v=="string"){var D={};D.__data__=v,v=D}else this.u&&(D={},D.__data__=Me(v),v=D);k.i.push(new QS(k.Ya++,v)),k.G==3&&sx(k)},Ti.prototype.N=function(){this.g.l=null,delete this.j,JS(this.g),delete this.g,Ti.aa.N.call(this)};function _D(v){Lt.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var k=v.__sm__;if(k){e:{for(const D in k){v=D;break e}v=void 0}(this.i=v)&&(v=this.i,k=k!==null&&v in k?k[v]:void 0),this.data=k}else this.data=v}m(_D,Lt);function jD(){Vn.call(this),this.status=1}m(jD,Vn);function Th(v){this.g=v}m(Th,SD),Th.prototype.ua=function(){gt(this.g,"a")},Th.prototype.ta=function(v){gt(this.g,new _D(v))},Th.prototype.sa=function(v){gt(this.g,new jD)},Th.prototype.ra=function(){gt(this.g,"b")},ax.prototype.createWebChannel=ax.prototype.g,Ti.prototype.send=Ti.prototype.o,Ti.prototype.open=Ti.prototype.m,Ti.prototype.close=Ti.prototype.close,W6=function(){return new ax},H6=function(){return Zr()},z6=Zn,iC={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},z.NO_ERROR=0,z.TIMEOUT=8,z.HTTP_ERROR=6,P0=z,le.COMPLETE="complete",U6=le,an.EventType=wt,wt.OPEN="a",wt.CLOSE="b",wt.ERROR="c",wt.MESSAGE="d",Pt.prototype.listen=Pt.prototype.K,Km=an,Un.prototype.listenOnce=Un.prototype.L,Un.prototype.getLastError=Un.prototype.Ka,Un.prototype.getLastErrorCode=Un.prototype.Ba,Un.prototype.getStatus=Un.prototype.Z,Un.prototype.getResponseJson=Un.prototype.Oa,Un.prototype.getResponseText=Un.prototype.oa,Un.prototype.send=Un.prototype.ea,Un.prototype.setWithCredentials=Un.prototype.Ha,$6=Un}).apply(typeof Ex<"u"?Ex:typeof self<"u"?self:typeof window<"u"?window:{});const bR="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rp="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const au=new ik("@firebase/firestore");function Hh(){return au.logLevel}function Xre(t){au.setLogLevel(t)}function xe(t,...e){if(au.logLevel<=Ot.DEBUG){const n=e.map(gk);au.debug(`Firestore (${Rp}): ${t}`,...n)}}function tr(t,...e){if(au.logLevel<=Ot.ERROR){const n=e.map(gk);au.error(`Firestore (${Rp}): ${t}`,...n)}}function zi(t,...e){if(au.logLevel<=Ot.WARN){const n=e.map(gk);au.warn(`Firestore (${Rp}): ${t}`,...n)}}function gk(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $e(t="Unexpected state"){const e=`FIRESTORE (${Rp}) INTERNAL ASSERTION FAILED: `+t;throw tr(e),new Error(e)}function Ge(t,e){t||$e()}function Jre(t,e){t||$e()}function Ie(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ve extends $o{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q6{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G6{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Lr.UNAUTHENTICATED))}shutdown(){}}class Zre{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class ese{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ge(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Ur;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ur,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{xe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(xe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ur)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(xe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ge(typeof r.accessToken=="string"),new q6(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ge(e===null||typeof e=="string"),new Lr(e)}}class tse{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Lr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class nse{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new tse(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class K6{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rse{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Ge(this.o===void 0);const r=i=>{i.error!=null&&xe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,xe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{xe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):xe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ge(typeof n.token=="string"),this.R=n.token,new K6(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class sse{getToken(){return Promise.resolve(new K6(""))}invalidateToken(){}start(e,n){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=ise(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}}function dt(t,e){return t<e?-1:t>e?1:0}function qf(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function Y6(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ve(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ve(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new ve(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ve(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return un.fromMillis(Date.now())}static fromDate(e){return un.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new un(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?dt(this.nanoseconds,e.nanoseconds):dt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Xe(e)}static min(){return new Xe(new un(0,0))}static max(){return new Xe(new un(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(e,n,r){n===void 0?n=0:n>e.length&&$e(),r===void 0?r=e.length-n:r>e.length-n&&$e(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return iy.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof iy?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=e.get(s),a=n.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Dt extends iy{construct(e,n,r){return new Dt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ve(ae.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Dt(n)}static emptyPath(){return new Dt([])}}const ase=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Nn extends iy{construct(e,n,r){return new Nn(e,n,r)}static isValidIdentifier(e){return ase.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Nn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Nn(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ve(ae.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new ve(ae.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ve(ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new ve(ae.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Nn(n)}static emptyPath(){return new Nn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(Dt.fromString(e))}static fromName(e){return new Re(Dt.fromString(e).popFirst(5))}static empty(){return new Re(Dt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Dt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Dt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new Dt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function aC(t){return t.fields.find(e=>e.kind===2)}function Yu(t){return t.fields.filter(e=>e.kind!==2)}function ose(t,e){let n=dt(t.collectionGroup,e.collectionGroup);if(n!==0)return n;for(let r=0;r<Math.min(t.fields.length,e.fields.length);++r)if(n=lse(t.fields[r],e.fields[r]),n!==0)return n;return dt(t.fields.length,e.fields.length)}Gf.UNKNOWN_ID=-1;class wd{constructor(e,n){this.fieldPath=e,this.kind=n}}function lse(t,e){const n=Nn.comparator(t.fieldPath,e.fieldPath);return n!==0?n:dt(t.kind,e.kind)}class Kf{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Kf(0,Hi.min())}}function Q6(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Xe.fromTimestamp(r===1e9?new un(n+1,0):new un(n,r));return new Hi(s,Re.empty(),e)}function X6(t){return new Hi(t.readTime,t.key,-1)}class Hi{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Hi(Xe.min(),Re.empty(),-1)}static max(){return new Hi(Xe.max(),Re.empty(),-1)}}function vk(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Re.comparator(t.documentKey,e.documentKey),n!==0?n:dt(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J6="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z6{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Su(t){if(t.code!==ae.FAILED_PRECONDITION||t.message!==J6)throw t;xe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&$e(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ee((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ee?n:ee.resolve(n)}catch(n){return ee.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ee.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ee.reject(n)}static resolve(e){return new ee((n,r)=>{n(e)})}static reject(e){return new ee((n,r)=>{r(e)})}static waitFor(e){return new ee((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},c=>r(c))}),a=!0,i===s&&n()})}static or(e){let n=ee.resolve(!1);for(const r of e)n=n.next(s=>s?ee.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new ee((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const u=c;n(e[u]).next(d=>{a[u]=d,++l,l===i&&r(a)},d=>s(d))}})}static doWhile(e,n){return new ee((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new Ur,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new mg(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=xk(r.target.error);this.V.reject(new mg(e,s))}}static open(e,n,r,s){try{return new iN(n,e.transaction(s,r))}catch(i){throw new mg(n,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(xe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new use(n)}}class jo{constructor(e,n,r){this.name=e,this.version=n,this.p=r,jo.S(Cr())===12.2&&tr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return xe("SimpleDb","Removing database:",e),td(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!e6())return!1;if(jo.v())return!0;const e=Cr(),n=jo.S(e),r=0<n&&n<10,s=e5(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,n){return e.store(n)}static S(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(xe("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;n(a)},s.onblocked=()=>{r(new mg(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new ve(ae.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new ve(ae.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new mg(e,a))},s.onupgradeneeded=i=>{xe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{xe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=n=>this.N(n)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const l=iN.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(u=>(l.g(),u)).catch(u=>(l.abort(u),ee.reject(u))).toPromise();return c.catch(()=>{}),await l.m,c}catch(l){const c=l,u=c.name!=="FirebaseError"&&a<3;if(xe("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function e5(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class cse{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return td(this.B.delete())}}class mg extends ve{constructor(e,n){super(ae.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function _u(t){return t.name==="IndexedDbTransactionError"}class use{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(xe("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(xe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),td(r)}add(e){return xe("SimpleDb","ADD",this.store.name,e,e),td(this.store.add(e))}get(e){return td(this.store.get(e)).next(n=>(n===void 0&&(n=null),xe("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return xe("SimpleDb","DELETE",this.store.name,e),td(this.store.delete(e))}count(){return xe("SimpleDb","COUNT",this.store.name),td(this.store.count())}U(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new ee((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.W(i,(l,c)=>{a.push(c)}).next(()=>a)}}G(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new ee((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}j(e,n){xe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.H=!1;const s=this.cursor(r);return this.W(s,(i,a,l)=>l.delete())}J(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.W(s,n)}Y(e){const n=this.cursor({});return new ee((r,s)=>{n.onerror=i=>{const a=xk(i.target.error);s(a)},n.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}W(e,n){const r=[];return new ee((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new cse(l),u=n(l.primaryKey,l.value,c);if(u instanceof ee){const d=u.catch(h=>(c.done(),ee.reject(h)));r.push(d)}c.isDone?s():c.K===null?l.continue():l.continue(c.K)}}).next(()=>ee.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function td(t){return new ee((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=xk(r.target.error);n(s)}})}let wR=!1;function xk(t){const e=jo.S(Cr());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ve("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wR||(wR=!0,setTimeout(()=>{throw r},0)),r}}return t}class dse{constructor(e,n){this.asyncQueue=e,this.Z=n,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){xe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{xe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(n){_u(n)?xe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):await Su(n)}await this.X(6e4)})}}class hse{constructor(e,n){this.localStore=e,this.persistence=n}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.te(n,e))}te(e,n){const r=new Set;let s=n,i=!0;return ee.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return xe("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>n-s)}ne(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(l=>(xe("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>a.size)}))}re(e,n){let r=e;return n.changes.forEach((s,i)=>{const a=X6(i);vk(a,r)>0&&(r=a)}),new Hi(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}hi.oe=-1;function sv(t){return t==null}function ay(t){return t===0&&1/t==-1/0}function t5(t){return typeof t=="number"&&Number.isInteger(t)&&!ay(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=NR(e)),e=fse(t.get(n),e);return NR(e)}function fse(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function NR(t){return t+""}function mo(t){const e=t.length;if(Ge(e>=2),e===2)return Ge(t.charAt(0)===""&&t.charAt(1)===""),Dt.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const a=t.indexOf("",i);switch((a<0||a>n)&&$e(),t.charAt(a+1)){case"":const l=t.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,a),s+="\0";break;case"":s+=t.substring(i,a+1);break;default:$e()}i=a+2}return new Dt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(t,e){return[t,Os(e)]}function n5(t,e,n){return[t,Os(e),n]}const pse={},mse=["prefixPath","collectionGroup","readTime","documentId"],gse=["prefixPath","collectionGroup","documentId"],yse=["collectionGroup","readTime","prefixPath","documentId"],vse=["canonicalId","targetId"],xse=["targetId","path"],bse=["path","targetId"],wse=["collectionId","parent"],Nse=["indexId","uid"],Sse=["uid","sequenceNumber"],_se=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],jse=["indexId","uid","orderedDocumentKey"],Ese=["userId","collectionPath","documentId"],Cse=["userId","collectionPath","largestBatchId"],Tse=["userId","collectionGroup","largestBatchId"],r5=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ase=[...r5,"documentOverlays"],s5=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],i5=s5,bk=[...i5,"indexConfiguration","indexState","indexEntries"],kse=bk,Ise=[...bk,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC extends Z6{constructor(e,n){super(),this._e=e,this.currentSequenceNumber=n}}function Tr(t,e){const n=Ie(t);return jo.F(n._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ju(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function a5(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function o5(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,n){this.comparator=e,this.root=n||ls.EMPTY}insert(e,n){return new mn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ls.BLACK,null,null))}remove(e){return new mn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ls.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cx(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cx(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cx(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cx(this.root,e,this.comparator,!0)}}class Cx{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ls{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??ls.RED,this.left=s??ls.EMPTY,this.right=i??ls.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new ls(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ls.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return ls.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ls.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ls.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $e();const e=this.left.check();if(e!==this.right.check())throw $e();return e+(this.isRed()?0:1)}}ls.EMPTY=null,ls.RED=!0,ls.BLACK=!1;ls.EMPTY=new class{constructor(){this.size=0}get key(){throw $e()}get value(){throw $e()}get color(){throw $e()}get left(){throw $e()}get right(){throw $e()}copy(e,n,r,s,i){return this}insert(e,n,r){return new ls(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.comparator=e,this.data=new mn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new jR(this.data.getIterator())}getIteratorFrom(e){return new jR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof rn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new rn(this.comparator);return n.data=e,n}}class jR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ih(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e){this.fields=e,e.sort(Nn.comparator)}static empty(){return new fi([])}unionWith(e){let n=new rn(Nn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new fi(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return qf(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pse(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new l5("Invalid base64 string: "+i):i}}(e);return new Fn(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Fn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return dt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fn.EMPTY_BYTE_STRING=new Fn("");const Ose=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kl(t){if(Ge(!!t),typeof t=="string"){let e=0;const n=Ose.exec(t);if(Ge(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Cn(t.seconds),nanos:Cn(t.nanos)}}function Cn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Il(t){return typeof t=="string"?Fn.fromBase64String(t):Fn.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function oN(t){const e=t.mapValue.fields.__previous_value__;return aN(e)?oN(e):e}function oy(t){const e=kl(t.mapValue.fields.__local_write_time__.timestampValue);return new un(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dse{constructor(e,n,r,s,i,a,l,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=u}}class ou{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new ou("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ou&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},D0={nullValue:"NULL_VALUE"};function lu(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?aN(t)?4:c5(t)?9007199254740991:lN(t)?10:11:$e()}function ko(t,e){if(t===e)return!0;const n=lu(t);if(n!==lu(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return oy(t).isEqual(oy(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=kl(s.timestampValue),l=kl(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Il(s.bytesValue).isEqual(Il(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Cn(s.geoPointValue.latitude)===Cn(i.geoPointValue.latitude)&&Cn(s.geoPointValue.longitude)===Cn(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Cn(s.integerValue)===Cn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Cn(s.doubleValue),l=Cn(i.doubleValue);return a===l?ay(a)===ay(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return qf(t.arrayValue.values||[],e.arrayValue.values||[],ko);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(_R(a)!==_R(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!ko(a[c],l[c])))return!1;return!0}(t,e);default:return $e()}}function ly(t,e){return(t.values||[]).find(n=>ko(n,e))!==void 0}function cu(t,e){if(t===e)return 0;const n=lu(t),r=lu(e);if(n!==r)return dt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return dt(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=Cn(i.integerValue||i.doubleValue),c=Cn(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return ER(t.timestampValue,e.timestampValue);case 4:return ER(oy(t),oy(e));case 5:return dt(t.stringValue,e.stringValue);case 6:return function(i,a){const l=Il(i),c=Il(a);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let u=0;u<l.length&&u<c.length;u++){const d=dt(l[u],c[u]);if(d!==0)return d}return dt(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=dt(Cn(i.latitude),Cn(a.latitude));return l!==0?l:dt(Cn(i.longitude),Cn(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return CR(t.arrayValue,e.arrayValue);case 10:return function(i,a){var l,c,u,d;const h=i.fields||{},f=a.fields||{},p=(l=h.value)===null||l===void 0?void 0:l.arrayValue,m=(c=f.value)===null||c===void 0?void 0:c.arrayValue,g=dt(((u=p==null?void 0:p.values)===null||u===void 0?void 0:u.length)||0,((d=m==null?void 0:m.values)===null||d===void 0?void 0:d.length)||0);return g!==0?g:CR(p,m)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===Pc.mapValue&&a===Pc.mapValue)return 0;if(i===Pc.mapValue)return 1;if(a===Pc.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),u=a.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let h=0;h<c.length&&h<d.length;++h){const f=dt(c[h],d[h]);if(f!==0)return f;const p=cu(l[c[h]],u[d[h]]);if(p!==0)return p}return dt(c.length,d.length)}(t.mapValue,e.mapValue);default:throw $e()}}function ER(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return dt(t,e);const n=kl(t),r=kl(e),s=dt(n.seconds,r.seconds);return s!==0?s:dt(n.nanos,r.nanos)}function CR(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=cu(n[s],r[s]);if(i)return i}return dt(n.length,r.length)}function Yf(t){return lC(t)}function lC(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=kl(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Il(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Re.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=lC(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${lC(n.fields[a])}`;return s+"}"}(t.mapValue):$e()}function R0(t){switch(lu(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=oN(t);return e?16+R0(e):16;case 5:return 2*t.stringValue.length;case 6:return Il(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+R0(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return ju(r.fields,(i,a)=>{s+=i.length+R0(a)}),s}(t.mapValue);default:throw $e()}}function Bd(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function cC(t){return!!t&&"integerValue"in t}function cy(t){return!!t&&"arrayValue"in t}function TR(t){return!!t&&"nullValue"in t}function AR(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function M0(t){return!!t&&"mapValue"in t}function lN(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function gg(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ju(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=gg(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=gg(t.arrayValue.values[n]);return e}return Object.assign({},t)}function c5(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const u5={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Rse(t){return"nullValue"in t?D0:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Bd(ou.empty(),Re.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?lN(t)?u5:{mapValue:{}}:$e()}function Mse(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Bd(ou.empty(),Re.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?u5:"mapValue"in t?lN(t)?{mapValue:{}}:Pc:$e()}function kR(t,e){const n=cu(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function IR(t,e){const n=cu(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e){this.value=e}static empty(){return new ps({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!M0(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=gg(n)}setAll(e){let n=Nn.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=gg(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());M0(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ko(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];M0(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){ju(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new ps(gg(this.value))}}function d5(t){const e=[];return ju(t.fields,(n,r)=>{const s=new Nn([n]);if(M0(r)){const i=d5(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new fi(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new wn(e,0,Xe.min(),Xe.min(),Xe.min(),ps.empty(),0)}static newFoundDocument(e,n,r,s){return new wn(e,1,n,Xe.min(),r,s,0)}static newNoDocument(e,n){return new wn(e,2,n,Xe.min(),Xe.min(),ps.empty(),0)}static newUnknownDocument(e,n){return new wn(e,3,n,Xe.min(),Xe.min(),ps.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Xe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ps.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ps.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof wn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e,n){this.position=e,this.inclusive=n}}function PR(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=Re.comparator(Re.fromName(a.referenceValue),n.key):r=cu(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function OR(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ko(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,n="asc"){this.field=e,this.dir=n}}function Lse(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{}class Rt extends h5{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Fse(e,n,r):n==="array-contains"?new $se(e,r):n==="in"?new v5(e,r):n==="not-in"?new Use(e,r):n==="array-contains-any"?new zse(e,r):new Rt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Bse(e,r):new Vse(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(cu(n,this.value)):n!==null&&lu(this.value)===lu(n)&&this.matchesComparison(cu(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $e()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Jt extends h5{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new Jt(e,n)}matches(e){return Qf(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Qf(t){return t.op==="and"}function uC(t){return t.op==="or"}function wk(t){return f5(t)&&Qf(t)}function f5(t){for(const e of t.filters)if(e instanceof Jt)return!1;return!0}function dC(t){if(t instanceof Rt)return t.field.canonicalString()+t.op.toString()+Yf(t.value);if(wk(t))return t.filters.map(e=>dC(e)).join(",");{const e=t.filters.map(n=>dC(n)).join(",");return`${t.op}(${e})`}}function p5(t,e){return t instanceof Rt?function(r,s){return s instanceof Rt&&r.op===s.op&&r.field.isEqual(s.field)&&ko(r.value,s.value)}(t,e):t instanceof Jt?function(r,s){return s instanceof Jt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&p5(a,s.filters[l]),!0):!1}(t,e):void $e()}function m5(t,e){const n=t.filters.concat(e);return Jt.create(n,t.op)}function g5(t){return t instanceof Rt?function(n){return`${n.field.canonicalString()} ${n.op} ${Yf(n.value)}`}(t):t instanceof Jt?function(n){return n.op.toString()+" {"+n.getFilters().map(g5).join(" ,")+"}"}(t):"Filter"}class Fse extends Rt{constructor(e,n,r){super(e,n,r),this.key=Re.fromName(r.referenceValue)}matches(e){const n=Re.comparator(e.key,this.key);return this.matchesComparison(n)}}class Bse extends Rt{constructor(e,n){super(e,"in",n),this.keys=y5("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class Vse extends Rt{constructor(e,n){super(e,"not-in",n),this.keys=y5("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function y5(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>Re.fromName(r.referenceValue))}class $se extends Rt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return cy(n)&&ly(n.arrayValue,this.value)}}class v5 extends Rt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&ly(this.value.arrayValue,n)}}class Use extends Rt{constructor(e,n){super(e,"not-in",n)}matches(e){if(ly(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!ly(this.value.arrayValue,n)}}class zse extends Rt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!cy(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>ly(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hse{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.ue=null}}function hC(t,e=null,n=[],r=[],s=null,i=null,a=null){return new Hse(t,e,n,r,s,i,a)}function Vd(t){const e=Ie(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>dC(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),sv(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Yf(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Yf(r)).join(",")),e.ue=n}return e.ue}function iv(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Lse(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!p5(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!OR(t.startAt,e.startAt)&&OR(t.endAt,e.endAt)}function Ob(t){return Re.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Db(t,e){return t.filters.filter(n=>n instanceof Rt&&n.field.isEqual(e))}function DR(t,e,n){let r=D0,s=!0;for(const i of Db(t,e)){let a=D0,l=!0;switch(i.op){case"<":case"<=":a=Rse(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=D0}kR({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];kR({value:r,inclusive:s},{value:a,inclusive:n.inclusive})<0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}function RR(t,e,n){let r=Pc,s=!0;for(const i of Db(t,e)){let a=Pc,l=!0;switch(i.op){case">=":case">":a=Mse(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=Pc}IR({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];IR({value:r,inclusive:s},{value:a,inclusive:n.inclusive})>0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function x5(t,e,n,r,s,i,a,l){return new Wl(t,e,n,r,s,i,a,l)}function Mp(t){return new Wl(t)}function MR(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Nk(t){return t.collectionGroup!==null}function Af(t){const e=Ie(t);if(e.ce===null){e.ce=[];const n=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new rn(Nn.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(l=l.add(u.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.ce.push(new uy(i,r))}),n.has(Nn.keyField().canonicalString())||e.ce.push(new uy(Nn.keyField(),r))}return e.ce}function Ds(t){const e=Ie(t);return e.le||(e.le=w5(e,Af(t))),e.le}function b5(t){const e=Ie(t);return e.he||(e.he=w5(e,t.explicitOrderBy)),e.he}function w5(t,e){if(t.limitType==="F")return hC(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new uy(s.field,i)});const n=t.endAt?new uu(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new uu(t.startAt.position,t.startAt.inclusive):null;return hC(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function fC(t,e){const n=t.filters.concat([e]);return new Wl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Rb(t,e,n){return new Wl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function av(t,e){return iv(Ds(t),Ds(e))&&t.limitType===e.limitType}function N5(t){return`${Vd(Ds(t))}|lt:${t.limitType}`}function Wh(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>g5(s)).join(", ")}]`),sv(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Yf(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Yf(s)).join(",")),`Target(${r})`}(Ds(t))}; limitType=${t.limitType})`}function ov(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Re.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Af(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const u=PR(a,l,c);return a.inclusive?u<=0:u<0}(r.startAt,Af(r),s)||r.endAt&&!function(a,l,c){const u=PR(a,l,c);return a.inclusive?u>=0:u>0}(r.endAt,Af(r),s))}(t,e)}function S5(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function _5(t){return(e,n)=>{let r=!1;for(const s of Af(t)){const i=Wse(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Wse(t,e,n){const r=t.field.isKeyField()?Re.comparator(e.key,n.key):function(i,a,l){const c=a.data.field(i),u=l.data.field(i);return c!==null&&u!==null?cu(c,u):$e()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return $e()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ju(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return o5(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qse=new mn(Re.comparator);function pi(){return qse}const j5=new mn(Re.comparator);function Ym(...t){let e=j5;for(const n of t)e=e.insert(n.key,n);return e}function E5(t){let e=j5;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function go(){return yg()}function C5(){return yg()}function yg(){return new ql(t=>t.toString(),(t,e)=>t.isEqual(e))}const Gse=new mn(Re.comparator),Kse=new rn(Re.comparator);function yt(...t){let e=Kse;for(const n of t)e=e.add(n);return e}const Yse=new rn(dt);function Sk(){return Yse}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ay(e)?"-0":e}}function T5(t){return{integerValue:""+t}}function A5(t,e){return t5(e)?T5(e):_k(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(){this._=void 0}}function Qse(t,e,n){return t instanceof Xf?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&aN(i)&&(i=oN(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(n,e):t instanceof $d?I5(t,e):t instanceof Ud?P5(t,e):function(s,i){const a=k5(s,i),l=LR(a)+LR(s.Pe);return cC(a)&&cC(s.Pe)?T5(l):_k(s.serializer,l)}(t,e)}function Xse(t,e,n){return t instanceof $d?I5(t,e):t instanceof Ud?P5(t,e):n}function k5(t,e){return t instanceof Jf?function(r){return cC(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Xf extends cN{}class $d extends cN{constructor(e){super(),this.elements=e}}function I5(t,e){const n=O5(e);for(const r of t.elements)n.some(s=>ko(s,r))||n.push(r);return{arrayValue:{values:n}}}class Ud extends cN{constructor(e){super(),this.elements=e}}function P5(t,e){let n=O5(e);for(const r of t.elements)n=n.filter(s=>!ko(s,r));return{arrayValue:{values:n}}}class Jf extends cN{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function LR(t){return Cn(t.integerValue||t.doubleValue)}function O5(t){return cy(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,n){this.field=e,this.transform=n}}function Jse(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof $d&&s instanceof $d||r instanceof Ud&&s instanceof Ud?qf(r.elements,s.elements,ko):r instanceof Jf&&s instanceof Jf?ko(r.Pe,s.Pe):r instanceof Xf&&s instanceof Xf}(t.transform,e.transform)}class Zse{constructor(e,n){this.version=e,this.transformResults=n}}class An{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new An}static exists(e){return new An(void 0,e)}static updateTime(e){return new An(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function L0(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class uN{}function D5(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Fp(t.key,An.none()):new Lp(t.key,t.data,An.none());{const n=t.data,r=ps.empty();let s=new rn(Nn.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Gl(t.key,r,new fi(s.toArray()),An.none())}}function eie(t,e,n){t instanceof Lp?function(s,i,a){const l=s.value.clone(),c=BR(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Gl?function(s,i,a){if(!L0(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=BR(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(R5(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function vg(t,e,n,r){return t instanceof Lp?function(i,a,l,c){if(!L0(i.precondition,a))return l;const u=i.value.clone(),d=VR(i.fieldTransforms,c,a);return u.setAll(d),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Gl?function(i,a,l,c){if(!L0(i.precondition,a))return l;const u=VR(i.fieldTransforms,c,a),d=a.data;return d.setAll(R5(i)),d.setAll(u),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,a,l){return L0(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function tie(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=k5(r.transform,s||null);i!=null&&(n===null&&(n=ps.empty()),n.set(r.field,i))}return n||null}function FR(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&qf(r,s,(i,a)=>Jse(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Lp extends uN{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Gl extends uN{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function R5(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function BR(t,e,n){const r=new Map;Ge(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,Xse(a,l,n[s]))}return r}function VR(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,Qse(i,a,e))}return r}class Fp extends uN{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jk extends uN{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eie(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=vg(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=vg(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=C5();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const c=D5(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(Xe.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),yt())}isEqual(e){return this.batchId===e.batchId&&qf(this.mutations,e.mutations,(n,r)=>FR(n,r))&&qf(this.baseMutations,e.baseMutations,(n,r)=>FR(n,r))}}class Ck{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ge(e.mutations.length===r.length);let s=function(){return Gse}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Ck(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nie{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lr,Bt;function L5(t){switch(t){default:return $e();case ae.CANCELLED:case ae.UNKNOWN:case ae.DEADLINE_EXCEEDED:case ae.RESOURCE_EXHAUSTED:case ae.INTERNAL:case ae.UNAVAILABLE:case ae.UNAUTHENTICATED:return!1;case ae.INVALID_ARGUMENT:case ae.NOT_FOUND:case ae.ALREADY_EXISTS:case ae.PERMISSION_DENIED:case ae.FAILED_PRECONDITION:case ae.ABORTED:case ae.OUT_OF_RANGE:case ae.UNIMPLEMENTED:case ae.DATA_LOSS:return!0}}function F5(t){if(t===void 0)return tr("GRPC error has no .code"),ae.UNKNOWN;switch(t){case lr.OK:return ae.OK;case lr.CANCELLED:return ae.CANCELLED;case lr.UNKNOWN:return ae.UNKNOWN;case lr.DEADLINE_EXCEEDED:return ae.DEADLINE_EXCEEDED;case lr.RESOURCE_EXHAUSTED:return ae.RESOURCE_EXHAUSTED;case lr.INTERNAL:return ae.INTERNAL;case lr.UNAVAILABLE:return ae.UNAVAILABLE;case lr.UNAUTHENTICATED:return ae.UNAUTHENTICATED;case lr.INVALID_ARGUMENT:return ae.INVALID_ARGUMENT;case lr.NOT_FOUND:return ae.NOT_FOUND;case lr.ALREADY_EXISTS:return ae.ALREADY_EXISTS;case lr.PERMISSION_DENIED:return ae.PERMISSION_DENIED;case lr.FAILED_PRECONDITION:return ae.FAILED_PRECONDITION;case lr.ABORTED:return ae.ABORTED;case lr.OUT_OF_RANGE:return ae.OUT_OF_RANGE;case lr.UNIMPLEMENTED:return ae.UNIMPLEMENTED;case lr.DATA_LOSS:return ae.DATA_LOSS;default:return $e()}}(Bt=lr||(lr={}))[Bt.OK=0]="OK",Bt[Bt.CANCELLED=1]="CANCELLED",Bt[Bt.UNKNOWN=2]="UNKNOWN",Bt[Bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bt[Bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bt[Bt.NOT_FOUND=5]="NOT_FOUND",Bt[Bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bt[Bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bt[Bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bt[Bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bt[Bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bt[Bt.ABORTED=10]="ABORTED",Bt[Bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bt[Bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bt[Bt.INTERNAL=13]="INTERNAL",Bt[Bt.UNAVAILABLE=14]="UNAVAILABLE",Bt[Bt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mb=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B5(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rie=new bd([4294967295,4294967295],0);function $R(t){const e=B5().encode(t),n=new V6;return n.update(e),new Uint8Array(n.digest())}function UR(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new bd([n,r],0),new bd([s,i],0)]}class Ak{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Qm(`Invalid padding: ${n}`);if(r<0)throw new Qm(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Qm(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Qm(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=bd.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(bd.fromNumber(r)));return s.compare(rie)===1&&(s=new bd([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=$R(e),[r,s]=UR(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);if(!this.de(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Ak(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;const n=$R(e),[r,s]=UR(n);for(let i=0;i<this.hashCount;i++){const a=this.Ee(r,s,i);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Qm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,uv.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new cv(Xe.min(),s,new mn(dt),pi(),yt())}}class uv{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new uv(r,n,yt(),yt(),yt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class V5{constructor(e,n){this.targetId=e,this.me=n}}class $5{constructor(e,n,r=Fn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class zR{constructor(){this.fe=0,this.ge=WR(),this.pe=Fn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=yt(),n=yt(),r=yt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:$e()}}),new uv(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=WR()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ge(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class sie{constructor(e){this.Le=e,this.Be=new Map,this.ke=pi(),this.qe=HR(),this.Qe=new mn(dt)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:$e()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const i=s.target;if(Ob(i))if(r===0){const a=new Re(i.path);this.Ue(n,a,wn.newNoDocument(a,Xe.min()))}else Ge(r===1);else{const a=this.Ye(n);if(a!==r){const l=this.Ze(e),c=l?this.Xe(l,e,a):1;if(c!==0){this.je(n);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,u)}Mb==null||Mb.et(function(d,h,f,p,m){var g,y,x,w,N,S;const C={localCacheCount:d,existenceFilterCount:h.count,databaseId:f.database,projectId:f.projectId},A=h.unchangedNames;return A&&(C.bloomFilter={applied:m===0,hashCount:(g=A==null?void 0:A.hashCount)!==null&&g!==void 0?g:0,bitmapLength:(w=(x=(y=A==null?void 0:A.bits)===null||y===void 0?void 0:y.bitmap)===null||x===void 0?void 0:x.length)!==null&&w!==void 0?w:0,padding:(S=(N=A==null?void 0:A.bits)===null||N===void 0?void 0:N.padding)!==null&&S!==void 0?S:0,mightContain:j=>{var _;return(_=p==null?void 0:p.mightContain(j))!==null&&_!==void 0&&_}}),C}(a,e.me,this.Le.tt(),l,c))}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=Il(r).toUint8Array()}catch(c){if(c instanceof l5)return zi("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Ak(a,s,i)}catch(c){return zi(c instanceof Qm?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(n,i,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((i,a)=>{const l=this.Je(a);if(l){if(i.current&&Ob(l.target)){const c=new Re(l.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,wn.newNoDocument(c,e))}i.be&&(n.set(a,i.ve()),i.Ce())}});let r=yt();this.qe.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new cv(e,n,this.Qe,this.ke,r);return this.ke=pi(),this.qe=HR(),this.Qe=new mn(dt),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new zR,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new rn(dt),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||xe("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new zR),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function HR(){return new mn(Re.comparator)}function WR(){return new mn(Re.comparator)}const iie={asc:"ASCENDING",desc:"DESCENDING"},aie={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oie={and:"AND",or:"OR"};class lie{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function pC(t,e){return t.useProto3Json||sv(e)?e:{value:e}}function Zf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function U5(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function cie(t,e){return Zf(t,e.toTimestamp())}function nr(t){return Ge(!!t),Xe.fromTimestamp(function(n){const r=kl(n);return new un(r.seconds,r.nanos)}(t))}function kk(t,e){return mC(t,e).canonicalString()}function mC(t,e){const n=function(s){return new Dt(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function z5(t){const e=Dt.fromString(t);return Ge(Z5(e)),e}function dy(t,e){return kk(t.databaseId,e.path)}function Eo(t,e){const n=z5(e);if(n.get(1)!==t.databaseId.projectId)throw new ve(ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ve(ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Re(q5(n))}function H5(t,e){return kk(t.databaseId,e)}function W5(t){const e=z5(t);return e.length===4?Dt.emptyPath():q5(e)}function gC(t){return new Dt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function q5(t){return Ge(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function qR(t,e,n){return{name:dy(t,e),fields:n.value.mapValue.fields}}function G5(t,e,n){const r=Eo(t,e.name),s=nr(e.updateTime),i=e.createTime?nr(e.createTime):Xe.min(),a=new ps({mapValue:{fields:e.fields}}),l=wn.newFoundDocument(r,s,i,a);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function uie(t,e){return"found"in e?function(r,s){Ge(!!s.found),s.found.name,s.found.updateTime;const i=Eo(r,s.found.name),a=nr(s.found.updateTime),l=s.found.createTime?nr(s.found.createTime):Xe.min(),c=new ps({mapValue:{fields:s.found.fields}});return wn.newFoundDocument(i,a,l,c)}(t,e):"missing"in e?function(r,s){Ge(!!s.missing),Ge(!!s.readTime);const i=Eo(r,s.missing),a=nr(s.readTime);return wn.newNoDocument(i,a)}(t,e):$e()}function die(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:$e()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,d){return u.useProto3Json?(Ge(d===void 0||typeof d=="string"),Fn.fromBase64String(d||"")):(Ge(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Fn.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(u){const d=u.code===void 0?ae.UNKNOWN:F5(u.code);return new ve(d,u.message||"")}(a);n=new $5(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Eo(t,r.document.name),i=nr(r.document.updateTime),a=r.document.createTime?nr(r.document.createTime):Xe.min(),l=new ps({mapValue:{fields:r.document.fields}}),c=wn.newFoundDocument(s,i,a,l),u=r.targetIds||[],d=r.removedTargetIds||[];n=new F0(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Eo(t,r.document),i=r.readTime?nr(r.readTime):Xe.min(),a=wn.newNoDocument(s,i),l=r.removedTargetIds||[];n=new F0([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Eo(t,r.document),i=r.removedTargetIds||[];n=new F0([],i,s,null)}else{if(!("filter"in e))return $e();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new nie(s,i),l=r.targetId;n=new V5(l,a)}}return n}function hy(t,e){let n;if(e instanceof Lp)n={update:qR(t,e.key,e.value)};else if(e instanceof Fp)n={delete:dy(t,e.key)};else if(e instanceof Gl)n={update:qR(t,e.key,e.data),updateMask:yie(e.fieldMask)};else{if(!(e instanceof jk))return $e();n={verify:dy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof Xf)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof $d)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ud)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Jf)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw $e()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:cie(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$e()}(t,e.precondition)),n}function yC(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?An.updateTime(nr(i.updateTime)):i.exists!==void 0?An.exists(i.exists):An.none()}(e.currentDocument):An.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)Ge(l.setToServerValue==="REQUEST_TIME"),c=new Xf;else if("appendMissingElements"in l){const d=l.appendMissingElements.values||[];c=new $d(d)}else if("removeAllFromArray"in l){const d=l.removeAllFromArray.values||[];c=new Ud(d)}else"increment"in l?c=new Jf(a,l.increment):$e();const u=Nn.fromServerFormat(l.fieldPath);return new lv(u,c)}(t,s)):[];if(e.update){e.update.name;const s=Eo(t,e.update.name),i=new ps({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const u=c.fieldPaths||[];return new fi(u.map(d=>Nn.fromServerFormat(d)))}(e.updateMask);return new Gl(s,i,a,n,r)}return new Lp(s,i,n,r)}if(e.delete){const s=Eo(t,e.delete);return new Fp(s,n)}if(e.verify){const s=Eo(t,e.verify);return new jk(s,n)}return $e()}function hie(t,e){return t&&t.length>0?(Ge(e!==void 0),t.map(n=>function(s,i){let a=s.updateTime?nr(s.updateTime):nr(i);return a.isEqual(Xe.min())&&(a=nr(i)),new Zse(a,s.transformResults||[])}(n,e))):[]}function K5(t,e){return{documents:[H5(t,e.path)]}}function dN(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=H5(t,s);const i=function(u){if(u.length!==0)return J5(Jt.create(u,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(u){if(u.length!==0)return u.map(d=>function(f){return{field:Nc(f.field),direction:pie(f.dir)}}(d))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=pC(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:n,parent:s}}function Y5(t,e,n,r){const{_t:s,parent:i}=dN(t,e),a={},l=[];let c=0;return n.forEach(u=>{const d=r?u.alias:"aggregate_"+c++;a[d]=u.alias,u.aggregateType==="count"?l.push({alias:d,count:{}}):u.aggregateType==="avg"?l.push({alias:d,avg:{field:Nc(u.fieldPath)}}):u.aggregateType==="sum"&&l.push({alias:d,sum:{field:Nc(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},ut:a,parent:i}}function Q5(t){let e=W5(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ge(r===1);const d=n.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];n.where&&(i=function(h){const f=X5(h);return f instanceof Jt&&wk(f)?f.getFilters():[f]}(n.where));let a=[];n.orderBy&&(a=function(h){return h.map(f=>function(m){return new uy(qh(m.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(m.direction))}(f))}(n.orderBy));let l=null;n.limit&&(l=function(h){let f;return f=typeof h=="object"?h.value:h,sv(f)?null:f}(n.limit));let c=null;n.startAt&&(c=function(h){const f=!!h.before,p=h.values||[];return new uu(p,f)}(n.startAt));let u=null;return n.endAt&&(u=function(h){const f=!h.before,p=h.values||[];return new uu(p,f)}(n.endAt)),x5(e,s,a,i,l,"F",c,u)}function fie(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $e()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function X5(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=qh(n.unaryFilter.field);return Rt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=qh(n.unaryFilter.field);return Rt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=qh(n.unaryFilter.field);return Rt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=qh(n.unaryFilter.field);return Rt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return $e()}}(t):t.fieldFilter!==void 0?function(n){return Rt.create(qh(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $e()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Jt.create(n.compositeFilter.filters.map(r=>X5(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $e()}}(n.compositeFilter.op))}(t):$e()}function pie(t){return iie[t]}function mie(t){return aie[t]}function gie(t){return oie[t]}function Nc(t){return{fieldPath:t.canonicalString()}}function qh(t){return Nn.fromServerFormat(t.fieldPath)}function J5(t){return t instanceof Rt?function(n){if(n.op==="=="){if(AR(n.value))return{unaryFilter:{field:Nc(n.field),op:"IS_NAN"}};if(TR(n.value))return{unaryFilter:{field:Nc(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(AR(n.value))return{unaryFilter:{field:Nc(n.field),op:"IS_NOT_NAN"}};if(TR(n.value))return{unaryFilter:{field:Nc(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nc(n.field),op:mie(n.op),value:n.value}}}(t):t instanceof Jt?function(n){const r=n.getFilters().map(s=>J5(s));return r.length===1?r[0]:{compositeFilter:{op:gie(n.op),filters:r}}}(t):$e()}function yie(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Z5(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e,n,r,s,i=Xe.min(),a=Xe.min(),l=Fn.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new ul(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ul(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ul(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ul(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ez{constructor(e){this.ct=e}}function vie(t,e){let n;if(e.document)n=G5(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Re.fromSegments(e.noDocument.path),s=Hd(e.noDocument.readTime);n=wn.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return $e();{const r=Re.fromSegments(e.unknownDocument.path),s=Hd(e.unknownDocument.version);n=wn.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new un(s[0],s[1]);return Xe.fromTimestamp(i)}(e.readTime)),n}function GR(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Lb(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:dy(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Zf(i,a.version.toTimestamp()),createTime:Zf(i,a.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:zd(e.version)};else{if(!e.isUnknownDocument())return $e();r.unknownDocument={path:n.path.toArray(),version:zd(e.version)}}return r}function Lb(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function zd(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Hd(t){const e=new un(t.seconds,t.nanoseconds);return Xe.fromTimestamp(e)}function nd(t,e){const n=(e.baseMutations||[]).map(i=>yC(t.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>yC(t.ct,i)),s=un.fromMillis(e.localWriteTimeMs);return new Ek(e.batchId,s,n,r)}function Xm(t){const e=Hd(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?Hd(t.lastLimboFreeSnapshotVersion):Xe.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){return Ge(i.documents.length===1),Ds(Mp(W5(i.documents[0])))}(t.query):function(i){return Ds(Q5(i))}(t.query),new ul(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Fn.fromBase64String(t.resumeToken))}function tz(t,e){const n=zd(e.snapshotVersion),r=zd(e.lastLimboFreeSnapshotVersion);let s;s=Ob(e.target)?K5(t.ct,e.target):dN(t.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Vd(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Ik(t){const e=Q5({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Rb(e,e.limit,"L"):e}function L_(t,e){return new Tk(e.largestBatchId,yC(t.ct,e.overlayMutation))}function KR(t,e){const n=e.path.lastSegment();return[t,Os(e.path.popLast()),n]}function YR(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:zd(r.readTime),documentKey:Os(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xie{getBundleMetadata(e,n){return QR(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Hd(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return QR(e).put(function(s){return{bundleId:s.id,createTime:zd(nr(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return XR(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:Ik(i.bundledQuery),readTime:Hd(i.readTime)}}(r)})}saveNamedQuery(e,n){return XR(e).put(function(s){return{name:s.name,readTime:zd(nr(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function QR(t){return Tr(t,"bundles")}function XR(t){return Tr(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,n){this.serializer=e,this.userId=n}static lt(e,n){const r=n.uid||"";return new hN(e,r)}getOverlay(e,n){return bm(e).get(KR(this.userId,n)).next(r=>r?L_(this.serializer,r):null)}getOverlays(e,n){const r=go();return ee.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,a)=>{const l=new Tk(n,a);s.push(this.ht(e,l))}),ee.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(a=>s.add(Os(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(bm(e).j("collectionPathOverlayIndex",l))}),ee.waitFor(i)}getOverlaysForCollection(e,n,r){const s=go(),i=Os(n),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return bm(e).U("collectionPathOverlayIndex",a).next(l=>{for(const c of l){const u=L_(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=go();let a;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return bm(e).J({index:"collectionGroupOverlayIndex",range:l},(c,u,d)=>{const h=L_(this.serializer,u);i.size()<s||h.largestBatchId===a?(i.set(h.getKey(),h),a=h.largestBatchId):d.done()}).next(()=>i)}ht(e,n){return bm(e).put(function(s,i,a){const[l,c,u]=KR(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:u,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:hy(s.ct,a.mutation)}}(this.serializer,this.userId,n))}}function bm(t){return Tr(t,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bie{Pt(e){return Tr(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Fn.fromUint8Array(r):Fn.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.Pt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(){}It(e,n){this.Tt(e,n),n.Et()}Tt(e,n){if("nullValue"in e)this.dt(n,5);else if("booleanValue"in e)this.dt(n,10),n.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(n,15),n.At(Cn(e.integerValue));else if("doubleValue"in e){const r=Cn(e.doubleValue);isNaN(r)?this.dt(n,13):(this.dt(n,15),ay(r)?n.At(0):n.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(n,20),typeof r=="string"&&(r=kl(r)),n.Rt(`${r.seconds||""}`),n.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,n),this.ft(n);else if("bytesValue"in e)this.dt(n,30),n.gt(Il(e.bytesValue)),this.ft(n);else if("referenceValue"in e)this.yt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(n,45),n.At(r.latitude||0),n.At(r.longitude||0)}else"mapValue"in e?c5(e)?this.dt(n,Number.MAX_SAFE_INTEGER):lN(e)?this.wt(e.mapValue,n):(this.St(e.mapValue,n),this.ft(n)):"arrayValue"in e?(this.bt(e.arrayValue,n),this.ft(n)):$e()}Vt(e,n){this.dt(n,25),this.Dt(e,n)}Dt(e,n){n.Rt(e)}St(e,n){const r=e.fields||{};this.dt(n,55);for(const s of Object.keys(r))this.Vt(s,n),this.Tt(r[s],n)}wt(e,n){var r,s;const i=e.fields||{};this.dt(n,53);const a="value",l=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(n,15),n.At(Cn(l)),this.Vt(a,n),this.Tt(i[a],n)}bt(e,n){const r=e.values||[];this.dt(n,50);for(const s of r)this.Tt(s,n)}yt(e,n){this.dt(n,37),Re.fromName(e).path.forEach(r=>{this.dt(n,60),this.Dt(r,n)})}dt(e,n){e.At(n)}ft(e){e.At(2)}}rd.vt=new rd;function wie(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function JR(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=wie(255&r[i]);if(s+=a,a!==8)break}return s}(t);return Math.ceil(e/8)}class Nie{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ft(r.value),r=n.next();this.Mt()}xt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ot(r.value),r=n.next();this.Nt()}Lt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=n.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=n.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const n=this.qt(e),r=JR(n);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}Kt(e){const n=this.qt(e),r=JR(n);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const n=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Ft(e){const n=255&e;n===0?(this.Ut(0),this.Ut(255)):n===255?(this.Ut(255),this.Ut(0)):this.Ut(n)}Ot(e){const n=255&e;n===0?(this.Gt(0),this.Gt(255)):n===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Sie{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class _ie{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class wm{constructor(){this.jt=new Nie,this.Ht=new Sie(this.jt),this.Jt=new _ie(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,n,r,s){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new sd(this.indexId,this.documentKey,this.arrayValue,r)}}function sc(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=ZR(t.arrayValue,e.arrayValue),n!==0?n:(n=ZR(t.directionalValue,e.directionalValue),n!==0?n:Re.comparator(t.documentKey,e.documentKey)))}function ZR(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eM{constructor(e){this.Xt=new rn((n,r)=>Nn.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const n of e.filters){const r=n;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ge(e.collectionGroup===this.collectionId),this.nn)return!1;const n=aC(e);if(n!==void 0&&!this.sn(n))return!1;const r=Yu(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const l=this.Xt.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.on(l,c)||!this._n(this.en[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.en.length||!this._n(this.en[a++],l))return!1}return!0}an(){if(this.nn)return null;let e=new rn(Nn.comparator);const n=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new wd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new wd(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new wd(r.field,r.dir==="asc"?0:1)));return new Gf(Gf.UNKNOWN_ID,this.collectionId,n,Kf.empty())}sn(e){for(const n of this.tn)if(this.on(n,e))return!0;return!1}on(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}_n(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nz(t){var e,n;if(Ge(t instanceof Rt||t instanceof Jt),t instanceof Rt){if(t instanceof v5){const s=((n=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||n===void 0?void 0:n.map(i=>Rt.create(t.field,"==",i)))||[];return Jt.create(s,"or")}return t}const r=t.filters.map(s=>nz(s));return Jt.create(r,t.op)}function jie(t){if(t.getFilters().length===0)return[];const e=bC(nz(t));return Ge(rz(e)),vC(e)||xC(e)?[e]:e.getFilters()}function vC(t){return t instanceof Rt}function xC(t){return t instanceof Jt&&wk(t)}function rz(t){return vC(t)||xC(t)||function(n){if(n instanceof Jt&&uC(n)){for(const r of n.getFilters())if(!vC(r)&&!xC(r))return!1;return!0}return!1}(t)}function bC(t){if(Ge(t instanceof Rt||t instanceof Jt),t instanceof Rt)return t;if(t.filters.length===1)return bC(t.filters[0]);const e=t.filters.map(r=>bC(r));let n=Jt.create(e,t.op);return n=Fb(n),rz(n)?n:(Ge(n instanceof Jt),Ge(Qf(n)),Ge(n.filters.length>1),n.filters.reduce((r,s)=>Pk(r,s)))}function Pk(t,e){let n;return Ge(t instanceof Rt||t instanceof Jt),Ge(e instanceof Rt||e instanceof Jt),n=t instanceof Rt?e instanceof Rt?function(s,i){return Jt.create([s,i],"and")}(t,e):tM(t,e):e instanceof Rt?tM(e,t):function(s,i){if(Ge(s.filters.length>0&&i.filters.length>0),Qf(s)&&Qf(i))return m5(s,i.getFilters());const a=uC(s)?s:i,l=uC(s)?i:s,c=a.filters.map(u=>Pk(u,l));return Jt.create(c,"or")}(t,e),Fb(n)}function tM(t,e){if(Qf(e))return m5(e,t.getFilters());{const n=e.filters.map(r=>Pk(t,r));return Jt.create(n,"or")}}function Fb(t){if(Ge(t instanceof Rt||t instanceof Jt),t instanceof Rt)return t;const e=t.getFilters();if(e.length===1)return Fb(e[0]);if(f5(t))return t;const n=e.map(s=>Fb(s)),r=[];return n.forEach(s=>{s instanceof Rt?r.push(s):s instanceof Jt&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Jt.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eie{constructor(){this.un=new Ok}addToCollectionParentIndex(e,n){return this.un.add(n),ee.resolve()}getCollectionParents(e,n){return ee.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return ee.resolve()}deleteFieldIndex(e,n){return ee.resolve()}deleteAllFieldIndexes(e){return ee.resolve()}createTargetIndexes(e,n){return ee.resolve()}getDocumentsMatchingTarget(e,n){return ee.resolve(null)}getIndexType(e,n){return ee.resolve(0)}getFieldIndexes(e,n){return ee.resolve([])}getNextCollectionGroupToUpdate(e){return ee.resolve(null)}getMinOffset(e,n){return ee.resolve(Hi.min())}getMinOffsetFromCollectionGroup(e,n){return ee.resolve(Hi.min())}updateCollectionGroup(e,n,r){return ee.resolve()}updateIndexEntries(e,n){return ee.resolve()}}class Ok{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new rn(Dt.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new rn(Dt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tx=new Uint8Array(0);class Cie{constructor(e,n){this.databaseId=n,this.cn=new Ok,this.ln=new ql(r=>Vd(r),(r,s)=>iv(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.cn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.cn.add(n)});const i={collectionId:r,parent:Os(s)};return nM(e).put(i)}return ee.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[Y6(n),""],!1,!0);return nM(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==n)break;r.push(mo(a.parent))}return r})}addFieldIndex(e,n){const r=Nm(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const a=Oh(e);return i.next(l=>{a.put(YR(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Nm(e),s=Oh(e),i=Ph(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Nm(e),r=Ph(e),s=Oh(e);return n.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,n){return ee.forEach(this.hn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new eM(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Ph(e);let s=!0;const i=new Map;return ee.forEach(this.hn(n),a=>this.Pn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=yt();const l=[];return ee.forEach(i,(c,u)=>{xe("IndexedDbIndexManager",`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(S=>`${S.fieldPath}:${S.kind}`).join(",")}`}(c)} to execute ${Vd(n)}`);const d=function(N,S){const C=aC(S);if(C===void 0)return null;for(const A of Db(N,C.fieldPath))switch(A.op){case"array-contains-any":return A.value.arrayValue.values||[];case"array-contains":return[A.value]}return null}(u,c),h=function(N,S){const C=new Map;for(const A of Yu(S))for(const j of Db(N,A.fieldPath))switch(j.op){case"==":case"in":C.set(A.fieldPath.canonicalString(),j.value);break;case"not-in":case"!=":return C.set(A.fieldPath.canonicalString(),j.value),Array.from(C.values())}return null}(u,c),f=function(N,S){const C=[];let A=!0;for(const j of Yu(S)){const _=j.kind===0?DR(N,j.fieldPath,N.startAt):RR(N,j.fieldPath,N.startAt);C.push(_.value),A&&(A=_.inclusive)}return new uu(C,A)}(u,c),p=function(N,S){const C=[];let A=!0;for(const j of Yu(S)){const _=j.kind===0?RR(N,j.fieldPath,N.endAt):DR(N,j.fieldPath,N.endAt);C.push(_.value),A&&(A=_.inclusive)}return new uu(C,A)}(u,c),m=this.In(c,u,f),g=this.In(c,u,p),y=this.Tn(c,u,h),x=this.En(c.indexId,d,m,f.inclusive,g,p.inclusive,y);return ee.forEach(x,w=>r.G(w,n.limit).next(N=>{N.forEach(S=>{const C=Re.fromSegments(S.documentKey);a.has(C)||(a=a.add(C),l.push(C))})}))}).next(()=>l)}return ee.resolve(null)})}hn(e){let n=this.ln.get(e);return n||(e.filters.length===0?n=[e]:n=jie(Jt.create(e.filters,"and")).map(r=>hC(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,n),n)}En(e,n,r,s,i,a,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),u=c/(n!=null?n.length:1),d=[];for(let h=0;h<c;++h){const f=n?this.dn(n[h/u]):Tx,p=this.An(e,f,r[h%u],s),m=this.Rn(e,f,i[h%u],a),g=l.map(y=>this.An(e,f,y,!0));d.push(...this.createRange(p,m,g))}return d}An(e,n,r,s){const i=new sd(e,Re.empty(),n,r);return s?i:i.Zt()}Rn(e,n,r,s){const i=new sd(e,Re.empty(),n,r);return s?i.Zt():i}Pn(e,n){const r=new eM(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.rn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,n){let r=2;const s=this.hn(n);return ee.forEach(s,i=>this.Pn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let u=new rn(Nn.comparator),d=!1;for(const h of c.filters)for(const f of h.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?d=!0:u=u.add(f.field));for(const h of c.orderBy)h.field.isKeyField()||(u=u.add(h.field));return u.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&s.length>1&&r===2?1:r)}Vn(e,n){const r=new wm;for(const s of Yu(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const a=r.Yt(s.kind);rd.vt.It(i,a)}return r.zt()}dn(e){const n=new wm;return rd.vt.It(e,n.Yt(0)),n.zt()}mn(e,n){const r=new wm;return rd.vt.It(Bd(this.databaseId,n),r.Yt(function(i){const a=Yu(i);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,n,r){if(r===null)return[];let s=[];s.push(new wm);let i=0;for(const a of Yu(e)){const l=r[i++];for(const c of s)if(this.fn(n,a.fieldPath)&&cy(l))s=this.gn(s,a,l);else{const u=c.Yt(a.kind);rd.vt.It(l,u)}}return this.pn(s)}In(e,n,r){return this.Tn(e,n,r.position)}pn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].zt();return n}gn(e,n,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new wm;c.seed(l.zt()),rd.vt.It(a,c.Yt(n.kind)),i.push(c)}return i}fn(e,n){return!!e.filters.find(r=>r instanceof Rt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Nm(e),s=Oh(e);return(n?r.U("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.U()).next(i=>{const a=[];return ee.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(d,h){const f=h?new Kf(h.sequenceNumber,new Hi(Hd(h.readTime),new Re(mo(h.documentKey)),h.largestBatchId)):Kf.empty(),p=d.fields.map(([m,g])=>new wd(Nn.fromServerFormat(m),g));return new Gf(d.indexId,d.collectionGroup,p,f)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:dt(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Nm(e),i=Oh(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(l=>ee.forEach(l,c=>i.put(YR(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return ee.forEach(n,(s,i)=>{const a=r.get(s.collectionGroup);return(a?ee.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),ee.forEach(l,c=>this.wn(e,s,c).next(u=>{const d=this.Sn(i,c);return u.isEqual(d)?ee.resolve():this.bn(e,i,c,u,d)}))))})}Dn(e,n,r,s){return Ph(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,n.key),documentKey:n.key.path.toArray()})}vn(e,n,r,s){return Ph(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const s=Ph(e);let i=new rn(sc);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(a,l)=>{i=i.add(new sd(r.indexId,n,l.arrayValue,l.directionalValue))}).next(()=>i)}Sn(e,n){let r=new rn(sc);const s=this.Vn(n,e);if(s==null)return r;const i=aC(n);if(i!=null){const a=e.data.field(i.fieldPath);if(cy(a))for(const l of a.arrayValue.values||[])r=r.add(new sd(n.indexId,e.key,this.dn(l),s))}else r=r.add(new sd(n.indexId,e.key,Tx,s));return r}bn(e,n,r,s,i){xe("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const a=[];return function(c,u,d,h,f){const p=c.getIterator(),m=u.getIterator();let g=Ih(p),y=Ih(m);for(;g||y;){let x=!1,w=!1;if(g&&y){const N=d(g,y);N<0?w=!0:N>0&&(x=!0)}else g!=null?w=!0:x=!0;x?(h(y),y=Ih(m)):w?(f(g),g=Ih(p)):(g=Ih(p),y=Ih(m))}}(s,i,sc,l=>{a.push(this.Dn(e,n,r,l))},l=>{a.push(this.vn(e,n,r,l))}),ee.waitFor(a)}yn(e){let n=1;return Oh(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,l)=>sc(a,l)).filter((a,l,c)=>!l||sc(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=sc(a,e),c=sc(a,n);if(l===0)s[0]=e.Zt();else if(l>0&&c<0)s.push(a),s.push(a.Zt());else if(c>0)break}s.push(n);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const l=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,Tx,[]],c=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,Tx,[]];i.push(IDBKeyRange.bound(l,c))}return i}Cn(e,n){return sc(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(rM)}getMinOffset(e,n){return ee.mapArray(this.hn(n),r=>this.Pn(e,r).next(s=>s||$e())).next(rM)}}function nM(t){return Tr(t,"collectionParents")}function Ph(t){return Tr(t,"indexEntries")}function Nm(t){return Tr(t,"indexConfiguration")}function Oh(t){return Tr(t,"indexState")}function rM(t){Ge(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;vk(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Hi(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sM={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ks{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ks(e,ks.DEFAULT_COLLECTION_PERCENTILE,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sz(t,e,n){const r=t.store("mutations"),s=t.store("documentMutations"),i=[],a=IDBKeyRange.only(n.batchId);let l=0;const c=r.J({range:a},(d,h,f)=>(l++,f.delete()));i.push(c.next(()=>{Ge(l===1)}));const u=[];for(const d of n.mutations){const h=n5(e,d.key.path,n.batchId);i.push(s.delete(h)),u.push(d.key)}return ee.waitFor(i).next(()=>u)}function Bb(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw $e();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ks.DEFAULT_COLLECTION_PERCENTILE=10,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ks.DEFAULT=new ks(41943040,ks.DEFAULT_COLLECTION_PERCENTILE,ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ks.DISABLED=new ks(-1,0,0);class fN{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,n,r,s){Ge(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new fN(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ic(e).J({index:"userMutationsIndex",range:r},(s,i,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Gh(e),a=ic(e);return a.add({}).next(l=>{Ge(typeof l=="number");const c=new Ek(l,n,r,s),u=function(p,m,g){const y=g.baseMutations.map(w=>hy(p.ct,w)),x=g.mutations.map(w=>hy(p.ct,w));return{userId:m,batchId:g.batchId,localWriteTimeMs:g.localWriteTime.toMillis(),baseMutations:y,mutations:x}}(this.serializer,this.userId,c),d=[];let h=new rn((f,p)=>dt(f.canonicalString(),p.canonicalString()));for(const f of s){const p=n5(this.userId,f.key.path,l);h=h.add(f.key.path.popLast()),d.push(a.put(u)),d.push(i.put(p,pse))}return h.forEach(f=>{d.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),ee.waitFor(d).next(()=>c)})}lookupMutationBatch(e,n){return ic(e).get(n).next(r=>r?(Ge(r.userId===this.userId),nd(this.serializer,r)):null)}Mn(e,n){return this.Fn[n]?ee.resolve(this.Fn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Fn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ic(e).J({index:"userMutationsIndex",range:s},(a,l,c)=>{l.userId===this.userId&&(Ge(l.batchId>=r),i=nd(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ic(e).J({index:"userMutationsIndex",range:n,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ic(e).U("userMutationsIndex",n).next(r=>r.map(s=>nd(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=O0(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Gh(e).J({range:s},(a,l,c)=>{const[u,d,h]=a,f=mo(d);if(u===this.userId&&n.path.isEqual(f))return ic(e).get(h).next(p=>{if(!p)throw $e();Ge(p.userId===this.userId),i.push(nd(this.serializer,p))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new rn(dt);const s=[];return n.forEach(i=>{const a=O0(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=Gh(e).J({range:l},(u,d,h)=>{const[f,p,m]=u,g=mo(p);f===this.userId&&i.path.isEqual(g)?r=r.add(m):h.done()});s.push(c)}),ee.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=O0(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new rn(dt);return Gh(e).J({range:a},(c,u,d)=>{const[h,f,p]=c,m=mo(f);h===this.userId&&r.isPrefixOf(m)?m.length===s&&(l=l.add(p)):d.done()}).next(()=>this.xn(e,l))}xn(e,n){const r=[],s=[];return n.forEach(i=>{s.push(ic(e).get(i).next(a=>{if(a===null)throw $e();Ge(a.userId===this.userId),r.push(nd(this.serializer,a))}))}),ee.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return sz(e._e,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.On(n.batchId)}),ee.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return ee.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Gh(e).J({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=mo(i[1]);s.push(c)}else l.done()}).next(()=>{Ge(s.length===0)})})}containsKey(e,n){return iz(e,this.userId,n)}Nn(e){return az(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function iz(t,e,n){const r=O0(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Gh(t).J({range:i,H:!0},(l,c,u)=>{const[d,h,f]=l;d===e&&h===s&&(a=!0),u.done()}).next(()=>a)}function ic(t){return Tr(t,"mutations")}function Gh(t){return Tr(t,"documentMutations")}function az(t){return Tr(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Wd(0)}static kn(){return new Wd(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tie{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.qn(e).next(n=>{const r=new Wd(n.highestTargetId);return n.highestTargetId=r.next(),this.Qn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(n=>Xe.fromTimestamp(new un(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.Qn(e,s)))}addTargetData(e,n){return this.Kn(e,n).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(n,r),this.Qn(e,r))))}updateTargetData(e,n){return this.Kn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Dh(e).delete(n.targetId)).next(()=>this.qn(e)).next(r=>(Ge(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Dh(e).J((a,l)=>{const c=Xm(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>ee.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Dh(e).J((r,s)=>{const i=Xm(s);n(i)})}qn(e){return iM(e).get("targetGlobalKey").next(n=>(Ge(n!==null),n))}Qn(e,n){return iM(e).put("targetGlobalKey",n)}Kn(e,n){return Dh(e).put(tz(this.serializer,n))}$n(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=Vd(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Dh(e).J({range:s,index:"queryTargetsIndex"},(a,l,c)=>{const u=Xm(l);iv(n,u.target)&&(i=u,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Sc(e);return n.forEach(a=>{const l=Os(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),ee.waitFor(s)}removeMatchingKeys(e,n,r){const s=Sc(e);return ee.forEach(n,i=>{const a=Os(i.path);return ee.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Sc(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Sc(e);let i=yt();return s.J({range:r,H:!0},(a,l,c)=>{const u=mo(a[1]),d=new Re(u);i=i.add(d)}).next(()=>i)}containsKey(e,n){const r=Os(n.path),s=IDBKeyRange.bound([r],[Y6(r)],!1,!0);let i=0;return Sc(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,l],c,u)=>{a!==0&&(i++,u.done())}).next(()=>i>0)}ot(e,n){return Dh(e).get(n).next(r=>r?Xm(r):null)}}function Dh(t){return Tr(t,"targets")}function iM(t){return Tr(t,"targetGlobal")}function Sc(t){return Tr(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aM([t,e],[n,r]){const s=dt(t,n);return s===0?dt(e,r):s}class Aie{constructor(e){this.Un=e,this.buffer=new rn(aM),this.Wn=0}Gn(){return++this.Wn}zn(e){const n=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();aM(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class oz{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){xe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){_u(n)?xe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await Su(n)}await this.Hn(3e5)})}}class kie{constructor(e,n){this.Jn=e,this.params=n}calculateTargetCount(e,n){return this.Jn.Yn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ee.resolve(hi.oe);const r=new Aie(n);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Jn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Jn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(xe("LruGarbageCollector","Garbage collection skipped; disabled"),ee.resolve(sM)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(xe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sM):this.Xn(e,n))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,n){let r,s,i,a,l,c,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(xe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,a=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,l=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(u=Date.now(),Hh()<=Ot.DEBUG&&xe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-d}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${h} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),ee.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function lz(t,e){return new kie(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iie{constructor(e,n){this.db=e,this.garbageCollector=lz(this,n)}Yn(e){const n=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Zn(e,n){return this.tr(e,(r,s)=>n(s))}addReference(e,n,r){return Ax(e,r)}removeReference(e,n,r){return Ax(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Ax(e,n)}nr(e,n){return function(s,i){let a=!1;return az(s).Y(l=>iz(s,l,i).next(c=>(c&&(a=!0),ee.resolve(!c)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,l)=>{if(l<=n){const c=this.nr(e,a).next(u=>{if(!u)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,Xe.min()),Sc(e).delete(function(h){return[0,Os(h.path)]}(a))))});s.push(c)}}).next(()=>ee.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Ax(e,n)}tr(e,n){const r=Sc(e);let s,i=hi.oe;return r.J({index:"documentTargetsIndex"},([a,l],{path:c,sequenceNumber:u})=>{a===0?(i!==hi.oe&&n(new Re(mo(s)),i),i=u,s=c):i=hi.oe}).next(()=>{i!==hi.oe&&n(new Re(mo(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ax(t,e){return Sc(t).put(function(r,s){return{targetId:0,path:Os(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cz{constructor(){this.changes=new ql(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,wn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ee.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pie{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Uu(e).put(r)}removeEntry(e,n,r){return Uu(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Lb(a),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.rr(e,r)))}getEntry(e,n){let r=wn.newInvalidDocument(n);return Uu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sm(n))},(s,i)=>{r=this.ir(n,i)}).next(()=>r)}sr(e,n){let r={size:0,document:wn.newInvalidDocument(n)};return Uu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sm(n))},(s,i)=>{r={document:this.ir(n,i),size:Bb(i)}}).next(()=>r)}getEntries(e,n){let r=pi();return this._r(e,n,(s,i)=>{const a=this.ir(s,i);r=r.insert(s,a)}).next(()=>r)}ar(e,n){let r=pi(),s=new mn(Re.comparator);return this._r(e,n,(i,a)=>{const l=this.ir(i,a);r=r.insert(i,l),s=s.insert(i,Bb(a))}).next(()=>({documents:r,ur:s}))}_r(e,n,r){if(n.isEmpty())return ee.resolve();let s=new rn(cM);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Sm(s.first()),Sm(s.last())),a=s.getIterator();let l=a.getNext();return Uu(e).J({index:"documentKeyIndex",range:i},(c,u,d)=>{const h=Re.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;l&&cM(l,h)<0;)r(l,null),l=a.getNext();l&&l.isEqual(h)&&(r(l,u),l=a.hasNext()?a.getNext():null),l?d.$(Sm(l)):d.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const a=n.path,l=[a.popLast().toArray(),a.lastSegment(),Lb(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Uu(e).U(IDBKeyRange.bound(l,c,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let d=pi();for(const h of u){const f=this.ir(Re.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);f.isFoundDocument()&&(ov(n,f)||s.has(f.key))&&(d=d.insert(f.key,f))}return d})}getAllFromCollectionGroup(e,n,r,s){let i=pi();const a=lM(n,r),l=lM(n,Hi.max());return Uu(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,l,!0)},(c,u,d)=>{const h=this.ir(Re.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(h.key,h),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new Oie(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return oM(e).get("remoteDocumentGlobalKey").next(n=>(Ge(!!n),n))}rr(e,n){return oM(e).put("remoteDocumentGlobalKey",n)}ir(e,n){if(n){const r=vie(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(Xe.min())))return r}return wn.newInvalidDocument(e)}}function uz(t){return new Pie(t)}class Oie extends cz{constructor(e,n){super(),this.cr=e,this.trackRemovals=n,this.lr=new ql(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new rn((i,a)=>dt(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.lr.get(i);if(n.push(this.cr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=GR(this.cr.serializer,a);s=s.add(i.path.popLast());const u=Bb(c);r+=u-l.size,n.push(this.cr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=GR(this.cr.serializer,a.convertToNoDocument(Xe.min()));n.push(this.cr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.cr.updateMetadata(e,r)),ee.waitFor(n)}getFromCache(e,n){return this.cr.sr(e,n).next(r=>(this.lr.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.cr.ar(e,n).next(({documents:r,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function oM(t){return Tr(t,"remoteDocumentGlobal")}function Uu(t){return Tr(t,"remoteDocumentsV14")}function Sm(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function lM(t,e){const n=e.documentKey.path.toArray();return[t,Lb(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function cM(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=dt(n[i],r[i]),s)return s;return s=dt(n.length,r.length),s||(s=dt(n[n.length-2],r[r.length-2]),s||dt(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Die{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dz{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&vg(r.mutation,s,fi.empty(),un.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,yt()).next(()=>r))}getLocalViewOfDocuments(e,n,r=yt()){const s=go();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=Ym();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=go();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,yt()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=pi();const a=yg(),l=function(){return yg()}();return n.forEach((c,u)=>{const d=r.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof Gl)?i=i.insert(u.key,u):d!==void 0?(a.set(u.key,d.mutation.getFieldMask()),vg(d.mutation,u,d.mutation.getFieldMask(),un.now())):a.set(u.key,fi.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,d)=>a.set(u,d)),n.forEach((u,d)=>{var h;return l.set(u,new Die(d,(h=a.get(u))!==null&&h!==void 0?h:null))}),l))}recalculateAndSaveOverlays(e,n){const r=yg();let s=new mn((a,l)=>a-l),i=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(c=>{const u=n.get(c);if(u===null)return;let d=r.get(c)||fi.empty();d=l.applyToLocalView(u,d),r.set(c,d);const h=(s.get(l.batchId)||yt()).add(c);s=s.insert(l.batchId,h)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),u=c.key,d=c.value,h=C5();d.forEach(f=>{if(!i.has(f)){const p=D5(n.get(f),r.get(f));p!==null&&h.set(f,p),i=i.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,h))}return ee.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return Re.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Nk(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):ee.resolve(go());let l=-1,c=i;return a.next(u=>ee.forEach(u,(d,h)=>(l<h.largestBatchId&&(l=h.largestBatchId),i.get(d)?ee.resolve():this.remoteDocumentCache.getEntry(e,d).next(f=>{c=c.insert(d,f)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,yt())).next(d=>({batchId:l,changes:E5(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Re(n)).next(r=>{let s=Ym();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=Ym();return this.indexManager.getCollectionParents(e,i).next(l=>ee.forEach(l,c=>{const u=function(h,f){return new Wl(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(d=>{d.forEach((h,f)=>{a=a.insert(h,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((c,u)=>{const d=u.getKey();a.get(d)===null&&(a=a.insert(d,wn.newInvalidDocument(d)))});let l=Ym();return a.forEach((c,u)=>{const d=i.get(c);d!==void 0&&vg(d.mutation,u,fi.empty(),un.now()),ov(n,u)&&(l=l.insert(c,u))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rie{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return ee.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:nr(s.createTime)}}(n)),ee.resolve()}getNamedQuery(e,n){return ee.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:Ik(s.bundledQuery),readTime:nr(s.readTime)}}(n)),ee.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mie{constructor(){this.overlays=new mn(Re.comparator),this.Ir=new Map}getOverlay(e,n){return ee.resolve(this.overlays.get(n))}getOverlays(e,n){const r=go();return ee.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.ht(e,n,i)}),ee.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),ee.resolve()}getOverlaysForCollection(e,n,r){const s=go(),i=n.length+1,a=new Re(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return ee.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new mn((u,d)=>u-d);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let d=i.get(u.largestBatchId);d===null&&(d=go(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const l=go(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>l.set(u,d)),!(l.size()>=s)););return ee.resolve(l)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Tk(n,r));let i=this.Ir.get(n);i===void 0&&(i=yt(),this.Ir.set(n,i)),this.Ir.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(){this.sessionToken=Fn.EMPTY_BYTE_STRING}getSessionToken(e){return ee.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ee.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(){this.Tr=new rn(Dr.Er),this.dr=new rn(Dr.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Dr(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Dr(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new Re(new Dt([])),r=new Dr(n,e),s=new Dr(n,e+1),i=[];return this.dr.forEachInRange([r,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new Re(new Dt([])),r=new Dr(n,e),s=new Dr(n,e+1);let i=yt();return this.dr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new Dr(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Dr{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return Re.comparator(e.key,n.key)||dt(e.wr,n.wr)}static Ar(e,n){return dt(e.wr,n.wr)||Re.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fie{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new rn(Dr.Er)}checkEmpty(e){return ee.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Ek(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.br=this.br.add(new Dr(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ee.resolve(a)}lookupMutationBatch(e,n){return ee.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),i=s<0?0:s;return ee.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ee.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Dr(n,0),s=new Dr(n,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],a=>{const l=this.Dr(a.wr);i.push(l)}),ee.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new rn(dt);return n.forEach(s=>{const i=new Dr(s,0),a=new Dr(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],l=>{r=r.add(l.wr)})}),ee.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;Re.isDocumentKey(i)||(i=i.child(""));const a=new Dr(new Re(i),0);let l=new rn(dt);return this.br.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(l=l.add(c.wr)),!0)},a),ee.resolve(this.Cr(l))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ge(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return ee.forEach(n.mutations,s=>{const i=new Dr(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Dr(n,0),s=this.br.firstAfterOrEqual(r);return ee.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ee.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bie{constructor(e){this.Mr=e,this.docs=function(){return new mn(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ee.resolve(r?r.document.mutableCopy():wn.newInvalidDocument(n))}getEntries(e,n){let r=pi();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():wn.newInvalidDocument(s))}),ee.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=pi();const a=n.path,l=new Re(a.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:u,value:{document:d}}=c.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||vk(X6(d),r)<=0||(s.has(d.key)||ov(n,d))&&(i=i.insert(d.key,d.mutableCopy()))}return ee.resolve(i)}getAllFromCollectionGroup(e,n,r,s){$e()}Or(e,n){return ee.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Vie(this)}getSize(e){return ee.resolve(this.size)}}class Vie extends cz{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),ee.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ie{constructor(e){this.persistence=e,this.Nr=new ql(n=>Vd(n),iv),this.lastRemoteSnapshotVersion=Xe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Dk,this.targetCount=0,this.kr=Wd.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),ee.resolve()}getLastRemoteSnapshotVersion(e){return ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ee.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ee.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),ee.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new Wd(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,ee.resolve()}updateTargetData(e,n){return this.Kn(n),ee.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,ee.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.Nr.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),ee.waitFor(i).next(()=>s)}getTargetCount(e){return ee.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return ee.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),ee.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),ee.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),ee.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return ee.resolve(r)}containsKey(e,n){return ee.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,n){this.qr={},this.overlays={},this.Qr=new hi(0),this.Kr=!1,this.Kr=!0,this.$r=new Lie,this.referenceDelegate=e(this),this.Ur=new $ie(this),this.indexManager=new Eie,this.remoteDocumentCache=function(s){return new Bie(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new ez(n),this.Gr=new Rie(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Mie,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new Fie(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){xe("MemoryPersistence","Starting transaction:",e);const s=new Uie(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,n){return ee.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class Uie extends Z6{constructor(e){super(),this.currentSequenceNumber=e}}class pN{constructor(e){this.persistence=e,this.Jr=new Dk,this.Yr=null}static Zr(e){return new pN(e)}get Xr(){if(this.Yr)return this.Yr;throw $e()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),ee.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),ee.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),ee.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ee.forEach(this.Xr,r=>{const s=Re.fromPath(r);return this.ei(e,s).next(i=>{i||n.removeEntry(s,Xe.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return ee.or([()=>ee.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}class Vb{constructor(e,n){this.persistence=e,this.ti=new ql(r=>Os(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=lz(this,n)}static Zr(e,n){return new Vb(e,n)}zr(){}jr(e){return ee.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}Yn(e){const n=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}Zn(e,n){return ee.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?ee.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,a=>this.nr(e,a,n).next(l=>{l||(r++,i.removeEntry(a,Xe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.ti.set(n,e.currentSequenceNumber),ee.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),ee.resolve()}removeReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),ee.resolve()}updateLimboDocument(e,n){return this.ti.set(n,e.currentSequenceNumber),ee.resolve()}Wr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=R0(e.data.value)),n}nr(e,n,r){return ee.or([()=>this.persistence.Hr(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.ti.get(n);return ee.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{constructor(e){this.serializer=e}O(e,n,r,s){const i=new iN("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",SR,{unique:!0}),c.createObjectStore("documentMutations")}(e),uM(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=ee.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),uM(e)),a=a.next(()=>function(c){const u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Xe.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",SR,{unique:!0});const h=u.store("mutations"),f=d.map(p=>h.put(p));return ee.waitFor(f)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.ni(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(a=a.next(()=>this.ii(i))),r<8&&s>=8&&(a=a.next(()=>this.si(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.oi(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const u=c.createObjectStore("documentOverlays",{keyPath:Ese});u.createIndex("collectionPathOverlayIndex",Cse,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Tse,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const u=c.createObjectStore("remoteDocumentsV14",{keyPath:mse});u.createIndex("documentKeyIndex",gse),u.createIndex("collectionGroupIndex",yse)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Nse}).createIndex("sequenceNumberIndex",Sse,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:_se}).createIndex("documentKeyIndex",jse,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{n.objectStore("indexState").clear()}).next(()=>{n.objectStore("indexEntries").clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let n=0;return e.store("remoteDocuments").J((r,s)=>{n+=Bb(s)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.U().next(s=>ee.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(l=>ee.forEach(l,c=>{Ge(c.userId===i.userId);const u=nd(this.serializer,c);return sz(e,i.userId,u).next(()=>{})}))}))}ii(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((a,l)=>{const c=new Dt(a),u=function(h){return[0,Os(h)]}(c);i.push(n.get(u).next(d=>d?ee.resolve():(h=>n.put({targetId:0,path:Os(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>ee.waitFor(i))})}si(e,n){e.createObjectStore("collectionParents",{keyPath:wse});const r=n.store("collectionParents"),s=new Ok,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:Os(c)})}};return n.store("remoteDocuments").J({H:!0},(a,l)=>{const c=new Dt(a);return i(c.popLast())}).next(()=>n.store("documentMutations").J({H:!0},([a,l,c],u)=>{const d=mo(l);return i(d.popLast())}))}oi(e){const n=e.store("targets");return n.J((r,s)=>{const i=Xm(s),a=tz(this.serializer,i);return n.put(a)})}_i(e,n){const r=n.store("remoteDocuments"),s=[];return r.J((i,a)=>{const l=n.store("remoteDocumentsV14"),c=function(h){return h.document?new Re(Dt.fromString(h.document.name).popFirst(5)):h.noDocument?Re.fromSegments(h.noDocument.path):h.unknownDocument?Re.fromSegments(h.unknownDocument.path):$e()}(a).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(u))}).next(()=>ee.waitFor(s))}ai(e,n){const r=n.store("mutations"),s=uz(this.serializer),i=new Rk(pN.Zr,this.serializer.ct);return r.U().next(a=>{const l=new Map;return a.forEach(c=>{var u;let d=(u=l.get(c.userId))!==null&&u!==void 0?u:yt();nd(this.serializer,c).keys().forEach(h=>d=d.add(h)),l.set(c.userId,d)}),ee.forEach(l,(c,u)=>{const d=new Lr(u),h=hN.lt(this.serializer,d),f=i.getIndexManager(d),p=fN.lt(d,this.serializer,f,i.referenceDelegate);return new dz(s,p,h,f).recalculateAndSaveOverlaysForDocumentKeys(new oC(n,hi.oe),c).next()})})}}function uM(t){t.createObjectStore("targetDocuments",{keyPath:xse}).createIndex("documentTargetsIndex",bse,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",vse,{unique:!0}),t.createObjectStore("targetGlobal")}const F_="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Mk{constructor(e,n,r,s,i,a,l,c,u,d,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.ui=i,this.window=a,this.document=l,this.ci=u,this.li=d,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=f=>Promise.resolve(),!Mk.D())throw new ve(ae.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Iie(this,s),this.Ai=n+"main",this.serializer=new ez(c),this.Ri=new jo(this.Ai,this.hi,new zie(this.serializer)),this.$r=new bie,this.Ur=new Tie(this.referenceDelegate,this.serializer),this.remoteDocumentCache=uz(this.serializer),this.Gr=new xie,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&tr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ve(ae.FAILED_PRECONDITION,F_);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new hi(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kx(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(n=>{n||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(n=>this.isPrimary&&!n?this.bi(e).next(()=>!1):!!n&&this.Di(e).next(()=>!0))).catch(e=>{if(_u(e))return xe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return xe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return _m(e).get("owner").next(n=>ee.resolve(this.vi(n)))}Ci(e){return kx(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=Tr(n,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(l=>i.indexOf(l)===-1);return ee.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const n of e)this.Vi.removeItem(this.Oi(n.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?ee.resolve(!0):_m(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)){if(this.vi(n)&&this.networkEnabled)return!0;if(!this.vi(n)){if(!n.allowTabSynchronization)throw new ve(ae.FAILED_PRECONDITION,F_);return!1}}return!(!this.networkEnabled||!this.inForeground)||kx(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&xe("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new oC(e,hi.oe);return this.bi(n).next(()=>this.Ci(n))}),this.Ri.close(),this.qi()}xi(e,n){return e.filter(r=>this.Mi(r.updateTimeMs,n)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>kx(e).U().next(n=>this.xi(n,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,n){return fN.lt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Cie(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return hN.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,n,r){xe("IndexedDbPersistence","Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===17?Ise:c===16?kse:c===15?bk:c===14?i5:c===13?s5:c===12?Ase:c===11?r5:void $e()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,l=>(a=new oC(l,this.Qr?this.Qr.next():hi.oe),n==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw tr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ve(ae.FAILED_PRECONDITION,J6);return r(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Ki(e){return _m(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)&&!this.vi(n)&&!(this.li||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ve(ae.FAILED_PRECONDITION,F_)})}Di(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _m(e).put("owner",n)}static D(){return jo.D()}bi(e){const n=_m(e);return n.get("owner").next(r=>this.vi(r)?(xe("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):ee.resolve())}Mi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(tr(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const n=/(?:Version|Mobile)\/1[456]/;Z3()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var n;try{const r=((n=this.Vi)===null||n===void 0?void 0:n.getItem(this.Oi(e)))!==null;return xe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return tr("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){tr("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _m(t){return Tr(t,"owner")}function kx(t){return Tr(t,"clientMetadata")}function Lk(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=yt(),s=yt();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Fk(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hie{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hz{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Z3()?8:e5(Cr())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.Yi(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new Hie;return this.Xi(e,n,a).next(l=>{if(i.result=l,this.zi)return this.es(e,n,a,l.size)})}).next(()=>i.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Hh()<=Ot.DEBUG&&xe("QueryEngine","SDK will not create cache indexes for query:",Wh(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ee.resolve()):(Hh()<=Ot.DEBUG&&xe("QueryEngine","Query:",Wh(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Hh()<=Ot.DEBUG&&xe("QueryEngine","The SDK decides to create cache indexes for query:",Wh(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ds(n))):ee.resolve())}Yi(e,n){if(MR(n))return ee.resolve(null);let r=Ds(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Rb(n,null,"F"),r=Ds(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=yt(...i);return this.Ji.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.ts(n,l);return this.ns(n,u,a,c.readTime)?this.Yi(e,Rb(n,null,"F")):this.rs(e,u,n,c)}))})))}Zi(e,n,r,s){return MR(n)||s.isEqual(Xe.min())?ee.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const a=this.ts(n,i);return this.ns(n,a,r,s)?ee.resolve(null):(Hh()<=Ot.DEBUG&&xe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wh(n)),this.rs(e,a,n,Q6(s,-1)).next(l=>l))})}ts(e,n){let r=new rn(_5(e));return n.forEach((s,i)=>{ov(e,i)&&(r=r.add(i))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,n,r){return Hh()<=Ot.DEBUG&&xe("QueryEngine","Using full collection scan to execute query:",Wh(n)),this.Ji.getDocumentsMatchingQuery(e,n,Hi.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wie{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new mn(dt),this._s=new ql(i=>Vd(i),iv),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dz(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function fz(t,e,n,r){return new Wie(t,e,n,r)}async function pz(t,e){const n=Ie(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=yt();for(const u of s){a.push(u.batchId);for(const d of u.mutations)c=c.add(d.key)}for(const u of i){l.push(u.batchId);for(const d of u.mutations)c=c.add(d.key)}return n.localDocuments.getDocuments(r,c).next(u=>({hs:u,removedBatchIds:a,addedBatchIds:l}))})})}function qie(t,e){const n=Ie(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,u,d){const h=u.batch,f=h.keys();let p=ee.resolve();return f.forEach(m=>{p=p.next(()=>d.getEntry(c,m)).next(g=>{const y=u.docVersions.get(m);Ge(y!==null),g.version.compareTo(y)<0&&(h.applyToRemoteDocument(g,u),g.isValidDocument()&&(g.setReadTime(u.commitVersion),d.addEntry(g)))})}),p.next(()=>l.mutationQueue.removeMutationBatch(c,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=yt();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(c=c.add(l.batch.mutations[u].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function mz(t){const e=Ie(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function Gie(t,e){const n=Ie(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const l=[];e.targetChanges.forEach((d,h)=>{const f=s.get(h);if(!f)return;l.push(n.Ur.removeMatchingKeys(i,d.removedDocuments,h).next(()=>n.Ur.addMatchingKeys(i,d.addedDocuments,h)));let p=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(Fn.EMPTY_BYTE_STRING,Xe.min()).withLastLimboFreeSnapshotVersion(Xe.min()):d.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(d.resumeToken,r)),s=s.insert(h,p),function(g,y,x){return g.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,p,d)&&l.push(n.Ur.updateTargetData(i,p))});let c=pi(),u=yt();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,d))}),l.push(gz(i,a,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!r.isEqual(Xe.min())){const d=n.Ur.getLastRemoteSnapshotVersion(i).next(h=>n.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(d)}return ee.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(n.os=s,i))}function gz(t,e,n){let r=yt(),s=yt();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=pi();return n.forEach((l,c)=>{const u=i.get(l);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(Xe.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):xe("LocalStore","Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",c.version)}),{Ps:a,Is:s}})}function Kie(t,e){const n=Ie(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ep(t,e){const n=Ie(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(i=>i?(s=i,ee.resolve(s)):n.Ur.allocateTargetId(r).next(a=>(s=new ul(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function tp(t,e,n){const r=Ie(t),s=r.os.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!_u(a))throw a;xe("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function $b(t,e,n){const r=Ie(t);let s=Xe.min(),i=yt();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,u,d){const h=Ie(c),f=h._s.get(d);return f!==void 0?ee.resolve(h.os.get(f)):h.Ur.getTargetData(u,d)}(r,a,Ds(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?s:Xe.min(),n?i:yt())).next(l=>(xz(r,S5(e),l),{documents:l,Ts:i})))}function yz(t,e){const n=Ie(t),r=Ie(n.Ur),s=n.os.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(a=>a?a.target:null))}function vz(t,e){const n=Ie(t),r=n.us.get(e)||Xe.min();return n.persistence.runTransaction("Get new document changes","readonly",s=>n.cs.getAllFromCollectionGroup(s,e,Q6(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(xz(n,e,s),s))}function xz(t,e,n){let r=t.us.get(e)||Xe.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.us.set(e,r)}async function Yie(t,e,n,r){const s=Ie(t);let i=yt(),a=pi();for(const u of n){const d=e.Es(u.metadata.name);u.document&&(i=i.add(d));const h=e.ds(u);h.setReadTime(e.As(u.metadata.readTime)),a=a.insert(d,h)}const l=s.cs.newChangeBuffer({trackRemovals:!0}),c=await ep(s,function(d){return Ds(Mp(Dt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>gz(u,l,a).next(d=>(l.apply(u),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Ur.addMatchingKeys(u,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))}async function Qie(t,e,n=yt()){const r=await ep(t,Ds(Ik(e.bundledQuery))),s=Ie(t);return s.persistence.runTransaction("Save named query","readwrite",i=>{const a=nr(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return s.Gr.saveNamedQuery(i,e);const l=r.withResumeToken(Fn.EMPTY_BYTE_STRING,a);return s.os=s.os.insert(l.targetId,l),s.Ur.updateTargetData(i,l).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,n,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function dM(t,e){return`firestore_clients_${t}_${e}`}function hM(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function B_(t,e){return`firestore_targets_${t}_${e}`}class Ub{constructor(e,n,r,s){this.user=e,this.batchId=n,this.state=r,this.error=s}static Rs(e,n,r){const s=JSON.parse(r);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new ve(s.error.code,s.error.message))),a?new Ub(e,n,s.state,i):(tr("SharedClientState",`Failed to parse mutation state for ID '${n}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xg{constructor(e,n,r){this.targetId=e,this.state=n,this.error=r}static Rs(e,n){const r=JSON.parse(n);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ve(r.error.code,r.error.message))),i?new xg(e,r.state,s):(tr("SharedClientState",`Failed to parse target state for ID '${e}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zb{constructor(e,n){this.clientId=e,this.activeTargetIds=n}static Rs(e,n){const r=JSON.parse(n);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Sk();for(let a=0;s&&a<r.activeTargetIds.length;++a)s=t5(r.activeTargetIds[a]),i=i.add(r.activeTargetIds[a]);return s?new zb(e,i):(tr("SharedClientState",`Failed to parse client data for instance '${e}': ${n}`),null)}}class Bk{constructor(e,n){this.clientId=e,this.onlineState=n}static Rs(e){const n=JSON.parse(e);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new Bk(n.clientId,n.onlineState):(tr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class wC{constructor(){this.activeTargetIds=Sk()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class V_{constructor(e,n,r,s,i){this.window=e,this.ui=n,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new mn(dt),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=dM(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new wC),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(dM(this.persistenceKey,r));if(s){const i=zb.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const n=this.storage.getItem(this.xs);if(n){const r=this.Ls(n);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let n=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(n=!0)}),n}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,n,r){this.qs(e,n,r),this.Qs(e)}addLocalQueryTarget(e,n=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(B_(this.persistenceKey,e));if(s){const i=xg.Rs(e,s);i&&(r=i.state)}}return n&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(B_(this.persistenceKey,e))}updateQueryState(e,n,r){this.$s(e,n,r)}handleUserChange(e,n,r){n.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const n=this.storage.getItem(e);return xe("SharedClientState","READ",e,n),n}setItem(e,n){xe("SharedClientState","SET",e,n),this.storage.setItem(e,n)}removeItem(e){xe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const n=e;if(n.storageArea===this.storage){if(xe("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void tr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(n.key!==null){if(this.Cs.test(n.key)){if(n.newValue==null){const r=this.Gs(n.key);return this.zs(r,null)}{const r=this.js(n.key,n.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(n.key)){if(n.newValue!==null){const r=this.Hs(n.key,n.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(n.key)){if(n.newValue!==null){const r=this.Ys(n.key,n.newValue);if(r)return this.Zs(r)}}else if(n.key===this.xs){if(n.newValue!==null){const r=this.Ls(n.newValue);if(r)return this.Bs(r)}}else if(n.key===this.vs){const r=function(i){let a=hi.oe;if(i!=null)try{const l=JSON.parse(i);Ge(typeof l=="number"),a=l}catch(l){tr("SharedClientState","Failed to read sequence number from WebStorage",l)}return a}(n.newValue);r!==hi.oe&&this.sequenceNumberHandler(r)}else if(n.key===this.Os){const r=this.Xs(n.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(n)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,n,r){const s=new Ub(this.currentUser,e,n,r),i=hM(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const n=hM(this.persistenceKey,this.currentUser,e);this.removeItem(n)}Us(e){const n={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(n))}$s(e,n,r){const s=B_(this.persistenceKey,e),i=new xg(e,n,r);this.setItem(s,i.Vs())}Ws(e){const n=JSON.stringify(Array.from(e));this.setItem(this.Os,n)}Gs(e){const n=this.Cs.exec(e);return n?n[1]:null}js(e,n){const r=this.Gs(e);return zb.Rs(r,n)}Hs(e,n){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Ub.Rs(new Lr(i),s,n)}Ys(e,n){const r=this.Ms.exec(e),s=Number(r[1]);return xg.Rs(s,n)}Ls(e){return Bk.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);xe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,n){const r=n?this.Ss.insert(e,n):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),a=[],l=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||l.push(c)}),this.syncEngine.io(a,l).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let n=Sk();return e.forEach((r,s)=>{n=n.unionWith(s.activeTargetIds)}),n}}class bz{constructor(){this.so=new wC,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new wC,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xie{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){xe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){xe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ix=null;function $_(){return Ix===null?Ix=function(){return 268435456+Math.round(2147483648*Math.random())}():Ix++,"0x"+Ix.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jie={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zie{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs="WebChannelConnection";class eae extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(n,r,s,i,a){const l=$_(),c=this.xo(n,r.toUriEncodedString());xe("RestConnection",`Sending RPC '${n}' ${l}:`,c,s);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,a),this.No(n,c,u,s).then(d=>(xe("RestConnection",`Received RPC '${n}' ${l}: `,d),d),d=>{throw zi("RestConnection",`RPC '${n}' ${l} failed with error: `,d,"url: ",c,"request:",s),d})}Lo(n,r,s,i,a,l){return this.Mo(n,r,s,i,a)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Rp}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,a)=>n[a]=i),s&&s.headers.forEach((i,a)=>n[a]=i)}xo(n,r){const s=Jie[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const i=$_();return new Promise((a,l)=>{const c=new $6;c.setWithCredentials(!0),c.listenOnce(U6.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case P0.NO_ERROR:const d=c.getResponseJson();xe(Cs,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),a(d);break;case P0.TIMEOUT:xe(Cs,`RPC '${e}' ${i} timed out`),l(new ve(ae.DEADLINE_EXCEEDED,"Request time out"));break;case P0.HTTP_ERROR:const h=c.getStatus();if(xe(Cs,`RPC '${e}' ${i} failed with status:`,h,"response text:",c.getResponseText()),h>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);const p=f==null?void 0:f.error;if(p&&p.status&&p.message){const m=function(y){const x=y.toLowerCase().replace(/_/g,"-");return Object.values(ae).indexOf(x)>=0?x:ae.UNKNOWN}(p.status);l(new ve(m,p.message))}else l(new ve(ae.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new ve(ae.UNAVAILABLE,"Connection failed."));break;default:$e()}}finally{xe(Cs,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);xe(Cs,`RPC '${e}' ${i} sending request:`,s),c.send(n,"POST",u,r,15)})}Bo(e,n,r){const s=$_(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=W6(),l=H6(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const d=i.join("");xe(Cs,`Creating RPC '${e}' stream ${s}: ${d}`,c);const h=a.createWebChannel(d,c);let f=!1,p=!1;const m=new Zie({Io:y=>{p?xe(Cs,`Not sending because RPC '${e}' stream ${s} is closed:`,y):(f||(xe(Cs,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),xe(Cs,`RPC '${e}' stream ${s} sending:`,y),h.send(y))},To:()=>h.close()}),g=(y,x,w)=>{y.listen(x,N=>{try{w(N)}catch(S){setTimeout(()=>{throw S},0)}})};return g(h,Km.EventType.OPEN,()=>{p||(xe(Cs,`RPC '${e}' stream ${s} transport opened.`),m.yo())}),g(h,Km.EventType.CLOSE,()=>{p||(p=!0,xe(Cs,`RPC '${e}' stream ${s} transport closed`),m.So())}),g(h,Km.EventType.ERROR,y=>{p||(p=!0,zi(Cs,`RPC '${e}' stream ${s} transport errored:`,y),m.So(new ve(ae.UNAVAILABLE,"The operation could not be completed")))}),g(h,Km.EventType.MESSAGE,y=>{var x;if(!p){const w=y.data[0];Ge(!!w);const N=w,S=N.error||((x=N[0])===null||x===void 0?void 0:x.error);if(S){xe(Cs,`RPC '${e}' stream ${s} received error:`,S);const C=S.status;let A=function(E){const I=lr[E];if(I!==void 0)return F5(I)}(C),j=S.message;A===void 0&&(A=ae.INTERNAL,j="Unknown error status: "+C+" with message "+S.message),p=!0,m.So(new ve(A,j)),h.close()}else xe(Cs,`RPC '${e}' stream ${s} received:`,w),m.bo(w)}}),g(l,z6.STAT_EVENT,y=>{y.stat===iC.PROXY?xe(Cs,`RPC '${e}' stream ${s} detected buffering proxy`):y.stat===iC.NOPROXY&&xe(Cs,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{m.wo()},0),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wz(){return typeof window<"u"?window:null}function B0(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dv(t){return new lie(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e,n,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&xe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nz{constructor(e,n,r,s,i,a,l,c){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Vk(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===ae.RESOURCE_EXHAUSTED?(tr(n.toString()),tr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new ve(ae.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return xe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(xe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class tae extends Nz{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=die(this.serializer,e),r=function(i){if(!("targetChange"in i))return Xe.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Xe.min():a.readTime?nr(a.readTime):Xe.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=gC(this.serializer),n.addTarget=function(i,a){let l;const c=a.target;if(l=Ob(c)?{documents:K5(i,c)}:{query:dN(i,c)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=U5(i,a.resumeToken);const u=pC(i,a.expectedCount);u!==null&&(l.expectedCount=u)}else if(a.snapshotVersion.compareTo(Xe.min())>0){l.readTime=Zf(i,a.snapshotVersion.toTimestamp());const u=pC(i,a.expectedCount);u!==null&&(l.expectedCount=u)}return l}(this.serializer,e);const r=fie(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=gC(this.serializer),n.removeTarget=e,this.a_(n)}}class nae extends Nz{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Ge(!!e.streamToken),this.lastStreamToken=e.streamToken,Ge(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ge(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=hie(e.writeResults,e.commitTime),r=nr(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=gC(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>hy(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rae extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ve(ae.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,mC(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ve(ae.UNKNOWN,i.toString())})}Lo(e,n,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Lo(e,mC(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ve(ae.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class sae{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(tr(n),this.D_=!1):xe("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iae{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{r.enqueueAndForget(async()=>{Eu(this)&&(xe("RemoteStore","Restarting streams for network reachability change."),await async function(c){const u=Ie(c);u.L_.add(4),await Bp(u),u.q_.set("Unknown"),u.L_.delete(4),await hv(u)}(this))})}),this.q_=new sae(r,s)}}async function hv(t){if(Eu(t))for(const e of t.B_)await e(!0)}async function Bp(t){for(const e of t.B_)await e(!1)}function mN(t,e){const n=Ie(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),zk(n)?Uk(n):$p(n).r_()&&$k(n,e))}function np(t,e){const n=Ie(t),r=$p(n);n.N_.delete(e),r.r_()&&Sz(n,e),n.N_.size===0&&(r.r_()?r.o_():Eu(n)&&n.q_.set("Unknown"))}function $k(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Xe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}$p(t).A_(e)}function Sz(t,e){t.Q_.xe(e),$p(t).R_(e)}function Uk(t){t.Q_=new sie({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),$p(t).start(),t.q_.v_()}function zk(t){return Eu(t)&&!$p(t).n_()&&t.N_.size>0}function Eu(t){return Ie(t).L_.size===0}function _z(t){t.Q_=void 0}async function aae(t){t.q_.set("Online")}async function oae(t){t.N_.forEach((e,n)=>{$k(t,e)})}async function lae(t,e){_z(t),zk(t)?(t.q_.M_(e),Uk(t)):t.q_.set("Unknown")}async function cae(t,e,n){if(t.q_.set("Online"),e instanceof $5&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.N_.delete(l),s.Q_.removeTarget(l))}(t,e)}catch(r){xe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Hb(t,r)}else if(e instanceof F0?t.Q_.Ke(e):e instanceof V5?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Xe.min()))try{const r=await mz(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Q_.rt(a);return l.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const d=i.N_.get(u);d&&i.N_.set(u,d.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,u)=>{const d=i.N_.get(c);if(!d)return;i.N_.set(c,d.withResumeToken(Fn.EMPTY_BYTE_STRING,d.snapshotVersion)),Sz(i,c);const h=new ul(d.target,c,u,d.sequenceNumber);$k(i,h)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){xe("RemoteStore","Failed to raise snapshot:",r),await Hb(t,r)}}async function Hb(t,e,n){if(!_u(e))throw e;t.L_.add(1),await Bp(t),t.q_.set("Offline"),n||(n=()=>mz(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{xe("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await hv(t)})}function jz(t,e){return e().catch(n=>Hb(t,n,e))}async function Vp(t){const e=Ie(t),n=du(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;uae(e);)try{const s=await Kie(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,dae(e,s)}catch(s){await Hb(e,s)}Ez(e)&&Cz(e)}function uae(t){return Eu(t)&&t.O_.length<10}function dae(t,e){t.O_.push(e);const n=du(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Ez(t){return Eu(t)&&!du(t).n_()&&t.O_.length>0}function Cz(t){du(t).start()}async function hae(t){du(t).p_()}async function fae(t){const e=du(t);for(const n of t.O_)e.m_(n.mutations)}async function pae(t,e,n){const r=t.O_.shift(),s=Ck.from(r,e,n);await jz(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Vp(t)}async function mae(t,e){e&&du(t).V_&&await async function(r,s){if(function(a){return L5(a)&&a!==ae.ABORTED}(s.code)){const i=r.O_.shift();du(r).s_(),await jz(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Vp(r)}}(t,e),Ez(t)&&Cz(t)}async function pM(t,e){const n=Ie(t);n.asyncQueue.verifyOperationInProgress(),xe("RemoteStore","RemoteStore received new credentials");const r=Eu(n);n.L_.add(3),await Bp(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await hv(n)}async function NC(t,e){const n=Ie(t);e?(n.L_.delete(2),await hv(n)):e||(n.L_.add(2),await Bp(n),n.q_.set("Unknown"))}function $p(t){return t.K_||(t.K_=function(n,r,s){const i=Ie(n);return i.w_(),new tae(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:aae.bind(null,t),Ro:oae.bind(null,t),mo:lae.bind(null,t),d_:cae.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),zk(t)?Uk(t):t.q_.set("Unknown")):(await t.K_.stop(),_z(t))})),t.K_}function du(t){return t.U_||(t.U_=function(n,r,s){const i=Ie(n);return i.w_(),new nae(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:hae.bind(null,t),mo:mae.bind(null,t),f_:fae.bind(null,t),g_:pae.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Vp(t)):(await t.U_.stop(),t.O_.length>0&&(xe("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Ur,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Hk(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ve(ae.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Up(t,e){if(tr("AsyncQueue",`${e}: ${t}`),_u(t))return new ve(ae.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e){this.comparator=e?(n,r)=>e(n,r)||Re.comparator(n.key,r.key):(n,r)=>Re.comparator(n.key,r.key),this.keyedMap=Ym(),this.sortedSet=new mn(this.comparator)}static emptySet(e){return new kf(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof kf)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new kf;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(){this.W_=new mn(Re.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):$e():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class rp{constructor(e,n,r,s,i,a,l,c,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new rp(e,n,kf.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&av(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gae{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class yae{constructor(){this.queries=gM(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=Ie(n),i=s.queries;s.queries=gM(),i.forEach((a,l)=>{for(const c of l.j_)c.onError(r)})})(this,new ve(ae.ABORTED,"Firestore shutting down"))}}function gM(){return new ql(t=>N5(t),av)}async function Wk(t,e){const n=Ie(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new gae,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(s,!0);break;case 1:i.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=Up(a,`Initialization of query '${Wh(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.j_.push(e),e.Z_(n.onlineState),i.z_&&e.X_(i.z_)&&Gk(n)}async function qk(t,e){const n=Ie(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function vae(t,e){const n=Ie(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.j_)l.X_(s)&&(r=!0);a.z_=s}}r&&Gk(n)}function xae(t,e,n){const r=Ie(t),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(n);r.queries.delete(e)}function Gk(t){t.Y_.forEach(e=>{e.next()})}var SC,yM;(yM=SC||(SC={})).ea="default",yM.Cache="cache";class Kk{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new rp(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=rp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==SC.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bae{constructor(e,n){this.aa=e,this.byteLength=n}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(e){this.serializer=e}Es(e){return Eo(this.serializer,e)}ds(e){return e.metadata.exists?G5(this.serializer,e.document,!1):wn.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return nr(e)}}class wae{constructor(e,n,r){this.ca=e,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Tz(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let n=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++n;const r=Dt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++n);return n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null}ha(e){const n=new Map,r=new vM(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const a of s.metadata.queries){const l=(n.get(a)||yt()).add(i);n.set(a,l)}}return n}async complete(){const e=await Yie(this.localStore,new vM(this.serializer),this.documents,this.ca.id),n=this.ha(this.documents);for(const r of this.queries)await Qie(this.localStore,r,n.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Tz(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Az{constructor(e){this.key=e}}class kz{constructor(e){this.key=e}}class Iz{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=yt(),this.mutatedKeys=yt(),this.Aa=_5(e),this.Ra=new kf(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new mM,s=n?n.Ra:this.Ra;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,h)=>{const f=s.get(d),p=ov(this.query,h)?h:null,m=!!f&&this.mutatedKeys.has(f.key),g=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let y=!1;f&&p?f.data.isEqual(p.data)?m!==g&&(r.track({type:3,doc:p}),y=!0):this.ga(f,p)||(r.track({type:2,doc:p}),y=!0,(c&&this.Aa(p,c)>0||u&&this.Aa(p,u)<0)&&(l=!0)):!f&&p?(r.track({type:0,doc:p}),y=!0):f&&!p&&(r.track({type:1,doc:f}),y=!0,(c||u)&&(l=!0)),y&&(p?(a=a.add(p),i=g?i.add(d):i.delete(d)):(a=a.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const d=this.query.limitType==="F"?a.last():a.first();a=a.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:a,fa:r,ns:l,mutatedKeys:i}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((d,h)=>function(p,m){const g=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $e()}};return g(p)-g(m)}(d.type,h.type)||this.Aa(d.doc,h.doc)),this.pa(r),s=s!=null&&s;const l=n&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,u=c!==this.Ea;return this.Ea=c,a.length!==0||u?{snapshot:new rp(this.query,e.Ra,i,a,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new mM,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=yt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new kz(r))}),this.da.forEach(r=>{e.has(r)||n.push(new Az(r))}),n}ba(e){this.Ta=e.Ts,this.da=yt();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return rp.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Nae{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Sae{constructor(e){this.key=e,this.va=!1}}class _ae{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new ql(l=>N5(l),av),this.Ma=new Map,this.xa=new Set,this.Oa=new mn(Re.comparator),this.Na=new Map,this.La=new Dk,this.Ba={},this.ka=new Map,this.qa=Wd.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function jae(t,e,n=!0){const r=gN(t);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Pz(r,e,n,!0),s}async function Eae(t,e){const n=gN(t);await Pz(n,e,!0,!1)}async function Pz(t,e,n,r){const s=await ep(t.localStore,Ds(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await Yk(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&mN(t.remoteStore,s),l}async function Yk(t,e,n,r,s){t.Ka=(h,f,p)=>async function(g,y,x,w){let N=y.view.ma(x);N.ns&&(N=await $b(g.localStore,y.query,!1).then(({documents:j})=>y.view.ma(j,N)));const S=w&&w.targetChanges.get(y.targetId),C=w&&w.targetMismatches.get(y.targetId)!=null,A=y.view.applyChanges(N,g.isPrimaryClient,S,C);return _C(g,y.targetId,A.wa),A.snapshot}(t,h,f,p);const i=await $b(t.localStore,e,!0),a=new Iz(e,i.Ts),l=a.ma(i.documents),c=uv.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),u=a.applyChanges(l,t.isPrimaryClient,c);_C(t,n,u.wa);const d=new Nae(e,n,a);return t.Fa.set(e,d),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),u.snapshot}async function Cae(t,e,n){const r=Ie(t),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(a=>!av(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await tp(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&np(r.remoteStore,s.targetId),sp(r,s.targetId)}).catch(Su)):(sp(r,s.targetId),await tp(r.localStore,s.targetId,!0))}async function Tae(t,e){const n=Ie(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),np(n.remoteStore,r.targetId))}async function Aae(t,e,n){const r=Zk(t);try{const s=await function(a,l){const c=Ie(a),u=un.now(),d=l.reduce((p,m)=>p.add(m.key),yt());let h,f;return c.persistence.runTransaction("Locally write mutations","readwrite",p=>{let m=pi(),g=yt();return c.cs.getEntries(p,d).next(y=>{m=y,m.forEach((x,w)=>{w.isValidDocument()||(g=g.add(x))})}).next(()=>c.localDocuments.getOverlayedDocuments(p,m)).next(y=>{h=y;const x=[];for(const w of l){const N=tie(w,h.get(w.key).overlayedDocument);N!=null&&x.push(new Gl(w.key,N,d5(N.value.mapValue),An.exists(!0)))}return c.mutationQueue.addMutationBatch(p,u,x,l)}).next(y=>{f=y;const x=y.applyToLocalDocumentSet(h,g);return c.documentOverlayCache.saveOverlays(p,y.batchId,x)})}).then(()=>({batchId:f.batchId,changes:E5(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let u=a.Ba[a.currentUser.toKey()];u||(u=new mn(dt)),u=u.insert(l,c),a.Ba[a.currentUser.toKey()]=u}(r,s.batchId,n),await Kl(r,s.changes),await Vp(r.remoteStore)}catch(s){const i=Up(s,"Failed to persist write");n.reject(i)}}async function Oz(t,e){const n=Ie(t);try{const r=await Gie(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Na.get(i);a&&(Ge(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?Ge(a.va):s.removedDocuments.size>0&&(Ge(a.va),a.va=!1))}),await Kl(n,r,e)}catch(r){await Su(r)}}function xM(t,e,n){const r=Ie(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((i,a)=>{const l=a.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=Ie(a);c.onlineState=l;let u=!1;c.queries.forEach((d,h)=>{for(const f of h.j_)f.Z_(l)&&(u=!0)}),u&&Gk(c)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function kae(t,e,n){const r=Ie(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),i=s&&s.key;if(i){let a=new mn(Re.comparator);a=a.insert(i,wn.newNoDocument(i,Xe.min()));const l=yt().add(i),c=new cv(Xe.min(),new Map,new mn(dt),a,l);await Oz(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),Jk(r)}else await tp(r.localStore,e,!1).then(()=>sp(r,e,n)).catch(Su)}async function Iae(t,e){const n=Ie(t),r=e.batch.batchId;try{const s=await qie(n.localStore,e);Xk(n,r,null),Qk(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Kl(n,s)}catch(s){await Su(s)}}async function Pae(t,e,n){const r=Ie(t);try{const s=await function(a,l){const c=Ie(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,l).next(h=>(Ge(h!==null),d=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(r.localStore,e);Xk(r,e,n),Qk(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Kl(r,s)}catch(s){await Su(s)}}async function Oae(t,e){const n=Ie(t);Eu(n.remoteStore)||xe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const l=Ie(a);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>l.mutationQueue.getHighestUnacknowledgedBatchId(c))}(n.localStore);if(r===-1)return void e.resolve();const s=n.ka.get(r)||[];s.push(e),n.ka.set(r,s)}catch(r){const s=Up(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Qk(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function Xk(t,e,n){const r=Ie(t);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function sp(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||Dz(t,r)})}function Dz(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(np(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Jk(t))}function _C(t,e,n){for(const r of n)r instanceof Az?(t.La.addReference(r.key,e),Dae(t,r)):r instanceof kz?(xe("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||Dz(t,r.key)):$e()}function Dae(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(xe("SyncEngine","New document in limbo: "+n),t.xa.add(r),Jk(t))}function Jk(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new Re(Dt.fromString(e)),r=t.qa.next();t.Na.set(r,new Sae(n)),t.Oa=t.Oa.insert(n,r),mN(t.remoteStore,new ul(Ds(Mp(n.path)),r,"TargetPurposeLimboResolution",hi.oe))}}async function Kl(t,e,n){const r=Ie(t),s=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{a.push(r.Ka(c,e,n).then(u=>{var d;if((u||n)&&r.isPrimaryClient){const h=u?!u.fromCache:(d=n==null?void 0:n.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(u){s.push(u);const h=Fk.Wi(c.targetId,u);i.push(h)}}))}),await Promise.all(a),r.Ca.d_(s),await async function(c,u){const d=Ie(c);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ee.forEach(u,f=>ee.forEach(f.$i,p=>d.persistence.referenceDelegate.addReference(h,f.targetId,p)).next(()=>ee.forEach(f.Ui,p=>d.persistence.referenceDelegate.removeReference(h,f.targetId,p)))))}catch(h){if(!_u(h))throw h;xe("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const p=d.os.get(f),m=p.snapshotVersion,g=p.withLastLimboFreeSnapshotVersion(m);d.os=d.os.insert(f,g)}}}(r.localStore,i))}async function Rae(t,e){const n=Ie(t);if(!n.currentUser.isEqual(e)){xe("SyncEngine","User change. New user:",e.toKey());const r=await pz(n.localStore,e);n.currentUser=e,function(i,a){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new ve(ae.CANCELLED,a))})}),i.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Kl(n,r.hs)}}function Mae(t,e){const n=Ie(t),r=n.Na.get(e);if(r&&r.va)return yt().add(r.key);{let s=yt();const i=n.Ma.get(e);if(!i)return s;for(const a of i){const l=n.Fa.get(a);s=s.unionWith(l.view.Va)}return s}}async function Lae(t,e){const n=Ie(t),r=await $b(n.localStore,e.query,!0),s=e.view.ba(r);return n.isPrimaryClient&&_C(n,e.targetId,s.wa),s}async function Fae(t,e){const n=Ie(t);return vz(n.localStore,e).then(r=>Kl(n,r))}async function Bae(t,e,n,r){const s=Ie(t),i=await function(l,c){const u=Ie(l),d=Ie(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>d.Mn(h,c).next(f=>f?u.localDocuments.getDocuments(h,f):ee.resolve(null)))}(s.localStore,e);i!==null?(n==="pending"?await Vp(s.remoteStore):n==="acknowledged"||n==="rejected"?(Xk(s,e,r||null),Qk(s,e),function(l,c){Ie(Ie(l).mutationQueue).On(c)}(s.localStore,e)):$e(),await Kl(s,i)):xe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Vae(t,e){const n=Ie(t);if(gN(n),Zk(n),e===!0&&n.Qa!==!0){const r=n.sharedClientState.getAllActiveQueryTargets(),s=await bM(n,r.toArray());n.Qa=!0,await NC(n.remoteStore,!0);for(const i of s)mN(n.remoteStore,i)}else if(e===!1&&n.Qa!==!1){const r=[];let s=Promise.resolve();n.Ma.forEach((i,a)=>{n.sharedClientState.isLocalQueryTarget(a)?r.push(a):s=s.then(()=>(sp(n,a),tp(n.localStore,a,!0))),np(n.remoteStore,a)}),await s,await bM(n,r),function(a){const l=Ie(a);l.Na.forEach((c,u)=>{np(l.remoteStore,u)}),l.La.pr(),l.Na=new Map,l.Oa=new mn(Re.comparator)}(n),n.Qa=!1,await NC(n.remoteStore,!1)}}async function bM(t,e,n){const r=Ie(t),s=[],i=[];for(const a of e){let l;const c=r.Ma.get(a);if(c&&c.length!==0){l=await ep(r.localStore,Ds(c[0]));for(const u of c){const d=r.Fa.get(u),h=await Lae(r,d);h.snapshot&&i.push(h.snapshot)}}else{const u=await yz(r.localStore,a);l=await ep(r.localStore,u),await Yk(r,Rz(u),a,!1,l.resumeToken)}s.push(l)}return r.Ca.d_(i),s}function Rz(t){return x5(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function $ae(t){return function(n){return Ie(Ie(n).persistence).Qi()}(Ie(t).localStore)}async function Uae(t,e,n,r){const s=Ie(t);if(s.Qa)return void xe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const a=await vz(s.localStore,S5(i[0])),l=cv.createSynthesizedRemoteEventForCurrentChange(e,n==="current",Fn.EMPTY_BYTE_STRING);await Kl(s,a,l);break}case"rejected":await tp(s.localStore,e,!0),sp(s,e,r);break;default:$e()}}async function zae(t,e,n){const r=gN(t);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){xe("SyncEngine","Adding an already active target "+s);continue}const i=await yz(r.localStore,s),a=await ep(r.localStore,i);await Yk(r,Rz(i),a.targetId,!1,a.resumeToken),mN(r.remoteStore,a)}for(const s of n)r.Ma.has(s)&&await tp(r.localStore,s,!1).then(()=>{np(r.remoteStore,s),sp(r,s)}).catch(Su)}}function gN(t){const e=Ie(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Oz.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mae.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kae.bind(null,e),e.Ca.d_=vae.bind(null,e.eventManager),e.Ca.$a=xae.bind(null,e.eventManager),e}function Zk(t){const e=Ie(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Iae.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Pae.bind(null,e),e}function Hae(t,e,n){const r=Ie(t);(async function(i,a,l){try{const c=await a.getMetadata();if(await function(p,m){const g=Ie(p),y=nr(m.createTime);return g.persistence.runTransaction("hasNewerBundle","readonly",x=>g.Gr.getBundleMetadata(x,m.id)).then(x=>!!x&&x.createTime.compareTo(y)>=0)}(i.localStore,c))return await a.close(),l._completeWith(function(p){return{taskState:"Success",documentsLoaded:p.totalDocuments,bytesLoaded:p.totalBytes,totalDocuments:p.totalDocuments,totalBytes:p.totalBytes}}(c)),Promise.resolve(new Set);l._updateProgress(Tz(c));const u=new wae(c,i.localStore,a.serializer);let d=await a.Ua();for(;d;){const f=await u.la(d);f&&l._updateProgress(f),d=await a.Ua()}const h=await u.complete();return await Kl(i,h.Ia,void 0),await function(p,m){const g=Ie(p);return g.persistence.runTransaction("Save bundle","readwrite",y=>g.Gr.saveBundleMetadata(y,m))}(i.localStore,c),l._completeWith(h.progress),Promise.resolve(h.Pa)}catch(c){return zi("SyncEngine",`Loading bundle failed with ${c}`),l._failWith(c),Promise.resolve(new Set)}})(r,e,n).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class hu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dv(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return fz(this.persistence,new hz,e.initialUser,this.serializer)}Ga(e){return new Rk(pN.Zr,this.serializer)}Wa(e){return new bz}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hu.provider={build:()=>new hu};class Wae extends hu{constructor(e){super(),this.cacheSizeBytes=e}ja(e,n){Ge(this.persistence.referenceDelegate instanceof Vb);const r=this.persistence.referenceDelegate.garbageCollector;return new oz(r,e.asyncQueue,n)}Ga(e){const n=this.cacheSizeBytes!==void 0?ks.withCacheSize(this.cacheSizeBytes):ks.DEFAULT;return new Rk(r=>Vb.Zr(r,n),this.serializer)}}class eI extends hu{constructor(e,n,r){super(),this.Ja=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Zk(this.Ja.syncEngine),await Vp(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return fz(this.persistence,new hz,e.initialUser,this.serializer)}ja(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new oz(r,e.asyncQueue,n)}Ha(e,n){const r=new hse(n,this.persistence);return new dse(e.asyncQueue,r)}Ga(e){const n=Lk(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ks.withCacheSize(this.cacheSizeBytes):ks.DEFAULT;return new Mk(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,wz(),B0(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new bz}}class Mz extends eI{constructor(e,n){super(e,n,!1),this.Ja=e,this.cacheSizeBytes=n,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const n=this.Ja.syncEngine;this.sharedClientState instanceof V_&&(this.sharedClientState.syncEngine={no:Bae.bind(null,n),ro:Uae.bind(null,n),io:zae.bind(null,n),Qi:$ae.bind(null,n),eo:Fae.bind(null,n)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await Vae(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const n=wz();if(!V_.D(n))throw new ve(ae.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Lk(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new V_(n,e.asyncQueue,r,e.clientId,e.initialUser)}}class fu{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>xM(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Rae.bind(null,this.syncEngine),await NC(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new yae}()}createDatastore(e){const n=dv(e.databaseInfo.databaseId),r=function(i){return new eae(i)}(e.databaseInfo);return function(i,a,l,c){return new rae(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new iae(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>xM(this.syncEngine,n,0),function(){return fM.D()?new fM:new Xie}())}createSyncEngine(e,n){return function(s,i,a,l,c,u,d){const h=new _ae(s,i,a,l,c,u);return d&&(h.Qa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Ie(s);xe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Bp(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}fu.provider={build:()=>new fu};function wM(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):tr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qae{constructor(e,n){this.Xa=e,this.serializer=n,this.metadata=new Ur,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const n=this.eu.decode(e),r=Number(n);isNaN(r)&&this.ru(`length string (${n}) is not valid number`);const s=await this.iu(r);return new bae(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e===123)}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const n=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),n}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const n=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),n}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const n=new Uint8Array(this.buffer.length+e.value.length);n.set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gae{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ve(ae.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await async function(s,i){const a=Ie(s),l={documents:i.map(h=>dy(a.serializer,h))},c=await a.Lo("BatchGetDocuments",a.serializer.databaseId,Dt.emptyPath(),l,i.length),u=new Map;c.forEach(h=>{const f=uie(a.serializer,h);u.set(f.key.toString(),f)});const d=[];return i.forEach(h=>{const f=u.get(h.toString());Ge(!!f),d.push(f)}),d}(this.datastore,e);return n.forEach(r=>this.recordVersion(r)),n}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fp(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(n=>{e.delete(n.key.toString())}),e.forEach((n,r)=>{const s=Re.fromPath(r);this.mutations.push(new jk(s,this.precondition(s)))}),await async function(r,s){const i=Ie(r),a={writes:s.map(l=>hy(i.serializer,l))};await i.Mo("Commit",i.serializer.databaseId,Dt.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw $e();n=Xe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new ve(ae.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){const n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(Xe.min())?An.exists(!1):An.updateTime(n):An.none()}preconditionForUpdate(e){const n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(Xe.min()))throw new ve(ae.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return An.updateTime(n)}return An.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kae{constructor(e,n,r,s,i){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Vk(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new Gae(this.datastore),n=this.cu(e);n&&n.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const n=this.updateFunction(e);return!sv(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!L5(n)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yae{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Lr.UNAUTHENTICATED,this.clientId=yk.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{xe("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(xe("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ur;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Up(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function U_(t,e){t.asyncQueue.verifyOperationInProgress(),xe("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await pz(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function NM(t,e){t.asyncQueue.verifyOperationInProgress();const n=await tI(t);xe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>pM(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>pM(e.remoteStore,s)),t._onlineComponents=e}async function tI(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){xe("FirestoreClient","Using user provided OfflineComponentProvider");try{await U_(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===ae.FAILED_PRECONDITION||s.code===ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;zi("Error using user provided cache. Falling back to memory cache: "+n),await U_(t,new hu)}}else xe("FirestoreClient","Using default OfflineComponentProvider"),await U_(t,new hu);return t._offlineComponents}async function vN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(xe("FirestoreClient","Using user provided OnlineComponentProvider"),await NM(t,t._uninitializedComponentsProvider._online)):(xe("FirestoreClient","Using default OnlineComponentProvider"),await NM(t,new fu))),t._onlineComponents}function Lz(t){return tI(t).then(e=>e.persistence)}function zp(t){return tI(t).then(e=>e.localStore)}function Fz(t){return vN(t).then(e=>e.remoteStore)}function nI(t){return vN(t).then(e=>e.syncEngine)}function Bz(t){return vN(t).then(e=>e.datastore)}async function ip(t){const e=await vN(t),n=e.eventManager;return n.onListen=jae.bind(null,e.syncEngine),n.onUnlisten=Cae.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Eae.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Tae.bind(null,e.syncEngine),n}function Qae(t){return t.asyncQueue.enqueue(async()=>{const e=await Lz(t),n=await Fz(t);return e.setNetworkEnabled(!0),function(s){const i=Ie(s);return i.L_.delete(0),hv(i)}(n)})}function Xae(t){return t.asyncQueue.enqueue(async()=>{const e=await Lz(t),n=await Fz(t);return e.setNetworkEnabled(!1),async function(s){const i=Ie(s);i.L_.add(0),await Bp(i),i.q_.set("Offline")}(n)})}function Jae(t,e){const n=new Ur;return t.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await function(u,d){const h=Ie(u);return h.persistence.runTransaction("read document","readonly",f=>h.localDocuments.getDocument(f,d))}(s,i);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new ve(ae.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const c=Up(l,`Failed to get document '${i} from cache`);a.reject(c)}}(await zp(t),e,n)),n.promise}function Vz(t,e,n={}){const r=new Ur;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,u){const d=new yN({next:f=>{d.Za(),a.enqueueAndForget(()=>qk(i,h));const p=f.docs.has(l);!p&&f.fromCache?u.reject(new ve(ae.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&f.fromCache&&c&&c.source==="server"?u.reject(new ve(ae.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Kk(Mp(l.path),d,{includeMetadataChanges:!0,_a:!0});return Wk(i,h)}(await ip(t),t.asyncQueue,e,n,r)),r.promise}function Zae(t,e){const n=new Ur;return t.asyncQueue.enqueueAndForget(async()=>async function(s,i,a){try{const l=await $b(s,i,!0),c=new Iz(i,l.Ts),u=c.ma(l.documents),d=c.applyChanges(u,!1);a.resolve(d.snapshot)}catch(l){const c=Up(l,`Failed to execute query '${i} against cache`);a.reject(c)}}(await zp(t),e,n)),n.promise}function $z(t,e,n={}){const r=new Ur;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,u){const d=new yN({next:f=>{d.Za(),a.enqueueAndForget(()=>qk(i,h)),f.fromCache&&c.source==="server"?u.reject(new ve(ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Kk(l,d,{includeMetadataChanges:!0,_a:!0});return Wk(i,h)}(await ip(t),t.asyncQueue,e,n,r)),r.promise}function eoe(t,e,n){const r=new Ur;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await Bz(t);r.resolve(async function(a,l,c){var u;const d=Ie(a),{request:h,ut:f,parent:p}=Y5(d.serializer,b5(l),c);d.connection.Fo||delete h.parent;const m=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,p,h,1)).filter(y=>!!y.result);Ge(m.length===1);const g=(u=m[0].result)===null||u===void 0?void 0:u.aggregateFields;return Object.keys(g).reduce((y,x)=>(y[f[x]]=g[x],y),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}function toe(t,e){const n=new yN(e);return t.asyncQueue.enqueueAndForget(async()=>function(s,i){Ie(s).Y_.add(i),i.next()}(await ip(t),n)),()=>{n.Za(),t.asyncQueue.enqueueAndForget(async()=>function(s,i){Ie(s).Y_.delete(i)}(await ip(t),n))}}function noe(t,e,n,r){const s=function(a,l){let c;return c=typeof a=="string"?B5().encode(a):a,function(d,h){return new qae(d,h)}(function(d,h){if(d instanceof Uint8Array)return wM(d,h);if(d instanceof ArrayBuffer)return wM(new Uint8Array(d),h);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),l)}(n,dv(e));t.asyncQueue.enqueueAndForget(async()=>{Hae(await nI(t),s,r)})}function roe(t,e){return t.asyncQueue.enqueue(async()=>function(r,s){const i=Ie(r);return i.persistence.runTransaction("Get named query","readonly",a=>i.Gr.getNamedQuery(a,s))}(await zp(t),e))}function soe(t,e){return t.asyncQueue.enqueue(async()=>async function(r,s){const i=Ie(r),a=i.indexManager,l=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(u=>function(h,f,p,m,g){h=[...h],f=[...f],h.sort(p),f.sort(p);const y=h.length,x=f.length;let w=0,N=0;for(;w<x&&N<y;){const S=p(h[N],f[w]);S<0?g(h[N++]):S>0?m(f[w++]):(w++,N++)}for(;w<x;)m(f[w++]);for(;N<y;)g(h[N++])}(u,s,ose,d=>{l.push(a.addFieldIndex(c,d))},d=>{l.push(a.deleteFieldIndex(c,d))})).next(()=>ee.waitFor(l)))}(await zp(t),e))}function ioe(t,e){return t.asyncQueue.enqueue(async()=>function(r,s){Ie(r).ss.zi=s}(await zp(t),e))}function aoe(t){return t.asyncQueue.enqueue(async()=>function(n){const r=Ie(n),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await zp(t)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uz(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SM=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(t,e,n){if(!n)throw new ve(ae.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function zz(t,e,n,r){if(e===!0&&r===!0)throw new ve(ae.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function _M(t){if(!Re.isDocumentKey(t))throw new ve(ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function jM(t){if(Re.isDocumentKey(t))throw new ve(ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xN(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":$e()}function Tt(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ve(ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xN(t);throw new ve(ae.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Hz(t,e){if(e<=0)throw new ve(ae.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ve(ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ve(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zz("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Uz((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ve(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ve(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ve(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fv{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new EM({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ve(ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ve(ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new EM(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new G6;switch(r.type){case"firstParty":return new nse(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ve(ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=SM.get(n);r&&(xe("ComponentProvider","Removing Datastore"),SM.delete(n),r.terminate())}(this),Promise.resolve()}}function Wz(t,e,n,r={}){var s;const i=(t=Tt(t,fv))._getSettings(),a=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==a&&zi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=Lr.MOCK_USER;else{l=J3(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new ve(ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Lr(u)}t._authCredentials=new Zre(new q6(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Wr(this.firestore,e,this._query)}}class Yn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Yn(this.firestore,e,this._key)}}class qa extends Wr{constructor(e,n,r){super(e,n,Mp(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Yn(this.firestore,null,new Re(e))}withConverter(e){return new qa(this.firestore,e,this._path)}}function fr(t,e,...n){if(t=Mt(t),rI("collection","path",e),t instanceof fv){const r=Dt.fromString(e,...n);return jM(r),new qa(t,null,r)}{if(!(t instanceof Yn||t instanceof qa))throw new ve(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Dt.fromString(e,...n));return jM(r),new qa(t.firestore,null,r)}}function ooe(t,e){if(t=Tt(t,fv),rI("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ve(ae.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Wr(t,null,function(r){return new Wl(Dt.emptyPath(),r)}(e))}function We(t,e,...n){if(t=Mt(t),arguments.length===1&&(e=yk.newId()),rI("doc","path",e),t instanceof fv){const r=Dt.fromString(e,...n);return _M(r),new Yn(t,null,new Re(r))}{if(!(t instanceof Yn||t instanceof qa))throw new ve(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Dt.fromString(e,...n));return _M(r),new Yn(t.firestore,t instanceof qa?t.converter:null,new Re(r))}}function loe(t,e){return t=Mt(t),e=Mt(e),(t instanceof Yn||t instanceof qa)&&(e instanceof Yn||e instanceof qa)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function sI(t,e){return t=Mt(t),e=Mt(e),t instanceof Wr&&e instanceof Wr&&t.firestore===e.firestore&&av(t._query,e._query)&&t.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Vk(this,"async_queue_retry"),this.Vu=()=>{const r=B0();r&&xe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=B0();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=B0();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Ur;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!_u(e))throw e;xe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw tr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=Hk.createAndSchedule(this,e,n,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&$e()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function jC(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class qz{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ur,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,n,r){this._progressObserver={next:e,error:n,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,n){return this._taskCompletionResolver.promise.then(e,n)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const coe=-1;class sn extends fv{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new CM,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new CM(e),this._firestoreClient=void 0,await e}}}function uoe(t,e,n){n||(n="(default)");const r=gh(t,"firestore");if(r.isInitialized(n)){const s=r.getImmediate({identifier:n}),i=r.getOptions(n);if(su(i,e))return s;throw new ve(ae.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ve(ae.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ve(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:n})}function Gz(t,e){const n=typeof t=="object"?t:tN(),r=typeof t=="string"?t:e||"(default)",s=gh(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=sk("firestore");i&&Wz(s,...i)}return s}function In(t){if(t._terminated)throw new ve(ae.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Kz(t),t._firestoreClient}function Kz(t){var e,n,r;const s=t._freezeSettings(),i=function(l,c,u,d){return new Dse(l,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Uz(d.experimentalLongPollingOptions),d.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new Yae(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function doe(t,e){zi("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return Yz(t,fu.provider,{build:r=>new eI(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function hoe(t){zi("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=t._freezeSettings();Yz(t,fu.provider,{build:n=>new Mz(n,e.cacheSizeBytes)})}function Yz(t,e,n){if((t=Tt(t,sn))._firestoreClient||t._terminated)throw new ve(ae.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ve(ae.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},Kz(t)}function foe(t){if(t._initialized&&!t._terminated)throw new ve(ae.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ur;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!jo.D())return Promise.resolve();const s=r+"main";await jo.delete(s)}(Lk(t._databaseId,t._persistenceKey)),e.resolve()}catch(n){e.reject(n)}}),e.promise}function poe(t){return function(n){const r=new Ur;return n.asyncQueue.enqueueAndForget(async()=>Oae(await nI(n),r)),r.promise}(In(t=Tt(t,sn)))}function moe(t){return Qae(In(t=Tt(t,sn)))}function goe(t){return Xae(In(t=Tt(t,sn)))}function yoe(t){return _te(t.app,"firestore",t._databaseId.database),t._delete()}function voe(t,e){const n=In(t=Tt(t,sn)),r=new qz;return noe(n,t._databaseId,e,r),r}function xoe(t,e){return roe(In(t=Tt(t,sn)),e).then(n=>n?new Wr(t,null,n.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class Qz{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pu(Fn.fromBase64String(e))}catch(n){throw new ve(ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new pu(Fn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ve(ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Nn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function boe(){return new Cu("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ve(ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ve(ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return dt(this._lat,e._lat)||dt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const woe=/^__.*__$/;class Noe{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Gl(e,this.data,this.fieldMask,n,this.fieldTransforms):new Lp(e,this.data,n,this.fieldTransforms)}}class Xz{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Gl(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Jz(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $e()}}class wN{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new wN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Wb(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Jz(this.Cu)&&woe.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Soe{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||dv(e)}Qu(e,n,r,s=!1){return new wN({Cu:e,methodName:n,qu:r,path:Nn.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vh(t){const e=t._freezeSettings(),n=dv(t._databaseId);return new Soe(t._databaseId,!!e.ignoreUndefinedProperties,n)}function NN(t,e,n,r,s,i={}){const a=t.Qu(i.merge||i.mergeFields?2:0,e,n,s);dI("Data must be an object, but it was:",a,r);const l=tH(r,a);let c,u;if(i.merge)c=new fi(a.fieldMask),u=a.fieldTransforms;else if(i.mergeFields){const d=[];for(const h of i.mergeFields){const f=fy(e,h,n);if(!a.contains(f))throw new ve(ae.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);rH(d,f)||d.push(f)}c=new fi(d),u=a.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=a.fieldTransforms;return new Noe(new ps(l),c,u)}class mv extends Tu{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mv}}function Zz(t,e,n){return new wN({Cu:3,qu:e.settings.qu,methodName:t._methodName,xu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class iI extends Tu{_toFieldTransform(e){return new lv(e.path,new Xf)}isEqual(e){return e instanceof iI}}class aI extends Tu{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=Zz(this,e,!0),r=this.Ku.map(i=>xh(i,n)),s=new $d(r);return new lv(e.path,s)}isEqual(e){return e instanceof aI&&su(this.Ku,e.Ku)}}class oI extends Tu{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=Zz(this,e,!0),r=this.Ku.map(i=>xh(i,n)),s=new Ud(r);return new lv(e.path,s)}isEqual(e){return e instanceof oI&&su(this.Ku,e.Ku)}}class lI extends Tu{constructor(e,n){super(e),this.$u=n}_toFieldTransform(e){const n=new Jf(e.serializer,A5(e.serializer,this.$u));return new lv(e.path,n)}isEqual(e){return e instanceof lI&&this.$u===e.$u}}function cI(t,e,n,r){const s=t.Qu(1,e,n);dI("Data must be an object, but it was:",s,r);const i=[],a=ps.empty();ju(r,(c,u)=>{const d=SN(e,c,n);u=Mt(u);const h=s.Nu(d);if(u instanceof mv)i.push(d);else{const f=xh(u,h);f!=null&&(i.push(d),a.set(d,f))}});const l=new fi(i);return new Xz(a,l,s.fieldTransforms)}function uI(t,e,n,r,s,i){const a=t.Qu(1,e,n),l=[fy(e,r,n)],c=[s];if(i.length%2!=0)throw new ve(ae.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)l.push(fy(e,i[f])),c.push(i[f+1]);const u=[],d=ps.empty();for(let f=l.length-1;f>=0;--f)if(!rH(u,l[f])){const p=l[f];let m=c[f];m=Mt(m);const g=a.Nu(p);if(m instanceof mv)u.push(p);else{const y=xh(m,g);y!=null&&(u.push(p),d.set(p,y))}}const h=new fi(u);return new Xz(d,h,a.fieldTransforms)}function eH(t,e,n,r=!1){return xh(n,t.Qu(r?4:3,e))}function xh(t,e){if(nH(t=Mt(t)))return dI("Unsupported field value:",e,t),tH(t,e);if(t instanceof Tu)return function(r,s){if(!Jz(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=xh(l,s.Lu(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Mt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return A5(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=un.fromDate(r);return{timestampValue:Zf(s.serializer,i)}}if(r instanceof un){const i=new un(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Zf(s.serializer,i)}}if(r instanceof bN)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof pu)return{bytesValue:U5(s.serializer,r._byteString)};if(r instanceof Yn){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:kk(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof pv)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return _k(l.serializer,c)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${xN(r)}`)}(t,e)}function tH(t,e){const n={};return o5(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ju(t,(r,s)=>{const i=xh(s,e.Mu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function nH(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof un||t instanceof bN||t instanceof pu||t instanceof Yn||t instanceof Tu||t instanceof pv)}function dI(t,e,n){if(!nH(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=xN(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function fy(t,e,n){if((e=Mt(e))instanceof Cu)return e._internalPath;if(typeof e=="string")return SN(t,e);throw Wb("Field path arguments must be of type string or ",t,!1,void 0,n)}const _oe=new RegExp("[~\\*/\\[\\]]");function SN(t,e,n){if(e.search(_oe)>=0)throw Wb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Cu(...e.split("."))._internalPath}catch{throw Wb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Wb(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new ve(ae.INVALID_ARGUMENT,l+t+c)}function rH(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Yn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new joe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(_N("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class joe extends py{data(){return super.data()}}function _N(t,e){return typeof e=="string"?SN(t,e):e instanceof Cu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sH(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ve(ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hI{}class Hp extends hI{}function Wi(t,e,...n){let r=[];e instanceof hI&&r.push(e),r=r.concat(n),function(i){const a=i.filter(c=>c instanceof bh).length,l=i.filter(c=>c instanceof Wp).length;if(a>1||a>0&&l>0)throw new ve(ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Wp extends Hp{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Wp(e,n,r)}_apply(e){const n=this._parse(e);return oH(e._query,n),new Wr(e.firestore,e.converter,fC(e._query,n))}_parse(e){const n=vh(e.firestore);return function(i,a,l,c,u,d,h){let f;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new ve(ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){AM(h,d);const p=[];for(const m of h)p.push(TM(c,i,m));f={arrayValue:{values:p}}}else f=TM(c,i,h)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||AM(h,d),f=eH(l,a,h,d==="in"||d==="not-in");return Rt.create(u,d,f)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function ba(t,e,n){const r=e,s=_N("where",t);return Wp._create(s,r,n)}class bh extends hI{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new bh(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Jt.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)oH(a,c),a=fC(a,c)}(e._query,n),new Wr(e.firestore,e.converter,fC(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Eoe(...t){return t.forEach(e=>lH("or",e)),bh._create("or",t)}function Coe(...t){return t.forEach(e=>lH("and",e)),bh._create("and",t)}class jN extends Hp{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new jN(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new ve(ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ve(ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new uy(i,a)}(e._query,this._field,this._direction);return new Wr(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Wl(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function qr(t,e="asc"){const n=e,r=_N("orderBy",t);return jN._create(r,n)}class gv extends Hp{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new gv(e,n,r)}_apply(e){return new Wr(e.firestore,e.converter,Rb(e._query,this._limit,this._limitType))}}function iH(t){return Hz("limit",t),gv._create("limit",t,"F")}function Toe(t){return Hz("limitToLast",t),gv._create("limitToLast",t,"L")}class yv extends Hp{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new yv(e,n,r)}_apply(e){const n=aH(e,this.type,this._docOrFields,this._inclusive);return new Wr(e.firestore,e.converter,function(s,i){return new Wl(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function Aoe(...t){return yv._create("startAt",t,!0)}function koe(...t){return yv._create("startAfter",t,!1)}class vv extends Hp{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new vv(e,n,r)}_apply(e){const n=aH(e,this.type,this._docOrFields,this._inclusive);return new Wr(e.firestore,e.converter,function(s,i){return new Wl(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function Ioe(...t){return vv._create("endBefore",t,!1)}function Poe(...t){return vv._create("endAt",t,!0)}function aH(t,e,n,r){if(n[0]=Mt(n[0]),n[0]instanceof py)return function(i,a,l,c,u){if(!c)throw new ve(ae.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const d=[];for(const h of Af(i))if(h.field.isKeyField())d.push(Bd(a,c.key));else{const f=c.data.field(h.field);if(aN(f))throw new ve(ae.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(f===null){const p=h.field.canonicalString();throw new ve(ae.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${p}' (used as the orderBy) does not exist.`)}d.push(f)}return new uu(d,u)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=vh(t.firestore);return function(a,l,c,u,d,h){const f=a.explicitOrderBy;if(d.length>f.length)throw new ve(ae.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const p=[];for(let m=0;m<d.length;m++){const g=d[m];if(f[m].field.isKeyField()){if(typeof g!="string")throw new ve(ae.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof g}`);if(!Nk(a)&&g.indexOf("/")!==-1)throw new ve(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${g}' contains a slash.`);const y=a.path.child(Dt.fromString(g));if(!Re.isDocumentKey(y))throw new ve(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${y}' is not because it contains an odd number of segments.`);const x=new Re(y);p.push(Bd(l,x))}else{const y=eH(c,u,g);p.push(y)}}return new uu(p,h)}(t._query,t.firestore._databaseId,s,e,n,r)}}function TM(t,e,n){if(typeof(n=Mt(n))=="string"){if(n==="")throw new ve(ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Nk(e)&&n.indexOf("/")!==-1)throw new ve(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Dt.fromString(n));if(!Re.isDocumentKey(r))throw new ve(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Bd(t,new Re(r))}if(n instanceof Yn)return Bd(t,n._key);throw new ve(ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xN(n)}.`)}function AM(t,e){if(!Array.isArray(t)||t.length===0)throw new ve(ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function oH(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ve(ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ve(ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function lH(t,e){if(!(e instanceof Wp||e instanceof bh))throw new ve(ae.INVALID_ARGUMENT,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class fI{convertValue(e,n="none"){switch(lu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Il(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw $e()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ju(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var n,r,s;const i=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>Cn(a.doubleValue));return new pv(i)}convertGeoPoint(e){return new bN(Cn(e.latitude),Cn(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=oN(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(oy(e));default:return null}}convertTimestamp(e){const n=kl(e);return new un(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Dt.fromString(e);Ge(Z5(r));const s=new ou(r.get(1),r.get(3)),i=new Re(r.popFirst(5));return s.isEqual(n)||tr(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EN(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Ooe extends fI{constructor(e){super(),this.firestore=e}convertBytes(e){return new pu(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Yn(this.firestore,null,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Doe(t){return new ap("sum",fy("sum",t))}function Roe(t){return new ap("avg",fy("average",t))}function cH(){return new ap("count")}function Moe(t,e){var n,r;return t instanceof ap&&e instanceof ap&&t.aggregateType===e.aggregateType&&((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function Loe(t,e){return sI(t.query,e.query)&&su(t.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class qd extends py{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new bg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(_N("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class bg extends qd{data(e={}){return super.data(e)}}class Gd{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Oc(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new bg(this._firestore,this._userDataWriter,r.key,r,new Oc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ve(ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new bg(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oc(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new bg(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Oc(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,d=-1;return l.type!==0&&(u=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),d=a.indexOf(l.doc.key)),{type:Foe(l.type),doc:c,oldIndex:u,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Foe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $e()}}function Boe(t,e){return t instanceof qd&&e instanceof qd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(t._document===null?e._document===null:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Gd&&e instanceof Gd&&t._firestore===e._firestore&&sI(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function us(t){t=Tt(t,Yn);const e=Tt(t.firestore,sn);return Vz(In(e),t._key).then(n=>pI(e,t,n))}class Au extends fI{constructor(e){super(),this.firestore=e}convertBytes(e){return new pu(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Yn(this.firestore,null,n)}}function Voe(t){t=Tt(t,Yn);const e=Tt(t.firestore,sn),n=In(e),r=new Au(e);return Jae(n,t._key).then(s=>new qd(e,r,t._key,s,new Oc(s!==null&&s.hasLocalMutations,!0),t.converter))}function $oe(t){t=Tt(t,Yn);const e=Tt(t.firestore,sn);return Vz(In(e),t._key,{source:"server"}).then(n=>pI(e,t,n))}function Io(t){t=Tt(t,Wr);const e=Tt(t.firestore,sn),n=In(e),r=new Au(e);return sH(t._query),$z(n,t._query).then(s=>new Gd(e,r,t,s))}function Uoe(t){t=Tt(t,Wr);const e=Tt(t.firestore,sn),n=In(e),r=new Au(e);return Zae(n,t._query).then(s=>new Gd(e,r,t,s))}function zoe(t){t=Tt(t,Wr);const e=Tt(t.firestore,sn),n=In(e),r=new Au(e);return $z(n,t._query,{source:"server"}).then(s=>new Gd(e,r,t,s))}function mu(t,e,n){t=Tt(t,Yn);const r=Tt(t.firestore,sn),s=EN(t.converter,e,n);return qp(r,[NN(vh(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,An.none())])}function _t(t,e,n,...r){t=Tt(t,Yn);const s=Tt(t.firestore,sn),i=vh(s);let a;return a=typeof(e=Mt(e))=="string"||e instanceof Cu?uI(i,"updateDoc",t._key,e,n,r):cI(i,"updateDoc",t._key,e),qp(s,[a.toMutation(t._key,An.exists(!0))])}function wh(t){return qp(Tt(t.firestore,sn),[new Fp(t._key,An.none())])}function ku(t,e){const n=Tt(t.firestore,sn),r=We(t),s=EN(t.converter,e);return qp(n,[NN(vh(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,An.exists(!1))]).then(()=>r)}function Nh(t,...e){var n,r,s;t=Mt(t);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||jC(e[a])||(i=e[a],a++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(jC(e[a])){const h=e[a];e[a]=(n=h.next)===null||n===void 0?void 0:n.bind(h),e[a+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[a+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let c,u,d;if(t instanceof Yn)u=Tt(t.firestore,sn),d=Mp(t._key.path),c={next:h=>{e[a]&&e[a](pI(u,t,h))},error:e[a+1],complete:e[a+2]};else{const h=Tt(t,Wr);u=Tt(h.firestore,sn),d=h._query;const f=new Au(u);c={next:p=>{e[a]&&e[a](new Gd(u,f,h,p))},error:e[a+1],complete:e[a+2]},sH(t._query)}return function(f,p,m,g){const y=new yN(g),x=new Kk(p,y,m);return f.asyncQueue.enqueueAndForget(async()=>Wk(await ip(f),x)),()=>{y.Za(),f.asyncQueue.enqueueAndForget(async()=>qk(await ip(f),x))}}(In(u),d,l,c)}function Hoe(t,e){return toe(In(t=Tt(t,sn)),jC(e)?e:{next:e})}function qp(t,e){return function(r,s){const i=new Ur;return r.asyncQueue.enqueueAndForget(async()=>Aae(await nI(r),s,i)),i.promise}(In(t),e)}function pI(t,e,n){const r=n.docs.get(e._key),s=new Au(t);return new qd(t,s,e._key,r,new Oc(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Woe(t){return uH(t,{count:cH()})}function uH(t,e){const n=Tt(t.firestore,sn),r=In(n),s=a5(e,(i,a)=>new M5(a,i.aggregateType,i._internalFieldPath));return eoe(r,t._query,s).then(i=>function(l,c,u){const d=new Au(l);return new Qz(c,d,u)}(n,t,i))}class qoe{constructor(e){this.kind="memory",this._onlineComponentProvider=fu.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=hu.provider}toJSON(){return{kind:this.kind}}}class Goe{constructor(e){let n;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),n=e.tabManager):(n=dH(void 0),n._initialize(e)),this._onlineComponentProvider=n._onlineComponentProvider,this._offlineComponentProvider=n._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Koe{constructor(){this.kind="memoryEager",this._offlineComponentProvider=hu.provider}toJSON(){return{kind:this.kind}}}class Yoe{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Wae(e)}}toJSON(){return{kind:this.kind}}}function Qoe(){return new Koe}function Xoe(t){return new Yoe(t==null?void 0:t.cacheSizeBytes)}function Joe(t){return new qoe(t)}function Zoe(t){return new Goe(t)}class ele{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fu.provider,this._offlineComponentProvider={build:n=>new eI(n,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class tle{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fu.provider,this._offlineComponentProvider={build:n=>new Mz(n,e==null?void 0:e.cacheSizeBytes)}}}function dH(t){return new ele(t==null?void 0:t.forceOwnership)}function nle(){return new tle}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rle={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hH{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=vh(e)}set(e,n,r){this._verifyNotCommitted();const s=_c(e,this._firestore),i=EN(s.converter,n,r),a=NN(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,An.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const i=_c(e,this._firestore);let a;return a=typeof(n=Mt(n))=="string"||n instanceof Cu?uI(this._dataReader,"WriteBatch.update",i._key,n,r,s):cI(this._dataReader,"WriteBatch.update",i._key,n),this._mutations.push(a.toMutation(i._key,An.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=_c(e,this._firestore);return this._mutations=this._mutations.concat(new Fp(n._key,An.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ve(ae.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function _c(t,e){if((t=Mt(t)).firestore!==e)throw new ve(ae.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fH=class extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=vh(n)}get(n){const r=_c(n,this._firestore),s=new Ooe(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return $e();const a=i[0];if(a.isFoundDocument())return new py(this._firestore,s,a.key,a,r.converter);if(a.isNoDocument())return new py(this._firestore,s,r._key,null,r.converter);throw $e()})}set(n,r,s){const i=_c(n,this._firestore),a=EN(i.converter,r,s),l=NN(this._dataReader,"Transaction.set",i._key,a,i.converter!==null,s);return this._transaction.set(i._key,l),this}update(n,r,s,...i){const a=_c(n,this._firestore);let l;return l=typeof(r=Mt(r))=="string"||r instanceof Cu?uI(this._dataReader,"Transaction.update",a._key,r,s,i):cI(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,l),this}delete(n){const r=_c(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,n){super(e,n),this._firestore=e}get(e){const n=_c(e,this._firestore),r=new Au(this._firestore);return super.get(e).then(s=>new qd(this._firestore,r,n._key,s._document,new Oc(!1,!1),n.converter))}};function sle(t,e,n){t=Tt(t,sn);const r=Object.assign(Object.assign({},rle),n);return function(i){if(i.maxAttempts<1)throw new ve(ae.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,a,l){const c=new Ur;return i.asyncQueue.enqueueAndForget(async()=>{const u=await Bz(i);new Kae(i.asyncQueue,u,l,a,c).au()}),c.promise}(In(t),s=>e(new fH(t,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ile(){return new mv("deleteField")}function et(){return new iI("serverTimestamp")}function gu(...t){return new aI("arrayUnion",t)}function pH(...t){return new oI("arrayRemove",t)}function ale(t){return new lI("increment",t)}function ole(t){return new pv(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lle(t){return In(t=Tt(t,sn)),new hH(t,e=>qp(t,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cle(t,e){const n=In(t=Tt(t,sn));if(!n._uninitializedComponentsProvider||n._uninitializedComponentsProvider._offline.kind==="memory")return zi("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const a=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(d){throw new ve(ae.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,l=[];if(Array.isArray(a.indexes))for(const c of a.indexes){const u=kM(c,"collectionGroup"),d=[];if(Array.isArray(c.fields))for(const h of c.fields){const f=SN("setIndexConfiguration",kM(h,"fieldPath"));h.arrayConfig==="CONTAINS"?d.push(new wd(f,2)):h.order==="ASCENDING"?d.push(new wd(f,0)):h.order==="DESCENDING"&&d.push(new wd(f,1))}l.push(new Gf(Gf.UNKNOWN_ID,u,d,Kf.empty()))}return l}(e);return soe(n,r)}function kM(t,e){if(typeof t[e]!="string")throw new ve(ae.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mH{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function ule(t){var e;t=Tt(t,sn);const n=IM.get(t);if(n)return n;if(((e=In(t)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new mH(t);return IM.set(t,r),r}function dle(t){gH(t,!0)}function hle(t){gH(t,!1)}function fle(t){aoe(In(t._firestore)).then(e=>xe("deleting all persistent cache indexes succeeded")).catch(e=>zi("deleting all persistent cache indexes failed",e))}function gH(t,e){ioe(In(t._firestore),e).then(n=>xe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(n=>zi(`setting persistent cache index auto creation isEnabled=${e} failed`,n))}const IM=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ple(t){var e;const n=(e=In(Tt(t.firestore,sn))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return n===void 0?null:dN(n,Ds(t._query))._t}function mle(t,e){var n;const r=a5(e,(i,a)=>new M5(a,i.aggregateType,i._internalFieldPath)),s=(n=In(Tt(t.firestore,sn))._onlineComponents)===null||n===void 0?void 0:n.datastore.serializer;return s===void 0?null:Y5(s,b5(t._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gle{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return mI.instance.onExistenceFilterMismatch(e)}}class mI{constructor(){this.Uu=new Map}static get instance(){return Px||(Px=new mI,function(n){if(Mb)throw new Error("a TestingHooksSpi instance is already set");Mb=n}(Px)),Px}et(e){this.Uu.forEach(n=>n(e))}onExistenceFilterMismatch(e){const n=Symbol(),r=this.Uu;return r.set(n,e),()=>r.delete(n)}}let Px=null;(function(e,n=!0){(function(s){Rp=s})(yh),iu(new Cl("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new sn(new ese(r.getProvider("auth-internal")),new rse(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new ve(ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ou(u.options.projectId,d)}(a,s),a);return i=Object.assign({useFetchStreams:n},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),xa(bR,"4.7.3",e),xa(bR,"4.7.3","esm2017")})();const yle=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:fI,AggregateField:ap,AggregateQuerySnapshot:Qz,Bytes:pu,CACHE_SIZE_UNLIMITED:coe,CollectionReference:qa,DocumentReference:Yn,DocumentSnapshot:qd,FieldPath:Cu,FieldValue:Tu,Firestore:sn,FirestoreError:ve,GeoPoint:bN,LoadBundleTask:qz,PersistentCacheIndexManager:mH,Query:Wr,QueryCompositeFilterConstraint:bh,QueryConstraint:Hp,QueryDocumentSnapshot:bg,QueryEndAtConstraint:vv,QueryFieldFilterConstraint:Wp,QueryLimitConstraint:gv,QueryOrderByConstraint:jN,QuerySnapshot:Gd,QueryStartAtConstraint:yv,SnapshotMetadata:Oc,Timestamp:un,Transaction:fH,VectorValue:pv,WriteBatch:hH,_AutoId:yk,_ByteString:Fn,_DatabaseId:ou,_DocumentKey:Re,_EmptyAppCheckTokenProvider:sse,_EmptyAuthCredentialsProvider:G6,_FieldPath:Nn,_TestingHooks:gle,_cast:Tt,_debugAssert:Jre,_internalAggregationQueryToProtoRunAggregationQueryRequest:mle,_internalQueryToProtoQueryTarget:ple,_isBase64Available:Pse,_logWarn:zi,_validateIsNotUsedTogether:zz,addDoc:ku,aggregateFieldEqual:Moe,aggregateQuerySnapshotEqual:Loe,and:Coe,arrayRemove:pH,arrayUnion:gu,average:Roe,clearIndexedDbPersistence:foe,collection:fr,collectionGroup:ooe,connectFirestoreEmulator:Wz,count:cH,deleteAllPersistentCacheIndexes:fle,deleteDoc:wh,deleteField:ile,disableNetwork:goe,disablePersistentCacheIndexAutoCreation:hle,doc:We,documentId:boe,enableIndexedDbPersistence:doe,enableMultiTabIndexedDbPersistence:hoe,enableNetwork:moe,enablePersistentCacheIndexAutoCreation:dle,endAt:Poe,endBefore:Ioe,ensureFirestoreConfigured:In,executeWrite:qp,getAggregateFromServer:uH,getCountFromServer:Woe,getDoc:us,getDocFromCache:Voe,getDocFromServer:$oe,getDocs:Io,getDocsFromCache:Uoe,getDocsFromServer:zoe,getFirestore:Gz,getPersistentCacheIndexManager:ule,increment:ale,initializeFirestore:uoe,limit:iH,limitToLast:Toe,loadBundle:voe,memoryEagerGarbageCollector:Qoe,memoryLocalCache:Joe,memoryLruGarbageCollector:Xoe,namedQuery:xoe,onSnapshot:Nh,onSnapshotsInSync:Hoe,or:Eoe,orderBy:qr,persistentLocalCache:Zoe,persistentMultipleTabManager:nle,persistentSingleTabManager:dH,query:Wi,queryEqual:sI,refEqual:loe,runTransaction:sle,serverTimestamp:et,setDoc:mu,setIndexConfiguration:cle,setLogLevel:Xre,snapshotEqual:Boe,startAfter:koe,startAt:Aoe,sum:Doe,terminate:yoe,updateDoc:_t,vector:ole,waitForPendingWrites:poe,where:ba,writeBatch:lle},Symbol.toStringTag,{value:"Module"}));var vle="firebase",xle="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xa(vle,xle,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yH="firebasestorage.googleapis.com",vH="storageBucket",ble=2*60*1e3,wle=10*60*1e3,Nle=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn extends $o{constructor(e,n,r=0){super(z_(e),`Firebase Storage: ${n} (${z_(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Bn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return z_(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var _n;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(_n||(_n={}));function z_(t){return"storage/"+t}function gI(){const t="An unknown error occurred, please check the error payload for server response.";return new Bn(_n.UNKNOWN,t)}function Sle(t){return new Bn(_n.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function _le(t){return new Bn(_n.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function jle(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Bn(_n.UNAUTHENTICATED,t)}function Ele(){return new Bn(_n.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Cle(t){return new Bn(_n.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function xH(){return new Bn(_n.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function bH(){return new Bn(_n.CANCELED,"User canceled the upload/download.")}function Tle(t){return new Bn(_n.INVALID_URL,"Invalid URL '"+t+"'.")}function Ale(t){return new Bn(_n.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function kle(){return new Bn(_n.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+vH+"' property when initializing the app?")}function wH(){return new Bn(_n.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Ile(){return new Bn(_n.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Ple(){return new Bn(_n.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Ole(t){return new Bn(_n.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function EC(t){return new Bn(_n.INVALID_ARGUMENT,t)}function NH(){return new Bn(_n.APP_DELETED,"The Firebase app was deleted.")}function Dle(t){return new Bn(_n.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function wg(t,e){return new Bn(_n.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function jm(t){throw new Bn(_n.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Mi.makeFromUrl(e,n)}catch{return new Mi(e,"")}if(r.path==="")return r;throw Ale(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(S){S.path.charAt(S.path.length-1)==="/"&&(S.path_=S.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+s+a,"i"),c={bucket:1,path:3};function u(S){S.path_=decodeURIComponent(S.path)}const d="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",p=new RegExp(`^https?://${h}/${d}/b/${s}/o${f}`,"i"),m={bucket:1,path:3},g=n===yH?"(?:storage.googleapis.com|storage.cloud.google.com)":n,y="([^?#]*)",x=new RegExp(`^https?://${g}/${s}/${y}`,"i"),N=[{regex:l,indices:c,postModify:i},{regex:p,indices:m,postModify:u},{regex:x,indices:{bucket:1,path:2},postModify:u}];for(let S=0;S<N.length;S++){const C=N[S],A=C.regex.exec(e);if(A){const j=A[C.indices.bucket];let _=A[C.indices.path];_||(_=""),r=new Mi(j,_),C.postModify(r);break}}if(r==null)throw Tle(e);return r}}class Rle{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mle(t,e,n){let r=1,s=null,i=null,a=!1,l=0;function c(){return l===2}let u=!1;function d(...y){u||(u=!0,e.apply(null,y))}function h(y){s=setTimeout(()=>{s=null,t(p,c())},y)}function f(){i&&clearTimeout(i)}function p(y,...x){if(u){f();return}if(y){f(),d.call(null,y,...x);return}if(c()||a){f(),d.call(null,y,...x);return}r<64&&(r*=2);let N;l===1?(l=2,N=0):N=(r+Math.random())*1e3,h(N)}let m=!1;function g(y){m||(m=!0,f(),!u&&(s!==null?(y||(l=2),clearTimeout(s),h(0)):y||(l=1)))}return h(0),i=setTimeout(()=>{a=!0,g(!0)},n),g}function Lle(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fle(t){return t!==void 0}function Ble(t){return typeof t=="function"}function Vle(t){return typeof t=="object"&&!Array.isArray(t)}function CN(t){return typeof t=="string"||t instanceof String}function PM(t){return yI()&&t instanceof Blob}function yI(){return typeof Blob<"u"}function OM(t,e,n,r){if(r<e)throw EC(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw EC(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gp(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function SH(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var Nd;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Nd||(Nd={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _H(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $le{constructor(e,n,r,s,i,a,l,c,u,d,h,f=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=c,this.timeout_=u,this.progressCallback_=d,this.connectionFactory_=h,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,m)=>{this.resolve_=p,this.reject_=m,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Ox(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=l=>{const c=l.loaded,u=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,u)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const l=i.getErrorCode()===Nd.NO_ERROR,c=i.getStatus();if(!l||_H(c,this.additionalRetryCodes_)&&this.retry){const d=i.getErrorCode()===Nd.ABORT;r(!1,new Ox(!1,null,d));return}const u=this.successCodes_.indexOf(c)!==-1;r(!0,new Ox(u,i))})},n=(r,s)=>{const i=this.resolve_,a=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());Fle(c)?i(c):i()}catch(c){a(c)}else if(l!==null){const c=gI();c.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,c)):a(c)}else if(s.canceled){const c=this.appDelete_?NH():bH();a(c)}else{const c=xH();a(c)}};this.canceled_?n(!1,new Ox(!1,null,!0)):this.backoffId_=Mle(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Lle(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ox{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function Ule(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function zle(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Hle(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Wle(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function qle(t,e,n,r,s,i,a=!0){const l=SH(t.urlParams),c=t.url+l,u=Object.assign({},t.headers);return Hle(u,e),Ule(u,n),zle(u,i),Wle(u,r),new $le(c,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gle(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Kle(...t){const e=Gle();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(yI())return new Blob(t);throw new Bn(_n.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Yle(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qle(t){if(typeof atob>"u")throw Ole("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yo={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class H_{constructor(e,n){this.data=e,this.contentType=n||null}}function Xle(t,e){switch(t){case yo.RAW:return new H_(jH(e));case yo.BASE64:case yo.BASE64URL:return new H_(EH(t,e));case yo.DATA_URL:return new H_(Zle(e),ece(e))}throw gI()}function jH(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=t.charCodeAt(++n);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function Jle(t){let e;try{e=decodeURIComponent(t)}catch{throw wg(yo.DATA_URL,"Malformed data URL.")}return jH(e)}function EH(t,e){switch(t){case yo.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw wg(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case yo.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw wg(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Qle(e)}catch(s){throw s.message.includes("polyfill")?s:wg(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class CH{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw wg(yo.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=tce(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function Zle(t){const e=new CH(t);return e.base64?EH(yo.BASE64,e.rest):Jle(e.rest)}function ece(t){return new CH(t).contentType}function tce(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e,n){let r=0,s="";PM(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(PM(this.data_)){const r=this.data_,s=Yle(r,e,n);return s===null?null:new rl(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new rl(r,!0)}}static getBlob(...e){if(yI()){const n=e.map(r=>r instanceof rl?r.data_:r);return new rl(Kle.apply(null,n))}else{const n=e.map(a=>CN(a)?Xle(yo.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(a=>{for(let l=0;l<a.length;l++)s[i++]=a[l]}),new rl(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TH(t){let e;try{e=JSON.parse(t)}catch{return null}return Vle(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nce(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function rce(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function AH(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sce(t,e){return e}let $s=class{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||sce}},Dx=null;function ice(t){return!CN(t)||t.length<2?t:AH(t)}function vI(){if(Dx)return Dx;const t=[];t.push(new $s("bucket")),t.push(new $s("generation")),t.push(new $s("metageneration")),t.push(new $s("name","fullPath",!0));function e(i,a){return ice(a)}const n=new $s("name");n.xform=e,t.push(n);function r(i,a){return a!==void 0?Number(a):a}const s=new $s("size");return s.xform=r,t.push(s),t.push(new $s("timeCreated")),t.push(new $s("updated")),t.push(new $s("md5Hash",null,!0)),t.push(new $s("cacheControl",null,!0)),t.push(new $s("contentDisposition",null,!0)),t.push(new $s("contentEncoding",null,!0)),t.push(new $s("contentLanguage",null,!0)),t.push(new $s("contentType",null,!0)),t.push(new $s("metadata","customMetadata",!0)),Dx=t,Dx}function ace(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new Mi(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function oce(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const a=n[i];r[a.local]=a.xform(r,e[a.server])}return ace(r,t),r}function kH(t,e,n){const r=TH(e);return r===null?null:oce(t,r,n)}function lce(t,e,n,r){const s=TH(e);if(s===null||!CN(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(u=>{const d=t.bucket,h=t.fullPath,f="/b/"+a(d)+"/o/"+a(h),p=Gp(f,n,r),m=SH({alt:"media",token:u});return p+m})[0]}function IH(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}class Sh{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(t){if(!t)throw gI()}function xI(t,e){function n(r,s){const i=kH(t,s,e);return vl(i!==null),i}return n}function cce(t,e){function n(r,s){const i=kH(t,s,e);return vl(i!==null),lce(i,s,t.host,t._protocol)}return n}function xv(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=Ele():s=jle():n.getStatus()===402?s=_le(t.bucket):n.getStatus()===403?s=Cle(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function bI(t){const e=xv(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=Sle(t.path)),i.serverResponse=s.serverResponse,i}return n}function uce(t,e,n){const r=e.fullServerUrl(),s=Gp(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,l=new Sh(s,i,xI(t,n),a);return l.errorHandler=bI(e),l}function dce(t,e,n){const r=e.fullServerUrl(),s=Gp(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,l=new Sh(s,i,cce(t,n),a);return l.errorHandler=bI(e),l}function hce(t,e){const n=e.fullServerUrl(),r=Gp(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function a(c,u){}const l=new Sh(r,s,a,i);return l.successCodes=[200,204],l.errorHandler=bI(e),l}function fce(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function PH(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=fce(null,e)),r}function OH(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function l(){let N="";for(let S=0;S<2;S++)N=N+Math.random().toString().slice(2);return N}const c=l();a["Content-Type"]="multipart/related; boundary="+c;const u=PH(e,r,s),d=IH(u,n),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+c+`\r
Content-Type: `+u.contentType+`\r
\r
`,f=`\r
--`+c+"--",p=rl.getBlob(h,r,f);if(p===null)throw wH();const m={name:u.fullPath},g=Gp(i,t.host,t._protocol),y="POST",x=t.maxUploadRetryTime,w=new Sh(g,y,xI(t,n),x);return w.urlParams=m,w.headers=a,w.body=p.uploadData(),w.errorHandler=xv(e),w}class qb{constructor(e,n,r,s){this.current=e,this.total=n,this.finalized=!!r,this.metadata=s||null}}function wI(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{vl(!1)}return vl(!!n&&(e||["active"]).indexOf(n)!==-1),n}function pce(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a=PH(e,r,s),l={name:a.fullPath},c=Gp(i,t.host,t._protocol),u="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=IH(a,n),f=t.maxUploadRetryTime;function p(g){wI(g);let y;try{y=g.getResponseHeader("X-Goog-Upload-URL")}catch{vl(!1)}return vl(CN(y)),y}const m=new Sh(c,u,p,f);return m.urlParams=l,m.headers=d,m.body=h,m.errorHandler=xv(e),m}function mce(t,e,n,r){const s={"X-Goog-Upload-Command":"query"};function i(u){const d=wI(u,["active","final"]);let h=null;try{h=u.getResponseHeader("X-Goog-Upload-Size-Received")}catch{vl(!1)}h||vl(!1);const f=Number(h);return vl(!isNaN(f)),new qb(f,r.size(),d==="final")}const a="POST",l=t.maxUploadRetryTime,c=new Sh(n,a,i,l);return c.headers=s,c.errorHandler=xv(e),c}const DM=256*1024;function gce(t,e,n,r,s,i,a,l){const c=new qb(0,0);if(a?(c.current=a.current,c.total=a.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw Ile();const u=c.total-c.current;let d=u;s>0&&(d=Math.min(d,s));const h=c.current,f=h+d;let p="";d===0?p="finalize":u===d?p="upload, finalize":p="upload";const m={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${c.current}`},g=r.slice(h,f);if(g===null)throw wH();function y(S,C){const A=wI(S,["active","final"]),j=c.current+d,_=r.size();let E;return A==="final"?E=xI(e,i)(S,C):E=null,new qb(j,_,A==="final",E)}const x="POST",w=e.maxUploadRetryTime,N=new Sh(n,x,y,w);return N.headers=m,N.body=g.uploadData(),N.progressCallback=l||null,N.errorHandler=xv(t),N}const li={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function W_(t){switch(t){case"running":case"pausing":case"canceling":return li.RUNNING;case"paused":return li.PAUSED;case"success":return li.SUCCESS;case"canceled":return li.CANCELED;case"error":return li.ERROR;default:return li.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yce{constructor(e,n,r){if(Ble(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rh(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class vce{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Nd.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Nd.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Nd.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s){if(this.sent_)throw jm("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw jm("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw jm("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw jm("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw jm("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class xce extends vce{initXhr(){this.xhr_.responseType="text"}}function jc(){return new xce}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bce{constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=vI(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(_n.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(_H(s.status,[]))if(i)s=xH();else{this.sleepTime=Math.max(this.sleepTime*2,Nle),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(_n.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=pce(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,jc,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const s=mce(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,jc,n,r);this._request=i,i.getPromise().then(a=>{a=a,this._request=void 0,this._updateProgress(a.current),this._needToFetchStatus=!1,a.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=DM*this._chunkMultiplier,n=new qb(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let a;try{a=gce(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}const l=this._ref.storage._makeRequest(a,jc,s,i,!1);this._request=l,l.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){DM*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=uce(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,jc,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=OH(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,jc,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=bH(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=W_(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,s){const i=new yce(n||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(W_(this._state)){case li.SUCCESS:Rh(this._resolve.bind(null,this.snapshot))();break;case li.CANCELED:case li.ERROR:const n=this._reject;Rh(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(W_(this._state)){case li.RUNNING:case li.PAUSED:e.next&&Rh(e.next.bind(e,this.snapshot))();break;case li.SUCCESS:e.complete&&Rh(e.complete.bind(e))();break;case li.CANCELED:case li.ERROR:e.error&&Rh(e.error.bind(e,this._error))();break;default:e.error&&Rh(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,n){this._service=e,n instanceof Mi?this._location=n:this._location=Mi.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Kd(e,n)}get root(){const e=new Mi(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return AH(this._location.path)}get storage(){return this._service}get parent(){const e=nce(this._location.path);if(e===null)return null;const n=new Mi(this._location.bucket,e);return new Kd(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Dle(e)}}function wce(t,e,n){t._throwIfRoot("uploadBytes");const r=OH(t.storage,t._location,vI(),new rl(e,!0),n);return t.storage.makeRequestWithTokens(r,jc).then(s=>({metadata:s,ref:t}))}function Nce(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new bce(t,new rl(e),n)}function Sce(t){t._throwIfRoot("getDownloadURL");const e=dce(t.storage,t._location,vI());return t.storage.makeRequestWithTokens(e,jc).then(n=>{if(n===null)throw Ple();return n})}function _ce(t){t._throwIfRoot("deleteObject");const e=hce(t.storage,t._location);return t.storage.makeRequestWithTokens(e,jc)}function jce(t,e){const n=rce(t._location.path,e),r=new Mi(t._location.bucket,n);return new Kd(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ece(t){return/^[A-Za-z]+:\/\//.test(t)}function Cce(t,e){return new Kd(t,e)}function DH(t,e){if(t instanceof NI){const n=t;if(n._bucket==null)throw kle();const r=new Kd(n,n._bucket);return e!=null?DH(r,e):r}else return e!==void 0?jce(t,e):t}function Tce(t,e){if(e&&Ece(e)){if(t instanceof NI)return Cce(t,e);throw EC("To use ref(service, url), the first argument must be a Storage instance.")}else return DH(t,e)}function RM(t,e){const n=e==null?void 0:e[vH];return n==null?null:Mi.makeFromBucketSpec(n,t)}function Ace(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:J3(s,t.app.options.projectId))}class NI{constructor(e,n,r,s,i){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=yH,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=ble,this._maxUploadRetryTime=wle,this._requests=new Set,s!=null?this._bucket=Mi.makeFromBucketSpec(s,this._host):this._bucket=RM(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Mi.makeFromBucketSpec(this._url,e):this._bucket=RM(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){OM("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){OM("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Kd(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new Rle(NH());{const a=qle(e,this._appId,r,s,n,this._firebaseVersion,i);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const MM="@firebase/storage",LM="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RH="storage";function kce(t,e,n){return t=Mt(t),wce(t,e,n)}function TN(t,e,n){return t=Mt(t),Nce(t,e,n)}function bv(t){return t=Mt(t),Sce(t)}function MH(t){return t=Mt(t),_ce(t)}function Yd(t,e){return t=Mt(t),Tce(t,e)}function Ice(t=tN(),e){t=Mt(t);const r=gh(t,RH).getImmediate({identifier:e}),s=sk("storage");return s&&Pce(r,...s),r}function Pce(t,e,n,r={}){Ace(t,e,n,r)}function Oce(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new NI(n,r,s,e,yh)}function Dce(){iu(new Cl(RH,Oce,"PUBLIC").setMultipleInstances(!0)),xa(MM,LM,""),xa(MM,LM,"esm2017")}Dce();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LH="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rce{constructor(e,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||e.get().then(s=>this.auth=s,()=>{}),this.messaging||n.get().then(s=>this.messaging=s,()=>{}),this.appCheck||r.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:n,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC="us-central1";class Mce{constructor(e,n,r,s,i=CC,a){this.app=e,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new Rce(n,r,s),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(i);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=CC}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function Lce(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}const FM="@firebase/functions",BM="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fce="auth-internal",Bce="app-check-internal",Vce="messaging-internal";function $ce(t,e){const n=(r,{instanceIdentifier:s})=>{const i=r.getProvider("app").getImmediate(),a=r.getProvider(Fce),l=r.getProvider(Vce),c=r.getProvider(Bce);return new Mce(i,a,l,c,s,t)};iu(new Cl(LH,n,"PUBLIC").setMultipleInstances(!0)),xa(FM,BM,e),xa(FM,BM,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uce(t=tN(),e=CC){const r=gh(Mt(t),LH).getImmediate({identifier:e}),s=sk("functions");return s&&zce(r,...s),r}function zce(t,e,n){Lce(Mt(t),e,n)}$ce(fetch.bind(self));const Hce={apiKey:"AIzaSyAKuC4hkk2WCWwE6CvkmeGrDVXBIHiNTkY",authDomain:"hq-website-4abc7.firebaseapp.com",projectId:"hq-website-4abc7",storageBucket:"hq-website-4abc7.firebasestorage.app",messagingSenderId:"123456789",appId:"1:123456789:web:abc123"},AN=r6(Hce),fo=Yre(AN),ke=Gz(AN),Qd=Ice(AN);Uce(AN,"europe-west1");const FH=b.createContext(null),Wce=8*60*60*1e3;function qce({children:t}){const[e,n]=b.useState(null),[r,s]=b.useState(null),[i,a]=b.useState(!0),[l,c]=b.useState(null);b.useEffect(()=>{const p=Fne(fo,async m=>{if(m){const g=await m.getIdTokenResult(),y=g.claims.role||"viewer",x=await us(We(ke,"users",m.uid)),w=x.exists()?x.data():null;(w==null?void 0:w.status)==="suspended"?(await cR(fo),c("Your account has been suspended. Contact an administrator."),n(null),s(null)):(n({uid:m.uid,email:m.email,role:y,claims:g.claims}),s(w))}else n(null),s(null);a(!1)});return()=>p()},[]),b.useEffect(()=>{if(!e)return;let p;const m=()=>{clearTimeout(p),p=setTimeout(()=>{d()},Wce)},g=["mousedown","keydown","scroll","touchstart"];return g.forEach(y=>document.addEventListener(y,m)),m(),()=>{clearTimeout(p),g.forEach(y=>document.removeEventListener(y,m))}},[e]);const u=async(p,m)=>{c(null);try{const g=await Rne(fo,p,m);return await _t(We(ke,"users",g.user.uid),{lastLogin:et(),failedLoginAttempts:0}),g}catch(g){let y="Failed to sign in";throw g.code==="auth/user-not-found"||g.code==="auth/wrong-password"?y="Invalid email or password":g.code==="auth/too-many-requests"&&(y="Too many failed attempts. Please try again later."),c(y),new Error(y)}},d=async()=>{try{await cR(fo)}catch(p){console.error("Sign out error:",p)}},f={user:e,userProfile:r,loading:i,error:l,signIn:u,signOut:d,resetPassword:async p=>{try{await One(fo,p)}catch{throw new Error("Failed to send password reset email")}}};return o.jsx(FH.Provider,{value:f,children:t})}function Xi(){const t=b.useContext(FH);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}const Gn={SUPER_ADMIN:"super_admin",ADMIN:"admin",EDITOR:"editor",VIEWER:"viewer"},Be={LISTINGS_VIEW:"listings.view",LISTINGS_CREATE:"listings.create",LISTINGS_EDIT:"listings.edit",LISTINGS_DELETE:"listings.delete",LISTINGS_PUBLISH:"listings.publish",LISTINGS_MARK_SOLD:"listings.mark_sold",BLOGS_VIEW:"blogs.view",BLOGS_CREATE:"blogs.create",BLOGS_EDIT:"blogs.edit",BLOGS_DELETE:"blogs.delete",BLOGS_PUBLISH:"blogs.publish",ENQUIRIES_VIEW:"enquiries.view",ENQUIRIES_RESPOND:"enquiries.respond",CONTACTS_VIEW:"contacts.view",CONTACTS_CREATE:"contacts.create",CONTACTS_EDIT:"contacts.edit",CONTACTS_DELETE:"contacts.delete",SOCIAL_VIEW:"social.view",SOCIAL_CREATE:"social.create",SOCIAL_EDIT:"social.edit",SOCIAL_DELETE:"social.delete",PRICING_VIEW:"pricing.view",PRICING_ESTIMATE:"pricing.estimate",PRICING_DATA_ADD:"pricing.data_add",PRICING_DATA_IMPORT:"pricing.data_import",PRICING_DATA_EDIT:"pricing.data_edit",PRICING_DATA_DELETE:"pricing.data_delete",PRICING_REVIEW:"pricing.review",PRICING_REPORTS:"pricing.reports",USERS_INVITE:"users.invite",USERS_MANAGE:"users.manage",AUDIT_VIEW:"audit.view",SETTINGS_MANAGE:"settings.manage"},Gce={[Gn.SUPER_ADMIN]:Object.values(Be),[Gn.ADMIN]:[Be.LISTINGS_VIEW,Be.LISTINGS_CREATE,Be.LISTINGS_EDIT,Be.LISTINGS_DELETE,Be.LISTINGS_PUBLISH,Be.LISTINGS_MARK_SOLD,Be.BLOGS_VIEW,Be.BLOGS_CREATE,Be.BLOGS_EDIT,Be.BLOGS_DELETE,Be.BLOGS_PUBLISH,Be.ENQUIRIES_VIEW,Be.ENQUIRIES_RESPOND,Be.CONTACTS_VIEW,Be.CONTACTS_CREATE,Be.CONTACTS_EDIT,Be.CONTACTS_DELETE,Be.SOCIAL_VIEW,Be.SOCIAL_CREATE,Be.SOCIAL_EDIT,Be.SOCIAL_DELETE,Be.PRICING_VIEW,Be.PRICING_ESTIMATE,Be.PRICING_DATA_ADD,Be.PRICING_DATA_IMPORT,Be.PRICING_DATA_EDIT,Be.PRICING_DATA_DELETE,Be.PRICING_REVIEW,Be.PRICING_REPORTS,Be.USERS_INVITE,Be.AUDIT_VIEW],[Gn.EDITOR]:[Be.LISTINGS_VIEW,Be.LISTINGS_CREATE,Be.LISTINGS_EDIT,Be.LISTINGS_MARK_SOLD,Be.BLOGS_VIEW,Be.BLOGS_CREATE,Be.BLOGS_EDIT,Be.ENQUIRIES_VIEW,Be.ENQUIRIES_RESPOND,Be.CONTACTS_VIEW,Be.CONTACTS_CREATE,Be.CONTACTS_EDIT,Be.SOCIAL_VIEW,Be.SOCIAL_CREATE,Be.SOCIAL_EDIT,Be.PRICING_VIEW,Be.PRICING_ESTIMATE,Be.PRICING_DATA_ADD],[Gn.VIEWER]:[Be.LISTINGS_VIEW,Be.BLOGS_VIEW,Be.ENQUIRIES_VIEW,Be.CONTACTS_VIEW,Be.SOCIAL_VIEW,Be.PRICING_VIEW]};function q_(t,e){var n;return((n=Gce[t])==null?void 0:n.includes(e))??!1}function BH(t){return{[Gn.SUPER_ADMIN]:"Super Admin",[Gn.ADMIN]:"Admin",[Gn.EDITOR]:"Editor",[Gn.VIEWER]:"Viewer"}[t]||t}function Js(){const{user:t}=Xi(),e=(t==null?void 0:t.role)||Gn.VIEWER;return{role:e,can:c=>q_(e,c),canAny:c=>c.some(u=>q_(e,u)),canAll:c=>c.every(u=>q_(e,u)),isSuperAdmin:()=>e===Gn.SUPER_ADMIN,isAdmin:()=>[Gn.SUPER_ADMIN,Gn.ADMIN].includes(e),isEditor:()=>[Gn.SUPER_ADMIN,Gn.ADMIN,Gn.EDITOR].includes(e),PERMISSIONS:Be,ROLES:Gn}}function Qn({fullScreen:t=!1,size:e="medium"}){const n={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"};return t?o.jsx("div",{className:"loading-fullscreen",children:o.jsx("div",{className:`spinner ${n[e]}`})}):o.jsx("div",{className:`spinner ${n[e]}`})}function Us({children:t,requiredPermission:e,requiredPermissions:n,requireAll:r=!1}){const{user:s,loading:i}=Xi(),{can:a,canAny:l,canAll:c}=Js(),u=Ul();return i?o.jsx(Qn,{fullScreen:!0}):s?e&&!a(e)?o.jsx(jf,{to:"/dashboard",replace:!0}):n&&!(r?c(n):l(n))?o.jsx(jf,{to:"/dashboard",replace:!0}):t:o.jsx(jf,{to:"/login",state:{from:u},replace:!0})}function Kce({onVisibilityChange:t}){const{can:e,PERMISSIONS:n,isSuperAdmin:r}=Js(),[s,i]=b.useState(!0),[a,l]=b.useState(()=>localStorage.getItem("sidebar-auto-hide")==="true"),c=b.useRef(null),u=b.useRef(null),d=[{path:"/dashboard",icon:"/",label:"Dashboard",show:!0},{path:"/listings",icon:"/",label:"Aircraft",show:e(n.LISTINGS_VIEW)},{path:"/pricing",icon:"/",label:"Pricing Tool",show:e(n.PRICING_VIEW)},{path:"/blog",icon:"/",label:"Blog",show:e(n.BLOGS_VIEW)},{path:"/social",icon:"/",label:"Social",show:e(n.SOCIAL_VIEW)},{path:"/enquiries",icon:"/",label:"Enquiries",show:e(n.ENQUIRIES_VIEW)},{path:"/contacts",icon:"/",label:"Contacts",show:e(n.CONTACTS_VIEW)},{path:"/media",icon:"/",label:"Media",show:e(n.LISTINGS_VIEW)},{path:"/users",icon:"/",label:"Users",show:e(n.USERS_INVITE)},{path:"/audit",icon:"/",label:"Audit Log",show:e(n.AUDIT_VIEW)},{path:"/settings",icon:"/",label:"Settings",show:r()}];b.useEffect(()=>{t&&t(a?s:!0)},[s,a,t]);const h=b.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null),i(!0)},[]),f=b.useCallback(()=>{a&&(u.current=setTimeout(()=>{i(!1)},300))},[a]),p=b.useCallback(()=>{i(!0)},[]),m=b.useCallback(()=>{i(!0)},[]),g=b.useCallback(()=>{const y=!a;l(y),localStorage.setItem("sidebar-auto-hide",y.toString()),y||i(!0)},[a]);return b.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),o.jsxs(o.Fragment,{children:[a&&!s&&o.jsx("div",{className:"sidebar-trigger-zone",onMouseEnter:p}),o.jsx("div",{className:`sidebar-peek-indicator ${a&&!s?"visible":""}`,onClick:m,onMouseEnter:p,children:o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsxs("aside",{ref:c,className:`sidebar ${a?"sidebar-auto-hide":""} ${s?"sidebar-visible":""}`,onMouseEnter:h,onMouseLeave:f,children:[o.jsxs("div",{className:"sidebar-logo",children:[o.jsx("span",{className:"logo-text",children:"HQ Aviation"}),o.jsx("span",{className:"logo-badge",children:"Admin"})]}),o.jsx("nav",{className:"sidebar-nav",children:d.filter(y=>y.show).map(y=>o.jsxs(tee,{to:y.path,className:({isActive:x})=>`sidebar-link ${x?"sidebar-link-active":""}`,children:[o.jsx("span",{className:"sidebar-icon",children:y.icon}),o.jsx("span",{className:"sidebar-label",children:y.label})]},y.path))}),o.jsxs("div",{className:"sidebar-footer",children:[o.jsxs("button",{className:`sidebar-link sidebar-toggle-btn ${a?"active":""}`,onClick:g,title:a?"Disable auto-hide":"Enable auto-hide",children:[o.jsx("span",{className:"sidebar-icon",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a?o.jsxs(o.Fragment,{children:[o.jsx("polyline",{points:"15 18 9 12 15 6"}),o.jsx("line",{x1:"20",y1:"6",x2:"20",y2:"18"})]}):o.jsxs(o.Fragment,{children:[o.jsx("polyline",{points:"9 18 15 12 9 6"}),o.jsx("line",{x1:"4",y1:"6",x2:"4",y2:"18"})]})})}),o.jsx("span",{className:"sidebar-label",children:a?"Pin Sidebar":"Auto-hide"})]}),o.jsxs("a",{href:"http://localhost:7500",target:"_blank",rel:"noopener noreferrer",className:"sidebar-link",children:[o.jsx("span",{className:"sidebar-icon",children:"/"}),o.jsx("span",{className:"sidebar-label",children:"View Website"})]})]})]})]})}function Yce(){var i,a,l;const{user:t,userProfile:e,signOut:n}=Xi(),[r,s]=b.useState(!1);return o.jsxs("header",{className:"header",children:[o.jsx("div",{className:"header-left",children:o.jsx("h1",{className:"header-title",children:"Admin Dashboard"})}),o.jsxs("div",{className:"header-right",children:[o.jsxs("div",{className:"header-user",onClick:()=>s(!r),children:[o.jsx("div",{className:"user-avatar",children:((i=e==null?void 0:e.displayName)==null?void 0:i[0])||((l=(a=t==null?void 0:t.email)==null?void 0:a[0])==null?void 0:l.toUpperCase())||"?"}),o.jsxs("div",{className:"user-info",children:[o.jsx("span",{className:"user-name",children:(e==null?void 0:e.displayName)||(t==null?void 0:t.email)}),o.jsx("span",{className:"user-role",children:BH(t==null?void 0:t.role)})]}),o.jsx("span",{className:"dropdown-arrow",children:r?"^":"v"})]}),r&&o.jsxs("div",{className:"header-dropdown",children:[o.jsx("div",{className:"dropdown-item dropdown-email",children:t==null?void 0:t.email}),o.jsx("button",{className:"dropdown-item",onClick:n,children:"Sign Out"})]})]})]})}function Qce(){const[t,e]=b.useState(!0),n=b.useCallback(r=>{e(r)},[]);return o.jsxs("div",{className:"app-layout",children:[o.jsx(Kce,{onVisibilityChange:n}),o.jsxs("div",{className:`main-content ${t?"":"sidebar-collapsed"}`,children:[o.jsx(Yce,{}),o.jsx("main",{className:"page-content",children:o.jsx(H3,{})})]})]})}function Xce(){return o.jsx("div",{className:"auth-layout",children:o.jsxs("div",{className:"auth-container",children:[o.jsxs("div",{className:"auth-logo",children:[o.jsx("span",{className:"logo-text",children:"HQ Aviation"}),o.jsx("span",{className:"logo-badge",children:"Admin"})]}),o.jsx(H3,{})]})})}const VH=b.createContext(null);function Jce({children:t}){const[e,n]=b.useState([]),r=b.useCallback((u,d="info",h=4e3)=>{const f=Date.now();return n(p=>[...p,{id:f,message:u,type:d}]),h>0&&setTimeout(()=>{n(p=>p.filter(m=>m.id!==f))},h),f},[]),s=b.useCallback(u=>{n(d=>d.filter(h=>h.id!==u))},[]),i=b.useCallback(u=>r(u,"success"),[r]),a=b.useCallback(u=>r(u,"error",6e3),[r]),l=b.useCallback(u=>r(u,"warning"),[r]),c=b.useCallback(u=>r(u,"info"),[r]);return o.jsxs(VH.Provider,{value:{toasts:e,addToast:r,removeToast:s,success:i,error:a,warning:l,info:c},children:[t,o.jsx(Zce,{toasts:e,removeToast:s})]})}function Zce({toasts:t,removeToast:e}){return t.length===0?null:o.jsx("div",{className:"toast-container",children:t.map(n=>o.jsxs("div",{className:`toast toast-${n.type}`,children:[o.jsx("span",{children:n.message}),o.jsx("button",{onClick:()=>e(n.id),className:"toast-close",children:""})]},n.id))})}function qt(){const t=b.useContext(VH);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}function K({children:t,type:e="button",variant:n="primary",size:r="medium",disabled:s=!1,loading:i=!1,onClick:a,className:l="",...c}){const u="btn",d=`btn-${n}`,h=`btn-${r}`,f=[u,d,h,l].filter(Boolean).join(" ");return o.jsx("button",{type:e,className:f,disabled:s||i,onClick:a,...c,children:i?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"btn-spinner"}),o.jsx("span",{children:"Loading..."})]}):t})}const ye=b.forwardRef(({label:t,type:e="text",error:n,helpText:r,className:s="",...i},a)=>o.jsxs("div",{className:`form-group ${s}`,children:[t&&o.jsx("label",{className:"form-label",children:t}),o.jsx("input",{ref:a,type:e,className:`form-input ${n?"form-input-error":""}`,...i}),n&&o.jsx("span",{className:"form-error",children:n}),r&&!n&&o.jsx("span",{className:"form-help",children:r})]}));ye.displayName="Input";function eue(){var w,N,S;const[t,e]=b.useState(""),[n,r]=b.useState(""),[s,i]=b.useState(!1),[a,l]=b.useState(!1),{signIn:c,resetPassword:u,error:d}=Xi(),{success:h,error:f}=qt(),p=rr(),m=Ul(),g=((N=(w=m.state)==null?void 0:w.from)==null?void 0:N.pathname)||"/dashboard",y=async C=>{C.preventDefault(),i(!0);try{await c(t,n),p(g,{replace:!0})}catch(A){f(A.message)}finally{i(!1)}},x=async C=>{if(C.preventDefault(),!t){f("Please enter your email address");return}i(!0);try{await u(t),h("Password reset email sent. Check your inbox."),l(!1)}catch(A){f(A.message)}finally{i(!1)}};return a?o.jsxs("div",{className:"auth-card",children:[o.jsx("h2",{className:"auth-title",children:"Reset Password"}),o.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"}),o.jsxs("form",{onSubmit:x,children:[o.jsx(ye,{label:"Email",type:"email",value:t,onChange:C=>e(C.target.value),placeholder:"your@email.com",required:!0}),o.jsx(K,{type:"submit",loading:s,className:"btn-full",children:"Send Reset Link"})]}),o.jsx("p",{className:"auth-footer",children:o.jsx("button",{type:"button",className:"auth-link",onClick:()=>l(!1),children:"Back to login"})})]}):o.jsxs("div",{className:"auth-card",children:[o.jsx("h2",{className:"auth-title",children:"Sign In"}),o.jsx("p",{className:"auth-subtitle",children:"Access the admin dashboard"}),((S=m.state)==null?void 0:S.reason)==="inactivity"&&o.jsx("div",{className:"auth-alert",children:"You were signed out due to inactivity"}),o.jsxs("form",{onSubmit:y,children:[o.jsx(ye,{label:"Email",type:"email",value:t,onChange:C=>e(C.target.value),placeholder:"your@email.com",required:!0}),o.jsx(ye,{label:"Password",type:"password",value:n,onChange:C=>r(C.target.value),placeholder:"Enter your password",required:!0}),o.jsx(K,{type:"submit",loading:s,className:"btn-full",children:"Sign In"})]}),o.jsx("p",{className:"auth-footer",children:o.jsx("button",{type:"button",className:"auth-link",onClick:()=>l(!0),children:"Forgot your password?"})})]})}const tue="modulepreload",nue=function(t){return"/admin/"+t},VM={},rue=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=nue(c),c in VM)return;VM[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":tue,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function sue(){const[t]=see(),e=rr(),{success:n,error:r}=qt(),s=t.get("token"),[i,a]=b.useState(!0),[l,c]=b.useState(null),[u,d]=b.useState(null),[h,f]=b.useState(""),[p,m]=b.useState(""),[g,y]=b.useState(""),[x,w]=b.useState(!1);b.useEffect(()=>{async function S(){var C,A;if(!s){d("Invalid invite link"),a(!1);return}try{const{getDocs:j,collection:_,query:E,where:I}=await rue(async()=>{const{getDocs:se,collection:L,query:B,where:$}=await Promise.resolve().then(()=>yle);return{getDocs:se,collection:L,query:B,where:$}},void 0),T=E(_(ke,"invites"),I("token","==",s)),P=await j(T);if(P.empty){d("Invite not found"),a(!1);return}const O=P.docs[0],H={id:O.id,...O.data()},X=((A=(C=H.expiresAt)==null?void 0:C.toDate)==null?void 0:A.call(C))||new Date(H.expiresAt);if(new Date>X){d("This invite has expired"),a(!1);return}if(H.status==="accepted"){d("This invite has already been used"),a(!1);return}c(H)}catch(j){console.error("Error validating invite:",j),d("Failed to validate invite")}a(!1)}S()},[s]);const N=async S=>{if(S.preventDefault(),p!==g){r("Passwords do not match");return}if(p.length<12){r("Password must be at least 12 characters");return}w(!0);try{const A=(await Dne(fo,l.email,p)).user;await mu(We(ke,"users",A.uid),{email:l.email,displayName:h,role:l.role,status:"active",invitedBy:l.invitedBy,createdAt:et(),updatedAt:et(),lastLogin:et()}),await _t(We(ke,"invites",l.id),{status:"accepted",acceptedAt:et()}),n("Account created successfully!"),e("/dashboard")}catch(C){console.error("Error creating account:",C),C.code==="auth/email-already-in-use"?r("An account with this email already exists"):r("Failed to create account")}finally{w(!1)}};return i?o.jsxs("div",{className:"auth-card",children:[o.jsx(Qn,{}),o.jsx("p",{children:"Validating invite..."})]}):u?o.jsxs("div",{className:"auth-card",children:[o.jsx("h2",{className:"auth-title",children:"Invalid Invite"}),o.jsx("p",{className:"auth-error",children:u}),o.jsx("p",{className:"auth-footer",children:"Contact your administrator for a new invite."})]}):o.jsxs("div",{className:"auth-card",children:[o.jsx("h2",{className:"auth-title",children:"Create Your Account"}),o.jsxs("p",{className:"auth-subtitle",children:["You've been invited to join as ",o.jsx("strong",{children:l.role.replace("_"," ")})]}),o.jsxs("form",{onSubmit:N,children:[o.jsx(ye,{label:"Email",type:"email",value:l.email,disabled:!0}),o.jsx(ye,{label:"Full Name",value:h,onChange:S=>f(S.target.value),placeholder:"Your full name",required:!0}),o.jsx(ye,{label:"Password",type:"password",value:p,onChange:S=>m(S.target.value),placeholder:"At least 12 characters",helpText:"Min 12 characters, 1 uppercase, 1 number, 1 special character",required:!0}),o.jsx(ye,{label:"Confirm Password",type:"password",value:g,onChange:S=>y(S.target.value),placeholder:"Confirm your password",required:!0}),o.jsx(K,{type:"submit",loading:x,className:"btn-full",children:"Create Account"})]})]})}async function ds(t){const e=fo.currentUser;if(!e){console.warn("Cannot log audit event: No authenticated user");return}try{await ku(fr(ke,"audit_logs"),{timestamp:et(),userId:e.uid,userEmail:e.email,userName:e.displayName||e.email,action:t.action,resourceType:t.resourceType,resourceId:t.resourceId,resourceName:t.resourceName||null,changes:t.changes||null,userAgent:navigator.userAgent})}catch(n){console.error("Failed to log audit event:",n)}}function pn(t,e=[],n=!0){const[r,s]=b.useState([]),[i,a]=b.useState(!0),[l,c]=b.useState(null);return b.useEffect(()=>{const u=Wi(fr(ke,t),...e);if(n){const d=Nh(u,h=>{const f=h.docs.map(p=>({id:p.id,...p.data()}));s(f),a(!1)},h=>{console.error("Firestore error:",h),c(h),a(!1)});return()=>d()}else Io(u).then(d=>{const h=d.docs.map(f=>({id:f.id,...f.data()}));s(h),a(!1)}).catch(d=>{console.error("Firestore error:",d),c(d),a(!1)})},[t,JSON.stringify(e),n]),{data:r,loading:i,error:l}}function wv(t,e){const[n,r]=b.useState(null),[s,i]=b.useState(!0),[a,l]=b.useState(null);return b.useEffect(()=>{if(!e){r(null),i(!1);return}const c=We(ke,t,e),u=Nh(c,d=>{d.exists()?r({id:d.id,...d.data()}):r(null),i(!1)},d=>{console.error("Firestore error:",d),l(d),i(!1)});return()=>u()},[t,e]),{data:n,loading:s,error:a}}function Ms(t){const[e,n]=b.useState(!1),r=b.useCallback(async(a,l=null)=>{n(!0);try{const c=await ku(fr(ke,t),{...a,createdAt:et(),updatedAt:et()});return ds({action:`${t}.create`,resourceType:t,resourceId:c.id,resourceName:l||a.name||a.title||a.registration||`${a.firstName} ${a.lastName}`||null}),n(!1),c.id}catch(c){throw n(!1),c}},[t]),s=b.useCallback(async(a,l,c=null)=>{n(!0);try{await _t(We(ke,t,a),{...l,updatedAt:et()}),ds({action:`${t}.update`,resourceType:t,resourceId:a,resourceName:c||l.name||l.title||l.registration||null,changes:l}),n(!1)}catch(u){throw n(!1),u}},[t]),i=b.useCallback(async(a,l=null)=>{n(!0);try{await wh(We(ke,t,a)),ds({action:`${t}.delete`,resourceType:t,resourceId:a,resourceName:l}),n(!1)}catch(c){throw n(!1),c}},[t]);return{create:r,update:s,remove:i,loading:e}}function ht(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function Qa(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function $H(t,e){const n=ht(t);return isNaN(e)?Qa(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function UH(t,e){const n=ht(t);if(isNaN(e))return Qa(t,NaN);if(!e)return n;const r=n.getDate(),s=Qa(t,n.getTime());s.setMonth(n.getMonth()+e+1,0);const i=s.getDate();return r>=i?s:(n.setFullYear(s.getFullYear(),s.getMonth(),r),n)}const zH=6048e5,iue=864e5,Rx=43200,$M=1440;let aue={};function Nv(){return aue}function my(t,e){var l,c,u,d;const n=Nv(),r=(e==null?void 0:e.weekStartsOn)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,s=ht(t),i=s.getDay(),a=(i<r?7:0)+i-r;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}function Gb(t){return my(t,{weekStartsOn:1})}function HH(t){const e=ht(t),n=e.getFullYear(),r=Qa(t,0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);const s=Gb(r),i=Qa(t,0);i.setFullYear(n,0,4),i.setHours(0,0,0,0);const a=Gb(i);return e.getTime()>=s.getTime()?n+1:e.getTime()>=a.getTime()?n:n-1}function Xd(t){const e=ht(t);return e.setHours(0,0,0,0),e}function Kb(t){const e=ht(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function WH(t,e){const n=Xd(t),r=Xd(e),s=+n-Kb(n),i=+r-Kb(r);return Math.round((s-i)/iue)}function oue(t){const e=HH(t),n=Qa(t,0);return n.setFullYear(e,0,4),n.setHours(0,0,0,0),Gb(n)}function If(t,e){const n=ht(t),r=ht(e),s=n.getTime()-r.getTime();return s<0?-1:s>0?1:s}function lue(t){return Qa(t,Date.now())}function cue(t,e){const n=Xd(t),r=Xd(e);return+n==+r}function uue(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function due(t){if(!uue(t)&&typeof t!="number")return!1;const e=ht(t);return!isNaN(Number(e))}function hue(t,e){const n=ht(t),r=ht(e),s=n.getFullYear()-r.getFullYear(),i=n.getMonth()-r.getMonth();return s*12+i}function fue(t,e){const n=ht(t),r=ht(e);return n.getFullYear()-r.getFullYear()}function dl(t,e){const n=ht(t),r=ht(e),s=UM(n,r),i=Math.abs(WH(n,r));n.setDate(n.getDate()-s*i);const a=+(UM(n,r)===-s),l=s*(i-a);return l===0?0:l}function UM(t,e){const n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function pue(t){return e=>{const r=(t?Math[t]:Math.trunc)(e);return r===0?0:r}}function mue(t,e){return+ht(t)-+ht(e)}function qH(t){const e=ht(t);return e.setHours(23,59,59,999),e}function GH(t){const e=ht(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function gue(t){const e=ht(t);return+qH(e)==+GH(e)}function yue(t,e){const n=ht(t),r=ht(e),s=If(n,r),i=Math.abs(hue(n,r));let a;if(i<1)a=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-s*i);let l=If(n,r)===-s;gue(ht(t))&&i===1&&If(t,r)===1&&(l=!1),a=s*(i-Number(l))}return a===0?0:a}function vue(t,e,n){const r=mue(t,e)/1e3;return pue(n==null?void 0:n.roundingMethod)(r)}function xue(t,e){const n=ht(t),r=ht(e),s=If(n,r),i=Math.abs(fue(n,r));n.setFullYear(1584),r.setFullYear(1584);const a=If(n,r)===-s,l=s*(i-+a);return l===0?0:l}function bue(t,e){const n=ht(t.start),r=ht(t.end);let s=+n>+r;const i=s?+n:+r,a=s?r:n;a.setHours(0,0,0,0);let l=1;const c=[];for(;+a<=i;)c.push(ht(a)),a.setDate(a.getDate()+l),a.setHours(0,0,0,0);return s?c.reverse():c}function wue(t){const e=ht(t);return e.setDate(1),e.setHours(0,0,0,0),e}function Nue(t){const e=ht(t),n=Qa(t,0);return n.setFullYear(e.getFullYear(),0,1),n.setHours(0,0,0,0),n}const Sue={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},_ue=(t,e,n)=>{let r;const s=Sue[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function G_(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const jue={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Eue={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Cue={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Tue={date:G_({formats:jue,defaultWidth:"full"}),time:G_({formats:Eue,defaultWidth:"full"}),dateTime:G_({formats:Cue,defaultWidth:"full"})},Aue={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},kue=(t,e,n,r)=>Aue[t];function Em(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const a=t.defaultFormattingWidth||t.defaultWidth,l=n!=null&&n.width?String(n.width):a;s=t.formattingValues[l]||t.formattingValues[a]}else{const a=t.defaultWidth,l=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[l]||t.values[a]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const Iue={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Pue={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Oue={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Due={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Rue={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Mue={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Lue=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Fue={ordinalNumber:Lue,era:Em({values:Iue,defaultWidth:"wide"}),quarter:Em({values:Pue,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Em({values:Oue,defaultWidth:"wide"}),day:Em({values:Due,defaultWidth:"wide"}),dayPeriod:Em({values:Rue,defaultWidth:"wide",formattingValues:Mue,defaultFormattingWidth:"wide"})};function Cm(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const a=i[0],l=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?Vue(l,h=>h.test(a)):Bue(l,h=>h.test(a));let u;u=t.valueCallback?t.valueCallback(c):c,u=n.valueCallback?n.valueCallback(u):u;const d=e.slice(a.length);return{value:u,rest:d}}}function Bue(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Vue(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function $ue(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let a=t.valueCallback?t.valueCallback(i[0]):i[0];a=n.valueCallback?n.valueCallback(a):a;const l=e.slice(s.length);return{value:a,rest:l}}}const Uue=/^(\d+)(th|st|nd|rd)?/i,zue=/\d+/i,Hue={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Wue={any:[/^b/i,/^(a|c)/i]},que={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Gue={any:[/1/i,/2/i,/3/i,/4/i]},Kue={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Yue={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Que={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Xue={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jue={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Zue={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ede={ordinalNumber:$ue({matchPattern:Uue,parsePattern:zue,valueCallback:t=>parseInt(t,10)}),era:Cm({matchPatterns:Hue,defaultMatchWidth:"wide",parsePatterns:Wue,defaultParseWidth:"any"}),quarter:Cm({matchPatterns:que,defaultMatchWidth:"wide",parsePatterns:Gue,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Cm({matchPatterns:Kue,defaultMatchWidth:"wide",parsePatterns:Yue,defaultParseWidth:"any"}),day:Cm({matchPatterns:Que,defaultMatchWidth:"wide",parsePatterns:Xue,defaultParseWidth:"any"}),dayPeriod:Cm({matchPatterns:Jue,defaultMatchWidth:"any",parsePatterns:Zue,defaultParseWidth:"any"})},KH={code:"en-US",formatDistance:_ue,formatLong:Tue,formatRelative:kue,localize:Fue,match:ede,options:{weekStartsOn:0,firstWeekContainsDate:1}};function tde(t){const e=ht(t);return WH(e,Nue(e))+1}function nde(t){const e=ht(t),n=+Gb(e)-+oue(e);return Math.round(n/zH)+1}function YH(t,e){var d,h,f,p;const n=ht(t),r=n.getFullYear(),s=Nv(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??s.firstWeekContainsDate??((p=(f=s.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??1,a=Qa(t,0);a.setFullYear(r+1,0,i),a.setHours(0,0,0,0);const l=my(a,e),c=Qa(t,0);c.setFullYear(r,0,i),c.setHours(0,0,0,0);const u=my(c,e);return n.getTime()>=l.getTime()?r+1:n.getTime()>=u.getTime()?r:r-1}function rde(t,e){var l,c,u,d;const n=Nv(),r=(e==null?void 0:e.firstWeekContainsDate)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(u=n.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,s=YH(t,e),i=Qa(t,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),my(i,e)}function sde(t,e){const n=ht(t),r=+my(n,e)-+rde(n,e);return Math.round(r/zH)+1}function Qt(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const ac={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Qt(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Qt(n+1,2)},d(t,e){return Qt(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Qt(t.getHours()%12||12,e.length)},H(t,e){return Qt(t.getHours(),e.length)},m(t,e){return Qt(t.getMinutes(),e.length)},s(t,e){return Qt(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),s=Math.trunc(r*Math.pow(10,n-3));return Qt(s,e.length)}},Mh={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},zM={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),s=r>0?r:1-r;return n.ordinalNumber(s,{unit:"year"})}return ac.y(t,e)},Y:function(t,e,n,r){const s=YH(t,r),i=s>0?s:1-s;if(e==="YY"){const a=i%100;return Qt(a,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):Qt(i,e.length)},R:function(t,e){const n=HH(t);return Qt(n,e.length)},u:function(t,e){const n=t.getFullYear();return Qt(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Qt(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Qt(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return ac.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Qt(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const s=sde(t,r);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):Qt(s,e.length)},I:function(t,e,n){const r=nde(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Qt(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):ac.d(t,e)},D:function(t,e,n){const r=tde(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Qt(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Qt(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const s=t.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Qt(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return Qt(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let s;switch(r===12?s=Mh.noon:r===0?s=Mh.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let s;switch(r>=17?s=Mh.evening:r>=12?s=Mh.afternoon:r>=4?s=Mh.morning:s=Mh.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return ac.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):ac.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Qt(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Qt(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):ac.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):ac.s(t,e)},S:function(t,e){return ac.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return WM(r);case"XXXX":case"XX":return Qu(r);case"XXXXX":case"XXX":default:return Qu(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return WM(r);case"xxxx":case"xx":return Qu(r);case"xxxxx":case"xxx":default:return Qu(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+HM(r,":");case"OOOO":default:return"GMT"+Qu(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+HM(r,":");case"zzzz":default:return"GMT"+Qu(r,":")}},t:function(t,e,n){const r=Math.trunc(t.getTime()/1e3);return Qt(r,e.length)},T:function(t,e,n){const r=t.getTime();return Qt(r,e.length)}};function HM(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Math.trunc(r/60),i=r%60;return i===0?n+String(s):n+String(s)+e+Qt(i,2)}function WM(t,e){return t%60===0?(t>0?"-":"+")+Qt(Math.abs(t)/60,2):Qu(t,e)}function Qu(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),s=Qt(Math.trunc(r/60),2),i=Qt(r%60,2);return n+s+e+i}const qM=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},QH=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},ide=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],s=n[2];if(!s)return qM(t,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",qM(r,e)).replace("{{time}}",QH(s,e))},ade={p:QH,P:ide},ode=/^D+$/,lde=/^Y+$/,cde=["D","DD","YY","YYYY"];function ude(t){return ode.test(t)}function dde(t){return lde.test(t)}function hde(t,e,n){const r=fde(t,e,n);if(console.warn(r),cde.includes(t))throw new RangeError(r)}function fde(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const pde=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mde=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,gde=/^'([^]*?)'?$/,yde=/''/g,vde=/[a-zA-Z]/;function rt(t,e,n){var d,h,f,p;const r=Nv(),s=r.locale??KH,i=r.firstWeekContainsDate??((h=(d=r.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??1,a=r.weekStartsOn??((p=(f=r.locale)==null?void 0:f.options)==null?void 0:p.weekStartsOn)??0,l=ht(t);if(!due(l))throw new RangeError("Invalid time value");let c=e.match(mde).map(m=>{const g=m[0];if(g==="p"||g==="P"){const y=ade[g];return y(m,s.formatLong)}return m}).join("").match(pde).map(m=>{if(m==="''")return{isToken:!1,value:"'"};const g=m[0];if(g==="'")return{isToken:!1,value:xde(m)};if(zM[g])return{isToken:!0,value:m};if(g.match(vde))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:m}});s.localize.preprocessor&&(c=s.localize.preprocessor(l,c));const u={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return c.map(m=>{if(!m.isToken)return m.value;const g=m.value;(dde(g)||ude(g))&&hde(g,e,String(t));const y=zM[g[0]];return y(l,g,s.localize,u)}).join("")}function xde(t){const e=t.match(gde);return e?e[1].replace(yde,"'"):t}function bde(t,e,n){const r=Nv(),s=(n==null?void 0:n.locale)??r.locale??KH,i=2520,a=If(t,e);if(isNaN(a))throw new RangeError("Invalid time value");const l=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:a});let c,u;a>0?(c=ht(e),u=ht(t)):(c=ht(t),u=ht(e));const d=vue(u,c),h=(Kb(u)-Kb(c))/1e3,f=Math.round((d-h)/60);let p;if(f<2)return n!=null&&n.includeSeconds?d<5?s.formatDistance("lessThanXSeconds",5,l):d<10?s.formatDistance("lessThanXSeconds",10,l):d<20?s.formatDistance("lessThanXSeconds",20,l):d<40?s.formatDistance("halfAMinute",0,l):d<60?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",1,l):f===0?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",f,l);if(f<45)return s.formatDistance("xMinutes",f,l);if(f<90)return s.formatDistance("aboutXHours",1,l);if(f<$M){const m=Math.round(f/60);return s.formatDistance("aboutXHours",m,l)}else{if(f<i)return s.formatDistance("xDays",1,l);if(f<Rx){const m=Math.round(f/$M);return s.formatDistance("xDays",m,l)}else if(f<Rx*2)return p=Math.round(f/Rx),s.formatDistance("aboutXMonths",p,l)}if(p=yue(u,c),p<12){const m=Math.round(f/Rx);return s.formatDistance("xMonths",m,l)}else{const m=p%12,g=Math.trunc(p/12);return m<3?s.formatDistance("aboutXYears",g,l):m<9?s.formatDistance("overXYears",g,l):s.formatDistance("almostXYears",g+1,l)}}function Kh(t,e){return bde(t,lue(t),e)}function wde(t,e){const n=ht(t),r=ht(e);return n.getTime()>r.getTime()}function Nde(t,e){const n=ht(t),r=ht(e);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()}function Sde(t,e){const n=+ht(t),[r,s]=[+ht(e.start),+ht(e.end)].sort((i,a)=>i-a);return n>=r&&n<=s}function XH(t,e){return $H(t,-e)}function Xo(t,e){return UH(t,-e)}function _de(){const{data:t,loading:e}=pn("contacts",[qr("followUp.nextFollowUpDate","asc")]);return{...b.useMemo(()=>{if(!t||t.length===0)return{overdue:[],dueToday:[],dueTomorrow:[],upcoming:[],totalNeedingFollowUp:0};const s=Xd(new Date),i=[],a=[],l=[],c=[];t.forEach(d=>{var g,y;const h=(g=d.followUp)==null?void 0:g.nextFollowUpDate;if(!h)return;const f=h.toDate?h.toDate():new Date(h),p=dl(f,s),m={...d,followUpDate:f,daysUntil:p,priority:((y=d.followUp)==null?void 0:y.followUpPriority)||"normal"};p<0?i.push(m):p===0?a.push(m):p===1?l.push(m):p<=7&&c.push(m)}),i.sort((d,h)=>d.daysUntil-h.daysUntil);const u=d=>{const h={urgent:0,normal:1,low:2};return d.sort((f,p)=>h[f.priority]-h[p.priority])};return{overdue:u(i),dueToday:u(a),dueTomorrow:u(l),upcoming:u(c),totalNeedingFollowUp:i.length+a.length+l.length}},[t]),loading:e}}const sa="contacts";function Ia(){const[t,e]=b.useState(!1),{user:n}=Xi(),r=b.useCallback(async g=>{e(!0);try{const y=await ku(fr(ke,sa),{...g,linkedEnquiryIds:g.linkedEnquiryIds||[],purchaseHistory:[],ownedAircraft:[],tags:g.tags||[],followUp:{nextFollowUpDate:null,lastContactedDate:null,followUpPriority:"normal",followUpNotes:""},createdAt:et(),updatedAt:et(),createdBy:(n==null?void 0:n.uid)||null,lastModifiedBy:(n==null?void 0:n.uid)||null});return ds({action:"contacts.create",resourceType:"contact",resourceId:y.id,resourceName:`${g.firstName} ${g.lastName}`}),e(!1),y.id}catch(y){throw e(!1),y}},[n]),s=b.useCallback(async(g,y,x=null)=>{e(!0);try{await _t(We(ke,sa,g),{...y,updatedAt:et(),lastModifiedBy:(n==null?void 0:n.uid)||null}),ds({action:"contacts.update",resourceType:"contact",resourceId:g,resourceName:x||`${y.firstName} ${y.lastName}`||null,changes:y}),e(!1)}catch(w){throw e(!1),w}},[n]),i=b.useCallback(async(g,y=null)=>{e(!0);try{await wh(We(ke,sa,g)),ds({action:"contacts.delete",resourceType:"contact",resourceId:g,resourceName:y}),e(!1)}catch(x){throw e(!1),x}},[]),a=b.useCallback(async(g,y)=>{try{await _t(We(ke,sa,g),{linkedEnquiryIds:gu(y),updatedAt:et()})}catch(x){throw x}},[]),l=b.useCallback(async(g,y)=>{try{const x=We(ke,sa,g),w=await us(x);if(!w.exists())throw new Error("Contact not found");const N=w.data().purchaseHistory||[];await _t(x,{purchaseHistory:[...N,y],status:"past_buyer",updatedAt:et()})}catch(x){throw x}},[]),c=b.useCallback(async(g,y)=>{try{const x=We(ke,sa,g),w=await us(x);if(!w.exists())throw new Error("Contact not found");const N=w.data().ownedAircraft||[],S={id:`aircraft_${Date.now()}`,...y};return await _t(x,{ownedAircraft:[...N,S],updatedAt:et()}),S.id}catch(x){throw x}},[]),u=b.useCallback(async(g,y,x)=>{try{const w=We(ke,sa,g),N=await us(w);if(!N.exists())throw new Error("Contact not found");const C=(N.data().ownedAircraft||[]).map(A=>A.id===y?{...A,...x}:A);await _t(w,{ownedAircraft:C,updatedAt:et()})}catch(w){throw w}},[]),d=b.useCallback(async(g,y)=>{try{const x=We(ke,sa,g),w=await us(x);if(!w.exists())throw new Error("Contact not found");const S=(w.data().ownedAircraft||[]).filter(C=>C.id!==y);await _t(x,{ownedAircraft:S,updatedAt:et()})}catch(x){throw x}},[]),h=b.useCallback(async(g,y)=>{try{await _t(We(ke,sa,g),{followUp:y,updatedAt:et()})}catch(x){throw x}},[]),f=b.useCallback(async g=>{try{const y=We(ke,sa,g),x=await us(y);if(!x.exists())throw new Error("Contact not found");const w=x.data().followUp||{};await _t(y,{followUp:{...w,lastContactedDate:et()},updatedAt:et()})}catch(y){throw y}},[]),p=b.useCallback(async g=>{try{const y=Wi(fr(ke,sa),qr("lastName")),x=await Io(y),w=g.toLowerCase();return x.docs.map(S=>({id:S.id,...S.data()})).filter(S=>{const C=`${S.firstName} ${S.lastName}`.toLowerCase(),A=(S.email||"").toLowerCase(),j=(S.company||"").toLowerCase();return C.includes(w)||A.includes(w)||j.includes(w)})}catch(y){throw y}},[]),m=b.useCallback(async g=>{try{const y=await us(We(ke,sa,g));return y.exists()?{id:y.id,...y.data()}:null}catch(y){throw y}},[]);return{loading:t,createContact:r,updateContact:s,deleteContact:i,linkEnquiry:a,addPurchaseToHistory:l,addOwnedAircraft:c,updateOwnedAircraft:u,removeOwnedAircraft:d,updateFollowUp:h,markAsContacted:f,searchContacts:p,getContact:m}}const Go={USD:1,GBP:1.27,EUR:1.08},K_="exchange_rates";function jde(){const[t,e]=b.useState(Go),[n,r]=b.useState(null),[s,i]=b.useState(!0),[a,l]=b.useState(!1),{user:c}=Xi(),u=b.useCallback(async()=>{var m,g;i(!0);try{const y=We(ke,"settings",K_),x=await us(y);if(x.exists()){const w=x.data();e(w.rates||Go),r(((g=(m=w.updatedAt)==null?void 0:m.toDate)==null?void 0:g.call(m))||null)}else e(Go),r(null)}catch(y){console.error("Failed to fetch exchange rates:",y),e(Go)}i(!1)},[]);b.useEffect(()=>{u()},[u]);const d=b.useCallback(async(m,g)=>{if(!m||g===void 0||g<=0)throw new Error("Invalid currency or rate");l(!0);try{const y={...t,[m]:parseFloat(g)},x=We(ke,"settings",K_);return await mu(x,{rates:y,updatedAt:et(),updatedBy:(c==null?void 0:c.uid)||null},{merge:!0}),e(y),r(new Date),l(!1),!0}catch(y){throw console.error("Failed to update exchange rate:",y),l(!1),y}},[t,c]),h=b.useCallback(async m=>{if(!m||typeof m!="object")throw new Error("Invalid rates object");l(!0);try{const g=We(ke,"settings",K_);return await mu(g,{rates:{USD:1,GBP:parseFloat(m.GBP)||Go.GBP,EUR:parseFloat(m.EUR)||Go.EUR},updatedAt:et(),updatedBy:(c==null?void 0:c.uid)||null},{merge:!0}),e({USD:1,GBP:parseFloat(m.GBP)||Go.GBP,EUR:parseFloat(m.EUR)||Go.EUR}),r(new Date),l(!1),!0}catch(g){throw console.error("Failed to update exchange rates:",g),l(!1),g}},[c]),f=b.useCallback((m,g)=>{if(!m||m<=0)return 0;const y=t[g]||1;return Math.round(m*y)},[t]),p=b.useCallback((m,g)=>{if(!m||m<=0)return 0;const y=t[g]||1;return Math.round(m/y)},[t]);return{rates:t,lastUpdated:n,loading:s,saving:a,updateRate:d,updateAllRates:h,convertToUSD:f,convertFromUSD:p,refetch:u,DEFAULT_RATES:Go}}function Ede({leftPanel:t,rightPanel:e,defaultLeftWidth:n=50,minLeftWidth:r=20,maxLeftWidth:s=80,storageKey:i=null}){const[a,l]=b.useState(()=>{if(i){const m=localStorage.getItem(i);if(m)return parseFloat(m)}return n}),[c,u]=b.useState(!1),d=b.useRef(null),h=b.useCallback(m=>{m.preventDefault(),u(!0)},[]),f=b.useCallback(m=>{if(!c||!d.current)return;const y=d.current.getBoundingClientRect(),w=(m.clientX-y.left)/y.width*100,N=Math.min(s,Math.max(r,w));l(N),i&&localStorage.setItem(i,N.toString())},[c,r,s,i]),p=b.useCallback(()=>{u(!1)},[]);return b.useEffect(()=>(c&&(document.addEventListener("mousemove",f),document.addEventListener("mouseup",p),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",p),document.body.style.cursor="",document.body.style.userSelect=""}),[c,f,p]),o.jsxs("div",{ref:d,className:`resizable-panels ${c?"is-dragging":""}`,children:[o.jsx("div",{className:"resizable-panel resizable-panel-left",style:{width:`${a}%`},children:t}),o.jsx("div",{className:"resizable-handle",onMouseDown:h,children:o.jsx("div",{className:"resizable-handle-bar",children:o.jsxs("div",{className:"resizable-handle-dots",children:[o.jsx("span",{}),o.jsx("span",{}),o.jsx("span",{})]})})}),o.jsx("div",{className:"resizable-panel resizable-panel-right",style:{width:`${100-a}%`},children:e})]})}function ut({isOpen:t,onClose:e,title:n,children:r,footer:s,size:i="medium"}){return b.useEffect(()=>{const a=l=>{l.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",a),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",a),document.body.style.overflow=""}},[t,e]),t?o.jsx("div",{className:"modal-overlay",onClick:e,children:o.jsxs("div",{className:`modal modal-${i}`,onClick:a=>a.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{className:"modal-title",children:n}),o.jsx("button",{className:"modal-close",onClick:e,children:""})]}),o.jsx("div",{className:"modal-body",children:r}),s&&o.jsx("div",{className:"modal-footer",children:s})]})}):null}function JH(t){const[e,n]=b.useState([]),[r,s]=b.useState(!0),[i,a]=b.useState(null),{user:l}=Xi();b.useEffect(()=>{if(!t){n([]),s(!1);return}const f=Wi(fr(ke,"contacts",t,"activities"),qr("date","desc")),p=Nh(f,m=>{const g=m.docs.map(y=>({id:y.id,...y.data()}));n(g),s(!1)},m=>{console.error("Activities error:",m),a(m),s(!1)});return()=>p()},[t]);const c=b.useCallback(async f=>{var g,y;if(!t)throw new Error("No contact ID");let p=null;if(((g=f.linkedHelicopters)==null?void 0:g.length)>0){const x=await us(We(ke,"contacts",t));if(x.exists()){const w=x.data();p={id:t,firstName:w.firstName,lastName:w.lastName,company:w.company,email:w.email}}}const m=await ku(fr(ke,"contacts",t,"activities"),{...f,date:f.date||et(),createdBy:(l==null?void 0:l.uid)||null,createdByName:(l==null?void 0:l.displayName)||(l==null?void 0:l.email)||"Unknown",createdAt:et()});if(["call","email","meeting"].includes(f.type)&&await _t(We(ke,"contacts",t),{"followUp.lastContactedDate":et(),updatedAt:et()}),((y=f.linkedHelicopters)==null?void 0:y.length)>0&&p){const x={id:`proposal_${Date.now()}`,contactId:t,contactName:`${p.firstName} ${p.lastName}`,contactCompany:p.company||null,activityId:m.id,activityType:f.type,activityTitle:f.title,proposedAt:new Date().toISOString(),proposedBy:(l==null?void 0:l.displayName)||(l==null?void 0:l.email)||"Unknown",outcome:f.proposalOutcome||"pending",notes:f.description||null};for(const w of f.linkedHelicopters)try{await _t(We(ke,"helicopters",w.id),{proposalHistory:gu(x),updatedAt:et()})}catch(N){console.error(`Failed to update helicopter ${w.id} proposal history:`,N)}}return m.id},[t,l]),u=b.useCallback(async(f,p)=>{if(!t)throw new Error("No contact ID");await _t(We(ke,"contacts",t,"activities",f),{...p,updatedAt:et()})},[t]),d=b.useCallback(async f=>{if(!t)throw new Error("No contact ID");await wh(We(ke,"contacts",t,"activities",f))},[t]),h=b.useCallback(async(f,p,m="")=>c({type:f,title:p,description:m,date:et()}),[c]);return{activities:e,loading:r,error:i,addActivity:c,updateActivity:u,deleteActivity:d,logQuickActivity:h}}function Yb({isOpen:t,onClose:e,onSuccess:n,contactId:r,contactName:s,linkedHelicopter:i=null,relationshipType:a=null}){const[l,c]=b.useState("call"),[u,d]=b.useState(""),[h,f]=b.useState(""),[p,m]=b.useState(!1),{addActivity:g}=JH(r),{markAsContacted:y}=Ia(),{success:x,error:w}=qt(),N=[{value:"call",label:"Phone Call",icon:""},{value:"email",label:"Email",icon:""},{value:"meeting",label:"Meeting",icon:""},{value:"message",label:"Message/Text",icon:""}],S={potential_buyer:"Potential Buyer",previous_owner:"Previous Owner",enquiry:"Enquiry",broker:"Broker / Agent",other:"Other"},C=async()=>{if(!u.trim()){w("Please enter a summary of the contact");return}m(!0);try{const j={type:l,title:u.trim(),description:h.trim()||null,date:new Date};i&&(j.linkedHelicopters=[{id:i.id,registration:i.registration,displayName:`${i.year||""} ${i.manufacturer||""} ${i.model||""}`.trim(),relationshipType:a||null,relationshipLabel:a?S[a]:null}]),await g(j),await y(r),x(i?`Mention logged for ${i.registration}`:"Contact logged successfully"),n==null||n({contactType:l,summary:u.trim(),notes:h.trim()}),A()}catch(j){console.error("Failed to log contact:",j),w("Failed to log contact")}finally{m(!1)}},A=()=>{c("call"),d(""),f(""),e()};return o.jsx(ut,{isOpen:t,onClose:A,title:"Log Contact",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:A,children:"Cancel"}),o.jsx(K,{onClick:C,loading:p,children:"Log Contact"})]}),children:o.jsxs("div",{className:"mark-contacted-modal",children:[o.jsxs("p",{className:"modal-intro",children:["Log your interaction with ",o.jsx("strong",{children:s}),i&&o.jsxs(o.Fragment,{children:[" regarding ",o.jsx("strong",{children:i.registration})]})]}),i&&o.jsxs("div",{className:"linked-aircraft-badge",children:[o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})}),o.jsxs("span",{children:[i.year," ",i.manufacturer," ",i.model]}),o.jsx("span",{className:"aircraft-reg-tag",children:i.registration}),a&&o.jsx("span",{className:`relationship-tag relationship-${a}`,children:S[a]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"How did you contact them?"}),o.jsx("div",{className:"contact-type-grid",children:N.map(j=>o.jsxs("button",{type:"button",className:`contact-type-option ${l===j.value?"selected":""}`,onClick:()=>c(j.value),children:[o.jsx("span",{className:"contact-type-icon",children:j.icon}),o.jsx("span",{className:"contact-type-label",children:j.label})]},j.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Summary *"}),o.jsx("input",{type:"text",className:"form-input",placeholder:"Brief summary of the conversation...",value:u,onChange:j=>d(j.target.value),autoFocus:!0}),o.jsx("p",{className:"form-help",children:'e.g., "Discussed R44 availability, sending specs"'})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Notes (optional)"}),o.jsx("textarea",{className:"form-textarea",rows:3,placeholder:"Additional details, follow-up actions, etc...",value:h,onChange:j=>f(j.target.value)})]})]})})}const ZH=[{value:"individual",label:"Individual"},{value:"business",label:"Business"}],Iu=[{value:"prospect",label:"Prospect",color:"#3b82f6"},{value:"active_buyer",label:"Active Buyer",color:"#22c55e"},{value:"past_buyer",label:"Past Buyer",color:"#8b5cf6"},{value:"seller",label:"Seller",color:"#f59e0b"},{value:"broker",label:"Broker",color:"#06b6d4"},{value:"inactive",label:"Inactive",color:"#6b7280"}],Sv=[{value:"website_enquiry",label:"Website Enquiry"},{value:"referral",label:"Referral"},{value:"trade_show",label:"Trade Show"},{value:"cold_outreach",label:"Cold Outreach"},{value:"repeat_customer",label:"Repeat Customer"},{value:"other",label:"Other"}],_v=[{value:"immediate",label:"Immediate (ready to buy)"},{value:"1_3_months",label:"1-3 Months"},{value:"3_6_months",label:"3-6 Months"},{value:"6_12_months",label:"6-12 Months"},{value:"exploring",label:"Just Exploring"}],eW=[{value:"first_time",label:"First-Time Buyer",description:"No previous aircraft ownership"},{value:"upgrading",label:"Upgrading",description:"Current owner looking to upgrade"},{value:"adding",label:"Adding to Fleet",description:"Expanding existing fleet"},{value:"replacing",label:"Replacing",description:"Replacing current aircraft"},{value:"downsizing",label:"Downsizing",description:"Moving to smaller/simpler aircraft"},{value:"other",label:"Other",description:"Other situation"}],SI=[{value:"urgent",label:"Urgent",color:"#ef4444"},{value:"normal",label:"Normal",color:"#3b82f6"},{value:"low",label:"Low",color:"#6b7280"}],tW=[{value:"call",label:"Phone Call",icon:"phone"},{value:"email",label:"Email",icon:"mail"},{value:"meeting",label:"Meeting",icon:"users"},{value:"note",label:"Note",icon:"file-text"},{value:"enquiry",label:"Enquiry",icon:"message-circle"},{value:"follow_up",label:"Follow-up",icon:"clock"},{value:"purchase",label:"Purchase",icon:"check-circle"}],nW=[{value:"GBP",label:"GBP ()",symbol:""},{value:"USD",label:"USD ($)",symbol:"$"},{value:"EUR",label:"EUR ()",symbol:""}],TC=[{value:"high",label:"High Interest"},{value:"medium",label:"Medium Interest"},{value:"low",label:"Low Interest"}],kN=[{value:"high",label:"High Interest",color:"#22c55e",description:"Ready to buy, actively searching"},{value:"medium",label:"Medium Interest",color:"#f59e0b",description:"Interested but not urgent"},{value:"low",label:"Low Interest",color:"#9ca3af",description:"Minimal engagement"},{value:"unknown",label:"Unknown",color:"#6b7280",description:"Not yet assessed"}],Cde=[{value:"any",label:"Any (New or Used)"},{value:"new_only",label:"New Only"},{value:"used_only",label:"Used Only"},{value:"prefers_new",label:"Prefers New"},{value:"prefers_used",label:"Prefers Used"}],AC=[{value:"either",label:"New or Used"},{value:"new",label:"New Only"},{value:"used",label:"Used Only"}],Tm=[{value:"VIP",label:"VIP",category:"priority"},{value:"Priority",label:"Priority",category:"priority"},{value:"Hot Lead",label:"Hot Lead",category:"priority"},{value:"Cash Buyer",label:"Cash Buyer",category:"buyer"},{value:"Finance Buyer",label:"Finance Buyer",category:"buyer"},{value:"First Time Buyer",label:"First Time Buyer",category:"buyer"},{value:"Repeat Buyer",label:"Repeat Buyer",category:"buyer"},{value:"Fleet Buyer",label:"Fleet Buyer",category:"buyer"},{value:"New Aircraft",label:"New Aircraft",category:"interest"},{value:"Used Aircraft",label:"Used Aircraft",category:"interest"},{value:"Part Exchange",label:"Part Exchange",category:"interest"},{value:"Training",label:"Training",category:"interest"},{value:"Charter",label:"Charter",category:"interest"},{value:"UK Based",label:"UK Based",category:"region"},{value:"European",label:"European",category:"region"},{value:"International",label:"International",category:"region"},{value:"Export",label:"Export",category:"region"},{value:"Long Term",label:"Long Term",category:"relationship"},{value:"Key Account",label:"Key Account",category:"relationship"},{value:"Referred",label:"Referred",category:"relationship"}];function rW(t){const e=Iu.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function sW(t){const e=Iu.find(n=>n.value===t);return(e==null?void 0:e.color)||"#6b7280"}function Tde(t){const e=Sv.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function _I(t){const e=_v.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function Ade(t){const e=SI.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function kde(t){const e=SI.find(n=>n.value===t);return(e==null?void 0:e.color)||"#6b7280"}function Ide(t){const e=tW.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function Pde(t){const e=eW.find(n=>n.value===t);return(e==null?void 0:e.label)||t}function Ode(t){const e={highly_motivated:"High Interest",very_interested:"High Interest",interested:"Medium Interest",casual:"Medium Interest"};if(e[t])return e[t];const n=kN.find(r=>r.value===t);return(n==null?void 0:n.label)||t||"Unknown"}const Dde=["type","firstName","lastName","email","phone","jobTitle","companyName","companyEmail","companyPhone","companyWebsite","city","country","region","status","source","sourceDetails","timeline","budgetMin","budgetMax","budgetCurrency","aircraftInterests","assignedTo","tags","notes"],Rde=`type,firstName,lastName,email,phone,jobTitle,companyName,companyEmail,companyPhone,companyWebsite,city,country,region,status,source,sourceDetails,timeline,budgetMin,budgetMax,budgetCurrency,aircraftInterests,assignedTo,tags,notes
business,John,Smith,john@acmeaviation.com,+44 7700 900123,Fleet Manager,Acme Aviation Ltd,info@acmeaviation.com,+44 20 1234 5678,https://acmeaviation.com,London,United Kingdom,England,prospect,website_enquiry,,1_3_months,500000,800000,GBP,Robinson R66 high;Airbus H125 medium,Alex,VIP;Priority,Looking for fleet expansion
individual,Jane,Doe,jane.doe@email.com,+1 555 123 4567,Private Buyer,,,,New York,United States,NY,active_buyer,referral,Referred by Bob Jones,immediate,200000,350000,USD,Robinson R44 high,Sarah,Cash Buyer,Ready to purchase - prefers low hours`,GM=Dde.join(",");function Qb({isOpen:t,onClose:e,onSelect:n,title:r="Select Contact",allowCreate:s=!0}){const[i,a]=b.useState(""),[l,c]=b.useState("all"),[u,d]=b.useState(!1),[h,f]=b.useState(!1),{createContact:p}=Ia(),{data:m,loading:g}=pn("contacts",[qr("lastName")]),[y,x]=b.useState({contactType:"individual",firstName:"",lastName:"",email:"",phone:"",companyName:"",companyEmail:"",companyPhone:"",jobTitle:""}),w=m.filter(E=>{if(l!=="all"&&(E.contactType||"individual")!==l)return!1;if(!i)return!0;const I=i.toLowerCase(),T=`${E.firstName} ${E.lastName}`.toLowerCase(),P=(E.email||"").toLowerCase(),O=(E.companyName||E.company||"").toLowerCase();return T.includes(I)||P.includes(I)||O.includes(I)}),N=E=>{const I=E.companyName||E.company||null;n({id:E.id,firstName:E.firstName,lastName:E.lastName,email:E.email,company:I,companyName:I,contactType:E.contactType||"individual"}),e(),a("")},S=E=>{const{name:I,value:T}=E.target;x(P=>({...P,[I]:T}))},C=async()=>{const E=y.contactType==="business";if(!(E&&!y.companyName.trim())&&!(!y.firstName.trim()||!y.lastName.trim())){f(!0);try{const I={contactType:y.contactType,firstName:y.firstName,lastName:y.lastName,email:y.email,phone:y.phone,status:"active_buyer",source:"other",timeline:"immediate"};E?(I.companyName=y.companyName,I.companyEmail=y.companyEmail,I.companyPhone=y.companyPhone,I.jobTitle=y.jobTitle):I.companyName=y.companyName;const T=await p(I);n({id:T,firstName:y.firstName,lastName:y.lastName,email:y.email,company:y.companyName,contactType:y.contactType}),e(),a(""),d(!1),x({contactType:"individual",firstName:"",lastName:"",email:"",phone:"",companyName:"",companyEmail:"",companyPhone:"",jobTitle:""})}catch(I){console.error("Failed to create contact:",I)}finally{f(!1)}}},A=()=>{a(""),c("all"),d(!1),x({contactType:"individual",firstName:"",lastName:"",email:"",phone:"",companyName:"",companyEmail:"",companyPhone:"",jobTitle:""}),e()},j=y.contactType==="business",_=()=>{l!=="all"&&x(E=>({...E,contactType:l})),d(!0)};return o.jsx(ut,{isOpen:t,onClose:A,title:r,size:"medium",children:o.jsx("div",{className:"contact-picker",children:u?o.jsx(o.Fragment,{children:o.jsxs("div",{className:"picker-create-form",children:[o.jsx("button",{className:"back-button",onClick:()=>d(!1),children:" Back to search"}),o.jsxs("div",{className:"picker-type-toggle",children:[o.jsxs("button",{type:"button",className:`type-toggle-btn ${j?"":"active"}`,onClick:()=>x(E=>({...E,contactType:"individual"})),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Individual"]}),o.jsxs("button",{type:"button",className:`type-toggle-btn ${j?"active":""}`,onClick:()=>x(E=>({...E,contactType:"business"})),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),o.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Business"]})]}),j&&o.jsxs("div",{className:"form-section-compact",children:[o.jsx("h4",{children:"Business Details"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Company Name *",name:"companyName",value:y.companyName,onChange:S,placeholder:"Company name",required:!0}),o.jsx(ye,{label:"Company Email",name:"companyEmail",type:"email",value:y.companyEmail,onChange:S,placeholder:"info@company.com"}),o.jsx(ye,{label:"Company Phone",name:"companyPhone",value:y.companyPhone,onChange:S,placeholder:"Main phone"})]})]}),o.jsxs("div",{className:"form-section-compact",children:[o.jsx("h4",{children:j?"Primary Contact Person":"Contact Details"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"First Name *",name:"firstName",value:y.firstName,onChange:S,placeholder:"First name",required:!0}),o.jsx(ye,{label:"Last Name *",name:"lastName",value:y.lastName,onChange:S,placeholder:"Last name",required:!0}),o.jsx(ye,{label:"Email",name:"email",type:"email",value:y.email,onChange:S,placeholder:"email@example.com"}),o.jsx(ye,{label:"Phone",name:"phone",value:y.phone,onChange:S,placeholder:"Phone number"}),j&&o.jsx(ye,{label:"Job Title",name:"jobTitle",value:y.jobTitle,onChange:S,placeholder:"e.g., Fleet Manager"}),!j&&o.jsx(ye,{label:"Company (optional)",name:"companyName",value:y.companyName,onChange:S,placeholder:"If affiliated with a company"})]})]}),o.jsxs("div",{className:"picker-create-actions",children:[o.jsx(K,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),o.jsx(K,{onClick:C,loading:h,disabled:!y.firstName.trim()||!y.lastName.trim()||j&&!y.companyName.trim(),children:"Create & Select"})]})]})}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"picker-type-filter",children:[o.jsx("button",{type:"button",className:`type-filter-btn ${l==="all"?"active":""}`,onClick:()=>c("all"),children:"All"}),o.jsxs("button",{type:"button",className:`type-filter-btn ${l==="individual"?"active":""}`,onClick:()=>c("individual"),children:[o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Individual"]}),o.jsxs("button",{type:"button",className:`type-filter-btn ${l==="business"?"active":""}`,onClick:()=>c("business"),children:[o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),o.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Business"]})]}),o.jsx("div",{className:"picker-search",children:o.jsx("input",{type:"text",value:i,onChange:E=>a(E.target.value),className:"form-input",placeholder:"Search contacts by name, email, or company...",autoFocus:!0})}),o.jsx("div",{className:"picker-results",children:g?o.jsx("p",{className:"text-muted",children:"Loading contacts..."}):w.length===0?o.jsxs("div",{className:"picker-empty",children:[o.jsx("p",{children:"No contacts found"}),s&&o.jsx(K,{variant:"secondary",size:"small",onClick:_,children:"Create New Contact"})]}):o.jsx("div",{className:"picker-list",children:w.map(E=>{const I=E.contactType||"individual",T=E.companyName||E.company;return o.jsxs("button",{className:"picker-item",onClick:()=>N(E),children:[o.jsxs("div",{className:"picker-item-main",children:[o.jsx("span",{className:`picker-item-type-icon ${I}`,children:I==="business"?o.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),o.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}):o.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),o.jsxs("div",{className:"picker-item-names",children:[I==="business"&&T&&o.jsx("span",{className:"picker-item-company-name",children:T}),o.jsxs("span",{className:`picker-item-name ${I==="business"?"secondary":""}`,children:[E.firstName," ",E.lastName,I==="business"&&E.jobTitle&&o.jsxs("span",{className:"picker-item-title",children:["  ",E.jobTitle]})]})]})]}),o.jsxs("div",{className:"picker-item-secondary",children:[E.email&&o.jsx("span",{className:"picker-item-email",children:E.email}),o.jsx("span",{className:"status-badge status-badge-small",style:{backgroundColor:sW(E.status)},children:rW(E.status)})]})]},E.id)})})}),s&&w.length>0&&o.jsx("div",{className:"picker-footer",children:o.jsxs(K,{variant:"secondary",size:"small",onClick:_,children:["Create New ",l==="business"?"Business":"Contact"]})})]})})})}function jI({contactId:t,currentStatus:e,onStatusChange:n,compact:r=!1}){const[s,i]=b.useState(!1),[a,l]=b.useState(!1),[c,u]=b.useState(""),[d,h]=b.useState("#6b7280"),[f,p]=b.useState(!1),[m,g]=b.useState({top:0,left:0}),y=b.useRef(null),x=b.useRef(null),{success:w,error:N}=qt(),{update:S}=Ms("contacts"),{data:C}=pn("settings"),A=C.find(L=>L.id==="contactStatuses"),j=(A==null?void 0:A.customStatuses)||[],{create:_,update:E}=Ms("settings"),I=[...Iu,...j.map(L=>({value:L.value,label:L.label,color:L.color,isCustom:!0}))],T=()=>{if(y.current){const L=y.current.getBoundingClientRect(),B=window.innerHeight-L.bottom,$=L.top,q=300;B<q&&$>B?g({top:L.top-q,left:L.left}):g({top:L.bottom+4,left:L.left})}};b.useEffect(()=>{const L=$=>{x.current&&!x.current.contains($.target)&&y.current&&!y.current.contains($.target)&&(i(!1),l(!1))},B=()=>{s&&T()};return document.addEventListener("mousedown",L),window.addEventListener("scroll",B,!0),window.addEventListener("resize",B),()=>{document.removeEventListener("mousedown",L),window.removeEventListener("scroll",B,!0),window.removeEventListener("resize",B)}},[s]);const P=L=>{L.stopPropagation(),s||T(),i(!s)},O=async L=>{if(L.value===e){i(!1);return}p(!0);try{await S(t,{status:L.value,updatedAt:new Date}),n==null||n(L.value),w(`Status changed to ${L.label}`),i(!1)}catch(B){console.error("Failed to update status:",B),N("Failed to update status")}finally{p(!1)}},H=async()=>{if(!c.trim()){N("Please enter a status name");return}const L=c.toLowerCase().replace(/\s+/g,"_");if(I.find(B=>B.value===L)){N("A status with this name already exists");return}p(!0);try{const B={value:L,label:c.trim(),color:d},$=[...j,B];A?await E("contactStatuses",{customStatuses:$,updatedAt:new Date}):await _({id:"contactStatuses",customStatuses:$,createdAt:new Date}),w(`Custom status "${c}" added`),u(""),h("#6b7280"),l(!1),await O(B)}catch(B){console.error("Failed to add custom status:",B),N("Failed to add custom status")}finally{p(!1)}},X=I.find(L=>L.value===e)||{label:e,color:"#6b7280"},se=["#3b82f6","#22c55e","#8b5cf6","#f59e0b","#06b6d4","#ef4444","#ec4899","#6b7280"];return o.jsxs("div",{className:"contact-status-selector",children:[o.jsxs("button",{ref:y,type:"button",className:`status-selector-trigger ${r?"compact":""} ${s?"open":""}`,style:{backgroundColor:X.color},onClick:P,disabled:f,children:[o.jsx("span",{className:"status-label",children:X.label}),o.jsx("svg",{className:`status-chevron ${s?"rotated":""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),s&&o.jsx("div",{ref:x,className:"contact-status-dropdown",style:{top:m.top,left:m.left},onClick:L=>L.stopPropagation(),children:a?o.jsxs("div",{className:"add-custom-form",children:[o.jsxs("div",{className:"add-custom-header",children:[o.jsxs("button",{type:"button",className:"back-btn",onClick:()=>l(!1),children:[o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back"]}),o.jsx("span",{children:"Add Custom Status"})]}),o.jsxs("div",{className:"add-custom-body",children:[o.jsx("input",{type:"text",className:"form-input",placeholder:"Status name...",value:c,onChange:L=>u(L.target.value),autoFocus:!0}),o.jsxs("div",{className:"color-picker",children:[o.jsx("span",{className:"color-label",children:"Color:"}),o.jsx("div",{className:"color-options",children:se.map(L=>o.jsx("button",{type:"button",className:`color-option ${d===L?"selected":""}`,style:{backgroundColor:L},onClick:()=>h(L)},L))})]}),o.jsx("button",{type:"button",className:"btn btn-primary btn-small btn-full",onClick:H,disabled:f||!c.trim(),children:f?"Adding...":"Add Status"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"status-dropdown-section",children:[o.jsx("div",{className:"status-dropdown-header",children:"Status"}),I.map(L=>o.jsxs("button",{type:"button",className:`status-option ${L.value===e?"selected":""}`,onClick:()=>O(L),children:[o.jsx("span",{className:"status-color-dot",style:{backgroundColor:L.color}}),o.jsx("span",{className:"status-option-label",children:L.label}),L.isCustom&&o.jsx("span",{className:"status-custom-badge",children:"Custom"}),L.value===e&&o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})]},L.value))]}),o.jsx("div",{className:"status-dropdown-footer",children:o.jsxs("button",{type:"button",className:"add-custom-btn",onClick:()=>l(!0),children:[o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Custom Status"]})})]})})]})}function iW(){const[t,e]=b.useState({defaultPercentage:5,minimumCommission:0,currency:"USD",enableBrokerSplit:!1,defaultSplitPercentage:50,tiers:[]}),[n,r]=b.useState(!0);b.useEffect(()=>{(async()=>{r(!0);try{const h=We(ke,"settings","commission"),f=await us(h);f.exists()&&e(p=>({...p,...f.data()}))}catch(h){console.error("Error fetching commission settings:",h)}r(!1)})()},[]);const s=async d=>{try{const h=We(ke,"settings","commission"),f={...t,...d};return await mu(h,f,{merge:!0}),e(f),!0}catch(h){return console.error("Error updating commission settings:",h),!1}},i=async d=>s({defaultPercentage:d}),a=(d,h=null)=>{var m;if(!d||d<=0)return typeof h=="object"&&h!==null?{total:0,yourShare:0,otherShare:0,effectiveRate:0}:0;let f=0;if(h)if(h.type==="fixed")f=h.value||0;else if(h.type==="percentage")f=d*(h.value||0)/100;else if(h.type==="tiered"&&((m=t.tiers)==null?void 0:m.length)>0){const g=t.tiers.find(y=>d>=y.minPrice&&d<y.maxPrice);g?f=d*g.percentage/100:f=d*t.defaultPercentage/100}else f=d*t.defaultPercentage/100;else f=d*t.defaultPercentage/100;t.minimumCommission>0&&f<t.minimumCommission&&(f=t.minimumCommission);const p=h==null?void 0:h.brokerSplit;if(p!=null&&p.enabled){const g=p.percentage||t.defaultSplitPercentage||50,y=f*(g/100),x=f-y;if(typeof h=="object")return{total:f,yourShare:y,otherShare:x,otherBroker:p.otherBroker||"Co-Broker",effectiveRate:f/d*100}}return h===null||typeof h!="object"||!h.detailed?f:{total:f,yourShare:f,otherShare:0,effectiveRate:f/d*100}};return{settings:t,loading:n,updateSettings:s,updateDefaultPercentage:i,calculateCommission:a,getCommissionPreview:(d,h=null)=>{const f=a(d,h?{...h,detailed:!0}:{detailed:!0});return{total:f.total||f,yourShare:f.yourShare||f,otherShare:f.otherShare||0,effectiveRate:d>0?(f.total||f)/d*100:0}},formatCurrency:d=>new Intl.NumberFormat("en-US",{style:"currency",currency:t.currency,minimumFractionDigits:0,maximumFractionDigits:0}).format(d),formatCurrencyPrecise:d=>new Intl.NumberFormat("en-US",{style:"currency",currency:t.currency,minimumFractionDigits:2,maximumFractionDigits:2}).format(d)}}const aW={USD:1,GBP:1.27,EUR:1.08};function KM(t,e){if(!t||t<=0)return 0;const n=aW[e];return n?Math.round(t*n):(console.warn(`Unknown currency: ${e}, returning original amount`),t)}function YM(t){return aW[t]||1}const oW={manufacturer:{required:!0,message:"Manufacturer is required"},model:{required:!0,message:"Model is required"},year:{required:!0,min:1950,max:new Date().getFullYear()+1,message:"Year must be between 1950 and next year"},totalHours:{required:!0,min:0,max:1e5,message:"Total hours must be between 0 and 100,000"},engineHours:{required:!1,min:0,max:1e5,message:"Engine hours must be between 0 and 100,000"},condition:{required:!0,allowedValues:["excellent","good","fair","project"],message:"Condition must be excellent, good, fair, or project"},salePrice:{required:!0,min:1e3,max:5e7,message:"Sale price must be between $1,000 and $50,000,000"},askingPrice:{required:!1,min:1e3,max:5e7,message:"Asking price must be between $1,000 and $50,000,000"},currency:{required:!0,allowedValues:["GBP","USD","EUR"],message:"Currency must be GBP, USD, or EUR"},saleDate:{required:!0,maxFutureDays:0,maxPastDays:20*365,message:"Sale date must be within the last 20 years and not in the future"},region:{required:!0,allowedValues:["UK","US","EU","Asia","Other"],message:"Region must be UK, US, EU, Asia, or Other"},source:{required:!0,allowedValues:["internal","market_data","manual_entry"],message:"Source must be internal, market_data, or manual_entry"},daysOnMarket:{required:!1,min:0,max:3650,message:"Days on market must be between 0 and 3650 (10 years)"}};function lW(t,e){const n=oW[t];if(!n)return null;if(n.required&&(e==null||e===""))return n.message||`${t} is required`;if(e==null||e==="")return null;if(n.min!==void 0&&typeof e=="number"&&e<n.min||n.max!==void 0&&typeof e=="number"&&e>n.max||n.allowedValues&&!n.allowedValues.includes(e))return n.message;if(t==="saleDate"&&e){const r=e instanceof Date?e:new Date(e),i=(new Date-r)/(1e3*60*60*24);if(n.maxFutureDays!==void 0&&i<-n.maxFutureDays)return"Sale date cannot be in the future";if(n.maxPastDays!==void 0&&i>n.maxPastDays)return"Sale date must be within the last 20 years"}return null}function cW(t){const e={};return Object.keys(oW).forEach(n=>{const r=lW(n,t[n]);r&&(e[n]=r)}),t.askingPrice&&t.salePrice&&t.salePrice>t.askingPrice*1.5&&(e.salePrice="Sale price seems too high compared to asking price"),t.engineHours&&t.totalHours&&t.engineHours>t.totalHours&&(e.engineHours="Engine hours cannot exceed total hours"),{isValid:Object.keys(e).length===0,errors:e}}function Mde(t,e){if(!e||e.length<5)return{isOutlier:!1,reason:null,zScore:0};const n=e.reduce((a,l)=>a+l,0)/e.length,r=e.reduce((a,l)=>a+Math.pow(l-n,2),0)/e.length,s=Math.sqrt(r);if(s===0)return{isOutlier:!1,reason:null,zScore:0};const i=Math.abs(t-n)/s;if(i>3){const a=t>n?"above":"below";return{isOutlier:!0,reason:`Price is ${i.toFixed(1)} standard deviations ${a} the mean ($${Math.round(n).toLocaleString()})`,zScore:i}}return{isOutlier:!1,reason:null,zScore:i}}const Ai="pricing_sales";function IN(){const[t,e]=b.useState(!1),{user:n}=Xi(),r=b.useCallback(async h=>{var f;e(!0);try{const{isValid:p,errors:m}=cW(h);if(!p)throw new Error(`Validation failed: ${Object.values(m).join(", ")}`);const g=KM(h.salePrice,h.currency),y=YM(h.currency),x=await Lde(h.manufacturer,h.model),w=Mde(g,x),N={manufacturer:h.manufacturer,model:h.model,year:parseInt(h.year),serialNumber:h.serialNumber||"",registration:((f=h.registration)==null?void 0:f.toUpperCase())||"",totalHours:parseInt(h.totalHours)||0,engineHours:parseInt(h.engineHours)||null,engineTBO:parseInt(h.engineTBO)||null,condition:h.condition,askingPrice:h.askingPrice?parseInt(h.askingPrice):null,salePrice:parseInt(h.salePrice),currency:h.currency,priceUSD:g,exchangeRateUsed:y,saleDate:h.saleDate,daysOnMarket:h.daysOnMarket?parseInt(h.daysOnMarket):null,region:h.region,country:h.country||"",source:h.source,sourceDetails:h.sourceDetails||"",helicopterId:h.helicopterId||null,isVerified:h.isVerified||!1,equipment:h.equipment||[],avionics:h.avionics||[],hasIFR:(h.avionics||[]).some(C=>C.toLowerCase().includes("ifr"))||(h.equipment||[]).includes("IFR Equipped"),hasAirCon:(h.equipment||[]).includes("Air Conditioning"),isOutlier:w.isOutlier,outlierReason:w.reason,reviewStatus:w.isOutlier?"pending":"approved",reviewedBy:w.isOutlier?null:n==null?void 0:n.uid,reviewedAt:w.isOutlier?null:et(),notes:h.notes||"",createdAt:et(),updatedAt:et(),createdBy:n==null?void 0:n.uid,lastModifiedBy:n==null?void 0:n.uid},S=await ku(fr(ke,Ai),N);return ds({action:"pricing_sales.create",resourceType:Ai,resourceId:S.id,resourceName:`${h.year} ${h.manufacturer} ${h.model}`}),e(!1),{id:S.id,isOutlier:w.isOutlier}}catch(p){throw e(!1),p}},[n]),s=b.useCallback(async(h,f)=>{e(!0);try{let p={...f};f.salePrice&&f.currency&&(p.priceUSD=KM(f.salePrice,f.currency),p.exchangeRateUsed=YM(f.currency)),(f.equipment||f.avionics)&&(p.hasIFR=(f.avionics||[]).some(m=>m.toLowerCase().includes("ifr"))||(f.equipment||[]).includes("IFR Equipped"),p.hasAirCon=(f.equipment||[]).includes("Air Conditioning")),p.updatedAt=et(),p.lastModifiedBy=n==null?void 0:n.uid,await _t(We(ke,Ai,h),p),ds({action:"pricing_sales.update",resourceType:Ai,resourceId:h,changes:f}),e(!1)}catch(p){throw e(!1),p}},[n]),i=b.useCallback(async(h,f=null)=>{e(!0);try{await wh(We(ke,Ai,h)),ds({action:"pricing_sales.delete",resourceType:Ai,resourceId:h,resourceName:f}),e(!1)}catch(p){throw e(!1),p}},[]),a=b.useCallback(async h=>{e(!0);try{await _t(We(ke,Ai,h),{reviewStatus:"approved",reviewedBy:n==null?void 0:n.uid,reviewedAt:et(),updatedAt:et(),lastModifiedBy:n==null?void 0:n.uid}),ds({action:"pricing_sales.approve",resourceType:Ai,resourceId:h}),e(!1)}catch(f){throw e(!1),f}},[n]),l=b.useCallback(async(h,f="")=>{e(!0);try{await _t(We(ke,Ai,h),{reviewStatus:"rejected",reviewedBy:n==null?void 0:n.uid,reviewedAt:et(),notes:f,updatedAt:et(),lastModifiedBy:n==null?void 0:n.uid}),ds({action:"pricing_sales.reject",resourceType:Ai,resourceId:h}),e(!1)}catch(p){throw e(!1),p}},[n]),c=b.useCallback(async(h,f)=>{var g,y,x,w;const p=N=>{if(!N)return"good";const S=N.toLowerCase();return["excellent","good","fair","project"].includes(S)?S:S.includes("excel")||S.includes("mint")||S.includes("new")?"excellent":S.includes("fair")||S.includes("average")?"fair":S.includes("project")||S.includes("needs work")?"project":"good"},m={manufacturer:h.manufacturer,model:h.model,year:parseInt(h.year)||new Date().getFullYear(),serialNumber:h.serialNumber||"",registration:h.registration||"",totalHours:parseInt(h.totalHours)||0,engineHours:(g=h.specs)!=null&&g.engineHours?parseInt(h.specs.engineHours):null,engineTBO:(y=h.specs)!=null&&y.engineTBO?parseInt(h.specs.engineTBO):null,condition:p(h.condition),askingPrice:h.price?parseInt(h.price):null,salePrice:parseInt(f.salePrice),currency:f.currency||h.currency||"GBP",saleDate:new Date,daysOnMarket:Fde(h.createdAt),region:Bde(h.registration),country:Vde(h.registration),source:"internal",sourceDetails:"HQ Aviation Sale",helicopterId:h.id,isVerified:!0,equipment:((x=h.specs)==null?void 0:x.equipment)||h.equipment||[],avionics:((w=h.specs)==null?void 0:w.avionics)||h.avionics||[],notes:f.saleNotes||""};return r(m)},[r]),u=b.useCallback(async h=>{e(!0);const f={success:[],failed:[]};for(const p of h)try{const m=await r(p);f.success.push({...p,id:m.id})}catch(m){f.failed.push({record:p,error:m.message})}return e(!1),f},[r]),d=b.useCallback(async()=>{e(!0);const h={synced:0,skipped:0,failed:0,errors:[]};try{const f=Wi(fr(ke,"helicopters"),ba("status","==","sold")),p=await Io(f),m=Wi(fr(ke,Ai),ba("helicopterId","!=",null)),g=await Io(m),y=new Set(g.docs.map(x=>x.data().helicopterId));for(const x of p.docs){const w={id:x.id,...x.data()};if(y.has(w.id)){h.skipped++;continue}const N=w.salePrice||w.price;if(!N){h.skipped++;continue}try{const S={salePrice:N,saleNotes:w.saleNotes||""};await c(w,S),h.synced++}catch(S){h.failed++,h.errors.push({helicopter:`${w.year} ${w.manufacturer} ${w.model}`,error:S.message})}}ds({action:"pricing_sales.sync",resourceType:Ai,resourceName:`Synced ${h.synced} records`})}catch(f){h.errors.push({error:f.message})}return e(!1),h},[c]);return{loading:t,createSaleRecord:r,updateSaleRecord:s,deleteSaleRecord:i,approveRecord:a,rejectRecord:l,createFromHelicopter:c,bulkImport:u,syncExistingSales:d}}async function Lde(t,e){try{const n=Wi(fr(ke,Ai),ba("manufacturer","==",t),ba("model","==",e),ba("reviewStatus","==","approved"));return(await Io(n)).docs.map(s=>s.data().priceUSD)}catch{return[]}}function Fde(t){if(!t)return null;const e=t.toDate?t.toDate():new Date(t);return Math.floor((new Date-e)/(1e3*60*60*24))}function Bde(t){return t?(t.substring(0,2).toUpperCase(),t.startsWith("G-")?"UK":t.startsWith("N")?"US":["D-","F-","I-","EC-","HB-","OE-","PH-","OO-","LX-"].some(e=>t.startsWith(e))?"EU":["JA-","VH-","ZK-","9V-","HS-","VT-","B-","RP-"].some(e=>t.startsWith(e))?"Asia":"Other"):"Other"}function Vde(t){return t?t.startsWith("G-")?"United Kingdom":t.startsWith("N")?"United States":t.startsWith("D-")?"Germany":t.startsWith("F-")?"France":t.startsWith("I-")?"Italy":t.startsWith("EC-")?"Spain":t.startsWith("HB-")?"Switzerland":t.startsWith("OE-")?"Austria":t.startsWith("PH-")?"Netherlands":t.startsWith("OO-")?"Belgium":t.startsWith("LX-")?"Luxembourg":t.startsWith("JA-")?"Japan":t.startsWith("VH-")?"Australia":t.startsWith("ZK-")?"New Zealand":"":""}function uW({isOpen:t,onClose:e,aircraft:n,onSuccess:r}){const{success:s,error:i}=qt(),{formatCurrency:a}=iW(),{update:l}=Ms("helicopters"),{data:c}=pn("users"),{data:u}=pn("contacts"),{user:d}=Xi(),{createFromHelicopter:h}=IN(),[f,p]=b.useState(!1),[m,g]=b.useState(!1),[y,x]=b.useState(!1),[w,N]=b.useState(null),[S,C]=b.useState(null),[A,j]=b.useState(""),[_,E]=b.useState({salePrice:"",currency:"GBP",buyerName:"",saleNotes:"",attributions:[{name:"",percentage:100}]});b.useEffect(()=>{if(t&&n){E({salePrice:(n==null?void 0:n.price)||"",currency:(n==null?void 0:n.currency)||"GBP",buyerName:"",saleNotes:"",attributions:[{name:"",percentage:100}]}),N(null);const B=(n.ownershipHistory||[]).find($=>$.isCurrentOwner);if(B)if(B.contactId){const $=u.find(q=>q.id===B.contactId);$?(C($),j("")):(C(null),j(B.ownerName||""))}else C(null),j(B.ownerName||"");else n.currentOwnerName?(C(null),j(n.currentOwnerName)):(C(null),j(""))}},[t,n,u]);const I=u.filter(B=>!B.aircraftInterests||!n?!1:B.aircraftInterests.some($=>$.manufacturer===n.manufacturer&&(!$.model||$.model===n.model))).slice(0,5),T=(B,$,q)=>{E(Y=>{const R=[...Y.attributions];return R[B]={...R[B],[$]:q},{...Y,attributions:R}})},P=()=>{E(B=>({...B,attributions:[...B.attributions,{name:"",percentage:0}]}))},O=B=>{_.attributions.length<=1||E($=>({...$,attributions:$.attributions.filter((q,Y)=>Y!==B)}))},H=()=>_.attributions.reduce((B,$)=>B+(parseFloat($.percentage)||0),0),X=()=>{const B=H();if(B===100||_.attributions.length===0)return;const $=_.attributions.length-1,q=parseFloat(_.attributions[$].percentage)||0,Y=100-B;T($,"percentage",Math.max(0,q+Y))},se=()=>parseFloat(_.salePrice)||(n==null?void 0:n.price)||0,L=async()=>{const B=H();if(Math.abs(B-100)>.1){i("Attribution percentages must total 100%");return}if(_.attributions.filter(q=>!q.name.trim()&&q.percentage>0).length>0){i("Please assign a name to all attributions");return}if(!w&&!_.buyerName.trim()){i("Please select or enter a buyer");return}if(!S&&!A.trim()){i("Please select or enter a seller");return}p(!0);try{const q=se(),Y=new Date,R=_.attributions.filter(ge=>ge.percentage>0&&ge.name.trim()).map(ge=>({name:ge.name.trim(),percentage:parseFloat(ge.percentage)})),G=S?`${S.firstName} ${S.lastName}`:A,Z=w?`${w.firstName} ${w.lastName}`:_.buyerName,W=w?{buyerContactId:w.id,buyerContact:{id:w.id,firstName:w.firstName,lastName:w.lastName,email:w.email,company:w.companyName||w.company||null,contactType:w.contactType||"individual"}}:{},U=(n.saleHistory||[]).length+1,pe={contactId:(S==null?void 0:S.id)||null,name:G,company:(S==null?void 0:S.companyName)||(S==null?void 0:S.company)||null},J={id:`sale_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,saleNumber:U,salePrice:q,currency:_.currency,saleDate:Y.toISOString(),recordedAt:Y.toISOString(),recordedBy:{id:(d==null?void 0:d.uid)||null,name:(d==null?void 0:d.displayName)||(d==null?void 0:d.email)||"System"},seller:pe,buyer:{contactId:(w==null?void 0:w.id)||null,name:Z,company:(w==null?void 0:w.companyName)||(w==null?void 0:w.company)||null},attribution:R,notes:_.saleNotes||null};await l(n.id,{status:"sold",soldAt:Y,salePrice:q,saleAttribution:R,buyerName:Z,saleNotes:_.saleNotes||null,...W,saleHistory:gu(J),updatedAt:Y});try{const ge=await h(n,{salePrice:q,currency:_.currency,saleNotes:_.saleNotes||""});console.log("Pricing record created successfully:",ge)}catch(ge){console.error("Failed to create pricing record:",ge),console.error("Aircraft data:",{id:n.id,manufacturer:n.manufacturer,model:n.model,year:n.year,totalHours:n.totalHours,condition:n.condition,price:n.price}),i(`Sale recorded but pricing data failed: ${ge.message}`)}s("Aircraft marked as sold"),r==null||r(),e()}catch(q){console.error("Failed to mark as sold:",q),i("Failed to record sale")}finally{p(!1)}};return n?o.jsxs(o.Fragment,{children:[o.jsx(ut,{isOpen:t,onClose:e,title:"Record Sale",size:"large",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:e,disabled:f,children:"Cancel"}),o.jsx(K,{onClick:L,disabled:f||Math.abs(H()-100)>.1,children:f?"Saving...":"Confirm Sale"})]}),children:o.jsxs("div",{className:"sold-modal-content",children:[o.jsxs("div",{className:"sold-modal-aircraft",children:[o.jsx("span",{className:"aircraft-year",children:n.year}),o.jsxs("span",{className:"aircraft-name",children:[n.manufacturer," ",n.model]}),n.registration&&o.jsx("span",{className:"aircraft-reg",children:n.registration})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Sale Price *"}),o.jsxs("div",{className:"price-currency-input",children:[o.jsxs("select",{className:"currency-select",value:_.currency,onChange:B=>E($=>({...$,currency:B.target.value})),children:[o.jsx("option",{value:"GBP",children:" GBP"}),o.jsx("option",{value:"USD",children:"$ USD"}),o.jsx("option",{value:"EUR",children:" EUR"})]}),o.jsx("input",{type:"number",className:"form-input price-input",value:_.salePrice,onChange:B=>E($=>({...$,salePrice:B.target.value})),placeholder:n.price?`Listed: ${a(n.price)}`:"Enter sale price"})]})]}),o.jsxs("div",{className:"form-grid form-grid-2",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Seller (Previous Owner) *"}),S?o.jsxs("div",{className:"selected-contact-display",children:[o.jsxs("div",{className:"selected-contact-info",children:[o.jsxs("span",{className:"contact-name",children:[S.firstName," ",S.lastName]}),(S.companyName||S.company)&&o.jsx("span",{className:"contact-company",children:S.companyName||S.company})]}),o.jsx("button",{type:"button",className:"change-contact-btn",onClick:()=>x(!0),children:"Change"}),o.jsx("button",{type:"button",className:"remove-contact-btn",onClick:()=>{C(null),j("")},children:"Clear"})]}):o.jsxs("div",{className:"buyer-input-group",children:[o.jsx("input",{type:"text",className:"form-input",value:A,onChange:B=>j(B.target.value),placeholder:"Enter seller name or select contact"}),o.jsx(K,{type:"button",variant:"secondary",size:"small",onClick:()=>x(!0),children:"Select"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Buyer *"}),w?o.jsxs("div",{className:"selected-contact-display",children:[o.jsxs("div",{className:"selected-contact-info",children:[o.jsxs("span",{className:"contact-name",children:[w.firstName," ",w.lastName]}),w.companyName&&o.jsx("span",{className:"contact-company",children:w.companyName})]}),o.jsx("button",{type:"button",className:"change-contact-btn",onClick:()=>g(!0),children:"Change"}),o.jsx("button",{type:"button",className:"remove-contact-btn",onClick:()=>N(null),children:"Remove"})]}):o.jsxs("div",{className:"buyer-selection-area",children:[I.length>0&&o.jsxs("div",{className:"potential-buyers-quick-select",children:[o.jsx("span",{className:"quick-select-label",children:"Interested contacts:"}),o.jsx("div",{className:"quick-select-options",children:I.map(B=>o.jsxs("button",{type:"button",className:"quick-select-btn",onClick:()=>N(B),children:[o.jsxs("span",{className:"quick-select-name",children:[B.firstName," ",B.lastName]}),B.companyName&&o.jsx("span",{className:"quick-select-company",children:B.companyName})]},B.id))}),o.jsx("div",{className:"quick-select-divider",children:o.jsx("span",{children:"or"})})]}),o.jsxs("div",{className:"buyer-input-group",children:[o.jsx("input",{type:"text",className:"form-input",value:_.buyerName,onChange:B=>E($=>({...$,buyerName:B.target.value})),placeholder:"Enter buyer name or select contact"}),o.jsx(K,{type:"button",variant:"secondary",size:"small",onClick:()=>g(!0),children:"Select"})]})]})]})]}),o.jsxs("div",{className:"attribution-section",children:[o.jsxs("div",{className:"attribution-header",children:[o.jsx("h4",{children:"Sales Attribution"}),o.jsx("span",{className:"attribution-hint",children:"Who contributed to this sale? Percentages must total 100%."})]}),o.jsxs("div",{className:"attribution-entries",children:[_.attributions.map((B,$)=>o.jsxs("div",{className:"attribution-entry",children:[o.jsxs("div",{className:"attribution-entry-main",children:[o.jsxs("select",{className:"form-select attribution-name-select",value:B.name,onChange:q=>T($,"name",q.target.value),children:[o.jsx("option",{value:"",children:"Select person"}),o.jsx("option",{value:"HQ Aviation",children:"HQ Aviation (Company)"}),c.map(q=>o.jsx("option",{value:q.displayName||q.email,children:q.displayName||q.email},q.id))]}),o.jsxs("div",{className:"attribution-percentage-wrapper",children:[o.jsx("input",{type:"number",className:"form-input attribution-percentage-input",value:B.percentage,onChange:q=>T($,"percentage",parseFloat(q.target.value)||0),min:"0",max:"100"}),o.jsx("span",{className:"percentage-symbol",children:"%"})]}),o.jsx("div",{className:"attribution-slider-wrapper",children:o.jsx("input",{type:"range",className:"attribution-slider",value:B.percentage,onChange:q=>T($,"percentage",parseFloat(q.target.value)),min:"0",max:"100",step:"5"})})]}),_.attributions.length>1&&o.jsx("button",{type:"button",className:"attribution-remove-btn",onClick:()=>O($),title:"Remove",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},$)),o.jsxs("button",{type:"button",className:"attribution-add-btn",onClick:P,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Person"]})]}),o.jsxs("div",{className:`attribution-total ${Math.abs(H()-100)<=.1?"valid":"invalid"}`,children:[o.jsx("span",{children:"Total:"}),o.jsxs("span",{className:"total-value",children:[H(),"%"]}),Math.abs(H()-100)>.1&&o.jsx("button",{type:"button",className:"auto-balance-btn",onClick:X,children:"Auto-balance"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Sale Notes (optional)"}),o.jsx("textarea",{className:"form-textarea",rows:2,value:_.saleNotes,onChange:B=>E($=>({...$,saleNotes:B.target.value})),placeholder:"Any additional notes..."})]}),o.jsxs("div",{className:"sale-summary",children:[o.jsxs("div",{className:"summary-row",children:[o.jsx("span",{children:"Sale Price:"}),o.jsx("strong",{className:"sale-price-value",children:a(se())})]}),(w||_.buyerName)&&o.jsxs("div",{className:"summary-row",children:[o.jsx("span",{children:"Buyer:"}),o.jsx("strong",{children:w?`${w.firstName} ${w.lastName}`:_.buyerName})]})]})]})}),o.jsx(Qb,{isOpen:m,onClose:()=>g(!1),onSelect:B=>{N(B),E($=>({...$,buyerName:""})),g(!1)},title:"Select Buyer Contact",allowCreate:!0}),o.jsx(Qb,{isOpen:y,onClose:()=>x(!1),onSelect:B=>{C(B),j(""),x(!1)},title:"Select Seller Contact",allowCreate:!0})]}):null}function $de(){var Ch,am;const t=rr(),{userProfile:e}=Xi(),{can:n,PERMISSIONS:r}=Js(),{success:s,error:i}=qt(),{update:a}=Ms("helicopters"),{rates:l,lastUpdated:c,loading:u,saving:d,updateAllRates:h}=jde(),[f,p]=b.useState(null),[m,g]=b.useState({}),[y,x]=b.useState({}),[w,N]=b.useState("available"),[S,C]=b.useState(!1),[A,j]=b.useState("updated_newest"),[_,E]=b.useState(10),[I,T]=b.useState(1),[P,O]=b.useState("all"),[H,X]=b.useState("all"),[se,L]=b.useState("all"),[B,$]=b.useState(""),[q,Y]=b.useState("12m"),[R,G]=b.useState(""),[Z,W]=b.useState(""),[Q,U]=b.useState("all"),[pe,J]=b.useState(!1),[ge,me]=b.useState(!1),[ue,st]=b.useState(null),[Ke,ot]=b.useState(!1),[lt,bt]=b.useState(null),[mt,V]=b.useState(null),[re,ie]=b.useState(!1),[Fe,Qe]=b.useState(null),[At,Jn]=b.useState(!1),Pt=[{value:"potential_buyer",label:"Potential Buyer",description:"Interested in purchasing this aircraft"},{value:"previous_owner",label:"Previous Owner",description:"Previously owned this aircraft"},{value:"enquiry",label:"Enquiry",description:"Made an enquiry about this aircraft"},{value:"broker",label:"Broker / Agent",description:"Representing a buyer or seller"},{value:"other",label:"Other",description:"Other relationship"}],[gt,Pn]=b.useState("aircraft"),ji=b.useRef(null),[Zi,ri]=b.useState("scroll-start");b.useEffect(()=>{const M=ji.current;if(!M)return;const ne=()=>{const{scrollLeft:Ne,scrollWidth:Le,clientWidth:Ee}=M;Le>Ee?Ne<=1?ri("scroll-start"):Ne+Ee>=Le-1?ri("scroll-end"):ri(""):ri("no-scroll")};ne(),M.addEventListener("scroll",ne),window.addEventListener("resize",ne);const oe=new ResizeObserver(ne);return oe.observe(M),()=>{M.removeEventListener("scroll",ne),window.removeEventListener("resize",ne),oe.disconnect()}},[]);const[Bs,ea]=b.useState(!1),[he,Me]=b.useState(null),[Se,vt]=b.useState({status:"all",levelOfInterest:"all",interestPriority:"all",interestCondition:"all",timeline:"all",manufacturer:"all",lastContacted:"all",search:""}),[it,kt]=b.useState(10),[an,wt]=b.useState(1),{data:Lt,loading:Vn}=pn("helicopters"),{data:Zn,loading:si}=pn("enquiries",[qr("createdAt","desc")]),{loading:Zr}=pn("blogs",[qr("createdAt","desc"),iH(5)]);pn("users");const{data:Vs,loading:$n}=pn("contacts"),{overdue:fe,dueToday:Ae,dueTomorrow:Je,totalNeedingFollowUp:$t}=_de();Ia();const tn=Zn.slice(0,10),bs=Vn||si||Zr,gr=M=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(M),ir=M=>{var oe;if(((oe=M.condition)==null?void 0:oe.toLowerCase())==="new"||M.isNew===!0)return!0;const ne=new Date().getFullYear();return M.year>=ne-1&&M.totalHours<50},Gt=b.useMemo(()=>{const M=new Date,ne=M.getFullYear(),oe=Lt.filter(qe=>qe.status==="available"),Ne=Lt.filter(qe=>qe.status==="sold"),Le=Lt.filter(qe=>qe.status==="draft"),Ee=Lt.filter(qe=>qe.status==="taking_offers");let Ce=null;switch(Q){case"1m":Ce=Xo(M,1);break;case"3m":Ce=Xo(M,3);break;case"6m":Ce=Xo(M,6);break;case"12m":Ce=Xo(M,12);break;case"ytd":Ce=new Date(ne,0,1);break;case"all":default:Ce=null;break}const Te=Ce?Ne.filter(qe=>{var Kt,wr,yn,Nr;const nn=((wr=(Kt=qe.soldAt)==null?void 0:Kt.toDate)==null?void 0:wr.call(Kt))||((Nr=(yn=qe.updatedAt)==null?void 0:yn.toDate)==null?void 0:Nr.call(yn));return nn&&nn>=Ce}):Ne,Nt=oe.filter(qe=>ir(qe)),Ut=oe.filter(qe=>!ir(qe)),br=Te.filter(qe=>ir(qe)),ft=Te.filter(qe=>!ir(qe)),De=Zn.filter(qe=>qe.status==="new").length,Ns=Zn.filter(qe=>qe.status==="pending").length,ar=qe=>{var wr,yn,Nr,ai,Wo,Ci;const nn=((yn=(wr=qe.createdAt)==null?void 0:wr.toDate)==null?void 0:yn.call(wr))||((ai=(Nr=qe.publishedAt)==null?void 0:Nr.toDate)==null?void 0:ai.call(Nr));if(!nn)return 0;const Kt=qe.status==="sold"&&((Ci=(Wo=qe.soldAt)==null?void 0:Wo.toDate)==null?void 0:Ci.call(Wo))||M;return dl(Kt,nn)},es=Te.map(qe=>ar(qe)).filter(qe=>qe>0);es.length>0&&Math.round(es.reduce((qe,nn)=>qe+nn,0)/es.length);const Ho=qe=>{var Kt,wr,yn,Nr;if(qe.status!=="sold")return null;const nn=((wr=(Kt=qe.soldAt)==null?void 0:Kt.toDate)==null?void 0:wr.call(Kt))||((Nr=(yn=qe.updatedAt)==null?void 0:yn.toDate)==null?void 0:Nr.call(yn));return nn?dl(M,nn):null},Et=qe=>{var Kt,wr,yn,Nr,ai,Wo;let nn=((wr=(Kt=qe.createdAt)==null?void 0:Kt.toDate)==null?void 0:wr.call(Kt))||M;if(qe.activityLog&&qe.activityLog.length>0){const Ci=qe.activityLog.filter(om=>om.type==="status_change").sort((om,eo)=>new Date(eo.timestamp)-new Date(om.timestamp));Ci.length>0&&(nn=new Date(Ci[0].timestamp))}if(qe.status==="sold"&&qe.soldAt){const Ci=((Nr=(yn=qe.soldAt)==null?void 0:yn.toDate)==null?void 0:Nr.call(yn))||new Date(qe.soldAt);Ci>nn&&(nn=Ci)}if(qe.updatedAt&&(!qe.activityLog||qe.activityLog.length===0)){const Ci=((Wo=(ai=qe.updatedAt)==null?void 0:ai.toDate)==null?void 0:Wo.call(ai))||new Date(qe.updatedAt);Ci>nn&&(nn=Ci)}return dl(M,nn)},or=Lt.map(qe=>({...qe,daysOnMarket:ar(qe),daysSinceSold:Ho(qe),daysSinceStatusChange:Et(qe),isNew:ir(qe)})),Oa=Te.filter(qe=>{var Kt,wr,yn,Nr;const nn=((wr=(Kt=qe.soldAt)==null?void 0:Kt.toDate)==null?void 0:wr.call(Kt))||((Nr=(yn=qe.updatedAt)==null?void 0:yn.toDate)==null?void 0:Nr.call(yn));return nn&&nn.getFullYear()===ne});return{activeListings:oe.length,soldListings:Te.length,draftListings:Le.length,takingOffersListings:Ee.length,newEnquiries:De,pendingEnquiries:Ns,salesThisYear:Oa.length,allListingsWithDays:or,newActive:Nt.length,usedActive:Ut.length,newSold:br.length,usedSold:ft.length}},[Lt,Zn,Q]),ta=b.useMemo(()=>{const M=new Set;return Gt.allListingsWithDays.forEach(ne=>{ne.manufacturer&&M.add(ne.manufacturer)}),Array.from(M).sort()},[Gt.allListingsWithDays]),z=b.useMemo(()=>{const M=new Set;return Gt.allListingsWithDays.forEach(ne=>{ne.model&&(H==="all"||ne.manufacturer===H)&&M.add(ne.model)}),Array.from(M).sort()},[Gt.allListingsWithDays,H]),le=b.useMemo(()=>{let M=Gt.allListingsWithDays.filter(ne=>ne.status===w);if(P==="new"?M=M.filter(ne=>ne.isNew):P==="used"&&(M=M.filter(ne=>!ne.isNew)),H!=="all"&&(M=M.filter(ne=>ne.manufacturer===H)),se!=="all"&&(M=M.filter(ne=>ne.model===se)),B.trim()){const ne=B.trim().toLowerCase();M=M.filter(oe=>{var Ne;return(Ne=oe.registration)==null?void 0:Ne.toLowerCase().includes(ne)})}switch(S&&(M=M.filter(ne=>ne.featured)),A){case"updated_newest":M.sort((ne,oe)=>{var Ee,Ce,Te,Nt,Ut,br,ft,De;const Ne=((Ce=(Ee=ne.updatedAt)==null?void 0:Ee.toDate)==null?void 0:Ce.call(Ee))||ne.updatedAt||((Nt=(Te=ne.createdAt)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||new Date(0),Le=((br=(Ut=oe.updatedAt)==null?void 0:Ut.toDate)==null?void 0:br.call(Ut))||oe.updatedAt||((De=(ft=oe.createdAt)==null?void 0:ft.toDate)==null?void 0:De.call(ft))||new Date(0);return new Date(Le)-new Date(Ne)});break;case"updated_oldest":M.sort((ne,oe)=>{var Ee,Ce,Te,Nt,Ut,br,ft,De;const Ne=((Ce=(Ee=ne.updatedAt)==null?void 0:Ee.toDate)==null?void 0:Ce.call(Ee))||ne.updatedAt||((Nt=(Te=ne.createdAt)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||new Date(0),Le=((br=(Ut=oe.updatedAt)==null?void 0:Ut.toDate)==null?void 0:br.call(Ut))||oe.updatedAt||((De=(ft=oe.createdAt)==null?void 0:ft.toDate)==null?void 0:De.call(ft))||new Date(0);return new Date(Ne)-new Date(Le)});break;case"price_high":M.sort((ne,oe)=>(oe.salePrice||oe.price||0)-(ne.salePrice||ne.price||0));break;case"price_low":M.sort((ne,oe)=>(ne.salePrice||ne.price||0)-(oe.salePrice||oe.price||0));break;case"sold_newest":M.sort((ne,oe)=>{var Ee,Ce,Te,Nt;const Ne=((Ce=(Ee=ne.soldAt)==null?void 0:Ee.toDate)==null?void 0:Ce.call(Ee))||ne.soldAt||new Date(0),Le=((Nt=(Te=oe.soldAt)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||oe.soldAt||new Date(0);return new Date(Le)-new Date(Ne)});break;case"sold_oldest":M.sort((ne,oe)=>{var Ee,Ce,Te,Nt;const Ne=((Ce=(Ee=ne.soldAt)==null?void 0:Ee.toDate)==null?void 0:Ce.call(Ee))||ne.soldAt||new Date(0),Le=((Nt=(Te=oe.soldAt)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||oe.soldAt||new Date(0);return new Date(Ne)-new Date(Le)});break}return M},[Gt.allListingsWithDays,w,A,P,H,se,S,B]),be=Math.ceil(le.length/_),Oe=b.useMemo(()=>{const M=(I-1)*_;return le.slice(M,M+_)},[le,I,_]),Ue=M=>{N(M),T(1),M==="sold"?j("sold_newest"):(A==="sold_newest"||A==="sold_oldest")&&j("updated_newest")},Ft=b.useMemo(()=>{const M=Lt.filter(oe=>oe.status==="sold"),ne={};return M.forEach(oe=>{var Ee;const Ne=((Ee=oe.condition)==null?void 0:Ee.toLowerCase())==="new",Le=`${oe.manufacturer||""} ${oe.model||""}`.trim();if(oe.saleAttribution&&Array.isArray(oe.saleAttribution))oe.saleAttribution.forEach(Ce=>{const Te=Ce.name||"Unknown",Nt=Ce.percentage||0;ne[Te]||(ne[Te]={name:Te,count:0,salesCount:0,deals:[],newCount:0,usedCount:0,aircraftTypes:{}}),ne[Te].count+=Nt/100,ne[Te].salesCount++,ne[Te].deals.push({id:oe.id,year:oe.year,manufacturer:oe.manufacturer,model:oe.model,registration:oe.registration,percentage:Nt,isNew:Ne,soldAt:oe.soldAt}),Ne?ne[Te].newCount++:ne[Te].usedCount++,Le&&(ne[Te].aircraftTypes[Le]=(ne[Te].aircraftTypes[Le]||0)+1)});else if(oe.soldBy){const Ce=oe.soldBy;ne[Ce]||(ne[Ce]={name:Ce,count:0,salesCount:0,deals:[],newCount:0,usedCount:0,aircraftTypes:{}}),ne[Ce].count+=1,ne[Ce].salesCount++,ne[Ce].deals.push({id:oe.id,year:oe.year,manufacturer:oe.manufacturer,model:oe.model,registration:oe.registration,percentage:100,isNew:Ne,soldAt:oe.soldAt}),Ne?ne[Ce].newCount++:ne[Ce].usedCount++,Le&&(ne[Ce].aircraftTypes[Le]=(ne[Ce].aircraftTypes[Le]||0)+1)}}),Object.values(ne).map(oe=>({...oe,count:Math.round(oe.count*10)/10})).sort((oe,Ne)=>Ne.salesCount-oe.salesCount)},[Lt]),jn=b.useMemo(()=>{const M=new Date;let ne=null,oe=M;switch(q){case"1m":ne=Xo(M,1);break;case"3m":ne=Xo(M,3);break;case"6m":ne=Xo(M,6);break;case"12m":ne=Xo(M,12);break;case"custom":R&&(ne=new Date(R)),Z&&(oe=new Date(Z));break;case"all":default:ne=null;break}const Ne=Lt.filter(Ee=>{var Te,Nt,Ut,br;if(Ee.status!=="sold")return!1;if(!ne&&q!=="custom")return!0;const Ce=((Nt=(Te=Ee.soldAt)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||((br=(Ut=Ee.updatedAt)==null?void 0:Ut.toDate)==null?void 0:br.call(Ut));return Ce?!(ne&&Ce<ne||oe&&Ce>oe):q==="all"}),Le={};return Ne.forEach(Ee=>{var Ut,br,ft,De;const Ce=Ee.manufacturer||"Unknown",Te=Ee.model||"Unknown",Nt=ir(Ee);Le[Ce]||(Le[Ce]={name:Ce,count:0,newCount:0,usedCount:0,models:{}}),Le[Ce].count++,Nt?Le[Ce].newCount++:Le[Ce].usedCount++,Le[Ce].models[Te]||(Le[Ce].models[Te]={name:Te,count:0,newCount:0,usedCount:0,aircraft:[]}),Le[Ce].models[Te].count++,Nt?Le[Ce].models[Te].newCount++:Le[Ce].models[Te].usedCount++,Le[Ce].models[Te].aircraft.push({id:Ee.id,registration:Ee.registration||"N/A",year:Ee.year,salePrice:Ee.salePrice||Ee.price||0,isNew:Nt,soldAt:((br=(Ut=Ee.soldAt)==null?void 0:Ut.toDate)==null?void 0:br.call(Ut))||((De=(ft=Ee.updatedAt)==null?void 0:ft.toDate)==null?void 0:De.call(ft))})}),Object.values(Le).map(Ee=>({...Ee,models:Object.values(Ee.models).map(Ce=>({...Ce,aircraft:Ce.aircraft.sort((Te,Nt)=>(Nt.soldAt||0)-(Te.soldAt||0))})).sort((Ce,Te)=>Te.count-Ce.count)})).sort((Ee,Ce)=>Ce.count-Ee.count)},[Lt,q,R,Z]),dn=b.useMemo(()=>{const M=new Set;return Vs.forEach(ne=>{ne.aircraftInterests&&Array.isArray(ne.aircraftInterests)&&ne.aircraftInterests.forEach(oe=>{oe&&oe.manufacturer&&M.add(oe.manufacturer)})}),Array.from(M).sort()},[Vs]),yr=b.useMemo(()=>{const M=new Date;let ne=[...Vs];if(Se.search&&Se.search.trim()){const Ne=Se.search.toLowerCase().trim();ne=ne.filter(Le=>{const Ee=`${Le.firstName||""} ${Le.lastName||""}`.toLowerCase(),Ce=(Le.email||"").toLowerCase(),Te=(Le.companyName||Le.company||"").toLowerCase();return Ee.includes(Ne)||Ce.includes(Ne)||Te.includes(Ne)})}Se.status&&Se.status!=="all"&&(ne=ne.filter(Ne=>Ne.status===Se.status)),Se.levelOfInterest&&Se.levelOfInterest!=="all"&&(ne=ne.filter(Ne=>{const Le=Ne.levelOfInterest||"unknown";return({highly_motivated:"high",very_interested:"high",interested:"medium",casual:"medium"}[Le]||Le)===Se.levelOfInterest})),Se.interestCondition&&Se.interestCondition!=="all"&&(ne=ne.filter(Ne=>!Ne.aircraftInterests||!Array.isArray(Ne.aircraftInterests)||Ne.aircraftInterests.length===0?!1:Ne.aircraftInterests.some(Le=>{if(!Le)return!1;const Ee=Le.condition||"either";return Se.interestCondition==="new"?Ee==="new"||Ee==="either":Se.interestCondition==="used"?Ee==="used"||Ee==="either":Se.interestCondition==="new_only"?Ee==="new":Se.interestCondition==="used_only"?Ee==="used":!0}))),Se.interestPriority&&Se.interestPriority!=="all"&&(ne=ne.filter(Ne=>!Ne.aircraftInterests||!Array.isArray(Ne.aircraftInterests)||Ne.aircraftInterests.length===0?!1:Ne.aircraftInterests.some(Le=>Le?(Le.priority||"medium")===Se.interestPriority:!1))),Se.timeline&&Se.timeline!=="all"&&(ne=ne.filter(Ne=>Ne.timeline===Se.timeline)),Se.manufacturer&&Se.manufacturer!=="all"&&(ne=ne.filter(Ne=>!Ne.aircraftInterests||!Array.isArray(Ne.aircraftInterests)||Ne.aircraftInterests.length===0?!1:Ne.aircraftInterests.some(Le=>Le&&Le.manufacturer===Se.manufacturer))),Se.lastContacted&&Se.lastContacted!=="all"&&(ne=ne.filter(Ne=>{var Ce,Te,Nt,Ut;const Le=((Nt=(Te=(Ce=Ne.followUp)==null?void 0:Ce.lastContactedDate)==null?void 0:Te.toDate)==null?void 0:Nt.call(Te))||((Ut=Ne.followUp)!=null&&Ut.lastContactedDate?new Date(Ne.followUp.lastContactedDate):null);if(Se.lastContacted==="never")return!Le;if(!Le)return!1;const Ee=dl(M,Le);switch(Se.lastContacted){case"today":return Ee===0;case"week":return Ee<=7;case"month":return Ee<=30;case"overdue":return Ee>14;default:return!0}}));const oe=Ne=>({high:0,highly_motivated:0,very_interested:0,medium:1,interested:1,casual:1,low:2,unknown:3})[Ne]??3;return ne.sort((Ne,Le)=>{const Ee=oe(Ne.levelOfInterest),Ce=oe(Le.levelOfInterest);if(Ee!==Ce)return Ee-Ce;const Te=`${Ne.firstName||""} ${Ne.lastName||""}`,Nt=`${Le.firstName||""} ${Le.lastName||""}`;return Te.localeCompare(Nt)}),ne},[Vs,Se]),ws=b.useMemo(()=>{const M=(an-1)*it;return yr.slice(M,M+it)},[yr,an,it]),vr=Math.ceil(yr.length/it),xr=(M,ne)=>{vt(oe=>({...oe,[M]:ne})),wt(1)},na=()=>{vt({status:"all",levelOfInterest:"all",interestPriority:"all",interestCondition:"all",timeline:"all",manufacturer:"all",lastContacted:"all",search:""}),wt(1)},Ei=Object.entries(Se).filter(([M,ne])=>M!=="search"&&ne!=="all").length,ec=M=>{g(ne=>({...ne,[M]:!ne[M]}))},ra=(M,ne)=>{const oe=`${M}:${ne}`;x(Ne=>({...Ne,[oe]:!Ne[oe]}))},ii=tn.filter(M=>{var ne,oe;if(M.status==="new")return!0;if(M.status==="pending"){const Ne=((oe=(ne=M.createdAt)==null?void 0:ne.toDate)==null?void 0:oe.call(ne))||new Date(M.createdAt);return wde(XH(new Date,1),Ne)}return!1}),im=M=>{if(!M)return"";try{return Kh(M,{addSuffix:!0})}catch{return""}},QS=()=>{const M=new Date().getHours();return M<12?"Good morning":M<18?"Good afternoon":"Good evening"},Xv=async(M,ne)=>{if(ne==="sold"){const oe=Gt.allListingsWithDays.find(Ne=>Ne.id===M);oe&&(Me(oe),ea(!0));return}try{await a(M,{status:ne,updatedAt:new Date}),s(`Status changed to ${ne}`)}catch(oe){console.error("Failed to update status:",oe),i("Failed to update status")}},Jv=async(M,ne)=>{try{await a(M,{featured:!ne,updatedAt:new Date}),s(ne?"Removed from featured":"Added to featured")}catch(oe){console.error("Failed to toggle featured:",oe),i("Failed to update featured status")}},Zv=M=>{var Ne;if(!((Ne=M.specs)!=null&&Ne.endOfLifeDate))return null;const ne=new Date(M.specs.endOfLifeDate);return xue(ne,new Date)},tc=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4"];return bs?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"dashboard",children:[o.jsx("div",{className:"page-header",children:o.jsxs("div",{children:[o.jsxs("h1",{children:[QS(),e!=null&&e.displayName?`, ${e.displayName}`:""]}),o.jsx("p",{className:"page-subtitle",children:rt(new Date,"EEEE, MMMM d, yyyy")})]})}),o.jsx("div",{className:"dashboard-alerts",children:ii.length>0&&n(r.ENQUIRIES_VIEW)&&o.jsxs("div",{className:"dashboard-alert alert-warning",children:[o.jsx("div",{className:"alert-icon",children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),o.jsxs("div",{className:"alert-content",children:[o.jsxs("strong",{children:[ii.length," enquir",ii.length===1?"y":"ies"," need response"]}),o.jsx("span",{children:"Potential buyers waiting"})]}),o.jsx(K,{size:"small",onClick:()=>t("/enquiries"),children:"View"})]})}),o.jsxs("div",{className:"stats-grid stats-grid-3",children:[o.jsxs("div",{className:"stat-card stat-card-clickable",onClick:()=>t("/listings?status=available"),children:[o.jsx("div",{className:"stat-icon stat-icon-blue",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:Gt.activeListings}),o.jsx("div",{className:"stat-label",children:"Available Aircraft"}),o.jsxs("div",{className:"stat-breakdown",children:[o.jsxs("span",{className:"breakdown-new",children:[Gt.newActive," new"]}),o.jsx("span",{className:"breakdown-divider",children:"/"}),o.jsxs("span",{className:"breakdown-used",children:[Gt.usedActive," used"]})]})]})]}),o.jsxs("div",{className:"stat-card stat-card-clickable",onClick:()=>t("/listings?status=sold"),children:[o.jsx("div",{className:"stat-icon stat-icon-purple",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:Gt.soldListings}),o.jsx("div",{className:"stat-label",children:"Aircraft Sold"}),o.jsxs("div",{className:"stat-breakdown",children:[o.jsxs("span",{children:[Gt.newSold," new"]}),o.jsx("span",{className:"breakdown-divider",children:"/"}),o.jsxs("span",{children:[Gt.usedSold," used"]})]})]}),o.jsxs("select",{className:"stat-period-select",value:Q,onChange:M=>U(M.target.value),onClick:M=>M.stopPropagation(),children:[o.jsx("option",{value:"1m",children:"Last Month"}),o.jsx("option",{value:"3m",children:"Last 3 Months"}),o.jsx("option",{value:"6m",children:"Last 6 Months"}),o.jsx("option",{value:"12m",children:"Last 12 Months"}),o.jsx("option",{value:"ytd",children:"Year to Date"}),o.jsx("option",{value:"all",children:"All Time"})]})]}),o.jsxs("div",{className:"stat-card stat-card-clickable",onClick:()=>t("/enquiries"),children:[o.jsx("div",{className:"stat-icon stat-icon-teal",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:Gt.newEnquiries+Gt.pendingEnquiries}),o.jsx("div",{className:"stat-label",children:"Active Enquiries"}),o.jsxs("div",{className:"stat-subtext",children:[Gt.newEnquiries," new, ",Gt.pendingEnquiries," pending"]})]})]})]}),o.jsxs("div",{className:"dashboard-main-tabs",children:[o.jsxs("button",{className:`dashboard-main-tab ${gt==="aircraft"?"active":""}`,onClick:()=>Pn("aircraft"),children:[o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})}),"Aircraft"]}),o.jsxs("button",{className:`dashboard-main-tab ${gt==="contacts"?"active":""}`,onClick:()=>Pn("contacts"),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"9",cy:"7",r:"4"}),o.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),o.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Contacts",Ei>0&&o.jsx("span",{className:"filter-count-badge",children:Ei})]}),o.jsxs("button",{className:`dashboard-main-tab ${gt==="exchange_rates"?"active":""}`,onClick:()=>Pn("exchange_rates"),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Exchange Rates"]})]}),gt==="aircraft"&&o.jsx(Ede,{defaultLeftWidth:55,minLeftWidth:30,maxLeftWidth:75,storageKey:"dashboard-panels-width",leftPanel:o.jsxs("div",{className:"chart-card",children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h3",{children:"Aircraft"}),o.jsxs("div",{className:"listing-filters",children:[o.jsxs("div",{className:"view-toggle",children:[o.jsx("button",{className:`view-toggle-btn ${pe?"active":""}`,onClick:()=>J(!0),title:"Compact view",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),o.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),o.jsx("button",{className:`view-toggle-btn ${pe?"":"active"}`,onClick:()=>J(!1),title:"Expanded view",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),o.jsx("line",{x1:"3",y1:"15",x2:"21",y2:"15"})]})})]}),o.jsxs("select",{className:"filter-select filter-select-small",value:_,onChange:M=>{E(parseInt(M.target.value)),T(1)},children:[o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"10",children:"10"}),o.jsx("option",{value:"15",children:"15"}),o.jsx("option",{value:"20",children:"20"}),o.jsx("option",{value:"25",children:"25"}),o.jsx("option",{value:"30",children:"30"}),o.jsx("option",{value:"50",children:"50"}),o.jsx("option",{value:"100",children:"100"})]})]})]}),o.jsxs("div",{className:"listing-status-tabs",children:[o.jsxs("div",{ref:ji,className:`status-tabs-left ${Zi}`,children:[o.jsxs("button",{className:`status-tab ${w==="available"?"status-tab-active":""}`,onClick:()=>Ue("available"),children:["Available (",Gt.activeListings,")"]}),o.jsxs("button",{className:`status-tab ${w==="taking_offers"?"status-tab-active":""}`,onClick:()=>Ue("taking_offers"),children:["Taking Offers (",Gt.takingOffersListings,")"]}),o.jsxs("button",{className:`status-tab ${w==="draft"?"status-tab-active":""}`,onClick:()=>Ue("draft"),children:["Drafts (",Gt.draftListings,")"]}),o.jsxs("button",{className:`status-tab ${w==="sold"?"status-tab-active":""}`,onClick:()=>Ue("sold"),children:["Sold (",Gt.soldListings,")"]})]}),o.jsx("div",{className:"status-tabs-right",children:o.jsx("button",{className:`featured-filter-btn ${S?"is-active":""}`,onClick:()=>C(!S),title:S?"Show all listings":"Show only featured",children:o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:S?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})})})]}),o.jsxs("div",{className:"listing-secondary-filters",children:[o.jsxs("div",{className:"registration-search-wrapper",children:[o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",className:"registration-search-input",placeholder:"Search registration...",value:B,onChange:M=>{$(M.target.value),T(1)}}),B&&o.jsx("button",{className:"registration-search-clear",onClick:()=>$(""),title:"Clear search",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsxs("select",{className:"filter-select",value:P,onChange:M=>O(M.target.value),children:[o.jsx("option",{value:"all",children:"All Conditions"}),o.jsx("option",{value:"new",children:"New"}),o.jsx("option",{value:"used",children:"Used"})]}),o.jsxs("select",{className:"filter-select",value:H,onChange:M=>{X(M.target.value),L("all")},children:[o.jsx("option",{value:"all",children:"All Manufacturers"}),ta.map(M=>o.jsx("option",{value:M,children:M},M))]}),z.length>0&&o.jsxs("select",{className:"filter-select",value:se,onChange:M=>L(M.target.value),children:[o.jsx("option",{value:"all",children:"All Models"}),z.map(M=>o.jsx("option",{value:M,children:M},M))]}),o.jsxs("select",{className:"filter-select sort-select",value:A,onChange:M=>j(M.target.value),children:[o.jsx("option",{value:"updated_newest",children:"Last Updated (Newest)"}),o.jsx("option",{value:"updated_oldest",children:"Last Updated (Oldest)"}),o.jsx("option",{value:"price_high",children:"Price (High to Low)"}),o.jsx("option",{value:"price_low",children:"Price (Low to High)"}),w==="sold"&&o.jsxs(o.Fragment,{children:[o.jsx("option",{value:"sold_newest",children:"Date Sold (Newest)"}),o.jsx("option",{value:"sold_oldest",children:"Date Sold (Oldest)"})]})]})]}),Oe.length>0?o.jsxs("div",{className:`listing-table ${pe?"listing-table-compact":"listing-table-expanded"}`,children:[o.jsxs("div",{className:"listing-table-header",children:[o.jsx("span",{className:"col-thumb"}),o.jsx("span",{className:"col-aircraft",children:"Aircraft"}),o.jsx("span",{className:"col-hours-remaining",children:"Hours / Life"}),o.jsx("span",{className:"col-price",children:"Price"})]}),Oe.map(M=>{var Le,Ee,Ce,Te,Nt,Ut,br,ft;const ne=Zv(M),oe=(Le=M.ownershipHistory)==null?void 0:Le.find(De=>De.isCurrentOwner),Ne=M.potentialBuyers||[];return o.jsxs("div",{className:"listing-table-row",children:[o.jsx("div",{className:"col-thumb",children:M.images&&M.images.length>0&&((Ee=M.images[0])!=null&&Ee.url)?o.jsx("img",{src:M.images[0].url,alt:"",className:"listing-thumb-img"}):o.jsx("div",{className:"listing-thumb-placeholder"})}),o.jsxs("div",{className:"col-aircraft",children:[o.jsxs("div",{className:"aircraft-main-row",children:[o.jsxs(at,{to:`/listings/${M.id}`,className:"aircraft-title-link",children:[M.year," ",M.manufacturer," ",M.model]}),o.jsx("button",{className:`featured-star ${M.featured?"is-featured":""}`,onClick:()=>Jv(M.id,M.featured),title:M.featured?"Remove from featured":"Add to featured",children:o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:M.featured?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})})]}),o.jsxs("div",{className:"aircraft-reg-row",children:[M.registration&&o.jsx("span",{className:"aircraft-reg",children:M.registration}),o.jsx(at,{to:`/listings/${M.id}/edit`,className:"listing-edit-btn",title:"Edit",children:"Edit"}),o.jsx("div",{className:"status-dropdown",children:o.jsxs("select",{className:`status-select status-${M.status}`,value:M.status,onChange:De=>Xv(M.id,De.target.value),children:[o.jsx("option",{value:"available",children:"Available"}),o.jsx("option",{value:"taking_offers",children:"Taking Offers"}),o.jsx("option",{value:"draft",children:"Draft"}),o.jsx("option",{value:"sold",children:"Sold"})]})})]}),M.updatedAt&&o.jsxs("span",{className:"last-modified",children:["Modified ",Kh(((Te=(Ce=M.updatedAt)==null?void 0:Ce.toDate)==null?void 0:Te.call(Ce))||new Date,{addSuffix:!0})]})]}),o.jsx("span",{className:"col-hours-remaining",children:o.jsxs("div",{className:"hours-life-info",children:[o.jsx("span",{className:"total-hours",children:M.totalHours?`${M.totalHours.toLocaleString()} hrs`:"-"}),ne!==null&&o.jsx("span",{className:`years-remaining ${ne<=2?"years-warning":""}`,children:ne>0?`${ne}y left`:"EOL passed"})]})}),o.jsx("span",{className:"col-price",children:w==="sold"?gr(M.salePrice||M.price||0):M.priceType==="poa"?"P.O.A.":gr(M.price||0)}),!pe&&o.jsx("div",{className:"expanded-details-fullwidth",children:o.jsxs("div",{className:"expanded-details-grid-4",children:[o.jsxs("div",{className:"expanded-col",children:[o.jsx("div",{className:"expanded-col-header",children:"Specifications"}),M.serialNumber&&o.jsxs("div",{className:"expanded-field",children:[o.jsx("span",{className:"field-label",children:"S/N:"}),o.jsx("span",{className:"field-value",children:M.serialNumber})]}),M.totalHours>0&&o.jsxs("div",{className:"expanded-field",children:[o.jsx("span",{className:"field-label",children:"TTAF:"}),o.jsxs("span",{className:"field-value",children:[M.totalHours.toLocaleString()," hrs"]})]}),((Nt=M.specs)==null?void 0:Nt.engineHours)>0&&o.jsxs("div",{className:"expanded-field",children:[o.jsx("span",{className:"field-label",children:"Engine:"}),o.jsxs("span",{className:"field-value",children:[M.specs.engineHours.toLocaleString()," hrs",((Ut=M.specs)==null?void 0:Ut.engineTBO)>0&&` / ${M.specs.engineTBO.toLocaleString()} TBO`]})]}),M.location&&o.jsxs("div",{className:"expanded-field",children:[o.jsx("span",{className:"field-label",children:"Location:"}),o.jsx("span",{className:"field-value",children:M.location})]}),M.condition&&o.jsxs("div",{className:"expanded-field",children:[o.jsx("span",{className:"field-label",children:"Condition:"}),o.jsx("span",{className:`condition-badge condition-${M.condition.toLowerCase()}`,children:M.condition})]})]}),o.jsxs("div",{className:"expanded-col",children:[o.jsx("div",{className:"expanded-col-header",children:"Notes"}),M.description?o.jsxs("div",{className:"expanded-notes",children:[M.description.substring(0,200),M.description.length>200?"...":""]}):o.jsx("div",{className:"expanded-notes expanded-notes-empty",children:"No description"})]}),o.jsxs("div",{className:"expanded-col",children:[o.jsx("div",{className:"expanded-col-header",children:"People"}),oe&&o.jsxs("div",{className:"people-category",children:[o.jsx("span",{className:"people-category-label",children:"Current Owner"}),o.jsxs("div",{className:"people-item",children:[oe.contactId?o.jsx(at,{to:`/contacts/${oe.contactId}`,className:"people-name",children:oe.ownerName}):o.jsx("span",{className:"people-name",children:oe.ownerName}),oe.company&&o.jsx("span",{className:"people-company",children:oe.company})]})]}),((br=M.ownershipHistory)==null?void 0:br.filter(De=>!De.isCurrentOwner).length)>0&&o.jsxs("div",{className:"people-category",children:[o.jsxs("span",{className:"people-category-label",children:["Previous Owner",M.ownershipHistory.filter(De=>!De.isCurrentOwner).length>1?"s":""]}),M.ownershipHistory.filter(De=>!De.isCurrentOwner).slice(0,2).map((De,Ns)=>o.jsx("div",{className:"people-item people-item-muted",children:o.jsx("span",{className:"people-name",children:De.ownerName})},Ns))]}),M.status==="sold"&&(M.buyerContact||M.buyerName)&&(()=>{const De=M.buyerContact,Ns=(De==null?void 0:De.contactType)==="business",ar=(De==null?void 0:De.company)||(De==null?void 0:De.companyName),es=De?`${De.firstName} ${De.lastName}`:M.buyerName;return o.jsxs("div",{className:"people-category",children:[o.jsx("span",{className:"people-category-label",children:"Buyer"}),o.jsx("div",{className:"buyer-chip buyer-chip-stacked",children:Ns&&ar?o.jsxs(o.Fragment,{children:[De!=null&&De.id?o.jsx(at,{to:`/contacts/${De.id}`,className:"buyer-chip-primary",children:ar}):o.jsx("span",{className:"buyer-chip-primary",children:ar}),o.jsx("span",{className:"buyer-chip-secondary",children:es})]}):o.jsxs(o.Fragment,{children:[De!=null&&De.id?o.jsx(at,{to:`/contacts/${De.id}`,className:"buyer-chip-primary",children:es}):o.jsx("span",{className:"buyer-chip-primary",children:es}),ar&&o.jsx("span",{className:"buyer-chip-secondary",children:ar})]})})]})})(),M.status==="sold"&&((ft=M.saleAttribution)==null?void 0:ft.length)>0&&o.jsxs("div",{className:"people-category",children:[o.jsx("span",{className:"people-category-label",children:"Sale Attribution"}),o.jsx("div",{className:"attribution-chips",children:M.saleAttribution.map((De,Ns)=>o.jsxs("div",{className:"buyer-chip attribution-chip",children:[o.jsx("span",{className:"buyer-chip-primary",children:De.name}),o.jsxs("span",{className:"attribution-percentage",children:[De.percentage,"%"]})]},Ns))})]}),Ne.length>0&&o.jsxs("div",{className:"people-category",children:[o.jsx("span",{className:"people-category-label",children:"Mentions"}),o.jsxs("div",{className:"mentions-list",children:[Ne.slice(0,5).map((De,Ns)=>{var Et,or;const ar=De.contactType==="business",es=ar&&De.company?De.company:`${De.firstName} ${De.lastName||""}`,Ho={potential_buyer:"Potential Buyer",previous_owner:"Previous Owner",enquiry:"Enquiry",broker:"Broker / Agent",other:"Other"}[De.relationshipType]||"Mention";return o.jsxs("details",{className:"mention-dropdown",children:[o.jsxs("summary",{className:"mention-summary",children:[o.jsx("span",{className:`mention-category-dot category-${De.relationshipType||"other"}`}),o.jsx("span",{className:"mention-name",children:De.contactId?o.jsx(at,{to:`/contacts/${De.contactId}`,onClick:Oa=>Oa.stopPropagation(),children:es}):es}),o.jsx("svg",{className:"mention-chevron",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),o.jsxs("div",{className:"mention-details",children:[o.jsx("div",{className:"mention-category-tag",children:o.jsx("span",{className:`category-badge category-${De.relationshipType||"other"}`,children:Ho})}),ar&&De.company&&o.jsxs("div",{className:"mention-detail-row",children:[o.jsx("span",{className:"detail-label",children:"Contact:"}),o.jsxs("span",{className:"detail-value",children:[De.firstName," ",De.lastName]})]}),De.interactionSummary&&o.jsxs("div",{className:"mention-detail-row",children:[o.jsx("span",{className:"detail-label",children:"Last interaction:"}),o.jsx("span",{className:"detail-value",children:De.interactionSummary})]}),De.addedAt&&o.jsxs("div",{className:"mention-detail-row",children:[o.jsx("span",{className:"detail-label",children:"Added:"}),o.jsx("span",{className:"detail-value",children:Kh(((or=(Et=De.addedAt)==null?void 0:Et.toDate)==null?void 0:or.call(Et))||new Date(De.addedAt),{addSuffix:!0})})]})]})]},De.contactId||Ns)}),Ne.length>5&&o.jsxs("span",{className:"mentions-more",children:["+",Ne.length-5," more"]})]})]}),o.jsxs("button",{className:"add-mention-btn",onClick:De=>{De.stopPropagation(),bt({id:M.id,registration:M.registration,manufacturer:M.manufacturer,model:M.model,year:M.year}),ot(!0)},children:[o.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Mention"]})]}),o.jsxs("div",{className:"expanded-col",children:[o.jsx("div",{className:"expanded-col-header",children:"Recent Activity"}),(()=>{var es,Ho;const De=[];if(Zn.filter(Et=>Et.helicopterId===M.id||Et.aircraftId===M.id).forEach(Et=>{var or,Oa;De.push({type:"enquiry",title:`Enquiry from ${Et.name||Et.email||"Unknown"}`,date:((Oa=(or=Et.createdAt)==null?void 0:or.toDate)==null?void 0:Oa.call(or))||new Date,icon:""})}),(M.potentialBuyers||[]).forEach(Et=>{var or,Oa;if(Et.addedAt){const qe={potential_buyer:"Potential Buyer",previous_owner:"Previous Owner",enquiry:"Enquiry",broker:"Broker",other:"Mention"}[Et.relationshipType]||"Mention",nn=Et.contactType==="business"&&Et.company?Et.company:`${Et.firstName} ${Et.lastName||""}`;De.push({type:"mention",category:Et.relationshipType,title:nn,label:qe,subtitle:Et.interactionSummary||null,date:((Oa=(or=Et.addedAt)==null?void 0:or.toDate)==null?void 0:Oa.call(or))||new Date(Et.addedAt),icon:Et.relationshipType==="potential_buyer"?"":Et.relationshipType==="broker"?"":""})}}),M.status==="sold"&&M.soldAt){const Et=M.buyerContact?M.buyerContact.contactType==="business"&&M.buyerContact.company?M.buyerContact.company:`${M.buyerContact.firstName} ${M.buyerContact.lastName}`:M.buyerName||"Unknown";De.push({type:"sold",title:Et,label:"Sold to",date:((Ho=(es=M.soldAt)==null?void 0:es.toDate)==null?void 0:Ho.call(es))||new Date(M.soldAt),icon:""})}De.sort((Et,or)=>or.date-Et.date);const ar=De.slice(0,4);return ar.length===0?o.jsx("div",{className:"activity-empty",children:"No recent activity"}):o.jsx("div",{className:"activity-v1",children:ar.map((Et,or)=>o.jsxs("div",{className:`activity-v1-item type-${Et.type}`,children:[o.jsx("div",{className:"activity-v1-dot"}),o.jsxs("div",{className:"activity-v1-content",children:[o.jsxs("span",{className:"activity-v1-title",children:[Et.label?`${Et.label}: `:"",Et.title]}),o.jsx("span",{className:"activity-v1-time",children:Kh(Et.date,{addSuffix:!0})})]})]},or))})})()]})]})})]},M.id)})]}):o.jsx("div",{className:"chart-empty",children:"No listings match this filter"}),be>1&&o.jsxs("div",{className:"listing-pagination",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>T(M=>Math.max(1,M-1)),disabled:I===1,children:" Prev"}),o.jsxs("span",{className:"pagination-info",children:["Page ",I," of ",be," (",le.length," items)"]}),o.jsx("button",{className:"pagination-btn",onClick:()=>T(M=>Math.min(be,M+1)),disabled:I===be,children:"Next "})]})]}),rightPanel:o.jsxs("div",{className:"chart-card",children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h3",{children:"Sales by Aircraft Type"}),o.jsxs("select",{className:"filter-select",value:q,onChange:M=>Y(M.target.value),children:[o.jsx("option",{value:"1m",children:"Last Month"}),o.jsx("option",{value:"3m",children:"Last 3 Months"}),o.jsx("option",{value:"6m",children:"Last 6 Months"}),o.jsx("option",{value:"12m",children:"Last 12 Months"}),o.jsx("option",{value:"all",children:"All Time"}),o.jsx("option",{value:"custom",children:"Custom Range"})]})]}),q==="custom"&&o.jsxs("div",{className:"custom-date-range",children:[o.jsx("input",{type:"date",className:"form-input date-input",value:R,onChange:M=>G(M.target.value),placeholder:"Start date"}),o.jsx("span",{className:"date-separator",children:"to"}),o.jsx("input",{type:"date",className:"form-input date-input",value:Z,onChange:M=>W(M.target.value),placeholder:"End date"})]}),jn.length>0?o.jsx("div",{className:"manufacturer-accordion",children:jn.map((M,ne)=>o.jsxs("div",{className:"manufacturer-accordion-item",children:[o.jsxs("button",{className:`manufacturer-accordion-header ${m[M.name]?"expanded":""}`,onClick:()=>ec(M.name),children:[o.jsxs("div",{className:"manufacturer-header-left",children:[o.jsx("span",{className:"manufacturer-color-dot",style:{background:tc[ne%tc.length]}}),o.jsx("span",{className:"manufacturer-name",children:M.name})]}),o.jsxs("div",{className:"manufacturer-header-right",children:[o.jsxs("span",{className:"manufacturer-count",children:[M.count," sold"]}),o.jsxs("span",{className:"manufacturer-breakdown",children:["(",M.newCount,"N / ",M.usedCount,"U)"]}),o.jsx("svg",{className:`chevron-icon ${m[M.name]?"rotated":""}`,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"6 9 12 15 18 9"})})]})]}),m[M.name]&&o.jsx("div",{className:"manufacturer-models",children:M.models.map(oe=>{const Ne=`${M.name}:${oe.name}`,Le=y[Ne];return o.jsxs("div",{className:"model-accordion-item",children:[o.jsxs("button",{className:`model-accordion-header ${Le?"expanded":""}`,onClick:()=>ra(M.name,oe.name),children:[o.jsx("span",{className:"model-name",children:oe.name}),o.jsxs("div",{className:"model-header-right",children:[o.jsxs("span",{className:"model-breakdown",children:[oe.newCount>0&&o.jsxs("span",{className:"model-new",children:[oe.newCount,"N"]}),oe.usedCount>0&&o.jsxs("span",{className:"model-used",children:[oe.usedCount,"U"]})]}),o.jsx("span",{className:"model-count",children:oe.count}),o.jsx("svg",{className:`chevron-icon chevron-small ${Le?"rotated":""}`,width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"6 9 12 15 18 9"})})]})]}),Le&&o.jsx("div",{className:"aircraft-list",children:oe.aircraft.map(Ee=>o.jsxs(at,{to:`/listings/${Ee.id}`,className:"aircraft-list-item",children:[o.jsx("span",{className:"aircraft-reg",children:Ee.registration}),o.jsx("span",{className:"aircraft-year",children:Ee.year}),o.jsx("span",{className:`aircraft-type-tag ${Ee.isNew?"type-new":"type-used"}`,children:Ee.isNew?"New":"Used"}),o.jsx("span",{className:"aircraft-price",children:gr(Ee.salePrice)})]},Ee.id))})]},oe.name)})})]},M.name))}):o.jsx("div",{className:"chart-empty",children:"No sales data yet"})]})}),gt==="contacts"&&o.jsxs("div",{className:"contacts-tab-content",children:[o.jsxs("div",{className:"contacts-filters-bar",children:[o.jsxs("div",{className:"contacts-search",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search contacts...",value:Se.search,onChange:M=>xr("search",M.target.value),className:"contacts-search-input"})]}),o.jsxs("div",{className:"contacts-filters",children:[o.jsxs("select",{className:"filter-select",value:Se.status,onChange:M=>xr("status",M.target.value),children:[o.jsx("option",{value:"all",children:"All Statuses"}),Iu.map(M=>o.jsx("option",{value:M.value,children:M.label},M.value))]}),o.jsxs("select",{className:"filter-select",value:Se.levelOfInterest,onChange:M=>xr("levelOfInterest",M.target.value),children:[o.jsx("option",{value:"all",children:"All Interest Levels"}),kN.map(M=>o.jsx("option",{value:M.value,children:M.label},M.value))]}),o.jsxs("select",{className:"filter-select",value:Se.interestCondition,onChange:M=>xr("interestCondition",M.target.value),children:[o.jsx("option",{value:"all",children:"Aircraft Condition: Any"}),AC.map(M=>o.jsx("option",{value:M.value,children:M.label},M.value))]}),o.jsxs("select",{className:"filter-select",value:Se.interestPriority,onChange:M=>xr("interestPriority",M.target.value),children:[o.jsx("option",{value:"all",children:"Interest Priority: Any"}),TC.map(M=>o.jsx("option",{value:M.value,children:M.label},M.value))]}),o.jsxs("select",{className:"filter-select",value:Se.timeline,onChange:M=>xr("timeline",M.target.value),children:[o.jsx("option",{value:"all",children:"All Timelines"}),_v.map(M=>o.jsx("option",{value:M.value,children:M.label},M.value))]}),o.jsxs("select",{className:"filter-select",value:Se.manufacturer,onChange:M=>xr("manufacturer",M.target.value),children:[o.jsx("option",{value:"all",children:"All Aircraft Types"}),dn.map(M=>o.jsx("option",{value:M,children:M},M))]}),o.jsxs("select",{className:"filter-select",value:Se.lastContacted,onChange:M=>xr("lastContacted",M.target.value),children:[o.jsx("option",{value:"all",children:"Last Contacted: Any"}),o.jsx("option",{value:"today",children:"Today"}),o.jsx("option",{value:"week",children:"This Week"}),o.jsx("option",{value:"month",children:"This Month"}),o.jsx("option",{value:"overdue",children:"Overdue (14+ days)"}),o.jsx("option",{value:"never",children:"Never Contacted"})]}),Ei>0&&o.jsxs("button",{className:"clear-filters-btn",onClick:na,children:["Clear Filters (",Ei,")"]})]})]}),o.jsxs("div",{className:"contacts-results-header",children:[o.jsxs("span",{className:"results-count",children:[yr.length," contact",yr.length!==1?"s":""," found"]}),o.jsxs("div",{className:"contacts-results-actions",children:[o.jsxs("select",{className:"filter-select filter-select-small",value:it,onChange:M=>{kt(parseInt(M.target.value)),wt(1)},children:[o.jsx("option",{value:"10",children:"10"}),o.jsx("option",{value:"25",children:"25"}),o.jsx("option",{value:"50",children:"50"})]}),o.jsx(K,{size:"small",onClick:()=>t("/contacts/new"),children:"+ New Contact"})]})]}),$n?o.jsx("div",{className:"chart-empty",children:"Loading contacts..."}):ws.length>0?o.jsx("div",{className:"contacts-list-dashboard",children:ws.map(M=>{var Ne,Le,Ee,Ce;const ne=((Ee=(Le=(Ne=M.followUp)==null?void 0:Ne.lastContactedDate)==null?void 0:Le.toDate)==null?void 0:Ee.call(Le))||((Ce=M.followUp)==null?void 0:Ce.lastContactedDate),oe=M.aircraftInterests||[];return o.jsxs("div",{className:"contact-list-card",children:[o.jsxs("div",{className:"contact-card-main",children:[o.jsxs("div",{className:"contact-card-header",children:[o.jsxs(at,{to:`/contacts/${M.id}`,className:"contact-card-name",children:[M.firstName," ",M.lastName]}),o.jsx(jI,{contactId:M.id,currentStatus:M.status,compact:!0})]}),(M.companyName||M.company)&&o.jsx("div",{className:"contact-card-company",children:M.companyName||M.company}),o.jsxs("div",{className:"contact-card-meta",children:[M.levelOfInterest&&M.levelOfInterest!=="unknown"&&o.jsx("span",{className:`level-of-interest-badge level-${M.levelOfInterest}`,children:Ode(M.levelOfInterest)}),oe.length>0&&oe.some(Te=>Te.condition==="new")&&o.jsx("span",{className:"pref-badge pref-new",children:"New"}),oe.length>0&&oe.some(Te=>Te.condition==="used")&&o.jsx("span",{className:"pref-badge pref-used",children:"Used"}),M.timeline&&o.jsx("span",{className:"timeline-badge",children:_I(M.timeline)})]})]}),o.jsxs("div",{className:"contact-card-details",children:[oe.length>0&&o.jsxs("div",{className:"contact-interests",children:[o.jsx("span",{className:"detail-label",children:"Looking for:"}),o.jsxs("div",{className:"interest-tags",children:[oe.slice(0,3).map((Te,Nt)=>o.jsxs("span",{className:`interest-tag priority-${Te.priority||"medium"}`,children:[Te.manufacturer," ",Te.model,Te.priority&&o.jsx("span",{className:`priority-indicator priority-${Te.priority}`,children:Te.priority==="high"?"":Te.priority==="medium"?"":""})]},Nt)),oe.length>3&&o.jsxs("span",{className:"interest-more",children:["+",oe.length-3]})]})]}),o.jsxs("div",{className:"contact-last-contacted",children:[o.jsx("span",{className:"detail-label",children:"Last contacted:"}),o.jsx("span",{className:`last-contacted-value ${ne?"":"never"}`,children:ne?Kh(ne,{addSuffix:!0}):"Never"})]})]}),o.jsxs("div",{className:"contact-card-actions",children:[o.jsx(K,{variant:"secondary",size:"small",onClick:()=>{st(M),me(!0)},children:"Log Contact"}),o.jsx(at,{to:`/contacts/${M.id}`,className:"btn btn-ghost btn-small",children:"View"})]})]},M.id)})}):o.jsxs("div",{className:"chart-empty",children:[o.jsx("p",{children:"No contacts match your filters"}),Ei>0&&o.jsx(K,{variant:"secondary",size:"small",onClick:na,children:"Clear Filters"})]}),vr>1&&o.jsxs("div",{className:"listing-pagination",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>wt(M=>Math.max(1,M-1)),disabled:an===1,children:" Prev"}),o.jsxs("span",{className:"pagination-info",children:["Page ",an," of ",vr]}),o.jsx("button",{className:"pagination-btn",onClick:()=>wt(M=>Math.min(vr,M+1)),disabled:an===vr,children:"Next "})]})]}),gt==="exchange_rates"&&o.jsx("div",{className:"exchange-rates-section",children:o.jsxs("div",{className:"chart-card",children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h3",{children:"Exchange Rates"}),o.jsx("span",{className:"chart-subtitle",children:"Currency conversion rates for pricing tool (Base: USD)"})]}),u?o.jsx("div",{className:"rates-loading",children:"Loading exchange rates..."}):o.jsxs("div",{className:"exchange-rates-content",children:[o.jsxs("div",{className:"rates-info",children:[o.jsx("p",{children:"These rates are used to convert aircraft sale prices to USD for comparison in the pricing tool."}),c&&o.jsxs("p",{className:"rates-last-updated",children:["Last updated: ",rt(c,"MMM d, yyyy h:mm a")]})]}),o.jsxs("div",{className:"rates-grid",children:[o.jsxs("div",{className:"rate-card",children:[o.jsxs("div",{className:"rate-header",children:[o.jsx("span",{className:"rate-currency",children:"GBP"}),o.jsx("span",{className:"rate-name",children:"British Pound"})]}),o.jsxs("div",{className:"rate-value-row",children:[o.jsx("span",{className:"rate-symbol",children:"1 ="}),f?o.jsx("input",{type:"number",className:"rate-input",value:f.GBP,onChange:M=>p(ne=>({...ne,GBP:M.target.value})),step:"0.01",min:"0.01"}):o.jsxs("span",{className:"rate-value",children:["$",(Ch=l.GBP)==null?void 0:Ch.toFixed(2)]}),o.jsx("span",{className:"rate-usd",children:"USD"})]}),o.jsxs("div",{className:"rate-example",children:["Example: 1,000,000 = $",(1e6*l.GBP).toLocaleString()]})]}),o.jsxs("div",{className:"rate-card",children:[o.jsxs("div",{className:"rate-header",children:[o.jsx("span",{className:"rate-currency",children:"EUR"}),o.jsx("span",{className:"rate-name",children:"Euro"})]}),o.jsxs("div",{className:"rate-value-row",children:[o.jsx("span",{className:"rate-symbol",children:"1 ="}),f?o.jsx("input",{type:"number",className:"rate-input",value:f.EUR,onChange:M=>p(ne=>({...ne,EUR:M.target.value})),step:"0.01",min:"0.01"}):o.jsxs("span",{className:"rate-value",children:["$",(am=l.EUR)==null?void 0:am.toFixed(2)]}),o.jsx("span",{className:"rate-usd",children:"USD"})]}),o.jsxs("div",{className:"rate-example",children:["Example: 1,000,000 = $",(1e6*l.EUR).toLocaleString()]})]}),o.jsxs("div",{className:"rate-card rate-card-base",children:[o.jsxs("div",{className:"rate-header",children:[o.jsx("span",{className:"rate-currency",children:"USD"}),o.jsx("span",{className:"rate-name",children:"US Dollar (Base)"})]}),o.jsxs("div",{className:"rate-value-row",children:[o.jsx("span",{className:"rate-symbol",children:"$1 ="}),o.jsx("span",{className:"rate-value",children:"$1.00"}),o.jsx("span",{className:"rate-usd",children:"USD"})]}),o.jsx("div",{className:"rate-example",children:"Base currency - no conversion"})]})]}),o.jsx("div",{className:"rates-actions",children:f?o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>p(null),disabled:d,children:"Cancel"}),o.jsx(K,{onClick:async()=>{try{await h(f),p(null),s("Exchange rates updated")}catch{i("Failed to update exchange rates")}},loading:d,children:"Save Changes"})]}):o.jsxs(K,{variant:"secondary",onClick:()=>p({GBP:l.GBP,EUR:l.EUR}),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"Edit Rates"]})}),o.jsxs("div",{className:"rates-note",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),o.jsx("p",{children:"Changes to exchange rates will affect how new sales are converted to USD. Existing pricing records will retain their original conversion rates."})]})]})]})}),o.jsxs("div",{className:"chart-card",style:{marginBottom:"24px"},children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h3",{children:"Sales Attribution"}),o.jsx("span",{className:"chart-subtitle",children:"Team member contributions"})]}),Ft.length>0?o.jsx("div",{className:"attribution-list",children:Ft.map((M,ne)=>o.jsxs("details",{className:"attribution-dropdown",children:[o.jsxs("summary",{className:"attribution-item",children:[o.jsx("div",{className:`attribution-avatar ${M.name==="HQ Aviation"?"avatar-company":""}`,style:{background:M.name==="HQ Aviation"?"#1a1a1a":tc[ne%tc.length]},children:M.name==="HQ Aviation"?"HQ":M.name.charAt(0).toUpperCase()}),o.jsxs("div",{className:"attribution-info",children:[o.jsx("span",{className:"attribution-name",children:M.name}),o.jsxs("span",{className:"attribution-stats",children:[M.salesCount," deal",M.salesCount!==1?"s":"","  ",M.newCount>0&&o.jsxs("span",{className:"stat-new",children:[M.newCount," new"]}),M.newCount>0&&M.usedCount>0&&", ",M.usedCount>0&&o.jsxs("span",{className:"stat-used",children:[M.usedCount," used"]})]})]}),o.jsx("svg",{className:"attribution-chevron",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),o.jsxs("div",{className:"attribution-deals",children:[Object.keys(M.aircraftTypes).length>0&&o.jsx("div",{className:"attribution-types",children:Object.entries(M.aircraftTypes).map(([oe,Ne])=>o.jsxs("span",{className:"type-tag",children:[oe," ",o.jsxs("span",{className:"type-count",children:["",Ne]})]},oe))}),o.jsx("div",{className:"deals-list",children:M.deals.map((oe,Ne)=>o.jsxs(at,{to:`/listings/${oe.id}`,className:"deal-item",children:[o.jsxs("div",{className:"deal-aircraft",children:[o.jsxs("span",{className:"deal-name",children:[oe.year," ",oe.manufacturer," ",oe.model]}),oe.registration&&o.jsx("span",{className:"deal-reg",children:oe.registration})]}),o.jsxs("div",{className:"deal-meta",children:[o.jsx("span",{className:`deal-condition ${oe.isNew?"condition-new":"condition-used"}`,children:oe.isNew?"New":"Used"}),o.jsxs("span",{className:"deal-percentage",children:[oe.percentage,"%"]})]})]},oe.id||Ne))})]})]},M.name))}):o.jsxs("div",{className:"chart-empty",children:[o.jsx("p",{children:"No sales attributed yet"}),o.jsx("p",{className:"chart-empty-hint",children:"Assign team members when marking aircraft as sold"})]})]}),o.jsxs("div",{className:"dashboard-grid",children:[o.jsxs("div",{className:"dashboard-section",children:[o.jsx("h2",{className:"section-title",children:"Quick Actions"}),o.jsxs("div",{className:"quick-actions",children:[n(r.LISTINGS_CREATE)&&o.jsxs("button",{className:"action-card",onClick:()=>t("/listings/new"),children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),o.jsx("span",{className:"action-label",children:"Add Aircraft"}),o.jsx("span",{className:"action-hint",children:"New helicopter"})]}),n(r.BLOGS_CREATE)&&o.jsxs("button",{className:"action-card",onClick:()=>t("/blog/new"),children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 20h9"}),o.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})]})}),o.jsx("span",{className:"action-label",children:"Write Post"}),o.jsx("span",{className:"action-hint",children:"Blog content"})]}),n(r.ENQUIRIES_VIEW)&&o.jsxs("button",{className:"action-card",onClick:()=>t("/enquiries"),children:[o.jsx("span",{className:"action-icon",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),o.jsx("span",{className:"action-label",children:"Enquiries"}),o.jsx("span",{className:"action-hint",children:Gt.newEnquiries>0?`${Gt.newEnquiries} new`:"View all"})]}),o.jsxs("button",{className:"action-card",onClick:()=>t("/media"),children:[o.jsx("span",{className:"action-icon",children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),o.jsx("span",{className:"action-label",children:"Media"}),o.jsx("span",{className:"action-hint",children:"Upload images"})]})]})]}),n(r.ENQUIRIES_VIEW)&&o.jsxs("div",{className:"dashboard-section",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("h2",{className:"section-title",children:"Latest Enquiries"}),o.jsx(at,{to:"/enquiries",className:"section-link",children:"View all"})]}),tn.length===0?o.jsx("div",{className:"empty-state-sm",children:"No enquiries yet"}):o.jsx("div",{className:"enquiry-list-compact",children:tn.slice(0,5).map(M=>{var ne,oe,Ne;return o.jsxs(at,{to:`/enquiries/${M.id}`,className:"enquiry-item-compact",children:[o.jsx("span",{className:`status-dot status-${M.status||"new"}`}),o.jsxs("div",{className:"enquiry-item-content",children:[o.jsx("span",{className:"enquiry-item-name",children:M.name||"Unknown"}),o.jsx("span",{className:"enquiry-item-subject",children:M.subject||((ne=M.message)==null?void 0:ne.substring(0,40))||"General"})]}),o.jsx("span",{className:"enquiry-item-time",children:im(((Ne=(oe=M.createdAt)==null?void 0:oe.toDate)==null?void 0:Ne.call(oe))||new Date(M.createdAt))})]},M.id)})})]})]}),n(r.CONTACTS_VIEW)&&$t>0&&o.jsxs("div",{className:"chart-card",style:{marginTop:"24px"},children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h3",{children:"Contacts Needing Follow-up"}),o.jsx(at,{to:"/contacts",className:"section-link",children:"View all contacts"})]}),o.jsxs("div",{className:"followup-widget",children:[fe.length>0&&o.jsxs("div",{className:"followup-section",children:[o.jsxs("h4",{className:"followup-section-title followup-overdue",children:["Overdue (",fe.length,")"]}),o.jsx("div",{className:"followup-list",children:fe.slice(0,5).map(M=>o.jsxs("div",{className:"followup-item followup-item-overdue",children:[o.jsxs(at,{to:`/contacts/${M.id}`,className:"followup-item-main",children:[o.jsxs("span",{className:"followup-name",children:[M.firstName," ",M.lastName]}),M.company&&o.jsx("span",{className:"followup-company",children:M.company}),o.jsxs("span",{className:"followup-days",children:[Math.abs(M.daysUntil)," day",Math.abs(M.daysUntil)!==1?"s":""," overdue"]})]}),o.jsx(K,{variant:"secondary",size:"small",onClick:ne=>{ne.preventDefault(),st(M),me(!0)},children:"Log Contact"})]},M.id))})]}),Ae.length>0&&o.jsxs("div",{className:"followup-section",children:[o.jsxs("h4",{className:"followup-section-title followup-today",children:["Due Today (",Ae.length,")"]}),o.jsx("div",{className:"followup-list",children:Ae.slice(0,5).map(M=>o.jsxs("div",{className:"followup-item followup-item-today",children:[o.jsxs(at,{to:`/contacts/${M.id}`,className:"followup-item-main",children:[o.jsxs("span",{className:"followup-name",children:[M.firstName," ",M.lastName]}),M.company&&o.jsx("span",{className:"followup-company",children:M.company})]}),o.jsx(K,{variant:"secondary",size:"small",onClick:ne=>{ne.preventDefault(),st(M),me(!0)},children:"Log Contact"})]},M.id))})]}),Je.length>0&&o.jsxs("div",{className:"followup-section",children:[o.jsxs("h4",{className:"followup-section-title followup-tomorrow",children:["Due Tomorrow (",Je.length,")"]}),o.jsx("div",{className:"followup-list",children:Je.slice(0,3).map(M=>o.jsx("div",{className:"followup-item",children:o.jsxs(at,{to:`/contacts/${M.id}`,className:"followup-item-main",children:[o.jsxs("span",{className:"followup-name",children:[M.firstName," ",M.lastName]}),M.company&&o.jsx("span",{className:"followup-company",children:M.company})]})},M.id))})]})]})]}),ue&&o.jsx(Yb,{isOpen:ge,onClose:()=>{me(!1),st(null)},contactId:ue.id,contactName:`${ue.firstName} ${ue.lastName}`}),o.jsx(Qb,{isOpen:Ke,onClose:()=>{ot(!1)},title:"Select Contact for Mention",onSelect:M=>{V(M),ot(!1),ie(!0)}}),re&&mt&&lt&&o.jsx("div",{className:"modal-overlay",onClick:()=>{ie(!1),V(null),bt(null)},children:o.jsxs("div",{className:"modal modal-small",onClick:M=>M.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:"What is their relationship?"}),o.jsx("button",{className:"modal-close",onClick:()=>{ie(!1),V(null),bt(null)},children:""})]}),o.jsxs("div",{className:"modal-body",children:[o.jsxs("p",{className:"relationship-intro",children:["How is ",o.jsxs("strong",{children:[mt.firstName," ",mt.lastName]})," related to"," ",o.jsxs("strong",{children:[lt.year," ",lt.manufacturer," ",lt.model]}),"?"]}),o.jsx("div",{className:"relationship-options",children:Pt.map(M=>o.jsxs("button",{className:"relationship-option",onClick:()=>{Qe(M.value),ie(!1),Jn(!0)},children:[o.jsx("span",{className:"relationship-label",children:M.label}),o.jsx("span",{className:"relationship-desc",children:M.description})]},M.value))})]})]})}),o.jsx(Yb,{isOpen:At&&!!mt&&!!lt,onClose:()=>{Jn(!1),V(null),bt(null),Qe(null)},onSuccess:async M=>{if(lt&&mt)try{const ne=Lt.find(Ce=>Ce.id===lt.id),oe=(ne==null?void 0:ne.potentialBuyers)||[],Ne=oe.findIndex(Ce=>Ce.contactId===mt.id),Le={contactId:mt.id,firstName:mt.firstName,lastName:mt.lastName,company:mt.companyName||mt.company||null,contactType:mt.contactType||"individual",relationshipType:Fe,interestLevel:Fe==="potential_buyer"?"high":"medium",interactionType:(M==null?void 0:M.contactType)||"call",interactionSummary:(M==null?void 0:M.summary)||null,addedAt:new Date};let Ee;Ne>=0?(Ee=[...oe],Ee[Ne]={...Ee[Ne],...Le,addedAt:oe[Ne].addedAt}):Ee=[...oe,Le],await a(lt.id,{potentialBuyers:Ee,updatedAt:new Date})}catch(ne){console.error("Failed to add contact to aircraft:",ne)}},contactId:mt==null?void 0:mt.id,contactName:mt?`${mt.firstName} ${mt.lastName}`:"",linkedHelicopter:lt,relationshipType:Fe}),o.jsx(uW,{isOpen:Bs,onClose:()=>{ea(!1),Me(null)},aircraft:he,onSuccess:()=>{ea(!1),Me(null)}})]})}function Ude({isOpen:t,onClose:e,aircraft:n,targetStatus:r,onConfirm:s}){var p,m,g;const[i,a]=b.useState(!0),[l,c]=b.useState(!1),u=(p=n==null?void 0:n.saleHistory)==null?void 0:p[n.saleHistory.length-1],d=(m=n==null?void 0:n.soldAt)!=null&&m.toDate?n.soldAt.toDate():n!=null&&n.soldAt?new Date(n.soldAt):null,h=y=>{if(!y)return"Unknown date";try{return rt(y,"dd MMM yyyy 'at' HH:mm")}catch{return"Unknown date"}},f=async()=>{c(!0);try{await s(i),e()}catch(y){console.error("Failed to revert sale:",y)}c(!1)};return n?o.jsx(ut,{isOpen:t,onClose:e,title:"Revert Sale Status",size:"medium",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:e,disabled:l,children:"Cancel"}),o.jsx(K,{onClick:f,loading:l,children:i?"Make Available (Keep Sale Record)":"Make Available (Delete Sale)"})]}),children:o.jsxs("div",{className:"revert-sale-modal-content",children:[o.jsxs("div",{className:"revert-warning",children:[o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),o.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),o.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),o.jsx("p",{children:o.jsx("strong",{children:"Are you sure you want to make this aircraft available again?"})})]}),o.jsxs("div",{className:"sale-info-box",children:[o.jsx("p",{children:"A sale for this aircraft was recorded on:"}),o.jsx("p",{className:"sale-date-highlight",children:h(d)}),u&&o.jsxs("div",{className:"sale-details-preview",children:[o.jsxs("p",{children:[o.jsx("span",{className:"label",children:"Sale #:"}),o.jsxs("span",{className:"value",children:["#",u.saleNumber]})]}),((g=u.buyer)==null?void 0:g.name)&&o.jsxs("p",{children:[o.jsx("span",{className:"label",children:"Buyer:"}),o.jsx("span",{className:"value",children:u.buyer.name})]}),n.salePrice&&o.jsxs("p",{children:[o.jsx("span",{className:"label",children:"Price:"}),o.jsx("span",{className:"value",children:new Intl.NumberFormat("en-GB",{style:"currency",currency:n.currency||"GBP",minimumFractionDigits:0}).format(n.salePrice)})]})]})]}),o.jsxs("div",{className:"revert-options",children:[o.jsx("p",{className:"options-label",children:"Would you like to keep or delete the sale record?"}),o.jsxs("label",{className:`revert-option ${i?"selected":""}`,children:[o.jsx("input",{type:"radio",name:"keepSale",checked:i,onChange:()=>a(!0)}),o.jsxs("div",{className:"option-content",children:[o.jsx("span",{className:"option-title",children:"Keep the sale record"}),o.jsx("span",{className:"option-description",children:"The sale will remain in history. Useful if the aircraft is being re-listed or was a trade-in."})]})]}),o.jsxs("label",{className:`revert-option ${i?"":"selected"}`,children:[o.jsx("input",{type:"radio",name:"keepSale",checked:!i,onChange:()=>a(!1)}),o.jsxs("div",{className:"option-content",children:[o.jsx("span",{className:"option-title",children:"Delete the sale record"}),o.jsx("span",{className:"option-description",children:"Remove the sale as if it never happened. Use this if the sale was recorded by mistake."})]})]})]})]})}):null}const Ht={STATUS_CHANGE:"status_change",PRICE_CHANGE:"price_change",CREATED:"created",UPDATED:"updated",FEATURED:"featured",UNFEATURED:"unfeatured",SOLD:"sold",SALE_CANCELLED:"sale_cancelled",NOTE:"note"},pf={draft:"Off Market",off_market:"Off Market",available:"Available",taking_offers:"Taking Offers",under_negotiation:"Under Negotiation",sold:"Sold"};function zde(t){const[e,n]=b.useState([]),[r,s]=b.useState(!0),{user:i}=Xi();b.useEffect(()=>{if(!t){n([]),s(!1);return}(async()=>{s(!0);try{const y=We(ke,"helicopters",t),x=await us(y);if(x.exists()){const w=x.data();n(w.activityLog||[])}}catch(y){console.error("Error fetching activities:",y)}s(!1)})()},[t]);const a=async(g,y={})=>{if(!t)return!1;const x={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:g,timestamp:new Date().toISOString(),createdBy:(i==null?void 0:i.displayName)||(i==null?void 0:i.email)||"System",createdById:(i==null?void 0:i.uid)||null,...y};try{const w=We(ke,"helicopters",t);return await _t(w,{activityLog:gu(x)}),n(N=>[...N,x]),!0}catch(w){return console.error("Error adding activity:",w),!1}};return{activities:e,loading:r,addActivity:a,logStatusChange:async(g,y,x="")=>a(Ht.STATUS_CHANGE,{oldStatus:g,newStatus:y,oldStatusLabel:pf[g]||g,newStatusLabel:pf[y]||y,notes:x}),logSale:async g=>a(Ht.SOLD,{salePrice:g.salePrice,buyerName:g.buyerName,buyerContactId:g.buyerContactId,attributionType:g.attributionType,attributions:g.attributions,notes:g.notes}),logSaleCancelled:async(g="")=>a(Ht.SALE_CANCELLED,{reason:g,notes:"Sale was marked as cancelled/mistake"}),logPriceChange:async(g,y,x)=>a(Ht.PRICE_CHANGE,{oldPrice:g,newPrice:y,currency:x}),logFeaturedChange:async g=>a(g?Ht.FEATURED:Ht.UNFEATURED,{featured:g}),addNote:async g=>a(Ht.NOTE,{note:g}),deleteActivity:async g=>{if(!t||!e.find(x=>x.id===g))return!1;try{const x=We(ke,"helicopters",t),w=await us(x);if(w.exists()){const S=(w.data().activityLog||[]).filter(C=>C.id!==g);return await _t(x,{activityLog:S}),n(S),!0}return!1}catch(x){return console.error("Error deleting activity:",x),!1}},getSortedActivities:()=>[...e].sort((g,y)=>new Date(y.timestamp)-new Date(g.timestamp))}}const Am=[{id:"db-1",registration:"N12345",manufacturer:"Robinson",model:"R66",year:2021,totalHours:520,estimatedValue:78e4,currency:"USD",location:"Texas, USA",source:"FAA Registry",lastUpdated:"2024-01-20",specs:{maxSpeed:140,range:350,passengers:4},isOurs:!1},{id:"db-2",registration:"D-HELI",manufacturer:"Airbus",model:"H135",year:2020,totalHours:890,estimatedValue:52e5,currency:"EUR",location:"Munich, Germany",source:"EASA Registry",lastUpdated:"2024-01-18",specs:{maxSpeed:155,range:395,passengers:6},isOurs:!1},{id:"db-3",registration:"VH-HEL",manufacturer:"Bell",model:"429",year:2019,totalHours:1450,estimatedValue:48e5,currency:"USD",location:"Sydney, Australia",source:"CASA Registry",lastUpdated:"2024-01-15",specs:{maxSpeed:161,range:411,passengers:7},isOurs:!1},{id:"db-4",registration:"F-GXYZ",manufacturer:"Airbus",model:"H145",year:2022,totalHours:280,estimatedValue:85e5,currency:"EUR",location:"Paris, France",source:"DGAC Registry",lastUpdated:"2024-01-22",specs:{maxSpeed:153,range:680,passengers:9},isOurs:!1},{id:"db-5",registration:"C-GHEL",manufacturer:"Leonardo",model:"AW139",year:2018,totalHours:2100,estimatedValue:92e5,currency:"USD",location:"Toronto, Canada",source:"Transport Canada",lastUpdated:"2024-01-19",specs:{maxSpeed:165,range:573,passengers:15},isOurs:!1},{id:"db-6",registration:"ZK-HEL",manufacturer:"MD Helicopters",model:"MD 902",year:2016,totalHours:3200,estimatedValue:21e5,currency:"USD",location:"Auckland, New Zealand",source:"CAA NZ",lastUpdated:"2024-01-17",specs:{maxSpeed:155,range:300,passengers:7},isOurs:!1},{id:"db-7",registration:"JA01HE",manufacturer:"Sikorsky",model:"S-76D",year:2020,totalHours:650,estimatedValue:125e5,currency:"USD",location:"Tokyo, Japan",source:"JCAB Registry",lastUpdated:"2024-01-21",specs:{maxSpeed:178,range:411,passengers:12},isOurs:!1},{id:"db-8",registration:"I-HELI",manufacturer:"Leonardo",model:"AW169",year:2021,totalHours:420,estimatedValue:78e5,currency:"EUR",location:"Milan, Italy",source:"ENAC Registry",lastUpdated:"2024-01-20",specs:{maxSpeed:168,range:440,passengers:10},isOurs:!1}],QM=[{key:"registration",label:"Registration",required:!0},{key:"manufacturer",label:"Manufacturer",required:!0},{key:"model",label:"Model",required:!0},{key:"year",label:"Year",required:!0},{key:"serialNumber",label:"Serial Number",required:!1},{key:"totalHours",label:"Total Hours",required:!1},{key:"engineHours",label:"Engine Hours",required:!1},{key:"engineTBO",label:"Engine TBO",required:!1},{key:"price",label:"Price",required:!1},{key:"currency",label:"Currency",required:!1},{key:"location",label:"Location",required:!1},{key:"condition",label:"Condition",required:!1},{key:"ownerName",label:"Owner Name",required:!1},{key:"ownerAddress",label:"Owner Address",required:!1},{key:"description",label:"Description",required:!1}],Hde={imported:"Imported to System",registration_change:"Registration Changed",owner_change:"Ownership Transferred",sold:"Aircraft Sold",acquired:"Aircraft Acquired",status_change:"Status Updated",price_change:"Price Changed",service:"Service Performed"},ia={SPLIT:"split",KANBAN:"kanban",TABLE:"table"},zu=[{id:"off_market",label:"Off Market",color:"#6b7280",description:"In inventory but not listed"},{id:"available",label:"Available",color:"#22c55e",description:"Listed and available"},{id:"taking_offers",label:"Taking Offers",color:"#f59e0b",description:"Accepting offers"},{id:"under_negotiation",label:"Under Negotiation",color:"#8b5cf6",description:"In active negotiation"},{id:"sold",label:"Sold",color:"#3b82f6",description:"Sale completed"}],Wde=`registration,manufacturer,model,year,serialNumber,totalHours,engineHours,price,currency,location,condition,ownerName,ownerAddress,description
G-EXAMPLE,Robinson,R44 Raven II,2020,R44-14523,680,680,425000,GBP,London UK,Excellent,Skyward Aviation Ltd,"45 Airport Road, Cheltenham, GL51 6SR, United Kingdom",Low hours example aircraft`;function qde(){const t=rr(),{can:e,PERMISSIONS:n}=Js(),{success:r,error:s}=qt(),{user:i}=Xi(),{data:a,loading:l}=pn("helicopters",[qr("createdAt","desc")]),{create:c,update:u}=Ms("helicopters"),[d,h]=b.useState(()=>localStorage.getItem("aircraftViewMode")||ia.TABLE),f=b.useRef(null),[p,m]=b.useState(!1),[g,y]=b.useState(!1),x=b.useCallback(()=>{if(f.current){const{scrollLeft:z,scrollWidth:le,clientWidth:be}=f.current;m(z>5),y(z<le-be-5)}},[]),w=b.useCallback(z=>{f.current&&(f.current.scrollBy({left:z==="left"?-300:300,behavior:"smooth"}),setTimeout(x,350))},[x]);b.useEffect(()=>{if(d===ia.KANBAN){const z=setTimeout(x,100);return window.addEventListener("resize",x),()=>{clearTimeout(z),window.removeEventListener("resize",x)}}},[d,x]);const[N,S]=b.useState(!1),[C,A]=b.useState(null),[j,_]=b.useState(1),[E,I]=b.useState(!1),[T,P]=b.useState(""),[O,H]=b.useState("all"),[X,se]=b.useState("all"),[L,B]=b.useState("all"),[$,q]=b.useState("updatedAt"),[Y,R]=b.useState("desc"),[G,Z]=b.useState({registration:!0,aircraft:!0,year:!0,hours:!0,price:!0,status:!0,location:!0,days:!0}),[W,Q]=b.useState(!1),[U,pe]=b.useState(1),[J,ge]=b.useState(25),[me,ue]=b.useState(null),[st,Ke]=b.useState(()=>{const z=localStorage.getItem("importedDatabaseAircraft");return z?JSON.parse(z):[]}),[ot,lt]=b.useState(""),[bt,mt]=b.useState("all"),[V,re]=b.useState("all"),[ie,Fe]=b.useState("all"),Qe=b.useMemo(()=>{const z=new Set(Am.map(le=>le.manufacturer).filter(Boolean));return Array.from(z).sort()},[]),At=b.useMemo(()=>{const z=new Set(Am.map(le=>le.source).filter(Boolean));return Array.from(z).sort()},[]),Jn=b.useMemo(()=>{let z=Am;bt!=="all"&&(z=Am.filter(be=>be.manufacturer===bt));const le=new Set(z.map(be=>be.model).filter(Boolean));return Array.from(le).sort()},[bt]);b.useEffect(()=>{re("all")},[bt]);const Pt=b.useMemo(()=>{let z=Am.filter(le=>!st.includes(le.id));if(ot){const le=ot.toLowerCase();z=z.filter(be=>{var Oe,Ue,Ft,jn,dn;return((Oe=be.registration)==null?void 0:Oe.toLowerCase().includes(le))||((Ue=be.manufacturer)==null?void 0:Ue.toLowerCase().includes(le))||((Ft=be.model)==null?void 0:Ft.toLowerCase().includes(le))||((jn=be.serialNumber)==null?void 0:jn.toLowerCase().includes(le))||((dn=be.location)==null?void 0:dn.toLowerCase().includes(le))})}return bt!=="all"&&(z=z.filter(le=>le.manufacturer===bt)),V!=="all"&&(z=z.filter(le=>le.model===V)),ie!=="all"&&(z=z.filter(le=>le.source===ie)),z},[st,ot,bt,V,ie]),[gt,Pn]=b.useState(null),[ji,Zi]=b.useState(!1),[ri,Bs]=b.useState(null),[ea,he]=b.useState(!1),[Me,Se]=b.useState(null),[vt,it]=b.useState(null),kt=b.useMemo(()=>{const z=new Date;return a.map(le=>{var Oe,Ue,Ft,jn,dn,yr,ws;let be=((Ue=(Oe=le.createdAt)==null?void 0:Oe.toDate)==null?void 0:Ue.call(Oe))||z;if(le.activityLog&&le.activityLog.length>0){const vr=le.activityLog.filter(xr=>xr.type==="status_change").sort((xr,na)=>new Date(na.timestamp)-new Date(xr.timestamp));vr.length>0&&(be=new Date(vr[0].timestamp))}if(le.status==="sold"&&le.soldAt){const vr=((jn=(Ft=le.soldAt)==null?void 0:Ft.toDate)==null?void 0:jn.call(Ft))||new Date(le.soldAt);vr>be&&(be=vr)}if(le.updatedAt&&(!le.activityLog||le.activityLog.length===0)){const vr=((yr=(dn=le.updatedAt)==null?void 0:dn.toDate)==null?void 0:yr.call(dn))||new Date(le.updatedAt);vr>be&&(be=vr)}return{...le,daysOnMarket:(ws=le.createdAt)!=null&&ws.toDate?dl(z,le.createdAt.toDate()):0,daysSinceStatusChange:dl(z,be),kanbanStatus:le.status==="draft"?"off_market":le.status||"off_market"}})},[a]),an=b.useMemo(()=>{const z=new Set(kt.map(le=>le.manufacturer).filter(Boolean));return Array.from(z).sort()},[kt]),wt=b.useMemo(()=>{let z=kt;X!=="all"&&(z=kt.filter(be=>be.manufacturer===X));const le=new Set(z.map(be=>be.model).filter(Boolean));return Array.from(le).sort()},[kt,X]);b.useEffect(()=>{B("all")},[X]);const Lt=b.useMemo(()=>{let z=[...kt];if(T){const le=T.toLowerCase();z=z.filter(be=>{var Oe,Ue,Ft;return((Oe=be.registration)==null?void 0:Oe.toLowerCase().includes(le))||((Ue=be.manufacturer)==null?void 0:Ue.toLowerCase().includes(le))||((Ft=be.model)==null?void 0:Ft.toLowerCase().includes(le))})}return O!=="all"&&(z=z.filter(le=>le.status===O||le.kanbanStatus===O)),X!=="all"&&(z=z.filter(le=>le.manufacturer===X)),L!=="all"&&(z=z.filter(le=>le.model===L)),z.sort((le,be)=>{var Ft,jn,dn,yr,ws,vr,xr,na,Ei,ec,ra,ii;let Oe=le[$],Ue=be[$];return $==="price"?(Oe=le.salePrice||le.price||0,Ue=be.salePrice||be.price||0):$==="updatedAt"?(Oe=((jn=(Ft=le.updatedAt)==null?void 0:Ft.toDate)==null?void 0:jn.call(Ft))||le.updatedAt||((yr=(dn=le.createdAt)==null?void 0:dn.toDate)==null?void 0:yr.call(dn))||new Date(0),Ue=((vr=(ws=be.updatedAt)==null?void 0:ws.toDate)==null?void 0:vr.call(ws))||be.updatedAt||((na=(xr=be.createdAt)==null?void 0:xr.toDate)==null?void 0:na.call(xr))||new Date(0),Oe=Oe instanceof Date?Oe.getTime():new Date(Oe).getTime()||0,Ue=Ue instanceof Date?Ue.getTime():new Date(Ue).getTime()||0):$==="createdAt"&&(Oe=((ec=(Ei=le.createdAt)==null?void 0:Ei.toDate)==null?void 0:ec.call(Ei))||le.createdAt||new Date(0),Ue=((ii=(ra=be.createdAt)==null?void 0:ra.toDate)==null?void 0:ii.call(ra))||be.createdAt||new Date(0),Oe=Oe instanceof Date?Oe.getTime():new Date(Oe).getTime()||0,Ue=Ue instanceof Date?Ue.getTime():new Date(Ue).getTime()||0),typeof Oe=="string"?Y==="asc"?Oe.localeCompare(Ue):Ue.localeCompare(Oe):Y==="asc"?(Oe||0)-(Ue||0):(Ue||0)-(Oe||0)}),z},[kt,T,O,X,L,$,Y]),Vn=Math.ceil(Lt.length/J),Zn=b.useMemo(()=>{const z=(U-1)*J;return Lt.slice(z,z+J)},[Lt,U,J]);b.useEffect(()=>{pe(1)},[T,O,X,L]);const si=b.useMemo(()=>{const z={};return zu.forEach(le=>{z[le.id]=Lt.filter(be=>be.kanbanStatus===le.id)}),z},[Lt]),Zr=b.useMemo(()=>({total:kt.length,offMarket:kt.filter(z=>z.kanbanStatus==="off_market").length,available:kt.filter(z=>z.kanbanStatus==="available").length,takingOffers:kt.filter(z=>z.kanbanStatus==="taking_offers").length,underNegotiation:kt.filter(z=>z.kanbanStatus==="under_negotiation").length,sold:kt.filter(z=>z.kanbanStatus==="sold").length}),[kt]),Vs=z=>{h(z),localStorage.setItem("aircraftViewMode",z)},$n=z=>{$===z?R(le=>le==="asc"?"desc":"asc"):(q(z),R("desc"))},fe=(z,le)=>{Pn(le),z.dataTransfer.effectAllowed="move"},Ae=z=>{z.preventDefault(),z.dataTransfer.dropEffect="move"},Je=async(z,le)=>{var be;if(z.preventDefault(),!gt||gt.kanbanStatus===le){Pn(null);return}if(le==="sold"){Bs(gt),Zi(!0),Pn(null);return}if(gt.kanbanStatus==="sold"&&gt.soldAt){it(gt),Se(le),he(!0),Pn(null);return}try{const Oe=le,Ue=gt.kanbanStatus,Ft={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"status_change",timestamp:new Date().toISOString(),createdBy:(i==null?void 0:i.displayName)||(i==null?void 0:i.email)||"System",createdById:(i==null?void 0:i.uid)||null,oldStatus:Ue,newStatus:Oe,oldStatusLabel:pf[Ue]||Ue,newStatusLabel:pf[Oe]||Oe};await u(gt.id,{status:Oe,updatedAt:new Date,activityLog:gu(Ft)}),r(`Moved to ${(be=zu.find(jn=>jn.id===le))==null?void 0:be.label}`)}catch{s("Failed to update status")}Pn(null)},$t=async z=>{var le;if(!(!vt||!Me)){try{let be={status:Me,soldAt:null,salePrice:null,saleAttribution:null,buyerName:null,buyerContactId:null,buyerContact:null,saleNotes:null,updatedAt:new Date};if(!z){const Ue=vt.saleHistory||[];be.saleHistory=Ue.slice(0,-1).map((Ft,jn)=>({...Ft,saleNumber:jn+1}))}const Oe={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:z?"status_change":"sale_cancelled",timestamp:new Date().toISOString(),createdBy:(i==null?void 0:i.displayName)||(i==null?void 0:i.email)||"System",createdById:(i==null?void 0:i.uid)||null,oldStatus:"sold",newStatus:Me,oldStatusLabel:pf.sold||"Sold",newStatusLabel:pf[Me]||Me,reason:z?"Sale record kept":"Sale record deleted"};await u(vt.id,{...be,activityLog:gu(Oe)}),r(`Moved to ${(le=zu.find(Ue=>Ue.id===Me))==null?void 0:le.label}${z?"":" (sale record removed)"}`)}catch{s("Failed to revert sale")}he(!1),it(null),Se(null)}},tn=z=>{var Oe;const le=(Oe=z.target.files)==null?void 0:Oe[0];if(!le)return;const be=new FileReader;be.onload=Ue=>{const Ft=Ue.target.result;gr(Ft)},be.readAsText(le)},bs=z=>{var Oe;z.preventDefault();const le=(Oe=z.dataTransfer.files)==null?void 0:Oe[0];if(!le||!le.name.endsWith(".csv")){s("Please drop a CSV file");return}const be=new FileReader;be.onload=Ue=>{const Ft=Ue.target.result;gr(Ft)},be.readAsText(le)},gr=z=>{const le=z.split(`
`).filter(Ue=>Ue.trim());if(le.length<2){s("CSV file is empty or has no data rows");return}const be=le[0].split(",").map(Ue=>Ue.trim().toLowerCase()),Oe=[];for(let Ue=1;Ue<le.length;Ue++){const Ft=le[Ue].split(",").map(dn=>dn.trim()),jn={};QM.forEach(dn=>{const yr=be.findIndex(ws=>ws===dn.key.toLowerCase()||ws===dn.label.toLowerCase());yr!==-1&&Ft[yr]?jn[dn.key]=Ft[yr]:jn[dn.key]=dn.required?"Unknown":""}),(jn.registration||jn.manufacturer)&&Oe.push(jn)}A(Oe),_(2)},ir=()=>{const z=new Blob([Wde],{type:"text/csv"}),le=URL.createObjectURL(z),be=document.createElement("a");be.href=le,be.download="aircraft_import_template.csv",be.click(),URL.revokeObjectURL(le)},Gt=async()=>{if(C!=null&&C.length){I(!0);try{let z=0;const le=new Date;for(const be of C){const Oe=be.ownerName||be.ownerAddress,Ue=[{id:`import-${Date.now()}-${z}`,type:"imported",date:le,registration:be.registration||"Unknown",notes:"Imported via CSV",source:"CSV Import",...Oe&&{newOwner:{name:be.ownerName||"Unknown",address:be.ownerAddress||""}}}];await c({registration:be.registration||"Unknown",manufacturer:be.manufacturer||"Unknown",model:be.model||"Unknown",year:parseInt(be.year)||new Date().getFullYear(),serialNumber:be.serialNumber||"",totalHours:parseInt(be.totalHours)||0,specs:{engineHours:parseInt(be.engineHours)||0},price:parseInt(be.price)||0,currency:be.currency||"GBP",location:be.location||"",condition:be.condition||"Unknown",status:be.status||"draft",description:be.description||"",currentOwner:Oe?{name:be.ownerName||"Unknown",address:be.ownerAddress||""}:null,registrationHistory:Ue,createdAt:le,updatedAt:le}),z++}r(`Successfully imported ${z} aircraft`),S(!1),A(null),_(1)}catch{s("Failed to import some aircraft")}I(!1)}},ta=(z,le="GBP")=>z?`${le==="GBP"?"":le==="EUR"?"":"$"}${z.toLocaleString()}`:"-";return l?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"aircraft-page-integrated",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Aircraft"}),o.jsxs("p",{className:"page-subtitle",children:[Zr.total," total aircraft"]})]}),o.jsxs("div",{className:"page-header-actions",children:[o.jsxs(K,{variant:"secondary",onClick:()=>S(!0),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),"Import CSV"]}),e(n.LISTINGS_CREATE)&&o.jsx(K,{onClick:()=>t("/listings/new"),children:"Add Aircraft"})]})]}),o.jsxs("div",{className:"view-mode-tabs",children:[o.jsxs("button",{className:`view-tab ${d===ia.TABLE?"active":""}`,onClick:()=>Vs(ia.TABLE),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),o.jsx("line",{x1:"3",y1:"15",x2:"21",y2:"15"}),o.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),"Table"]}),o.jsxs("button",{className:`view-tab ${d===ia.KANBAN?"active":""}`,onClick:()=>Vs(ia.KANBAN),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"5",height:"18",rx:"1"}),o.jsx("rect",{x:"10",y:"3",width:"5",height:"12",rx:"1"}),o.jsx("rect",{x:"17",y:"3",width:"5",height:"8",rx:"1"})]}),"Kanban"]}),o.jsxs("button",{className:`view-tab ${d===ia.SPLIT?"active":""}`,onClick:()=>Vs(ia.SPLIT),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"21"})]}),"Split View"]})]}),d===ia.TABLE&&o.jsxs("div",{className:"aircraft-filters-bar",children:[o.jsxs("div",{className:"filters-left",children:[o.jsxs("div",{className:"search-wrapper",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search aircraft...",value:T,onChange:z=>P(z.target.value),className:"search-input"})]}),o.jsxs("select",{className:"filter-select",value:O,onChange:z=>H(z.target.value),children:[o.jsx("option",{value:"all",children:"All Status"}),zu.map(z=>o.jsx("option",{value:z.id,children:z.label},z.id))]}),o.jsxs("select",{className:"filter-select",value:X,onChange:z=>se(z.target.value),children:[o.jsx("option",{value:"all",children:"All Manufacturers"}),an.map(z=>o.jsx("option",{value:z,children:z},z))]}),o.jsxs("select",{className:"filter-select",value:L,onChange:z=>B(z.target.value),children:[o.jsx("option",{value:"all",children:"All Models"}),wt.map(z=>o.jsx("option",{value:z,children:z},z))]})]}),o.jsxs("div",{className:"filters-right",children:[o.jsx("div",{className:"sort-dropdown-wrapper",children:o.jsxs("select",{className:"filter-select sort-select",value:`${$}-${Y}`,onChange:z=>{const[le,be]=z.target.value.split("-");q(le),R(be)},children:[o.jsx("option",{value:"updatedAt-desc",children:"Last Updated (Newest)"}),o.jsx("option",{value:"updatedAt-asc",children:"Last Updated (Oldest)"}),o.jsx("option",{value:"price-desc",children:"Price (High to Low)"}),o.jsx("option",{value:"price-asc",children:"Price (Low to High)"}),o.jsx("option",{value:"year-desc",children:"Year (Newest)"}),o.jsx("option",{value:"year-asc",children:"Year (Oldest)"})]})}),o.jsxs("button",{className:"column-picker-btn",onClick:()=>Q(!W),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),"Columns"]}),W&&o.jsx("div",{className:"column-picker-dropdown",children:Object.entries(G).map(([z,le])=>o.jsxs("label",{className:"column-option",children:[o.jsx("input",{type:"checkbox",checked:le,onChange:be=>Z(Oe=>({...Oe,[z]:be.target.checked}))}),z.charAt(0).toUpperCase()+z.slice(1)]},z))})]})]}),d===ia.TABLE&&o.jsxs("div",{className:"aircraft-table-wrapper",children:[o.jsxs("table",{className:"aircraft-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[G.registration&&o.jsxs("th",{onClick:()=>$n("registration"),className:"sortable",children:["Registration ",$==="registration"&&(Y==="asc"?"":"")]}),G.aircraft&&o.jsxs("th",{onClick:()=>$n("manufacturer"),className:"sortable",children:["Aircraft ",$==="manufacturer"&&(Y==="asc"?"":"")]}),G.year&&o.jsxs("th",{onClick:()=>$n("year"),className:"sortable",children:["Year ",$==="year"&&(Y==="asc"?"":"")]}),G.hours&&o.jsxs("th",{onClick:()=>$n("totalHours"),className:"sortable",children:["Hours ",$==="totalHours"&&(Y==="asc"?"":"")]}),G.price&&o.jsxs("th",{onClick:()=>$n("price"),className:"sortable",children:["Price ",$==="price"&&(Y==="asc"?"":"")]}),G.status&&o.jsx("th",{children:"Status"}),G.location&&o.jsx("th",{children:"Location"}),G.days&&o.jsxs("th",{onClick:()=>$n("daysSinceStatusChange"),className:"sortable",children:["Days Since Status Change ",$==="daysSinceStatusChange"&&(Y==="asc"?"":"")]}),o.jsx("th",{children:"Actions"})]})}),o.jsx("tbody",{children:Zn.map(z=>{var le,be;return o.jsxs("tr",{children:[G.registration&&o.jsx("td",{className:"cell-registration",children:z.registration||"-"}),G.aircraft&&o.jsx("td",{children:o.jsxs(at,{to:`/listings/${z.id}/edit`,className:"aircraft-link",children:[z.manufacturer," ",z.model]})}),G.year&&o.jsx("td",{children:z.year}),G.hours&&o.jsx("td",{children:((le=z.totalHours)==null?void 0:le.toLocaleString())||"-"}),G.price&&o.jsx("td",{className:"cell-price",children:z.priceType==="poa"?"POA":ta(z.price,z.currency)}),G.status&&o.jsx("td",{children:o.jsx("span",{className:`status-pill status-${z.kanbanStatus}`,children:((be=zu.find(Oe=>Oe.id===z.kanbanStatus))==null?void 0:be.label)||z.status})}),G.location&&o.jsx("td",{children:z.location||"-"}),G.days&&o.jsx("td",{className:z.daysSinceStatusChange>90?"days-warning":"",children:z.daysSinceStatusChange}),o.jsx("td",{children:o.jsx(at,{to:`/listings/${z.id}/edit`,className:"action-link",children:"Edit"})})]},z.id)})})]}),Lt.length===0&&o.jsx("div",{className:"empty-state",children:"No aircraft match your filters"}),Vn>1&&o.jsxs("div",{className:"table-pagination",children:[o.jsxs("div",{className:"pagination-info",children:["Showing ",(U-1)*J+1,"-",Math.min(U*J,Lt.length)," of ",Lt.length]}),o.jsxs("div",{className:"pagination-controls",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>pe(1),disabled:U===1,children:""}),o.jsx("button",{className:"pagination-btn",onClick:()=>pe(z=>Math.max(1,z-1)),disabled:U===1,children:" Prev"}),o.jsxs("span",{className:"pagination-pages",children:["Page ",U," of ",Vn]}),o.jsx("button",{className:"pagination-btn",onClick:()=>pe(z=>Math.min(Vn,z+1)),disabled:U===Vn,children:"Next "}),o.jsx("button",{className:"pagination-btn",onClick:()=>pe(Vn),disabled:U===Vn,children:""})]}),o.jsxs("select",{className:"pagination-select",value:J,onChange:z=>{ge(parseInt(z.target.value)),pe(1)},children:[o.jsx("option",{value:10,children:"10 per page"}),o.jsx("option",{value:25,children:"25 per page"}),o.jsx("option",{value:50,children:"50 per page"}),o.jsx("option",{value:100,children:"100 per page"})]})]})]}),d===ia.KANBAN&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"aircraft-filters-bar",children:o.jsxs("div",{className:"filters-left",children:[o.jsxs("div",{className:"search-wrapper",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search aircraft...",value:T,onChange:z=>P(z.target.value),className:"search-input"})]}),o.jsxs("select",{className:"filter-select",value:X,onChange:z=>se(z.target.value),children:[o.jsx("option",{value:"all",children:"All Manufacturers"}),an.map(z=>o.jsx("option",{value:z,children:z},z))]}),o.jsxs("select",{className:"filter-select",value:L,onChange:z=>B(z.target.value),children:[o.jsx("option",{value:"all",children:"All Models"}),wt.map(z=>o.jsx("option",{value:z,children:z},z))]})]})}),o.jsxs("div",{className:"aircraft-kanban-wrapper",children:[p&&o.jsx("button",{className:"scroll-indicator scroll-left",onClick:()=>w("left"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),g&&o.jsx("button",{className:"scroll-indicator scroll-right",onClick:()=>w("right"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx("div",{className:"aircraft-kanban",ref:f,onScroll:x,children:zu.map(z=>{var le,be;return o.jsxs("div",{className:`kanban-column ${gt?"drop-target":""}`,style:{"--status-color":z.color},onDragOver:Ae,onDrop:Oe=>Je(Oe,z.id),children:[o.jsx("div",{className:"kanban-column-header",children:o.jsxs("div",{className:"kanban-title",children:[o.jsx("span",{className:"status-indicator"}),o.jsx("h3",{children:z.label}),o.jsx("span",{className:"count",children:((le=si[z.id])==null?void 0:le.length)||0})]})}),o.jsx("div",{className:"kanban-cards",children:(be=si[z.id])==null?void 0:be.map(Oe=>{var Ue;return o.jsxs("div",{className:"kanban-card",draggable:!0,onDragStart:Ft=>fe(Ft,Oe),children:[o.jsxs("div",{className:"kanban-card-header",children:[o.jsx("span",{className:"registration",children:Oe.registration||"No Reg"}),Oe.featured&&o.jsx("span",{className:"featured-star",children:""})]}),o.jsxs("div",{className:"kanban-card-title",children:[Oe.year," ",Oe.manufacturer," ",Oe.model]}),o.jsxs("div",{className:"kanban-card-meta",children:[o.jsxs("span",{children:[((Ue=Oe.totalHours)==null?void 0:Ue.toLocaleString())||"0"," hrs"]}),o.jsx("span",{children:ta(Oe.price,Oe.currency)})]}),o.jsxs("div",{className:"kanban-card-footer",children:[o.jsxs("span",{className:"days",children:[Oe.daysSinceStatusChange,"d"]}),o.jsx(at,{to:`/listings/${Oe.id}/edit`,className:"edit-link",children:"Edit"})]})]},Oe.id)})})]},z.id)})})]})]}),d===ia.SPLIT&&o.jsxs("div",{className:"aircraft-split-view",children:[o.jsxs("div",{className:"split-panel our-aircraft",children:[o.jsxs("div",{className:"split-panel-header",children:[o.jsx("h3",{children:"Our Aircraft"}),o.jsx("span",{className:"badge",children:Lt.length})]}),o.jsx("div",{className:"database-search-bar",children:o.jsxs("div",{className:"search-wrapper",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search registration, manufacturer, model...",value:T,onChange:z=>P(z.target.value)})]})}),o.jsxs("div",{className:"database-filters",children:[o.jsxs("select",{value:O,onChange:z=>H(z.target.value),children:[o.jsx("option",{value:"all",children:"All Statuses"}),zu.map(z=>o.jsx("option",{value:z.id,children:z.label},z.id))]}),o.jsxs("select",{value:X,onChange:z=>se(z.target.value),children:[o.jsx("option",{value:"all",children:"All Manufacturers"}),an.map(z=>o.jsx("option",{value:z,children:z},z))]}),o.jsxs("select",{value:L,onChange:z=>B(z.target.value),children:[o.jsx("option",{value:"all",children:"All Models"}),wt.map(z=>o.jsx("option",{value:z,children:z},z))]})]}),o.jsx("div",{className:"split-panel-content",children:Lt.length===0?o.jsx("div",{className:"database-empty",children:o.jsx("p",{children:T||O!=="all"||X!=="all"||L!=="all"?"No aircraft match your filters":"No aircraft in inventory"})}):Lt.map(z=>o.jsxs("div",{className:"split-item",children:[o.jsxs("div",{className:"split-item-main",children:[o.jsx("span",{className:"registration",children:z.registration||"-"}),o.jsxs("span",{className:"aircraft-name",children:[z.year," ",z.manufacturer," ",z.model]})]}),o.jsxs("div",{className:"split-item-meta",children:[o.jsx("span",{className:`status-dot status-${z.kanbanStatus}`}),o.jsx("span",{className:"price",children:ta(z.price,z.currency)})]})]},z.id))})]}),o.jsx("div",{className:"split-divider",children:o.jsx(K,{size:"small",disabled:!me||E,loading:E,onClick:async()=>{var z,le,be;if(me){I(!0);try{const Oe=new Date;await c({registration:me.registration||"",manufacturer:me.manufacturer||"",model:me.model||"",year:me.year||new Date().getFullYear(),serialNumber:me.serialNumber||"",totalHours:me.totalHours||0,specs:{engineHours:me.engineHours||0,maxSpeed:(z=me.specs)==null?void 0:z.maxSpeed,range:(le=me.specs)==null?void 0:le.range,passengers:(be=me.specs)==null?void 0:be.passengers},price:me.estimatedValue||me.price||0,currency:me.currency||"GBP",location:me.location||"",condition:me.condition||"",status:"draft",description:me.description||"",currentOwner:me.currentOwner||null,registrationHistory:[{id:`import-${Date.now()}`,type:"imported",date:Oe,registration:me.registration,notes:`Imported from ${me.source||"Aircraft Database"}`,source:me.source||"Database Import"}],createdAt:Oe,updatedAt:Oe});const Ue=[...st,me.id];Ke(Ue),localStorage.setItem("importedDatabaseAircraft",JSON.stringify(Ue)),r(`${me.registration} added to Our Aircraft`),ue(null)}catch{s("Failed to import aircraft")}I(!1)}},children:" Add to Our Aircraft"})}),o.jsxs("div",{className:"split-panel database-aircraft",children:[o.jsxs("div",{className:"split-panel-header",children:[o.jsx("h3",{children:"Aircraft Database"}),o.jsx("span",{className:"badge",children:Pt.length})]}),o.jsx("div",{className:"database-search-bar",children:o.jsxs("div",{className:"search-wrapper",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search registration, manufacturer, model...",value:ot,onChange:z=>lt(z.target.value)})]})}),o.jsxs("div",{className:"database-filters",children:[o.jsxs("select",{value:bt,onChange:z=>mt(z.target.value),children:[o.jsx("option",{value:"all",children:"All Manufacturers"}),Qe.map(z=>o.jsx("option",{value:z,children:z},z))]}),o.jsxs("select",{value:V,onChange:z=>re(z.target.value),children:[o.jsx("option",{value:"all",children:"All Models"}),Jn.map(z=>o.jsx("option",{value:z,children:z},z))]}),o.jsxs("select",{value:ie,onChange:z=>Fe(z.target.value),children:[o.jsx("option",{value:"all",children:"All Sources"}),At.map(z=>o.jsx("option",{value:z,children:z},z))]})]}),o.jsx("div",{className:"split-panel-content",children:Pt.length===0?o.jsx("div",{className:"database-empty",children:o.jsx("p",{children:ot||bt!=="all"||V!=="all"||ie!=="all"?"No aircraft match your filters":"No aircraft in database"})}):Pt.map(z=>o.jsxs("div",{className:`split-item selectable ${(me==null?void 0:me.id)===z.id?"selected":""}`,onClick:()=>ue((me==null?void 0:me.id)===z.id?null:z),children:[o.jsxs("div",{className:"split-item-main",children:[o.jsx("span",{className:"registration",children:z.registration}),o.jsxs("span",{className:"aircraft-name",children:[z.year," ",z.manufacturer," ",z.model]})]}),o.jsxs("div",{className:"split-item-meta",children:[o.jsx("span",{className:"source-tag",children:z.source}),o.jsx("span",{className:"location",children:z.location})]})]},z.id))})]})]}),o.jsx(uW,{isOpen:ji,onClose:()=>{Zi(!1),Bs(null)},aircraft:ri,onSuccess:()=>{Zi(!1),Bs(null)}}),o.jsx(Ude,{isOpen:ea,onClose:()=>{he(!1),it(null),Se(null)},aircraft:vt,targetStatus:Me,onConfirm:$t}),o.jsx(ut,{isOpen:N,onClose:()=>{S(!1),A(null),_(1)},title:"Import Aircraft from CSV",size:"medium",children:o.jsxs("div",{className:"csv-import-modal",children:[j===1&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"csv-drop-zone",onDragOver:z=>z.preventDefault(),onDrop:bs,onClick:()=>document.getElementById("csv-file-input").click(),children:[o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("p",{children:"Drag & drop CSV file here"}),o.jsx("p",{className:"hint",children:"or click to browse"}),o.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:tn,style:{display:"none"}})]}),o.jsxs("div",{className:"csv-template-section",children:[o.jsx("p",{children:"Not sure what format to use?"}),o.jsx(K,{variant:"secondary",size:"small",onClick:ir,children:"Download Template"})]}),o.jsxs("div",{className:"csv-fields-info",children:[o.jsx("h4",{children:"Expected Fields:"}),o.jsx("div",{className:"fields-grid",children:QM.map(z=>o.jsxs("span",{className:z.required?"required":"",children:[z.label,z.required&&"*"]},z.key))}),o.jsx("p",{className:"note",children:"* Required fields. Missing optional fields will be left blank."})]})]}),j===2&&C&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"import-preview",children:[o.jsxs("h4",{children:["Preview: ",C.length," aircraft to import"]}),o.jsxs("div",{className:"preview-table-wrapper",children:[o.jsxs("table",{className:"preview-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Registration"}),o.jsx("th",{children:"Manufacturer"}),o.jsx("th",{children:"Model"}),o.jsx("th",{children:"Year"}),o.jsx("th",{children:"Status"})]})}),o.jsx("tbody",{children:C.slice(0,10).map((z,le)=>o.jsxs("tr",{children:[o.jsx("td",{children:z.registration}),o.jsx("td",{children:z.manufacturer}),o.jsx("td",{children:z.model}),o.jsx("td",{children:z.year}),o.jsx("td",{children:z.status||"draft"})]},le))})]}),C.length>10&&o.jsxs("p",{className:"more-rows",children:["...and ",C.length-10," more"]})]})]}),o.jsxs("div",{className:"import-actions",children:[o.jsx(K,{variant:"secondary",onClick:()=>{_(1),A(null)},children:"Back"}),o.jsxs(K,{onClick:Gt,loading:E,children:["Import ",C.length," Aircraft"]})]})]})]})})]})}function Gde(){return o.jsx(qde,{})}const oi={Robinson:{models:{"R22 Beta II":{engine:"Lycoming O-360-J2A",seats:2},"R44 Raven I":{engine:"Lycoming O-540-F1B5 (Carbureted)",seats:4},"R44 Raven II":{engine:"Lycoming IO-540-AE1A5 (Fuel Injected)",seats:4},"R44 Cadet":{engine:"Lycoming O-540-F1B5",seats:2},"R66 Turbine":{engine:"Rolls-Royce RR300",seats:5}}},Bell:{models:{"206B JetRanger III":{engine:"Rolls-Royce 250-C20J",seats:5},"206L-4 LongRanger":{engine:"Rolls-Royce 250-C30P",seats:7},407:{engine:"Rolls-Royce 250-C47B",seats:7},"407GXi":{engine:"Rolls-Royce M250-C47E/4",seats:7},429:{engine:"2x P&W PW207D1",seats:8},412:{engine:"2x P&W PT6T-3D Twin Pac",seats:15},"505 Jet Ranger X":{engine:"Safran Arrius 2R",seats:5}}},"Airbus Helicopters":{models:{"H125 (AS350 B3e)":{engine:"Safran Arriel 2D",seats:6},"H130 (EC130 T2)":{engine:"Safran Arriel 2D",seats:8},H135:{engine:"2x Safran Arrius 2B2Plus",seats:8},H145:{engine:"2x Safran Arriel 2E",seats:12},H155:{engine:"2x Turbomeca Arriel 2C2",seats:13},H160:{engine:"2x Safran Arrano 1A",seats:12},H175:{engine:"2x P&W PT6C-67E",seats:18}}},Leonardo:{models:{"AW109 GrandNew":{engine:"2x P&W PW207C",seats:8},"AW109 Trekker":{engine:"2x P&W PW207C",seats:8},AW119Kx:{engine:"P&W PT6B-37A",seats:8},AW139:{engine:"2x P&W PT6C-67C",seats:15},AW169:{engine:"2x P&W PW210A",seats:12},AW189:{engine:"2x GE CT7-2E1",seats:19}}},"MD Helicopters":{models:{"MD 500E":{engine:"Rolls-Royce 250-C20B",seats:5},"MD 520N":{engine:"Rolls-Royce 250-C20R/2",seats:5},"MD 530F":{engine:"Rolls-Royce 250-C30",seats:5},"MD 600N":{engine:"Rolls-Royce 250-C47M",seats:8},"MD 902 Explorer":{engine:"2x P&W PW206E",seats:8}}},Sikorsky:{models:{"S-76C++":{engine:"2x Turbomeca Arriel 2S2",seats:13},"S-76D":{engine:"2x P&W PW210S",seats:13},"S-92":{engine:"2x GE CT7-8A",seats:19}}},Guimbal:{models:{"Cabri G2":{engine:"Lycoming O-360-J2A",seats:2}}},Enstrom:{models:{"280FX Shark":{engine:"Lycoming HIO-360-F1AD",seats:3},"480B":{engine:"Rolls-Royce 250-C20W",seats:5}}}},Y_=["Garmin G500H TXi","Garmin G500H","Garmin G1000H NXi","Garmin G1000H","Garmin GTN 750Xi","Garmin GTN 750","Garmin GTN 650Xi","Garmin GTN 650","Garmin GNC 255A","Garmin GTX 345","Garmin GTX 335","Garmin GTX 330ES","Garmin GMA 350H","Garmin GFC 600H Autopilot","Garmin GRA 55 Radar Altimeter","Aspen EFD1000H Pro","Genesys HeliSAS","Genesys IDU-680","Honeywell Primus Epic","Collins Pro Line 21","ADS-B In/Out","TCAS II","EGPWS/HTAWS","Weather Radar","XM Weather","Satellite Phone","ELT (406 MHz)"],Q_=["Air Conditioning","Auxiliary Heater","Leather Interior","Cloth Interior","Executive Interior","VIP Configuration","Pop-out Floats","Fixed Floats","Emergency Float System","Cargo Hook","Cargo Mirror","Wire Strike Protection System","Ground Handling Wheels","Blade Tie-downs","Snow Shoes / Bear Paws","Inlet Barrier Filter","Heated Pitot","Rotor Brake","Dual Controls","Training Mirrors","Bubble Windows","Sliding Doors","Clamshell Doors","Hoist / Winch","Searchlight","FLIR Camera","External Speakers / PA","Aux Fuel Tank","Long Range Tanks","USB Charging Ports","Noise Cancelling Headsets","4-Point Harnesses","Night Vision Compatible","IFR Certified","RVSM Certified","Apical Life Raft"],dW=[{value:"paid",label:"VAT Paid"},{value:"plus",label:"Plus VAT"},{value:"exempt",label:"VAT Exempt"},{value:"na",label:"Not Applicable"}],hW=["New","Excellent","Very Good","Good","Fair","Project"],Xb=[{value:"GBP",label:"GBP ()",symbol:""},{value:"USD",label:"USD ($)",symbol:"$"},{value:"EUR",label:"EUR ()",symbol:""}],Mx=["Single Owner","Low Hours","Fresh Annual Inspection","No Damage History","Always Hangared","Complete Logbooks","Corrosion Prevention Program","Factory New Engine","Recently Overhauled","IFR Equipped","Corporate Maintained","Never Used for Training","Import Ready","Turnkey Ready","Part 135 Maintained","Exceptional Condition","Motivated Seller","Priced to Sell"];function X_(t){return!t||!Array.isArray(t)?[]:t.map(e=>typeof e=="string"?{name:e,price:0}:{name:e.name||"",price:e.price||0})}function no(t){return t.map(e=>({name:e,price:0}))}function fW(t,e){const[n,r]=b.useState([]),[s,i]=b.useState([]),[a,l]=b.useState([]),[c,u]=b.useState(!0),d=()=>!t||!e?null:`${t}_${e}`.replace(/[\/\s]+/g,"_");return b.useEffect(()=>{(async()=>{const C=d();if(!C){r(no(Y_)),i(no(Q_)),l(no(Mx)),u(!1);return}u(!0);try{const A=We(ke,"aircraft_options",C),j=await us(A);if(j.exists()){const _=j.data();r(X_(_.avionics)),i(X_(_.equipment)),l(X_(_.highlights)||no(Mx))}else{const _=no(Y_),E=no(Q_),I=no(Mx);await mu(A,{manufacturer:t,model:e,avionics:_,equipment:E,highlights:I,createdAt:new Date}),r(_),i(E),l(I)}}catch(A){console.error("Error fetching aircraft options:",A),r(no(Y_)),i(no(Q_)),l(no(Mx))}u(!1)})()},[t,e]),{avionicsOptions:n,equipmentOptions:s,highlightsOptions:a,loading:c,addAvionicsOption:async(S,C=0)=>{const A=d();if(!A||!S.trim())return!1;const j=S.trim();if(n.some(_=>_.name===j))return!1;try{const _={name:j,price:C},E=[...n,_],I=We(ke,"aircraft_options",A);return await _t(I,{avionics:E}),r(E),!0}catch(_){return console.error("Error adding avionics option:",_),!1}},editAvionicsOption:async(S,C,A)=>{const j=d();if(!j||!C.trim())return!1;const _=C.trim();if(S!==_&&n.some(E=>E.name===_))return!1;try{const E=n.map(T=>T.name===S?{name:_,price:A}:T),I=We(ke,"aircraft_options",j);return await _t(I,{avionics:E}),r(E),!0}catch(E){return console.error("Error editing avionics option:",E),!1}},removeAvionicsOption:async S=>{const C=d();if(!C)return!1;try{const A=n.filter(_=>_.name!==S),j=We(ke,"aircraft_options",C);return await _t(j,{avionics:A}),r(A),!0}catch(A){return console.error("Error removing avionics option:",A),!1}},addEquipmentOption:async(S,C=0)=>{const A=d();if(!A||!S.trim())return!1;const j=S.trim();if(s.some(_=>_.name===j))return!1;try{const _={name:j,price:C},E=[...s,_],I=We(ke,"aircraft_options",A);return await _t(I,{equipment:E}),i(E),!0}catch(_){return console.error("Error adding equipment option:",_),!1}},editEquipmentOption:async(S,C,A)=>{const j=d();if(!j||!C.trim())return!1;const _=C.trim();if(S!==_&&s.some(E=>E.name===_))return!1;try{const E=s.map(T=>T.name===S?{name:_,price:A}:T),I=We(ke,"aircraft_options",j);return await _t(I,{equipment:E}),i(E),!0}catch(E){return console.error("Error editing equipment option:",E),!1}},removeEquipmentOption:async S=>{const C=d();if(!C)return!1;try{const A=s.filter(_=>_.name!==S),j=We(ke,"aircraft_options",C);return await _t(j,{equipment:A}),i(A),!0}catch(A){return console.error("Error removing equipment option:",A),!1}},addHighlightsOption:async(S,C=0)=>{const A=d();if(!A||!S.trim())return!1;const j=S.trim();if(a.some(_=>_.name===j))return!1;try{const _={name:j,price:C},E=[...a,_],I=We(ke,"aircraft_options",A);return await _t(I,{highlights:E}),l(E),!0}catch(_){return console.error("Error adding highlights option:",_),!1}},editHighlightsOption:async(S,C,A)=>{const j=d();if(!j||!C.trim())return!1;const _=C.trim();if(S!==_&&a.some(E=>E.name===_))return!1;try{const E=a.map(T=>T.name===S?{name:_,price:A}:T),I=We(ke,"aircraft_options",j);return await _t(I,{highlights:E}),l(E),!0}catch(E){return console.error("Error editing highlights option:",E),!1}},removeHighlightsOption:async S=>{const C=d();if(!C)return!1;try{const A=a.filter(_=>_.name!==S),j=We(ke,"aircraft_options",C);return await _t(j,{highlights:A}),l(A),!0}catch(A){return console.error("Error removing highlights option:",A),!1}}}}function Pu(){const[t,e]=b.useState([]),[n,r]=b.useState({}),[s,i]=b.useState({}),[a,l]=b.useState(!0);b.useEffect(()=>{(async()=>{l(!0);try{const _=We(ke,"settings","aircraft_types"),E=await us(_);if(E.exists()){const I=E.data(),T=I.data||{},P=I.overrides||{},O=I.deletedDefaults||[];i({custom:T,overrides:P,deletedDefaults:O});const H=c(oi,T,P,O);r(H),e(Object.keys(H).sort())}else i({custom:{},overrides:{},deletedDefaults:[]}),r(oi),e(Object.keys(oi).sort())}catch(_){console.error("Error fetching aircraft types:",_),i({custom:{},overrides:{},deletedDefaults:[]}),r(oi),e(Object.keys(oi).sort())}l(!1)})()},[]);const c=(j,_,E,I)=>{const T={};for(const[P,O]of Object.entries(j)){if(I.includes(`manufacturer:${P}`))continue;const H=E[`manufacturer:${P}`]||P;T[H]||(T[H]={models:{}});for(const[X,se]of Object.entries(O.models||{})){if(I.includes(`model:${P}:${X}`))continue;const L=E[`model:${P}:${X}`],B=(L==null?void 0:L.name)||X,$=(L==null?void 0:L.engine)??se.engine;T[H].models[B]={...se,engine:$}}}for(const[P,O]of Object.entries(_)){T[P]||(T[P]={models:{}});for(const[H,X]of Object.entries(O.models||{}))T[P].models[H]=X}return T},u=async(j,_,E)=>{const I=We(ke,"settings","aircraft_types");await mu(I,{data:j,overrides:_,deletedDefaults:E})},d=j=>!j||!n[j]?[]:Object.keys(n[j].models||{}).sort(),h=(j,_)=>{var E,I,T;return((T=(I=(E=n[j])==null?void 0:E.models)==null?void 0:I[_])==null?void 0:T.engine)||""},f=j=>{if(oi[j])return!0;for(const _ of Object.keys(s.overrides||{}))if(_.startsWith("manufacturer:")&&s.overrides[_]===j)return!0;return!1},p=j=>{for(const[_,E]of Object.entries(s.overrides||{}))if(_.startsWith("manufacturer:")&&E===j)return _.replace("manufacturer:","");return oi[j]?j:null},m=async j=>{if(!j.trim())return!1;const _=j.trim();if(t.includes(_))return!1;try{const E={...s.custom};E[_]={models:{}},await u(E,s.overrides,s.deletedDefaults),i(T=>({...T,custom:E}));const I=c(oi,E,s.overrides,s.deletedDefaults);return r(I),e(Object.keys(I).sort()),!0}catch(E){return console.error("Error adding manufacturer:",E),!1}},g=async(j,_)=>{if(!j||!_.trim())return!1;const E=_.trim();if(j===E)return!0;if(t.includes(E))return!1;try{const I={...s.custom},T={...s.overrides},P=p(j);if(P)T[`manufacturer:${P}`]=E;else if(I[j])I[E]=I[j],delete I[j];else return!1;await u(I,T,s.deletedDefaults),i(H=>({...H,custom:I,overrides:T}));const O=c(oi,I,T,s.deletedDefaults);return r(O),e(Object.keys(O).sort()),!0}catch(I){return console.error("Error editing manufacturer:",I),!1}},y=async j=>{if(!j)return!1;try{const _={...s.custom},E={...s.overrides},I=[...s.deletedDefaults||[]],T=p(j);T&&(I.push(`manufacturer:${T}`),delete E[`manufacturer:${T}`]),_[j]&&delete _[j],await u(_,E,I),i(O=>({...O,custom:_,overrides:E,deletedDefaults:I}));const P=c(oi,_,E,I);return r(P),e(Object.keys(P).sort()),!0}catch(_){return console.error("Error deleting manufacturer:",_),!1}},x=(j,_)=>{var I,T;let E=j;for(const[P,O]of Object.entries(s.overrides||{}))if(P.startsWith("manufacturer:")&&O===j){E=P.replace("manufacturer:","");break}if((T=(I=oi[E])==null?void 0:I.models)!=null&&T[_])return{manufacturer:E,model:_};for(const[P,O]of Object.entries(s.overrides||{}))if(P.startsWith(`model:${E}:`)&&(O==null?void 0:O.name)===_)return{manufacturer:E,model:P.split(":")[2]};return null};return{manufacturers:t,aircraftData:n,loading:a,getModelsForManufacturer:d,getEngineForModel:h,addManufacturer:m,addModel:async(j,_,E="")=>{if(!j||!_.trim())return!1;const I=_.trim();if(d(j).includes(I))return!1;try{const P={...s.custom};let O=j;const H=p(j);H&&!P[j]&&(O=H),P[O]||(P[O]={models:{}}),P[O].models[I]={engine:E.trim(),seats:0},await u(P,s.overrides,s.deletedDefaults),i(se=>({...se,custom:P}));const X=c(oi,P,s.overrides,s.deletedDefaults);return r(X),!0}catch(P){return console.error("Error adding model:",P),!1}},editManufacturer:g,editModel:async(j,_,E,I)=>{var O;if(!j||!_||!E.trim())return!1;const T=E.trim();if(d(j).includes(T)&&_!==T)return!1;try{const H={...s.custom},X={...s.overrides},se=x(j,_);if(se){const B=`model:${se.manufacturer}:${se.model}`;X[B]={name:T,engine:(I==null?void 0:I.trim())||""}}else{let B=null;for(const $ of Object.keys(H))if((O=H[$].models)!=null&&O[_]){B=$;break}if(B)_!==T?(H[B].models[T]={...H[B].models[_],engine:(I==null?void 0:I.trim())||""},delete H[B].models[_]):H[B].models[_].engine=(I==null?void 0:I.trim())||"";else return!1}await u(H,X,s.deletedDefaults),i(B=>({...B,custom:H,overrides:X}));const L=c(oi,H,X,s.deletedDefaults);return r(L),!0}catch(H){return console.error("Error editing model:",H),!1}},deleteManufacturer:y,deleteModel:async(j,_)=>{var E;if(!j||!_)return!1;try{const I={...s.custom},T={...s.overrides},P=[...s.deletedDefaults||[]],O=x(j,_);O&&(P.push(`model:${O.manufacturer}:${O.model}`),delete T[`model:${O.manufacturer}:${O.model}`]);for(const X of Object.keys(I))if((E=I[X].models)!=null&&E[_]){delete I[X].models[_],Object.keys(I[X].models).length===0&&delete I[X];break}await u(I,T,P),i(X=>({...X,custom:I,overrides:T,deletedDefaults:P}));const H=c(oi,I,T,P);return r(H),e(Object.keys(H).sort()),!0}catch(I){return console.error("Error deleting model:",I),!1}},isCustomManufacturer:j=>!f(j),isCustomModel:(j,_)=>!x(j,_),isDefaultManufacturer:f}}function Pf({title:t,options:e,selectedValues:n,onToggle:r,onAdd:s,onEdit:i,onRemove:a,disabled:l=!1}){const[c,u]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(""),[m,g]=b.useState(""),[y,x]=b.useState(null),[w,N]=b.useState(""),[S,C]=b.useState(""),[A,j]=b.useState(null),[_,E]=b.useState(!1),I=()=>{h(!0),p(""),g("")},T=async()=>{if(!f.trim())return;await s(f.trim(),parseFloat(m)||0)&&(h(!1),p(""),g(""))},P=()=>{h(!1),p(""),g("")},O=$=>{var q;x($),N($.name),C(((q=$.price)==null?void 0:q.toString())||"0")},H=async()=>{if(!w.trim()||!y)return;await i(y.name,w.trim(),parseFloat(S)||0)&&(x(null),N(""),C(""))},X=()=>{x(null),N(""),C("")},se=$=>{j($)},L=async()=>{A&&(E(!0),await a(A),E(!1),j(null))},B=$=>!$&&$!==0?"":`${$.toLocaleString()}`;return o.jsxs("div",{className:"options-grid-container",children:[o.jsxs("div",{className:"options-grid-header",children:[o.jsx("h3",{children:t}),o.jsxs("label",{className:"options-price-toggle",children:[o.jsx("input",{type:"checkbox",checked:c,onChange:$=>u($.target.checked)}),o.jsx("span",{children:"Show prices"})]})]}),o.jsxs("div",{className:"options-grid",children:[e.map($=>o.jsxs("div",{className:"option-item",children:[o.jsxs("label",{className:"option-checkbox",children:[o.jsx("input",{type:"checkbox",checked:n.includes($.name),onChange:()=>r($.name),disabled:l}),o.jsx("span",{className:"option-name",children:$.name}),c&&$.price>0&&o.jsx("span",{className:"option-price",children:B($.price)})]}),o.jsxs("div",{className:"option-actions",children:[o.jsx("button",{type:"button",className:"option-action-btn option-edit-btn",onClick:()=>O($),title:"Edit option",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),o.jsx("button",{type:"button",className:"option-action-btn option-delete-btn",onClick:()=>se($.name),title:"Delete option",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"3,6 5,6 21,6"}),o.jsx("path",{d:"M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"})]})})]})]},$.name)),d?o.jsxs("div",{className:"option-item option-add-form",children:[o.jsx("input",{type:"text",value:f,onChange:$=>p($.target.value),placeholder:"Option name...",className:"option-add-input",autoFocus:!0,onKeyDown:$=>{$.key==="Enter"&&T(),$.key==="Escape"&&P()}}),o.jsx("input",{type:"number",value:m,onChange:$=>g($.target.value),placeholder:"Price",className:"option-add-price",onKeyDown:$=>{$.key==="Enter"&&T(),$.key==="Escape"&&P()}}),o.jsx("button",{type:"button",className:"option-add-confirm",onClick:T,title:"Add",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20,6 9,17 4,12"})})}),o.jsx("button",{type:"button",className:"option-add-cancel",onClick:P,title:"Cancel",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):o.jsxs("button",{type:"button",className:"option-item option-add-btn",onClick:I,disabled:l,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),o.jsx("span",{children:"Add option"})]})]}),o.jsxs(ut,{isOpen:!!y,onClose:X,title:"Edit Option",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:X,children:"Cancel"}),o.jsx(K,{onClick:H,children:"Save"})]}),children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Option Name"}),o.jsx("input",{type:"text",value:w,onChange:$=>N($.target.value),className:"form-input",autoFocus:!0})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Price ()"}),o.jsx("input",{type:"number",value:S,onChange:$=>C($.target.value),className:"form-input",placeholder:"0"}),o.jsx("span",{className:"form-help",children:"Internal value for pricing calculations"})]})]}),o.jsxs(ut,{isOpen:!!A,onClose:()=>j(null),title:"Delete Option",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>j(null),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:L,loading:_,children:"Delete"})]}),children:[o.jsxs("p",{children:['Are you sure you want to delete "',o.jsx("strong",{children:A}),'"?']}),o.jsx("p",{className:"form-help",style:{marginTop:"12px"},children:"This will only remove it from the available options list. Existing listings that have this option will not be affected."})]})]})}function pW({isOpen:t,onClose:e,manufacturers:n=[],getModelsForManufacturer:r,getEngineForModel:s,onAddManufacturer:i,onEditManufacturer:a,onDeleteManufacturer:l,onAddModel:c,onEditModel:u,onDeleteModel:d,selectedManufacturer:h,selectedModel:f,onSelectManufacturer:p,onSelectModel:m}){const[g,y]=b.useState("manufacturers"),[x,w]=b.useState(""),[N,S]=b.useState(!1),[C,A]=b.useState(""),[j,_]=b.useState(null),[E,I]=b.useState(""),[T,P]=b.useState(!1),[O,H]=b.useState(""),[X,se]=b.useState(""),[L,B]=b.useState(""),[$,q]=b.useState(null),[Y,R]=b.useState(""),[G,Z]=b.useState(""),[W,Q]=b.useState(""),[U,pe]=b.useState(null),[J,ge]=b.useState(!1),me=n.filter(ie=>ie.toLowerCase().includes(x.toLowerCase()));b.useEffect(()=>{t||(w(""),S(!1),_(null),P(!1),q(null),pe(null))},[t]);const ue=async()=>{if(!C.trim())return;ge(!0),await i(C.trim())&&(A(""),S(!1),p==null||p(C.trim())),ge(!1)},st=async()=>{if(!j||!E.trim())return;ge(!0),await a(j,E.trim())&&(h===j&&(p==null||p(E.trim())),_(null),I("")),ge(!1)},Ke=async ie=>{ge(!0),await l(ie)&&(h===ie&&(p==null||p(""),m==null||m("")),pe(null)),ge(!1)},ot=async()=>{if(!O||!X.trim())return;ge(!0),await c(O,X.trim(),L.trim())&&(h===O&&(m==null||m(X.trim())),se(""),B(""),P(!1)),ge(!1)},lt=async()=>{if(!Y||!$||!G.trim())return;ge(!0),await u(Y,$,G.trim(),W.trim())&&(h===Y&&f===$&&(m==null||m(G.trim())),q(null),R(""),Z(""),Q("")),ge(!1)},bt=async(ie,Fe)=>{ge(!0),await d(ie,Fe)&&(h===ie&&f===Fe&&(m==null||m("")),pe(null)),ge(!1)},mt=ie=>{_(ie),I(ie)},V=(ie,Fe)=>{R(ie),q(Fe),Z(Fe),Q((s==null?void 0:s(ie,Fe))||"")},re=ie=>{H(ie),se(""),B(""),P(!0)};return o.jsx(ut,{isOpen:t,onClose:e,title:"Manage Aircraft Types",size:"large",children:o.jsxs("div",{className:"aircraft-types-manager",children:[o.jsxs("div",{className:"atm-tabs",children:[o.jsxs("button",{className:`atm-tab ${g==="manufacturers"?"active":""}`,onClick:()=>y("manufacturers"),children:["Manufacturers (",n.length,")"]}),o.jsx("button",{className:`atm-tab ${g==="models"?"active":""}`,onClick:()=>y("models"),children:"All Models"})]}),o.jsx("div",{className:"atm-search",children:o.jsx(ye,{placeholder:g==="manufacturers"?"Search manufacturers...":"Search models...",value:x,onChange:ie=>w(ie.target.value)})}),g==="manufacturers"&&o.jsxs("div",{className:"atm-content",children:[o.jsx("div",{className:"atm-toolbar",children:o.jsx(K,{size:"small",onClick:()=>S(!0),children:"+ Add Manufacturer"})}),N&&o.jsxs("div",{className:"atm-inline-form",children:[o.jsx(ye,{placeholder:"Manufacturer name",value:C,onChange:ie=>A(ie.target.value),autoFocus:!0}),o.jsxs("div",{className:"atm-form-actions",children:[o.jsx(K,{size:"small",onClick:ue,loading:J,children:"Add"}),o.jsx(K,{size:"small",variant:"secondary",onClick:()=>{S(!1),A("")},children:"Cancel"})]})]}),o.jsx("div",{className:"atm-list",children:me.map(ie=>{const Fe=(r==null?void 0:r(ie))||[],Qe=j===ie;return o.jsx("div",{className:"atm-item",children:Qe?o.jsxs("div",{className:"atm-edit-form",children:[o.jsx(ye,{value:E,onChange:At=>I(At.target.value),autoFocus:!0}),o.jsxs("div",{className:"atm-form-actions",children:[o.jsx(K,{size:"small",onClick:st,loading:J,children:"Save"}),o.jsx(K,{size:"small",variant:"secondary",onClick:()=>{_(null),I("")},children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"atm-item-main",children:[o.jsx("span",{className:"atm-item-name",children:ie}),o.jsxs("span",{className:"atm-item-count",children:[Fe.length," models"]})]}),o.jsxs("div",{className:"atm-item-actions",children:[o.jsx("button",{className:"atm-action-btn",onClick:()=>mt(ie),title:"Edit manufacturer name",children:"Edit"}),o.jsx("button",{className:"atm-action-btn atm-action-delete",onClick:()=>pe({type:"manufacturer",name:ie}),title:"Delete manufacturer",children:"Delete"})]})]})},ie)})})]}),g==="models"&&o.jsxs("div",{className:"atm-content",children:[o.jsx("div",{className:"atm-toolbar",children:o.jsx(K,{size:"small",onClick:()=>{H(h||n[0]||""),P(!0)},children:"+ Add Model"})}),T&&o.jsxs("div",{className:"atm-inline-form atm-model-form",children:[o.jsxs("select",{className:"form-select",value:O,onChange:ie=>H(ie.target.value),children:[o.jsx("option",{value:"",children:"Select manufacturer"}),n.map(ie=>o.jsx("option",{value:ie,children:ie},ie))]}),o.jsx(ye,{placeholder:"Model name",value:X,onChange:ie=>se(ie.target.value)}),o.jsx(ye,{placeholder:"Engine (optional)",value:L,onChange:ie=>B(ie.target.value)}),o.jsxs("div",{className:"atm-form-actions",children:[o.jsx(K,{size:"small",onClick:ot,loading:J,disabled:!O,children:"Add"}),o.jsx(K,{size:"small",variant:"secondary",onClick:()=>{P(!1),se(""),B("")},children:"Cancel"})]})]}),o.jsx("div",{className:"atm-list",children:me.map(ie=>{const Fe=((r==null?void 0:r(ie))||[]).filter(Qe=>x?Qe.toLowerCase().includes(x.toLowerCase()):!0);return Fe.length===0&&x?null:o.jsxs("div",{className:"atm-manufacturer-group",children:[o.jsxs("div",{className:"atm-group-header",children:[o.jsx("span",{children:ie}),o.jsx("button",{className:"atm-add-model-btn",onClick:()=>re(ie),children:"+ Add Model"})]}),o.jsxs("div",{className:"atm-models-list",children:[Fe.map(Qe=>{const At=$===Qe&&Y===ie,Jn=(s==null?void 0:s(ie,Qe))||"";return o.jsx("div",{className:"atm-model-item",children:At?o.jsxs("div",{className:"atm-edit-form",children:[o.jsx(ye,{placeholder:"Model name",value:G,onChange:Pt=>Z(Pt.target.value),autoFocus:!0}),o.jsx(ye,{placeholder:"Engine",value:W,onChange:Pt=>Q(Pt.target.value)}),o.jsxs("div",{className:"atm-form-actions",children:[o.jsx(K,{size:"small",onClick:lt,loading:J,children:"Save"}),o.jsx(K,{size:"small",variant:"secondary",onClick:()=>{q(null),R("")},children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"atm-model-main",children:[o.jsx("span",{className:"atm-model-name",children:Qe}),Jn&&o.jsx("span",{className:"atm-model-engine",children:Jn})]}),o.jsxs("div",{className:"atm-item-actions",children:[o.jsx("button",{className:"atm-action-btn",onClick:()=>{p==null||p(ie),m==null||m(Qe),e()},title:"Select this model",children:"Select"}),o.jsx("button",{className:"atm-action-btn",onClick:()=>V(ie,Qe),title:"Edit model",children:"Edit"}),o.jsx("button",{className:"atm-action-btn atm-action-delete",onClick:()=>pe({type:"model",manufacturer:ie,name:Qe}),title:"Delete model",children:"Delete"})]})]})},Qe)}),Fe.length===0&&!x&&o.jsxs("div",{className:"atm-empty-models",children:["No models yet."," ",o.jsx("button",{onClick:()=>re(ie),children:"Add one"})]})]})]},ie)})})]}),U&&o.jsx("div",{className:"atm-delete-confirm",children:o.jsxs("div",{className:"atm-delete-content",children:[o.jsxs("h4",{children:["Delete ",U.type==="manufacturer"?"Manufacturer":"Model","?"]}),o.jsxs("p",{children:["Are you sure you want to delete ",o.jsx("strong",{children:U.name}),"?",U.type==="manufacturer"&&" This will also delete all its models."]}),o.jsxs("div",{className:"atm-delete-actions",children:[o.jsx(K,{variant:"danger",size:"small",onClick:()=>{U.type==="manufacturer"?Ke(U.name):bt(U.manufacturer,U.name)},loading:J,children:"Delete"}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>pe(null),children:"Cancel"})]})]})})]})})}function Kde(){const t=rr(),{success:e,error:n}=qt(),{create:r,update:s,loading:i}=Ms("helicopters"),[a,l]=b.useState({manufacturer:"",model:"",year:"",registration:"",serialNumber:"",priceType:"fixed",price:"",currency:"GBP",vatStatus:"plus",totalHours:"",engineHours:"",engineTBO:"",endOfLifeDate:"",engine:"",condition:"",description:"",avionics:[],equipment:[],highlights:[],status:"draft",featured:!1}),[c,u]=b.useState([]),[d,h]=b.useState([]),[f,p]=b.useState(!1),[m,g]=b.useState(!1),{manufacturers:y,loading:x,getModelsForManufacturer:w,getEngineForModel:N,addManufacturer:S,addModel:C,editManufacturer:A,editModel:j,deleteManufacturer:_,deleteModel:E}=Pu(),[I,T]=b.useState(!1),{avionicsOptions:P,equipmentOptions:O,highlightsOptions:H,loading:X,addAvionicsOption:se,editAvionicsOption:L,removeAvionicsOption:B,addEquipmentOption:$,editEquipmentOption:q,removeEquipmentOption:Y,addHighlightsOption:R,editHighlightsOption:G,removeHighlightsOption:Z}=fW(a.manufacturer,a.model);b.useEffect(()=>{a.manufacturer?u(w(a.manufacturer)):u([])},[a.manufacturer,y]),b.useEffect(()=>{if(a.manufacturer&&a.model){const V=N(a.manufacturer,a.model);l(re=>({...re,engine:V}))}},[a.manufacturer,a.model]);const W=V=>{const{name:re,value:ie,type:Fe,checked:Qe}=V.target;l(re==="manufacturer"?At=>({...At,manufacturer:ie,model:"",engine:"",avionics:[],equipment:[],highlights:[]}):re==="model"?At=>({...At,model:ie,avionics:[],equipment:[],highlights:[]}):At=>({...At,[re]:Fe==="checkbox"?Qe:ie}))},Q=(V,re)=>{l(ie=>({...ie,[V]:ie[V].includes(re)?ie[V].filter(Fe=>Fe!==re):[...ie[V],re]}))},U=b.useCallback(V=>{V.preventDefault(),V.stopPropagation(),p(!0)},[]),pe=b.useCallback(V=>{V.preventDefault(),V.stopPropagation(),p(!1)},[]),J=b.useCallback(V=>{V.preventDefault(),V.stopPropagation()},[]),ge=V=>{const re=Array.from(V).filter(Fe=>!(!Fe.type.startsWith("image/")||Fe.size>10485760));if(d.length+re.length>20){n(`Maximum 20 images allowed. You can add ${20-d.length} more.`);return}const ie=re.map(Fe=>({file:Fe,preview:URL.createObjectURL(Fe)}));h(Fe=>[...Fe,...ie])},me=b.useCallback(V=>{V.preventDefault(),V.stopPropagation(),p(!1),V.dataTransfer.files.length>0&&ge(V.dataTransfer.files)},[d]),ue=V=>{V.target.files.length>0&&ge(V.target.files),V.target.value=""},st=V=>{h(re=>{const ie=[...re];return URL.revokeObjectURL(ie[V].preview),ie.splice(V,1),ie})},Ke=(V,re)=>{const ie=V+re;ie<0||ie>=d.length||h(Fe=>{const Qe=[...Fe];return[Qe[V],Qe[ie]]=[Qe[ie],Qe[V]],Qe})},ot=V=>{V!==0&&h(re=>{const ie=[...re],[Fe]=ie.splice(V,1);return ie.unshift(Fe),ie})},lt=async V=>{if(d.length===0)return[];const re=[];for(const{file:ie}of d){const Fe=Date.now(),Qe=ie.name.replace(/[^a-zA-Z0-9.-]/g,"_"),At=`listings/${V}/${Fe}_${Qe}`,Jn=Yd(Qd,At),Pt=TN(Jn,ie);await new Promise((gt,Pn)=>{Pt.on("state_changed",null,Pn,async()=>{const ji=await bv(Pt.snapshot.ref);re.push({url:ji,path:At,name:ie.name,uploadedAt:new Date().toISOString()}),gt()})})}return re},bt=async V=>{V.preventDefault();try{let re="";a.priceType==="poa"?re="P.O.A.":a.priceType==="tbd"?re="T.B.D.":a.price&&(re=`${Xb.find(At=>At.value===a.currency).symbol}${parseInt(a.price).toLocaleString()}`,a.vatStatus==="plus"&&(re+=" +VAT"));const ie={manufacturer:a.manufacturer,model:a.model,year:parseInt(a.year)||0,registration:a.registration.toUpperCase(),serialNumber:a.serialNumber,price:a.priceType==="poa"||a.priceType==="tbd"?null:Math.round(Number(a.price))||0,priceType:a.priceType,priceDisplay:re,currency:a.currency,vatStatus:a.vatStatus,totalHours:parseInt(a.totalHours)||0,specs:{engine:a.engine,engineHours:parseInt(a.engineHours)||0,engineTBO:parseInt(a.engineTBO)||0,endOfLifeDate:a.endOfLifeDate||null,avionics:a.avionics,equipment:a.equipment},condition:a.condition,description:a.description,highlights:a.highlights,status:a.status,featured:a.featured,images:[]},Fe=await r(ie);if(d.length>0){g(!0);try{const Qe=await lt(Fe);Qe.length>0&&await s(Fe,{images:Qe})}catch(Qe){console.error("Failed to upload images:",Qe),n("Listing created but some images failed to upload")}g(!1)}d.forEach(Qe=>URL.revokeObjectURL(Qe.preview)),e("Aircraft created successfully"),t(`/listings/${Fe}`)}catch(re){n("Failed to create listing"),console.error(re)}},mt=a.manufacturer&&a.model;return o.jsxs("div",{className:"listing-create",children:[o.jsx("div",{className:"page-header",children:o.jsx("h1",{children:"Add New Aircraft"})}),o.jsxs("form",{onSubmit:bt,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Aircraft"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Manufacturer *"}),o.jsxs("div",{className:"select-with-actions",children:[o.jsxs("select",{name:"manufacturer",value:a.manufacturer,onChange:W,className:"form-select",required:!0,disabled:x,children:[o.jsx("option",{value:"",children:"Select manufacturer"}),y.map(V=>o.jsx("option",{value:V,children:V},V))]}),o.jsxs("button",{type:"button",className:"select-manage-btn",onClick:()=>T(!0),title:"Manage manufacturers & models",children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage"]})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Model *"}),o.jsx("div",{className:"select-with-actions",children:o.jsxs("select",{name:"model",value:a.model,onChange:W,className:"form-select",required:!0,disabled:!a.manufacturer,children:[o.jsx("option",{value:"",children:"Select model"}),c.map(V=>o.jsx("option",{value:V,children:V},V))]})})]}),o.jsx(ye,{label:"Year *",name:"year",type:"number",value:a.year,onChange:W,placeholder:"e.g., 2021",required:!0}),o.jsx(ye,{label:"Registration",name:"registration",value:a.registration,onChange:W,placeholder:"e.g., G-HQAV",style:{textTransform:"uppercase"}}),o.jsx(ye,{label:"Serial Number",name:"serialNumber",value:a.serialNumber,onChange:W,placeholder:"Serial number"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Condition"}),o.jsxs("select",{name:"condition",value:a.condition,onChange:W,className:"form-select",children:[o.jsx("option",{value:"",children:"Select condition"}),hW.map(V=>o.jsx("option",{value:V,children:V},V))]})]})]}),a.engine&&o.jsxs("div",{className:"info-box",children:[o.jsx("strong",{children:"Engine:"})," ",a.engine]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Pricing"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Price Type"}),o.jsxs("select",{name:"priceType",value:a.priceType,onChange:W,className:"form-select",children:[o.jsx("option",{value:"fixed",children:"Fixed Price"}),o.jsx("option",{value:"poa",children:"Price on Application (P.O.A.)"}),o.jsx("option",{value:"tbd",children:"To Be Determined (T.B.D.)"})]})]}),a.priceType==="fixed"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Currency"}),o.jsx("select",{name:"currency",value:a.currency,onChange:W,className:"form-select",children:Xb.map(V=>o.jsx("option",{value:V.value,children:V.label},V.value))})]}),o.jsx(ye,{label:"Price",name:"price",type:"number",step:"1",value:a.price,onChange:W,placeholder:"e.g., 650000"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"VAT Status"}),o.jsx("select",{name:"vatStatus",value:a.vatStatus,onChange:W,className:"form-select",children:dW.map(V=>o.jsx("option",{value:V.value,children:V.label},V.value))})]})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Hours & Component Life"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Total Airframe Hours",name:"totalHours",type:"number",value:a.totalHours,onChange:W,placeholder:"e.g., 450"}),o.jsx(ye,{label:"Engine Hours",name:"engineHours",type:"number",value:a.engineHours,onChange:W,placeholder:"e.g., 450"}),o.jsx(ye,{label:"Engine TBO",name:"engineTBO",type:"number",value:a.engineTBO,onChange:W,placeholder:"e.g., 3000"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"End of Life Date"}),o.jsx("input",{type:"date",name:"endOfLifeDate",value:a.endOfLifeDate,onChange:W,className:"form-input"}),o.jsx("span",{className:"form-help",children:"Remaining time will be calculated automatically on the website"})]})]})]}),o.jsx("div",{className:"form-section",children:mt?X?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Avionics"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Avionics",options:P,selectedValues:a.avionics,onToggle:V=>Q("avionics",V),onAdd:se,onEdit:L,onRemove:B}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Avionics"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see avionics options"})]})}),o.jsx("div",{className:"form-section",children:mt?X?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Equipment"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Equipment",options:O,selectedValues:a.equipment,onToggle:V=>Q("equipment",V),onAdd:$,onEdit:q,onRemove:Y}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Equipment"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see equipment options"})]})}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Images"}),o.jsxs("div",{className:"image-uploader",children:[o.jsxs("div",{className:`image-drop-zone ${f?"dragging":""}`,onDragEnter:U,onDragLeave:pe,onDragOver:J,onDrop:me,children:[o.jsx("div",{className:"drop-icon",children:o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),o.jsx("p",{className:"drop-text",children:f?"Drop images here":"Drag and drop images here"}),o.jsx("p",{className:"drop-hint",children:"or"}),o.jsxs("label",{className:"file-select-btn",children:[o.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ue,style:{display:"none"}}),o.jsx("span",{children:"Browse Files"})]}),o.jsx("p",{className:"drop-info",children:"Maximum 20 images, up to 10MB each. First image is the primary photo."})]}),d.length>0&&o.jsx("div",{className:"image-grid",children:d.map((V,re)=>o.jsxs("div",{className:`image-item ${re===0?"primary":""}`,children:[o.jsx("img",{src:V.preview,alt:`Preview ${re+1}`}),o.jsxs("div",{className:"image-overlay",children:[o.jsxs("div",{className:"image-actions",children:[re>0&&o.jsx("button",{type:"button",className:"image-action-btn",onClick:()=>Ke(re,-1),title:"Move left",children:""}),re<d.length-1&&o.jsx("button",{type:"button",className:"image-action-btn",onClick:()=>Ke(re,1),title:"Move right",children:""}),re!==0&&o.jsx("button",{type:"button",className:"image-action-btn primary-btn",onClick:()=>ot(re),title:"Set as primary",children:""}),o.jsx("button",{type:"button",className:"image-action-btn delete-btn",onClick:()=>st(re),title:"Remove",children:""})]}),re===0&&o.jsx("span",{className:"primary-badge",children:"Primary"})]})]},re))})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Description"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Full Description"}),o.jsx("textarea",{name:"description",value:a.description,onChange:W,className:"form-textarea",rows:6,placeholder:"Describe the aircraft, its history, and notable features..."})]})]}),o.jsx("div",{className:"form-section",children:mt?X?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Highlights"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Highlights",options:H,selectedValues:a.highlights,onToggle:V=>Q("highlights",V),onAdd:R,onEdit:G,onRemove:Z}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Highlights"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see highlight options"})]})}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Status & Visibility"}),o.jsx("div",{className:"form-grid",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsxs("select",{name:"status",value:a.status,onChange:W,className:"form-select",children:[o.jsx("option",{value:"draft",children:"Draft"}),o.jsx("option",{value:"available",children:"Available"}),o.jsx("option",{value:"sold",children:"Sold"})]})]})}),o.jsx("div",{className:"form-group",children:o.jsxs("label",{className:"form-checkbox",children:[o.jsx("input",{type:"checkbox",name:"featured",checked:a.featured,onChange:W}),o.jsx("span",{children:"Featured listing (show on homepage)"})]})})]}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{type:"button",variant:"secondary",onClick:()=>t("/listings"),children:"Cancel"}),o.jsx(K,{type:"submit",loading:i||m,children:m?"Uploading Images...":"Create Aircraft"})]})]}),o.jsx(pW,{isOpen:I,onClose:()=>T(!1),manufacturers:y,getModelsForManufacturer:w,getEngineForModel:N,onAddManufacturer:S,onEditManufacturer:A,onDeleteManufacturer:_,onAddModel:C,onEditModel:j,onDeleteModel:E,selectedManufacturer:a.manufacturer,selectedModel:a.model,onSelectManufacturer:V=>{l(re=>({...re,manufacturer:V,model:"",engine:""}))},onSelectModel:V=>{const re=N(a.manufacturer,V);l(ie=>({...ie,model:V,engine:re}))}})]})}function Yde({listingId:t,images:e=[],onImagesChange:n,maxImages:r=20}){const[s,i]=b.useState(!1),[a,l]=b.useState(!1),[c,u]=b.useState({}),[d,h]=b.useState(null),[f,p]=b.useState(!1),m=b.useCallback(j=>{j.preventDefault(),j.stopPropagation(),i(!0)},[]),g=b.useCallback(j=>{j.preventDefault(),j.stopPropagation(),i(!1)},[]),y=b.useCallback(j=>{j.preventDefault(),j.stopPropagation()},[]),x=async j=>{if(!t){alert("Please save the listing first before uploading images.");return}const _=Array.from(j).filter(I=>I.type.startsWith("image/")?I.size>10*1024*1024?(console.warn(`File too large: ${I.name}`),!1):!0:(console.warn(`Skipping non-image file: ${I.name}`),!1));if(e.length+_.length>r){alert(`Maximum ${r} images allowed. You can add ${r-e.length} more.`);return}if(_.length===0)return;l(!0);const E=[];for(const I of _)try{const T=Date.now(),P=I.name.replace(/[^a-zA-Z0-9.-]/g,"_"),O=`listings/${t}/${T}_${P}`,H=Yd(Qd,O),X=TN(H,I);await new Promise((se,L)=>{X.on("state_changed",B=>{const $=B.bytesTransferred/B.totalBytes*100;u(q=>({...q,[I.name]:$}))},B=>{console.error("Upload error:",B),L(B)},async()=>{const B=await bv(X.snapshot.ref);E.push({url:B,path:O,name:I.name,uploadedAt:new Date().toISOString()}),se()})})}catch(T){console.error(`Failed to upload ${I.name}:`,T)}l(!1),u({}),E.length>0&&n([...e,...E])},w=b.useCallback(j=>{j.preventDefault(),j.stopPropagation(),i(!1);const _=j.dataTransfer.files;_.length>0&&x(_)},[t,e,n,r]),N=j=>{const _=j.target.files;_.length>0&&x(_),j.target.value=""},S=async()=>{if(d){p(!0);try{const j=Yd(Qd,d.path);await MH(j);const _=e.filter(E=>E.path!==d.path);n(_),h(null)}catch(j){console.error("Failed to delete image:",j);const _=e.filter(E=>E.path!==d.path);n(_),h(null)}p(!1)}},C=(j,_)=>{const E=[...e],I=j+_;I<0||I>=E.length||([E[j],E[I]]=[E[I],E[j]],n(E))},A=j=>{if(j===0)return;const _=[...e],[E]=_.splice(j,1);_.unshift(E),n(_)};return o.jsxs("div",{className:"image-uploader",children:[o.jsx("div",{className:`image-drop-zone ${s?"dragging":""} ${a?"uploading":""}`,onDragEnter:m,onDragLeave:g,onDragOver:y,onDrop:w,children:a?o.jsxs("div",{className:"upload-progress",children:[o.jsx("div",{className:"upload-spinner"}),o.jsx("p",{children:"Uploading images..."}),Object.entries(c).map(([j,_])=>o.jsxs("div",{className:"progress-item",children:[o.jsx("span",{children:j}),o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-fill",style:{width:`${_}%`}})})]},j))]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"drop-icon",children:o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),o.jsx("p",{className:"drop-text",children:s?"Drop images here":"Drag and drop images here"}),o.jsx("p",{className:"drop-hint",children:"or"}),o.jsxs("label",{className:"file-select-btn",children:[o.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:N,style:{display:"none"}}),o.jsx("span",{children:"Browse Files"})]}),o.jsxs("p",{className:"drop-info",children:["Maximum ",r," images, up to 10MB each. First image is the primary photo."]})]})}),e.length>0&&o.jsx("div",{className:"image-grid",children:e.map((j,_)=>o.jsxs("div",{className:`image-item ${_===0?"primary":""}`,children:[o.jsx("img",{src:j.url,alt:j.name||`Image ${_+1}`}),o.jsxs("div",{className:"image-overlay",children:[o.jsxs("div",{className:"image-actions",children:[_>0&&o.jsx("button",{type:"button",className:"image-action-btn",onClick:()=>C(_,-1),title:"Move left",children:""}),_<e.length-1&&o.jsx("button",{type:"button",className:"image-action-btn",onClick:()=>C(_,1),title:"Move right",children:""}),_!==0&&o.jsx("button",{type:"button",className:"image-action-btn primary-btn",onClick:()=>A(_),title:"Set as primary",children:""}),o.jsx("button",{type:"button",className:"image-action-btn delete-btn",onClick:()=>h(j),title:"Delete",children:""})]}),_===0&&o.jsx("span",{className:"primary-badge",children:"Primary"})]})]},j.path||j.url||`image-${_}`))}),o.jsxs(ut,{isOpen:!!d,onClose:()=>h(null),title:"Delete Image",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>h(null),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:S,loading:f,children:"Delete"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this image?"}),d&&o.jsx("img",{src:d.url,alt:"To be deleted",style:{maxWidth:"100%",maxHeight:"200px",marginTop:"16px",borderRadius:"8px"}})]})]})}const XM=(t,e="MMM d, yyyy")=>{if(!t)return"";try{if(t!=null&&t.toDate)return rt(t.toDate(),e);if(t!=null&&t.seconds)return rt(new Date(t.seconds*1e3),e);const n=new Date(t);return isNaN(n.getTime())?"":rt(n,e)}catch{return""}};function Qde({listingId:t,potentialBuyers:e=[],onUpdate:n,listingTitle:r}){var T,P;const[s,i]=b.useState(!1),[a,l]=b.useState(!1),[c,u]=b.useState(null),[d,h]=b.useState(""),[f,p]=b.useState(""),[m,g]=b.useState(!1),{data:y,loading:x}=pn("contacts");Ia();const w=e.map(O=>O.contactId),S=y.filter(O=>!w.includes(O.id)).filter(O=>{if(!f)return!0;const H=f.toLowerCase(),X=`${O.firstName} ${O.lastName}`.toLowerCase(),se=(O.company||"").toLowerCase(),L=(O.email||"").toLowerCase();return X.includes(H)||se.includes(H)||L.includes(H)}),C=async O=>{g(!0);try{const H={contactId:O.id,firstName:O.firstName,lastName:O.lastName,email:O.email,company:O.company||null,phone:O.phone||null,addedAt:new Date().toISOString(),notes:[],interestLevel:"medium"},X=We(ke,"helicopters",t);await _t(X,{potentialBuyers:gu(H),updatedAt:et()}),n&&n([...e,H]),i(!1),p("")}catch(H){console.error("Failed to add potential buyer:",H)}g(!1)},A=async O=>{if(confirm("Remove this potential buyer from the listing?")){g(!0);try{const H=e.find(se=>se.contactId===O),X=We(ke,"helicopters",t);await _t(X,{potentialBuyers:pH(H),updatedAt:et()}),n&&n(e.filter(se=>se.contactId!==O))}catch(H){console.error("Failed to remove potential buyer:",H)}g(!1)}},j=async(O,H)=>{g(!0);try{const X=e.map(L=>L.contactId===O?{...L,interestLevel:H}:L),se=We(ke,"helicopters",t);await _t(se,{potentialBuyers:X,updatedAt:et()}),n&&n(X)}catch(X){console.error("Failed to update interest level:",X)}g(!1)},_=async()=>{if(!(!d.trim()||!c)){g(!0);try{const O={id:`note_${Date.now()}`,text:d.trim(),createdAt:new Date().toISOString(),createdBy:"current_user"},H=e.map(se=>se.contactId===c?{...se,notes:[...se.notes||[],O]}:se),X=We(ke,"helicopters",t);await _t(X,{potentialBuyers:H,updatedAt:et()}),n&&n(H),h(""),l(!1),u(null)}catch(O){console.error("Failed to add note:",O)}g(!1)}},E=O=>{u(O),h(""),l(!0)},I=O=>{switch(O){case"high":return"interest-high";case"low":return"interest-low";default:return"interest-medium"}};return o.jsxs("div",{className:"potential-buyers-manager",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("h3",{children:"Potential Buyers"}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>i(!0),children:"+ Add Buyer"})]}),e.length===0?o.jsx("p",{className:"empty-message",children:"No potential buyers assigned to this listing yet."}):o.jsx("div",{className:"potential-buyers-list",children:e.map(O=>o.jsxs("div",{className:"potential-buyer-card",children:[o.jsxs("div",{className:"buyer-main",children:[o.jsxs("div",{className:"buyer-info",children:[o.jsxs(at,{to:`/contacts/${O.contactId}`,className:"buyer-name",children:[O.firstName," ",O.lastName]}),O.company&&o.jsx("span",{className:"buyer-company",children:O.company}),o.jsxs("span",{className:"buyer-contact-info",children:[O.email,O.phone&&` | ${O.phone}`]})]}),o.jsxs("div",{className:"buyer-actions",children:[o.jsxs("select",{className:`interest-select ${I(O.interestLevel)}`,value:O.interestLevel||"medium",onChange:H=>j(O.contactId,H.target.value),children:[o.jsx("option",{value:"high",children:"High Interest"}),o.jsx("option",{value:"medium",children:"Medium Interest"}),o.jsx("option",{value:"low",children:"Low Interest"})]}),o.jsx("button",{className:"icon-btn",onClick:()=>E(O.contactId),title:"Add note",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),o.jsx("button",{className:"icon-btn icon-btn-danger",onClick:()=>A(O.contactId),title:"Remove",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),O.notes&&O.notes.length>0&&o.jsxs("div",{className:"buyer-notes",children:[o.jsx("span",{className:"notes-label",children:"Notes:"}),o.jsx("div",{className:"notes-list",children:O.notes.slice().reverse().map(H=>o.jsxs("div",{className:"note-item",children:[o.jsx("span",{className:"note-date",children:XM(H.createdAt,"MMM d, yyyy h:mm a")}),o.jsx("span",{className:"note-text",children:H.text})]},H.id))})]}),O.addedAt&&o.jsxs("span",{className:"buyer-added-date",children:["Added ",XM(O.addedAt)]})]},O.contactId))}),o.jsx(ut,{isOpen:s,onClose:()=>{i(!1),p("")},title:"Add Potential Buyer",size:"medium",children:o.jsxs("div",{className:"add-buyer-modal",children:[o.jsx("input",{type:"text",className:"form-input search-input",placeholder:"Search contacts by name, company, or email...",value:f,onChange:O=>p(O.target.value),autoFocus:!0}),x?o.jsx("p",{className:"loading-text",children:"Loading contacts..."}):S.length===0?o.jsx("p",{className:"empty-text",children:f?"No matching contacts found.":"No available contacts to add."}):o.jsxs("div",{className:"contacts-list",children:[S.slice(0,20).map(O=>o.jsxs("div",{className:"contact-option",children:[o.jsxs("div",{className:"contact-option-info",children:[o.jsxs("span",{className:"contact-option-name",children:[O.firstName," ",O.lastName]}),O.company&&o.jsx("span",{className:"contact-option-company",children:O.company}),o.jsx("span",{className:"contact-option-email",children:O.email})]}),o.jsx(K,{size:"small",onClick:()=>C(O),disabled:m,children:"Add"})]},O.id)),S.length>20&&o.jsx("p",{className:"more-results-text",children:"Showing first 20 results. Refine your search to see more."})]}),o.jsx("div",{className:"modal-footer",children:o.jsx(at,{to:"/contacts/new",className:"create-contact-link",children:"+ Create New Contact"})})]})}),o.jsx(ut,{isOpen:a,onClose:()=>{l(!1),u(null),h("")},title:"Add Note",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),o.jsx(K,{onClick:_,disabled:!d.trim()||m,children:"Add Note"})]}),children:o.jsxs("div",{className:"add-note-modal",children:[o.jsxs("p",{className:"note-context",children:["Adding note for: ",o.jsxs("strong",{children:[(T=e.find(O=>O.contactId===c))==null?void 0:T.firstName," ",(P=e.find(O=>O.contactId===c))==null?void 0:P.lastName]})]}),o.jsx("p",{className:"note-hint",children:"Record interactions, feedback, or any relevant details about this potential buyer's interest in the aircraft."}),o.jsx("textarea",{className:"form-textarea",rows:4,value:d,onChange:O=>h(O.target.value),placeholder:"e.g., Called buyer, discussed aircraft hours. They want to see maintenance records...",autoFocus:!0})]})})]})}function Xde({listingId:t,saleHistory:e=[],currency:n="GBP",onUpdate:r}){var x,w;const[s,i]=b.useState(!1),[a,l]=b.useState(null),[c,u]=b.useState(!1),{success:d,error:h}=qt(),f=[...e].sort((N,S)=>S.saleNumber-N.saleNumber),p=(N,S=n)=>N?`${{GBP:"",USD:"$",EUR:""}[S]||S}${N.toLocaleString()}`:"-",m=N=>{if(!N)return"-";try{return rt(new Date(N),"dd MMM yyyy")}catch{return N}},g=async()=>{if(a){u(!0);try{const S=e.filter(A=>A.id!==a.id).sort((A,j)=>new Date(A.saleDate)-new Date(j.saleDate)).map((A,j)=>({...A,saleNumber:j+1})),C=We(ke,"helicopters",t);await _t(C,{saleHistory:S,updatedAt:et()}),r&&r(S),d("Sale record deleted"),i(!1),l(null)}catch(N){console.error("Failed to delete sale record:",N),h(`Failed to delete: ${N.message}`)}u(!1)}},y=N=>{l(N),i(!0)};return e.length===0?null:o.jsxs("div",{className:"sale-history-section",children:[o.jsxs("div",{className:"history-section-header",children:[o.jsx("h4",{children:"Sale History"}),o.jsxs("span",{className:"sale-count",children:[e.length," sale",e.length!==1?"s":""," recorded"]})]}),o.jsx("div",{className:"sale-history-list",children:f.map(N=>{var S,C,A,j,_,E;return o.jsxs("div",{className:"sale-history-item",children:[o.jsxs("div",{className:"sale-number-badge",children:["#",N.saleNumber]}),o.jsxs("div",{className:"sale-main-content",children:[o.jsxs("div",{className:"ownership-transfer",children:[o.jsxs("div",{className:"transfer-party seller",children:[(S=N.seller)!=null&&S.contactId?o.jsx(at,{to:`/contacts/${N.seller.contactId}`,className:"party-name",children:N.seller.name}):o.jsx("span",{className:"party-name",children:((C=N.seller)==null?void 0:C.name)||"Unknown"}),((A=N.seller)==null?void 0:A.company)&&o.jsx("span",{className:"party-company",children:N.seller.company})]}),o.jsx("div",{className:"transfer-arrow",children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),o.jsx("polyline",{points:"12 5 19 12 12 19"})]})}),o.jsxs("div",{className:"transfer-party buyer",children:[(j=N.buyer)!=null&&j.contactId?o.jsx(at,{to:`/contacts/${N.buyer.contactId}`,className:"party-name",children:N.buyer.name}):o.jsx("span",{className:"party-name",children:((_=N.buyer)==null?void 0:_.name)||"Unknown"}),((E=N.buyer)==null?void 0:E.company)&&o.jsx("span",{className:"party-company",children:N.buyer.company})]})]}),o.jsxs("div",{className:"sale-details",children:[o.jsxs("div",{className:"sale-price",children:[o.jsx("span",{className:"price-label",children:"Sale Price:"}),o.jsx("span",{className:"price-value",children:p(N.salePrice,N.currency)})]}),o.jsxs("div",{className:"sale-date",children:[o.jsx("span",{className:"date-label",children:"Sold:"}),o.jsx("span",{className:"date-value",children:m(N.saleDate)})]})]}),N.notes&&o.jsxs("div",{className:"sale-notes",children:[o.jsx("span",{className:"notes-label",children:"Notes:"}),o.jsx("p",{className:"notes-content",children:N.notes})]}),N.attribution&&N.attribution.length>0&&o.jsx("div",{className:"sale-attribution-preview",children:N.attribution.map((I,T)=>o.jsxs("span",{className:"attribution-chip",children:[I.name,": ",I.percentage,"%"]},T))})]}),o.jsx("div",{className:"sale-actions",children:o.jsx("button",{type:"button",className:"icon-btn icon-btn-danger",onClick:I=>{I.preventDefault(),I.stopPropagation(),y(N)},title:"Delete sale record",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})})]},N.id||`sale-${N.saleNumber}`)})}),o.jsxs(ut,{isOpen:s,onClose:()=>{i(!1),l(null)},title:"Delete Sale Record",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:g,loading:c,children:"Delete Sale"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this sale record?"}),a&&o.jsxs("div",{className:"delete-sale-info",children:[o.jsx("p",{children:o.jsxs("strong",{children:["Sale #",a.saleNumber]})}),o.jsxs("p",{children:[p(a.salePrice,a.currency),"  ",m(a.saleDate)]}),o.jsxs("p",{className:"transfer-summary",children:[(x=a.seller)==null?void 0:x.name,"  ",(w=a.buyer)==null?void 0:w.name]})]}),o.jsx("p",{className:"text-muted",children:"This action cannot be undone. Other sale records will be automatically renumbered."})]})]})}function Jde({listingId:t,ownershipHistory:e=[],saleHistory:n=[],currentRegistration:r,currency:s="GBP",onUpdate:i,onSaleHistoryUpdate:a}){const[l,c]=b.useState(!1),[u,d]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(null),[g,y]=b.useState(!1),[x,w]=b.useState(!1),[N,S]=b.useState(""),{data:C}=pn("contacts"),A={contactId:null,ownerName:"",ownerType:"individual",company:"",registration:r||"",country:"",startDate:"",endDate:"",purchasePrice:"",salePrice:"",notes:"",isCurrentOwner:!1},[j,_]=b.useState(A),E=C.filter(R=>{if(!N)return!1;const G=N.toLowerCase(),Z=`${R.firstName} ${R.lastName}`.toLowerCase(),W=(R.company||"").toLowerCase();return Z.includes(G)||W.includes(G)}),I=R=>{const{name:G,value:Z,type:W,checked:Q}=R.target;_(U=>({...U,[G]:W==="checkbox"?Q:Z}))},T=R=>{_(G=>({...G,contactId:R.id,ownerName:`${R.firstName} ${R.lastName}`,company:R.company||"",ownerType:R.contactType==="business"?"business":"individual"})),w(!1),S("")},P=()=>{_(R=>({...R,contactId:null}))},O=async()=>{if(j.ownerName.trim()){y(!0);try{const R={id:`owner_${Date.now()}`,contactId:j.contactId,ownerName:j.ownerName.trim(),ownerType:j.ownerType,company:j.company.trim()||null,registration:j.registration.trim().toUpperCase(),country:j.country.trim()||null,startDate:j.startDate||null,endDate:j.isCurrentOwner?null:j.endDate||null,purchasePrice:j.purchasePrice?parseFloat(j.purchasePrice):null,salePrice:j.salePrice?parseFloat(j.salePrice):null,notes:j.notes.trim()||null,isCurrentOwner:j.isCurrentOwner,addedAt:new Date().toISOString()},G=[...e,R];G.sort((W,Q)=>W.isCurrentOwner?-1:Q.isCurrentOwner||!W.startDate?1:Q.startDate?new Date(Q.startDate)-new Date(W.startDate):-1);const Z=We(ke,"helicopters",t);await _t(Z,{ownershipHistory:G,updatedAt:et()}),i&&i(G),c(!1),_(A)}catch(R){console.error("Failed to add ownership entry:",R)}y(!1)}},H=async()=>{if(!(!j.ownerName.trim()||!p)){y(!0);try{const R={...p,contactId:j.contactId,ownerName:j.ownerName.trim(),ownerType:j.ownerType,company:j.company.trim()||null,registration:j.registration.trim().toUpperCase(),country:j.country.trim()||null,startDate:j.startDate||null,endDate:j.isCurrentOwner?null:j.endDate||null,purchasePrice:j.purchasePrice?parseFloat(j.purchasePrice):null,salePrice:j.salePrice?parseFloat(j.salePrice):null,notes:j.notes.trim()||null,isCurrentOwner:j.isCurrentOwner};let G=e.map(W=>W.id===p.id?R:W);G.sort((W,Q)=>W.isCurrentOwner?-1:Q.isCurrentOwner||!W.startDate?1:Q.startDate?new Date(Q.startDate)-new Date(W.startDate):-1);const Z=We(ke,"helicopters",t);await _t(Z,{ownershipHistory:G,updatedAt:et()}),i&&i(G),d(!1),m(null),_(A)}catch(R){console.error("Failed to update ownership entry:",R)}y(!1)}},X=async()=>{if(p){y(!0);try{const R=e.filter(Z=>Z.id!==p.id),G=We(ke,"helicopters",t);await _t(G,{ownershipHistory:R,updatedAt:et()}),i&&i(R),f(!1),m(null)}catch(R){console.error("Failed to delete ownership entry:",R)}y(!1)}},se=R=>{m(R),_({contactId:R.contactId,ownerName:R.ownerName,ownerType:R.ownerType||"individual",company:R.company||"",registration:R.registration||"",country:R.country||"",startDate:R.startDate||"",endDate:R.endDate||"",purchasePrice:R.purchasePrice||"",salePrice:R.salePrice||"",notes:R.notes||"",isCurrentOwner:R.isCurrentOwner||!1}),d(!0)},L=R=>{m(R),f(!0)},B=R=>{if(!R)return"-";try{return rt(new Date(R),"MMM yyyy")}catch{return R}},$=R=>R?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(R):null,q=[];let Y=null;return[...e].reverse().forEach(R=>{R.registration&&R.registration!==Y&&(q.push({registration:R.registration,date:R.startDate,owner:R.ownerName}),Y=R.registration)}),o.jsxs("div",{className:"ownership-history-manager",children:[n.length>0&&o.jsx(Xde,{listingId:t,saleHistory:n,currency:s,onUpdate:a}),o.jsxs("div",{className:"section-header",children:[o.jsxs("div",{children:[o.jsx("h3",{children:"Ownership History"}),o.jsx("p",{className:"section-subtitle",children:"Track previous owners and registration changes"})]}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>{_({...A,registration:r||""}),c(!0)},children:"+ Add Owner"})]}),q.length>1&&o.jsxs("div",{className:"registration-changes",children:[o.jsx("span",{className:"reg-changes-label",children:"Registration History:"}),o.jsx("div",{className:"reg-changes-list",children:q.map((R,G)=>o.jsxs("span",{className:"reg-change-item",children:[o.jsx("strong",{children:R.registration}),R.date&&o.jsxs("span",{className:"reg-change-date",children:["(",B(R.date),")"]}),G<q.length-1&&o.jsx("span",{className:"reg-arrow",children:""})]},G))})]}),e.length===0?o.jsx("p",{className:"empty-message",children:"No ownership history recorded yet."}):o.jsx("div",{className:"ownership-timeline",children:e.map((R,G)=>o.jsxs("div",{className:`ownership-entry ${R.isCurrentOwner?"ownership-entry-current":""}`,children:[o.jsxs("div",{className:"ownership-marker",children:[o.jsx("div",{className:"ownership-dot"}),G<e.length-1&&o.jsx("div",{className:"ownership-line"})]}),o.jsxs("div",{className:"ownership-content",children:[o.jsxs("div",{className:"ownership-header",children:[o.jsxs("div",{className:"ownership-owner-info",children:[R.contactId?o.jsx(at,{to:`/contacts/${R.contactId}`,className:"ownership-owner-name",children:R.ownerName}):o.jsx("span",{className:"ownership-owner-name",children:R.ownerName}),R.company&&R.ownerType==="business"&&o.jsx("span",{className:"ownership-company",children:R.company}),R.isCurrentOwner&&o.jsx("span",{className:"current-owner-badge",children:"Current Owner"})]}),o.jsxs("div",{className:"ownership-actions",children:[o.jsx("button",{className:"icon-btn",onClick:()=>se(R),title:"Edit",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),o.jsx("button",{className:"icon-btn icon-btn-danger",onClick:()=>L(R),title:"Delete",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),o.jsxs("div",{className:"ownership-details",children:[o.jsxs("div",{className:"ownership-detail-row",children:[o.jsxs("span",{className:"ownership-registration",children:[o.jsx("strong",{children:R.registration||"N/A"}),R.country&&o.jsxs("span",{className:"ownership-country",children:["(",R.country,")"]})]}),o.jsxs("span",{className:"ownership-period",children:[B(R.startDate),"  ",R.isCurrentOwner?"Present":B(R.endDate)]})]}),(R.purchasePrice||R.salePrice)&&o.jsxs("div",{className:"ownership-prices",children:[R.purchasePrice&&o.jsxs("span",{className:"ownership-price",children:["Acquired: ",$(R.purchasePrice)]}),R.salePrice&&o.jsxs("span",{className:"ownership-price",children:["Sold: ",$(R.salePrice)]})]}),R.notes&&o.jsx("p",{className:"ownership-notes",children:R.notes})]})]})]},R.id))}),o.jsx(ut,{isOpen:l||u,onClose:()=>{c(!1),d(!1),m(null),_(A)},title:u?"Edit Ownership Entry":"Add Previous Owner",size:"medium",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>{c(!1),d(!1),m(null),_(A)},children:"Cancel"}),o.jsx(K,{onClick:u?H:O,disabled:!j.ownerName.trim()||g,loading:g,children:u?"Save Changes":"Add Owner"})]}),children:o.jsxs("div",{className:"ownership-form",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Owner Name *"}),j.contactId?o.jsxs("div",{className:"linked-contact-display",children:[o.jsx("span",{className:"linked-icon",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),o.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}),o.jsxs("span",{children:["Linked to contact: ",o.jsx("strong",{children:j.ownerName})]}),o.jsx("button",{type:"button",className:"unlink-btn",onClick:P,children:"Unlink"})]}):o.jsxs("div",{className:"owner-input-group",children:[o.jsx("input",{type:"text",name:"ownerName",value:j.ownerName,onChange:I,className:"form-input",placeholder:"Enter owner name"}),o.jsx(K,{type:"button",variant:"secondary",size:"small",onClick:()=>w(!x),children:"Link Contact"})]}),x&&o.jsxs("div",{className:"contact-search-dropdown",children:[o.jsx("input",{type:"text",className:"form-input",placeholder:"Search contacts...",value:N,onChange:R=>S(R.target.value),autoFocus:!0}),E.length>0&&o.jsx("div",{className:"contact-search-results",children:E.slice(0,10).map(R=>o.jsxs("button",{type:"button",className:"contact-search-item",onClick:()=>T(R),children:[o.jsxs("span",{children:[R.firstName," ",R.lastName]}),R.company&&o.jsx("span",{className:"contact-company-hint",children:R.company})]},R.id))})]})]}),o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Owner Type"}),o.jsxs("select",{name:"ownerType",value:j.ownerType,onChange:I,className:"form-select",children:[o.jsx("option",{value:"individual",children:"Individual"}),o.jsx("option",{value:"business",children:"Business/Company"})]})]}),j.ownerType==="business"&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Company Name"}),o.jsx("input",{type:"text",name:"company",value:j.company,onChange:I,className:"form-input",placeholder:"Company name"})]})]}),o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Registration"}),o.jsx("input",{type:"text",name:"registration",value:j.registration,onChange:I,className:"form-input",placeholder:"e.g., N12345",style:{textTransform:"uppercase"}})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Country"}),o.jsx("input",{type:"text",name:"country",value:j.country,onChange:I,className:"form-input",placeholder:"e.g., USA, UK"})]})]}),o.jsx("div",{className:"form-group",children:o.jsxs("label",{className:"form-checkbox",children:[o.jsx("input",{type:"checkbox",name:"isCurrentOwner",checked:j.isCurrentOwner,onChange:I}),o.jsx("span",{children:"This is the current owner"})]})}),o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Start Date"}),o.jsx("input",{type:"date",name:"startDate",value:j.startDate,onChange:I,className:"form-input"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"End Date"}),o.jsx("input",{type:"date",name:"endDate",value:j.endDate,onChange:I,className:"form-input",disabled:j.isCurrentOwner})]})]}),o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Purchase Price"}),o.jsx("input",{type:"number",name:"purchasePrice",value:j.purchasePrice,onChange:I,className:"form-input",placeholder:"Optional"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Sale Price"}),o.jsx("input",{type:"number",name:"salePrice",value:j.salePrice,onChange:I,className:"form-input",placeholder:"Optional"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Notes"}),o.jsx("textarea",{name:"notes",value:j.notes,onChange:I,className:"form-textarea",rows:3,placeholder:"Any additional details about this ownership period..."})]})]})}),o.jsxs(ut,{isOpen:h,onClose:()=>{f(!1),m(null)},title:"Delete Ownership Entry",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:X,loading:g,children:"Delete"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this ownership entry?"}),p&&o.jsxs("p",{className:"delete-detail",children:[o.jsx("strong",{children:p.ownerName}),p.registration&&` (${p.registration})`]})]})]})}const JM={imported:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),registration_change:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),owner_change:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"9",cy:"7",r:"4"}),o.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),o.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),sold:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),acquired:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("polyline",{points:"12 6 12 12 16 14"})]}),status_change:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"23 4 23 10 17 10"}),o.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]}),price_change:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),service:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})})},Zde={imported:"#3b82f6",registration_change:"#8b5cf6",owner_change:"#f59e0b",sold:"#22c55e",acquired:"#06b6d4",status_change:"#6b7280",price_change:"#ec4899",service:"#14b8a6"};function ehe({events:t=[],currentRegistration:e,serialNumber:n,currentOwner:r,onAddEvent:s,onEditEvent:i,onDeleteEvent:a,onUpdateCurrentOwner:l,readOnly:c=!1}){const[u,d]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(null),[g,y]=b.useState({type:"owner_change",date:new Date().toISOString().split("T")[0],previousRegistration:"",newRegistration:e||"",previousOwnerName:"",previousOwnerAddress:"",newOwnerName:"",newOwnerAddress:"",notes:"",source:"Manual Entry"}),[x,w]=b.useState({name:"",address:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",source:"Manual Entry"}),N=T=>{if(!T)return new Date(0);if(T!=null&&T.toDate&&typeof T.toDate=="function")return T.toDate();if(T instanceof Date)return T;const P=new Date(T);return isNaN(P.getTime())?new Date(0):P},S=[...t].sort((T,P)=>{const O=N(T.date);return N(P.date)-O}),C=T=>{if(!T)return"-";try{if(T!=null&&T.toDate&&typeof T.toDate=="function")return rt(T.toDate(),"dd MMM yyyy");if(T instanceof Date)return rt(T,"dd MMM yyyy");const P=new Date(T);return isNaN(P.getTime())?"-":rt(P,"dd MMM yyyy")}catch{return"-"}},A=()=>{const T={id:(p==null?void 0:p.id)||`event-${Date.now()}`,type:g.type,date:new Date(g.date),notes:g.notes,source:g.source};g.type==="registration_change"&&(T.previousRegistration=g.previousRegistration,T.newRegistration=g.newRegistration),g.type==="owner_change"&&(g.previousOwnerName&&(T.previousOwner={name:g.previousOwnerName,address:g.previousOwnerAddress}),g.newOwnerName&&(T.newOwner={name:g.newOwnerName,address:g.newOwnerAddress}),T.registration=g.newRegistration||e),p?i==null||i(T):s==null||s(T),d(!1),m(null),j()},j=()=>{y({type:"owner_change",date:new Date().toISOString().split("T")[0],previousRegistration:"",newRegistration:e||"",previousOwnerName:"",previousOwnerAddress:"",newOwnerName:"",newOwnerAddress:"",notes:"",source:"Manual Entry"})},_=()=>{w({name:"",address:"",effectiveDate:new Date().toISOString().split("T")[0],notes:"",source:"Manual Entry"}),f(!0)},E=()=>{if(!x.name.trim())return;const T={id:`event-${Date.now()}`,type:"owner_change",date:new Date(x.effectiveDate),notes:x.notes,source:x.source,registration:e};r!=null&&r.name&&(T.previousOwner={name:r.name,address:r.address||""}),T.newOwner={name:x.name.trim(),address:x.address.trim()},s==null||s(T),l==null||l({name:x.name.trim(),address:x.address.trim()}),f(!1)},I=T=>{var O,H,X,se;m(T);const P=T.date instanceof Date?T.date:new Date(T.date);y({type:T.type,date:P.toISOString().split("T")[0],previousRegistration:T.previousRegistration||"",newRegistration:T.newRegistration||T.registration||e||"",previousOwnerName:((O=T.previousOwner)==null?void 0:O.name)||"",previousOwnerAddress:((H=T.previousOwner)==null?void 0:H.address)||"",newOwnerName:((X=T.newOwner)==null?void 0:X.name)||"",newOwnerAddress:((se=T.newOwner)==null?void 0:se.address)||"",notes:T.notes||"",source:T.source||"Manual Entry"}),d(!0)};return o.jsxs("div",{className:"registration-timeline",children:[o.jsx("div",{className:"timeline-header",children:o.jsxs("div",{className:"timeline-title",children:[o.jsxs("h3",{children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"8px",verticalAlign:"middle"},children:[o.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"9",cy:"7",r:"4"}),o.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),o.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Ownership & History"]}),n&&o.jsxs("span",{className:"serial-badge",children:["S/N: ",n]})]})}),o.jsxs("div",{className:"current-owner-section",children:[o.jsxs("div",{className:"current-owner-header",children:[o.jsx("h4",{children:"Current Registered Owner"}),o.jsx("span",{className:"owner-help",children:"As per the aviation registry (CAA, FAA, etc.)"})]}),r!=null&&r.name?o.jsxs("div",{className:"current-owner-display",children:[o.jsxs("div",{className:"owner-details",children:[o.jsx("div",{className:"owner-name-large",children:r.name}),r.address&&o.jsx("div",{className:"owner-address-display",children:r.address})]}),!c&&l&&o.jsx(K,{size:"small",variant:"secondary",onClick:_,children:"Update Owner"})]}):o.jsxs("div",{className:"current-owner-empty",children:[o.jsx("p",{children:"No registered owner on file"}),!c&&l&&o.jsx(K,{size:"small",variant:"secondary",onClick:_,children:"Add Owner"})]})]}),o.jsx("div",{className:"history-section-header",children:o.jsx("h4",{children:"Ownership History"})}),S.length===0?o.jsxs("div",{className:"timeline-empty",children:[o.jsx("p",{children:"No history recorded for this aircraft"}),o.jsx("p",{className:"timeline-empty-hint",children:"History is automatically recorded when you mark aircraft as sold or update ownership"})]}):o.jsx("div",{className:"timeline-events",children:S.map((T,P)=>o.jsxs("div",{className:"timeline-event",children:[o.jsx("div",{className:"event-icon",style:{backgroundColor:Zde[T.type]||"#6b7280"},children:JM[T.type]||JM.status_change}),o.jsx("div",{className:"event-line"}),o.jsxs("div",{className:"event-content",children:[o.jsxs("div",{className:"event-header",children:[o.jsx("span",{className:"event-type",children:Hde[T.type]||T.type}),o.jsx("span",{className:"event-date",children:C(T.date)})]}),T.type==="registration_change"&&o.jsxs("div",{className:"event-change",children:[o.jsx("span",{className:"old-value",children:T.previousRegistration}),o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),o.jsx("polyline",{points:"12 5 19 12 12 19"})]}),o.jsx("span",{className:"new-value",children:T.newRegistration})]}),T.type==="owner_change"&&o.jsxs("div",{className:"event-owners",children:[T.previousOwner&&o.jsxs("div",{className:"owner-info previous",children:[o.jsx("span",{className:"owner-label",children:"From:"}),o.jsx("span",{className:"owner-name",children:T.previousOwner.name}),T.previousOwner.address&&o.jsx("span",{className:"owner-address",children:T.previousOwner.address})]}),T.newOwner&&o.jsxs("div",{className:"owner-info current",children:[o.jsx("span",{className:"owner-label",children:"To:"}),o.jsx("span",{className:"owner-name",children:T.newOwner.name}),T.newOwner.address&&o.jsx("span",{className:"owner-address",children:T.newOwner.address})]})]}),T.notes&&o.jsx("p",{className:"event-notes",children:T.notes}),o.jsxs("div",{className:"event-footer",children:[o.jsx("span",{className:"event-source",children:T.source}),!c&&o.jsxs("div",{className:"event-actions",children:[i&&o.jsx("button",{className:"action-btn",onClick:()=>I(T),children:"Edit"}),a&&o.jsx("button",{className:"action-btn danger",onClick:()=>a(T.id),children:"Delete"})]})]})]})]},T.id||P))}),o.jsx(ut,{isOpen:u,onClose:()=>{d(!1),m(null),j()},title:p?"Edit History Event":"Add History Event",size:"medium",children:o.jsxs("div",{className:"timeline-event-form",children:[o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Event Type"}),o.jsxs("select",{value:g.type,onChange:T=>y(P=>({...P,type:T.target.value})),className:"form-select",children:[o.jsx("option",{value:"owner_change",children:"Ownership Change"}),o.jsx("option",{value:"registration_change",children:"Registration Change"}),o.jsx("option",{value:"acquired",children:"Aircraft Acquired"}),o.jsx("option",{value:"sold",children:"Aircraft Sold"}),o.jsx("option",{value:"status_change",children:"Status Update"}),o.jsx("option",{value:"service",children:"Service Performed"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Date"}),o.jsx(ye,{type:"date",value:g.date,onChange:T=>y(P=>({...P,date:T.target.value}))})]})]}),g.type==="registration_change"&&o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Previous Registration"}),o.jsx(ye,{placeholder:"e.g., F-HXYZ",value:g.previousRegistration,onChange:T=>y(P=>({...P,previousRegistration:T.target.value}))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"New Registration"}),o.jsx(ye,{placeholder:"e.g., G-HELI",value:g.newRegistration,onChange:T=>y(P=>({...P,newRegistration:T.target.value}))})]})]}),g.type==="owner_change"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Previous Owner (optional)"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Name"}),o.jsx(ye,{placeholder:"Company or individual name",value:g.previousOwnerName,onChange:T=>y(P=>({...P,previousOwnerName:T.target.value}))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Address"}),o.jsx(ye,{placeholder:"Full address",value:g.previousOwnerAddress,onChange:T=>y(P=>({...P,previousOwnerAddress:T.target.value}))})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"New Owner"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Name"}),o.jsx(ye,{placeholder:"Company or individual name",value:g.newOwnerName,onChange:T=>y(P=>({...P,newOwnerName:T.target.value}))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Address"}),o.jsx(ye,{placeholder:"Full address",value:g.newOwnerAddress,onChange:T=>y(P=>({...P,newOwnerAddress:T.target.value}))})]})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Notes"}),o.jsx("textarea",{className:"form-textarea",rows:3,placeholder:"Additional details about this event...",value:g.notes,onChange:T=>y(P=>({...P,notes:T.target.value}))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Source"}),o.jsx(ye,{placeholder:"e.g., Registry, Manual Entry, Dealer",value:g.source,onChange:T=>y(P=>({...P,source:T.target.value}))})]}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{variant:"secondary",onClick:()=>{d(!1),m(null),j()},children:"Cancel"}),o.jsx(K,{onClick:A,children:p?"Save Changes":"Add Event"})]})]})}),o.jsx(ut,{isOpen:h,onClose:()=>f(!1),title:r!=null&&r.name?"Update Registered Owner":"Add Registered Owner",size:"medium",children:o.jsxs("div",{className:"timeline-event-form",children:[(r==null?void 0:r.name)&&o.jsxs("div",{className:"previous-owner-notice",children:[o.jsx("span",{className:"notice-label",children:"Previous Owner:"}),o.jsx("span",{className:"notice-value",children:r.name})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"New Owner"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Owner Name *"}),o.jsx(ye,{placeholder:"Company or individual name",value:x.name,onChange:T=>w(P=>({...P,name:T.target.value})),autoFocus:!0})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Registered Address"}),o.jsx("textarea",{className:"form-textarea",rows:3,placeholder:"Full registered address",value:x.address,onChange:T=>w(P=>({...P,address:T.target.value}))})]})]}),o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Effective Date"}),o.jsx(ye,{type:"date",value:x.effectiveDate,onChange:T=>w(P=>({...P,effectiveDate:T.target.value}))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Source"}),o.jsx(ye,{placeholder:"e.g., Registry, Manual Entry",value:x.source,onChange:T=>w(P=>({...P,source:T.target.value}))})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Notes (optional)"}),o.jsx("textarea",{className:"form-textarea",rows:2,placeholder:"Additional details about this ownership change...",value:x.notes,onChange:T=>w(P=>({...P,notes:T.target.value}))})]}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),o.jsx(K,{onClick:E,disabled:!x.name.trim(),children:r!=null&&r.name?"Update Owner":"Add Owner"})]})]})})]})}function the({activities:t=[],loading:e=!1,onDeleteActivity:n,onAddNote:r,formatCurrency:s}){const[i,a]=b.useState(null),[l,c]=b.useState(!1),[u,d]=b.useState(""),[h,f]=b.useState(!1),[p,m]=b.useState(!1),g=[...t].sort((C,A)=>new Date(A.timestamp)-new Date(C.timestamp)),y=async C=>{f(!0);const A=await(n==null?void 0:n(C.id));f(!1),A&&a(null)},x=async()=>{if(!u.trim())return;m(!0);const C=await(r==null?void 0:r(u.trim()));m(!1),C&&(d(""),c(!1))},w=C=>{switch(C){case Ht.STATUS_CHANGE:return o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),o.jsx("path",{d:"M12 6v6l4 2"})]});case Ht.SOLD:return o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})});case Ht.SALE_CANCELLED:return o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),o.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]});case Ht.PRICE_CHANGE:return o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]});case Ht.FEATURED:case Ht.UNFEATURED:return o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})});case Ht.NOTE:return o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})});case Ht.CREATED:return o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]});default:return o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("circle",{cx:"12",cy:"12",r:"10"})})}},N=C=>{var A;switch(C.type){case Ht.STATUS_CHANGE:return`Status changed from ${C.oldStatusLabel} to ${C.newStatusLabel}`;case Ht.SOLD:const j=(s==null?void 0:s(C.salePrice))||`$${(A=C.salePrice)==null?void 0:A.toLocaleString()}`;return`Marked as Sold${C.buyerName?` to ${C.buyerName}`:""} for ${j}`;case Ht.SALE_CANCELLED:return"Sale cancelled / marked as mistake";case Ht.PRICE_CHANGE:return`Price changed from ${(s==null?void 0:s(C.oldPrice))||C.oldPrice} to ${(s==null?void 0:s(C.newPrice))||C.newPrice}`;case Ht.FEATURED:return"Marked as Featured";case Ht.UNFEATURED:return"Removed from Featured";case Ht.NOTE:return"Note added";case Ht.CREATED:return"Aircraft created";case Ht.UPDATED:return"Aircraft updated";default:return C.type}},S=C=>{switch(C){case Ht.SOLD:return"activity-sold";case Ht.SALE_CANCELLED:return"activity-cancelled";case Ht.STATUS_CHANGE:return"activity-status";case Ht.PRICE_CHANGE:return"activity-price";case Ht.FEATURED:case Ht.UNFEATURED:return"activity-featured";case Ht.NOTE:return"activity-note";default:return""}};return e?o.jsxs("div",{className:"helicopter-activity-log",children:[o.jsx("div",{className:"activity-header",children:o.jsx("h3",{children:"Activity Log"})}),o.jsx("div",{className:"activity-loading",children:"Loading activities..."})]}):o.jsxs("div",{className:"helicopter-activity-log",children:[o.jsxs("div",{className:"activity-header",children:[o.jsxs("div",{children:[o.jsxs("h3",{children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"8px",verticalAlign:"middle"},children:[o.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),o.jsx("path",{d:"M12 6v6l4 2"})]}),"Activity Log"]}),o.jsx("p",{className:"form-help",children:"Track all changes and events for this aircraft"})]}),o.jsx(K,{size:"small",variant:"secondary",onClick:()=>c(!0),children:"+ Add Note"})]}),g.length===0?o.jsx("div",{className:"activity-empty",children:o.jsx("p",{children:"No activity recorded yet"})}):o.jsx("div",{className:"activity-timeline",children:g.map(C=>o.jsxs("div",{className:`activity-item ${S(C.type)}`,children:[o.jsx("div",{className:"activity-icon",children:w(C.type)}),o.jsxs("div",{className:"activity-content",children:[o.jsxs("div",{className:"activity-main",children:[o.jsx("span",{className:"activity-title",children:N(C)}),o.jsx("button",{className:"activity-delete-btn",onClick:()=>a(C),title:"Delete this activity",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}),(C.notes||C.note)&&o.jsx("p",{className:"activity-notes",children:C.notes||C.note}),C.type===Ht.SOLD&&C.attributions&&o.jsx("div",{className:"activity-attributions",children:C.attributions.map((A,j)=>o.jsxs("span",{className:"attribution-tag",children:[A.name,": ",A.percentage,"%"]},j))}),o.jsxs("div",{className:"activity-meta",children:[o.jsx("span",{className:"activity-time",children:Kh(new Date(C.timestamp),{addSuffix:!0})}),o.jsxs("span",{className:"activity-date",children:["(",rt(new Date(C.timestamp),"MMM d, yyyy h:mm a"),")"]}),o.jsxs("span",{className:"activity-by",children:["by ",C.createdBy]})]})]})]},C.id))}),o.jsxs(ut,{isOpen:!!i,onClose:()=>a(null),title:"Delete Activity",size:"small",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>a(null),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:()=>y(i),loading:h,children:"Delete"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this activity?"}),o.jsx("p",{className:"form-help",style:{marginTop:"8px"},children:o.jsx("strong",{children:i&&N(i)})}),o.jsx("p",{className:"form-help",style:{marginTop:"12px",color:"var(--color-warning)"},children:"This action cannot be undone. Use this if the activity was logged by mistake."})]}),o.jsx(ut,{isOpen:l,onClose:()=>{c(!1),d("")},title:"Add Note",size:"small",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>c(!1),children:"Cancel"}),o.jsx(K,{onClick:x,loading:p,disabled:!u.trim(),children:"Add Note"})]}),children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Note"}),o.jsx("textarea",{className:"form-textarea",rows:4,value:u,onChange:C=>d(C.target.value),placeholder:"Add a note about this aircraft...",autoFocus:!0})]})})]})}function nhe(){const{id:t}=Op(),e=rr(),{success:n,error:r}=qt(),{can:s,PERMISSIONS:i}=Js(),{data:a,loading:l}=wv("helicopters",t),{update:c,remove:u,loading:d}=Ms("helicopters"),[h,f]=b.useState(null),[p,m]=b.useState([]),[g,y]=b.useState(!1),[x,w]=b.useState(!1),[N,S]=b.useState(!1),[C,A]=b.useState(null),[j,_]=b.useState([]),[E,I]=b.useState([]),[T,P]=b.useState([]),[O,H]=b.useState([]),[X,se]=b.useState([]),{addPurchaseToHistory:L}=Ia(),{formatCurrency:B}=iW(),{data:$}=pn("users"),{activities:q,loading:Y,logStatusChange:R,logSale:G,logPriceChange:Z,logFeaturedChange:W,addNote:Q,deleteActivity:U}=zde(t),[pe,J]=b.useState({salePrice:"",buyerName:"",saleNotes:"",attributions:[]}),ge=()=>{J({salePrice:"",buyerName:"",saleNotes:"",attributions:[{name:"",percentage:100}]})},me=(fe,Ae,Je)=>{J($t=>{const tn=[...$t.attributions];return tn[fe]={...tn[fe],[Ae]:Je},{...$t,attributions:tn}})},ue=()=>{J(fe=>({...fe,attributions:[...fe.attributions,{name:"",percentage:0}]}))},st=fe=>{pe.attributions.length<=1||J(Ae=>({...Ae,attributions:Ae.attributions.filter((Je,$t)=>$t!==fe)}))},Ke=()=>pe.attributions.reduce((fe,Ae)=>fe+(parseFloat(Ae.percentage)||0),0),ot=()=>{const fe=Ke();if(fe===100||pe.attributions.length===0)return;const Ae=pe.attributions.length-1,Je=parseFloat(pe.attributions[Ae].percentage)||0,$t=100-fe;me(Ae,"percentage",Math.max(0,Je+$t))},{manufacturers:lt,loading:bt,getModelsForManufacturer:mt,getEngineForModel:V,addManufacturer:re,addModel:ie,editManufacturer:Fe,editModel:Qe,deleteManufacturer:At,deleteModel:Jn}=Pu(),[Pt,gt]=b.useState(!1),{avionicsOptions:Pn,equipmentOptions:ji,highlightsOptions:Zi,loading:ri,addAvionicsOption:Bs,editAvionicsOption:ea,removeAvionicsOption:he,addEquipmentOption:Me,editEquipmentOption:Se,removeEquipmentOption:vt,addHighlightsOption:it,editHighlightsOption:kt,removeHighlightsOption:an}=fW(h==null?void 0:h.manufacturer,h==null?void 0:h.model);b.useEffect(()=>{var fe,Ae,Je,$t,tn,bs,gr,ir;a&&(_(a.potentialBuyers||[]),I(a.ownershipHistory||[]),P(a.saleHistory||[]),H(a.proposalHistory||[]),se(a.registrationHistory||[]),f({manufacturer:a.manufacturer||"",model:a.model||"",year:a.year||"",registration:a.registration||"",serialNumber:a.serialNumber||"",priceType:a.priceType||(a.priceDisplay==="P.O.A."?"poa":a.priceDisplay==="T.B.D."?"tbd":"fixed"),price:a.price||"",currency:a.currency||"GBP",vatStatus:a.vatStatus||"plus",totalHours:a.totalHours||"",engineHours:((fe=a.specs)==null?void 0:fe.engineHours)||"",engineTBO:((Ae=a.specs)==null?void 0:Ae.engineTBO)||"",endOfLifeDate:((Je=a.specs)==null?void 0:Je.endOfLifeDate)||"",engine:(($t=a.specs)==null?void 0:$t.engine)||"",condition:a.condition||"",description:a.description||"",avionics:((tn=a.specs)==null?void 0:tn.avionics)||[],equipment:((bs=a.specs)==null?void 0:bs.equipment)||[],highlights:a.highlights||[],status:a.status||"draft",featured:a.featured||!1,images:a.images||[],currentOwnerName:((gr=a.currentOwner)==null?void 0:gr.name)||"",currentOwnerAddress:((ir=a.currentOwner)==null?void 0:ir.address)||""}))},[a]),b.useEffect(()=>{h!=null&&h.manufacturer&&lt.length>0&&m(mt(h.manufacturer))},[h==null?void 0:h.manufacturer,lt]);const wt=fe=>{const{name:Ae,value:Je,type:$t,checked:tn}=fe.target;if(Ae==="manufacturer")f(bs=>({...bs,manufacturer:Je,model:"",engine:"",avionics:[],equipment:[],highlights:[]}));else if(Ae==="model"){const bs=h.manufacturer&&Je?V(h.manufacturer,Je):"";f(gr=>({...gr,model:Je,engine:bs,avionics:[],equipment:[],highlights:[]}))}else f(bs=>({...bs,[Ae]:$t==="checkbox"?tn:Je}))},Lt=(fe,Ae)=>{f(Je=>({...Je,[fe]:Je[fe].includes(Ae)?Je[fe].filter($t=>$t!==Ae):[...Je[fe],Ae]}))},Vn=fe=>{f(Ae=>({...Ae,images:fe}))},Zn=async fe=>{fe.preventDefault();try{let Ae="";h.status==="sold"?Ae="SOLD":h.priceType==="poa"?Ae="P.O.A.":h.priceType==="tbd"?Ae="T.B.D.":h.price&&(Ae=`${Xb.find(tn=>tn.value===h.currency).symbol}${parseInt(h.price).toLocaleString()}`,h.vatStatus==="plus"&&(Ae+=" +VAT"));const Je={manufacturer:h.manufacturer,model:h.model,year:parseInt(h.year)||0,registration:h.registration.toUpperCase(),serialNumber:h.serialNumber,price:h.priceType==="poa"||h.priceType==="tbd"?null:Math.round(Number(h.price))||0,priceType:h.priceType,priceDisplay:Ae,currency:h.currency,vatStatus:h.vatStatus,totalHours:parseInt(h.totalHours)||0,specs:{engine:h.engine,engineHours:parseInt(h.engineHours)||0,engineTBO:parseInt(h.engineTBO)||0,endOfLifeDate:h.endOfLifeDate||null,avionics:h.avionics,equipment:h.equipment},condition:h.condition,description:h.description,highlights:h.highlights,status:h.status,featured:h.featured,images:h.images,currentOwner:h.currentOwnerName||h.currentOwnerAddress?{name:h.currentOwnerName||"",address:h.currentOwnerAddress||""}:null,registrationHistory:X};await c(t,Je);try{a.status&&h.status&&a.status!==h.status&&await R(a.status,h.status);const $t=a.price||0,tn=Je.price||0;$t!==tn&&await Z($t,tn,h.currency),a.featured!==h.featured&&await W(h.featured)}catch($t){console.error("Failed to log activity:",$t)}n("Aircraft updated successfully"),e(-1)}catch(Ae){r("Failed to update aircraft"),console.error(Ae)}},si=async()=>{try{await u(t),n("Aircraft deleted"),e("/listings")}catch{r("Failed to delete listing")}},Zr=async()=>{const fe=Ke();if(Math.abs(fe-100)>.1){r("Attribution percentages must total 100%");return}if(pe.attributions.filter(Je=>!Je.name.trim()&&Je.percentage>0).length>0){r("Please assign a name to all attributions");return}try{const Je=parseFloat(pe.salePrice)||h.price||0,$t=new Date,tn=pe.attributions.filter(le=>le.percentage>0&&le.name.trim()).map(le=>({name:le.name.trim(),percentage:parseFloat(le.percentage)})),bs=C?{buyerContactId:C.id,buyerContact:{id:C.id,firstName:C.firstName,lastName:C.lastName,email:C.email,company:C.companyName||C.company||null,contactType:C.contactType||"individual"}}:{},gr=C?`${C.firstName} ${C.lastName}`:pe.buyerName||null,ir={id:`sold-${Date.now()}`,type:"sold",date:$t,registration:h.registration,notes:pe.saleNotes||"",source:"Sale Record",salePrice:Je,newOwner:gr?{name:gr,address:(C==null?void 0:C.company)||""}:null,previousOwner:h.currentOwnerName?{name:h.currentOwnerName,address:h.currentOwnerAddress||""}:null},Gt=[...X,ir];se(Gt);const ta=gr?{name:gr,address:(C==null?void 0:C.company)||""}:null,z={status:"sold",priceDisplay:"SOLD",soldAt:$t,salePrice:Je,saleAttribution:tn,buyerName:gr,saleNotes:pe.saleNotes||null,...bs,registrationHistory:Gt,currentOwner:ta};if(await c(t,z),ta&&f(le=>({...le,currentOwnerName:ta.name,currentOwnerAddress:ta.address})),await G({salePrice:Je,buyerName:C?`${C.firstName} ${C.lastName}`:pe.buyerName||null,buyerContactId:C==null?void 0:C.id,attributions:tn,notes:pe.saleNotes}),C)try{await L(C.id,{helicopterId:t,purchaseDate:new Date,salePrice:Je,aircraft:{year:h.year,manufacturer:h.manufacturer,model:h.model,registration:h.registration}})}catch(le){console.error("Failed to update contact purchase history:",le)}f(le=>({...le,status:"sold"})),w(!1),A(null),ge(),n("Sale recorded successfully")}catch{r("Failed to record sale")}},Vs=()=>parseFloat(pe.salePrice)||(h==null?void 0:h.price)||0;if(l||!h)return o.jsx(Qn,{fullScreen:!0});if(!a)return o.jsx("div",{className:"error-state",children:"Aircraft not found"});const $n=h.manufacturer&&h.model;return o.jsxs("div",{className:"listing-edit",children:[o.jsxs(at,{to:"/aircraft",className:"back-link",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back to Aircraft"]}),o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Edit Aircraft"}),o.jsxs("p",{className:"page-subtitle",children:[a.year," ",a.manufacturer," ",a.model]})]}),o.jsxs("div",{className:"header-actions",children:[s(i.LISTINGS_MARK_SOLD)&&h.status!=="sold"&&o.jsx(K,{variant:"secondary",onClick:()=>w(!0),children:"Mark as Sold"}),s(i.LISTINGS_DELETE)&&o.jsx(K,{variant:"danger",onClick:()=>y(!0),children:"Delete"})]})]}),o.jsxs("form",{onSubmit:Zn,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Aircraft"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Manufacturer *"}),o.jsxs("div",{className:"select-with-actions",children:[o.jsxs("select",{name:"manufacturer",value:h.manufacturer,onChange:wt,className:"form-select",required:!0,disabled:bt,children:[o.jsx("option",{value:"",children:"Select manufacturer"}),lt.map(fe=>o.jsx("option",{value:fe,children:fe},fe))]}),o.jsxs("button",{type:"button",className:"select-manage-btn",onClick:()=>gt(!0),title:"Manage manufacturers & models",children:[o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage"]})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Model *"}),o.jsxs("select",{name:"model",value:h.model,onChange:wt,className:"form-select",required:!0,disabled:!h.manufacturer,children:[o.jsx("option",{value:"",children:"Select model"}),p.map(fe=>o.jsx("option",{value:fe,children:fe},fe))]})]}),o.jsx(ye,{label:"Year *",name:"year",type:"number",value:h.year,onChange:wt,required:!0}),o.jsx(ye,{label:"Registration",name:"registration",value:h.registration,onChange:wt,style:{textTransform:"uppercase"}}),o.jsx(ye,{label:"Serial Number",name:"serialNumber",value:h.serialNumber,onChange:wt}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Condition"}),o.jsxs("select",{name:"condition",value:h.condition,onChange:wt,className:"form-select",children:[o.jsx("option",{value:"",children:"Select condition"}),hW.map(fe=>o.jsx("option",{value:fe,children:fe},fe))]})]})]}),h.engine&&o.jsxs("div",{className:"info-box",children:[o.jsx("strong",{children:"Engine:"})," ",h.engine]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Pricing"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Price Type"}),o.jsxs("select",{name:"priceType",value:h.priceType,onChange:wt,className:"form-select",children:[o.jsx("option",{value:"fixed",children:"Fixed Price"}),o.jsx("option",{value:"poa",children:"Price on Application (P.O.A.)"}),o.jsx("option",{value:"tbd",children:"To Be Determined (T.B.D.)"})]})]}),h.priceType==="fixed"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Currency"}),o.jsx("select",{name:"currency",value:h.currency,onChange:wt,className:"form-select",children:Xb.map(fe=>o.jsx("option",{value:fe.value,children:fe.label},fe.value))})]}),o.jsx(ye,{label:"Price",name:"price",type:"number",step:"1",value:h.price,onChange:wt}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"VAT Status"}),o.jsx("select",{name:"vatStatus",value:h.vatStatus,onChange:wt,className:"form-select",children:dW.map(fe=>o.jsx("option",{value:fe.value,children:fe.label},fe.value))})]})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Hours & Component Life"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Total Airframe Hours",name:"totalHours",type:"number",value:h.totalHours,onChange:wt}),o.jsx(ye,{label:"Engine Hours",name:"engineHours",type:"number",value:h.engineHours,onChange:wt}),o.jsx(ye,{label:"Engine TBO",name:"engineTBO",type:"number",value:h.engineTBO,onChange:wt}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"End of Life Date"}),o.jsx("input",{type:"date",name:"endOfLifeDate",value:h.endOfLifeDate,onChange:wt,className:"form-input"}),o.jsx("span",{className:"form-help",children:"Remaining time calculated automatically"})]})]})]}),o.jsx("div",{className:"form-section",children:$n?ri?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Avionics"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Avionics",options:Pn,selectedValues:h.avionics,onToggle:fe=>Lt("avionics",fe),onAdd:Bs,onEdit:ea,onRemove:he}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Avionics"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see avionics options"})]})}),o.jsx("div",{className:"form-section",children:$n?ri?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Equipment"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Equipment",options:ji,selectedValues:h.equipment,onToggle:fe=>Lt("equipment",fe),onAdd:Me,onEdit:Se,onRemove:vt}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Equipment"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see equipment options"})]})}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Images"}),o.jsx("p",{className:"form-help",style:{marginBottom:"12px"},children:"Drag and drop images or click to browse. First image is the primary photo."}),o.jsx(Yde,{listingId:t,images:h.images,onImagesChange:Vn,maxImages:20})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Description"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Full Description"}),o.jsx("textarea",{name:"description",value:h.description,onChange:wt,className:"form-textarea",rows:6})]})]}),o.jsx("div",{className:"form-section",children:$n?ri?o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Highlights"}),o.jsx("p",{className:"form-help",children:"Loading options..."})]}):o.jsx(Pf,{title:"Highlights",options:Zi,selectedValues:h.highlights,onToggle:fe=>Lt("highlights",fe),onAdd:it,onEdit:kt,onRemove:an}):o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Highlights"}),o.jsx("p",{className:"form-help",children:"Select a manufacturer and model first to see highlight options"})]})}),o.jsx("div",{className:"form-section",children:o.jsx(Jde,{listingId:t,ownershipHistory:E,saleHistory:T,currentRegistration:h.registration,currency:h.currency||"GBP",onUpdate:I,onSaleHistoryUpdate:P})}),o.jsx("div",{className:"form-section",children:o.jsx(ehe,{events:X,currentRegistration:h.registration,serialNumber:h.serialNumber,currentOwner:{name:h.currentOwnerName,address:h.currentOwnerAddress},onAddEvent:fe=>{const Ae=[...X,fe];se(Ae)},onEditEvent:fe=>{const Ae=X.map(Je=>Je.id===fe.id?fe:Je);se(Ae)},onDeleteEvent:fe=>{const Ae=X.filter(Je=>Je.id!==fe);se(Ae)},onUpdateCurrentOwner:fe=>{f(Ae=>({...Ae,currentOwnerName:fe.name,currentOwnerAddress:fe.address}))}})}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Status & Visibility"}),o.jsx("div",{className:"form-grid",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsxs("select",{name:"status",value:h.status,onChange:fe=>{fe.target.value==="sold"&&h.status!=="sold"?(ge(),w(!0)):wt(fe)},className:"form-select",disabled:!s(i.LISTINGS_PUBLISH),children:[o.jsx("option",{value:"off_market",children:"Off Market"}),o.jsx("option",{value:"available",children:"Available"}),o.jsx("option",{value:"taking_offers",children:"Taking Offers"}),o.jsx("option",{value:"under_negotiation",children:"Under Negotiation"}),o.jsx("option",{value:"sold",children:"Sold"})]})]})}),o.jsx("div",{className:"form-group",children:o.jsxs("label",{className:"form-checkbox",children:[o.jsx("input",{type:"checkbox",name:"featured",checked:h.featured,onChange:wt}),o.jsx("span",{children:"Featured listing (show on homepage)"})]})})]}),h.status!=="sold"&&o.jsx("div",{className:"form-section",children:o.jsx(Qde,{listingId:t,potentialBuyers:j,onUpdate:_,listingTitle:`${h.year} ${h.manufacturer} ${h.model}`})}),O.length>0&&o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Proposal History"}),o.jsx("p",{className:"form-help",style:{marginBottom:"16px"},children:"Contacts this aircraft was proposed to via activity mentions."}),o.jsx("div",{className:"proposal-history-list",children:O.sort((fe,Ae)=>new Date(Ae.proposedAt)-new Date(fe.proposedAt)).map(fe=>o.jsxs("div",{className:"proposal-history-item",children:[o.jsxs("div",{className:"proposal-main",children:[o.jsx(at,{to:`/contacts/${fe.contactId}`,className:"proposal-contact-name",children:fe.contactName}),fe.contactCompany&&o.jsxs("span",{className:"proposal-company",children:["(",fe.contactCompany,")"]}),o.jsx("span",{className:`proposal-outcome-badge outcome-${fe.outcome}`,children:fe.outcome==="not_interested"?"Not Interested":fe.outcome.charAt(0).toUpperCase()+fe.outcome.slice(1)})]}),o.jsxs("div",{className:"proposal-meta",children:[o.jsx("span",{className:"proposal-type",children:fe.activityType}),o.jsx("span",{className:"proposal-title",children:fe.activityTitle}),o.jsx("span",{className:"proposal-date",children:rt(new Date(fe.proposedAt),"MMM d, yyyy")}),o.jsxs("span",{className:"proposal-by",children:["by ",fe.proposedBy]})]}),fe.notes&&o.jsx("p",{className:"proposal-notes",children:fe.notes})]},fe.id))})]}),o.jsx("div",{className:"form-section",children:o.jsx(the,{activities:q,loading:Y,onDeleteActivity:U,onAddNote:Q,formatCurrency:B})}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{type:"button",variant:"secondary",onClick:()=>e("/listings"),children:"Cancel"}),o.jsx(K,{type:"submit",loading:d,children:"Save Changes"})]})]}),o.jsx(pW,{isOpen:Pt,onClose:()=>gt(!1),manufacturers:lt,getModelsForManufacturer:mt,getEngineForModel:V,onAddManufacturer:re,onEditManufacturer:Fe,onDeleteManufacturer:At,onAddModel:ie,onEditModel:Qe,onDeleteModel:Jn,selectedManufacturer:h.manufacturer,selectedModel:h.model,onSelectManufacturer:fe=>f(Ae=>({...Ae,manufacturer:fe,model:"",engine:""})),onSelectModel:fe=>{const Ae=h.manufacturer&&fe?V(h.manufacturer,fe):"";f(Je=>({...Je,model:fe,engine:Ae}))}}),o.jsx(ut,{isOpen:g,onClose:()=>y(!1),title:"Delete Aircraft",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:si,children:"Delete"})]}),children:o.jsx("p",{children:"Are you sure you want to delete this listing? This cannot be undone."})}),o.jsx(ut,{isOpen:x,onClose:()=>{w(!1),ge()},title:"Record Sale",size:"large",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>w(!1),children:"Cancel"}),o.jsx(K,{onClick:Zr,disabled:Math.abs(Ke()-100)>.1,children:"Confirm Sale"})]}),children:o.jsxs("div",{className:"sold-modal-content",children:[o.jsxs("div",{className:"sold-modal-aircraft",children:[o.jsx("span",{className:"aircraft-year",children:h==null?void 0:h.year}),o.jsxs("span",{className:"aircraft-name",children:[h==null?void 0:h.manufacturer," ",h==null?void 0:h.model]}),(h==null?void 0:h.registration)&&o.jsx("span",{className:"aircraft-reg",children:h==null?void 0:h.registration})]}),o.jsxs("div",{className:"form-grid form-grid-2",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Sale Price"}),o.jsx("input",{type:"number",className:"form-input",value:pe.salePrice,onChange:fe=>J(Ae=>({...Ae,salePrice:fe.target.value})),placeholder:h!=null&&h.price?`Listed: ${B(h.price)}`:"Enter sale price"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Buyer"}),C?o.jsxs("div",{className:"selected-contact-display",children:[o.jsxs("div",{className:"selected-contact-info",children:[o.jsxs("span",{className:"contact-name",children:[C.firstName," ",C.lastName]}),C.company&&o.jsx("span",{className:"contact-company",children:C.company})]}),o.jsx("button",{type:"button",className:"change-contact-btn",onClick:()=>S(!0),children:"Change"}),o.jsx("button",{type:"button",className:"remove-contact-btn",onClick:()=>A(null),children:"Remove"})]}):o.jsxs("div",{className:"buyer-selection-area",children:[j.length>0&&o.jsxs("div",{className:"potential-buyers-quick-select",children:[o.jsx("span",{className:"quick-select-label",children:"Select from potential buyers:"}),o.jsx("div",{className:"quick-select-options",children:j.map(fe=>o.jsxs("button",{type:"button",className:"quick-select-btn",onClick:()=>A({id:fe.contactId,firstName:fe.firstName,lastName:fe.lastName,email:fe.email,company:fe.company}),children:[o.jsxs("span",{className:"quick-select-name",children:[fe.firstName," ",fe.lastName]}),fe.company&&o.jsx("span",{className:"quick-select-company",children:fe.company}),o.jsx("span",{className:`interest-badge interest-${fe.interestLevel||"medium"}`,children:fe.interestLevel||"medium"})]},fe.contactId))}),o.jsx("div",{className:"quick-select-divider",children:o.jsx("span",{children:"or"})})]}),o.jsxs("div",{className:"buyer-input-group",children:[o.jsx("input",{type:"text",className:"form-input",value:pe.buyerName,onChange:fe=>J(Ae=>({...Ae,buyerName:fe.target.value})),placeholder:"Enter name or select contact"}),o.jsx(K,{type:"button",variant:"secondary",size:"small",onClick:()=>S(!0),children:"Select Contact"})]})]})]})]}),o.jsxs("div",{className:"attribution-section",children:[o.jsxs("div",{className:"attribution-header",children:[o.jsx("h4",{children:"Sales Attribution"}),o.jsx("span",{className:"attribution-hint",children:"Who contributed to this sale? Percentages must total 100%."})]}),o.jsxs("div",{className:"attribution-entries",children:[pe.attributions.map((fe,Ae)=>o.jsxs("div",{className:"attribution-entry",children:[o.jsxs("div",{className:"attribution-entry-main",children:[o.jsxs("select",{className:"form-select attribution-name-select",value:fe.name,onChange:Je=>me(Ae,"name",Je.target.value),children:[o.jsx("option",{value:"",children:"Select person"}),o.jsx("option",{value:"HQ Aviation",children:"HQ Aviation (Company)"}),$.map(Je=>o.jsx("option",{value:Je.displayName||Je.email,children:Je.displayName||Je.email},Je.id))]}),o.jsxs("div",{className:"attribution-percentage-wrapper",children:[o.jsx("input",{type:"number",className:"form-input attribution-percentage-input",value:fe.percentage,onChange:Je=>me(Ae,"percentage",parseFloat(Je.target.value)||0),min:"0",max:"100"}),o.jsx("span",{className:"percentage-symbol",children:"%"})]}),o.jsx("div",{className:"attribution-slider-wrapper",children:o.jsx("input",{type:"range",className:"attribution-slider",value:fe.percentage,onChange:Je=>me(Ae,"percentage",parseFloat(Je.target.value)),min:"0",max:"100",step:"5"})})]}),pe.attributions.length>1&&o.jsx("button",{type:"button",className:"attribution-remove-btn",onClick:()=>st(Ae),title:"Remove",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},Ae)),o.jsxs("button",{type:"button",className:"attribution-add-btn",onClick:ue,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Person"]})]}),o.jsxs("div",{className:`attribution-total ${Math.abs(Ke()-100)<=.1?"valid":"invalid"}`,children:[o.jsx("span",{children:"Total:"}),o.jsxs("span",{className:"total-value",children:[Ke(),"%"]}),Math.abs(Ke()-100)>.1&&o.jsx("button",{type:"button",className:"auto-balance-btn",onClick:ot,children:"Auto-balance"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Sale Notes (optional)"}),o.jsx("textarea",{className:"form-textarea",rows:2,value:pe.saleNotes,onChange:fe=>J(Ae=>({...Ae,saleNotes:fe.target.value})),placeholder:"Any additional notes..."})]}),o.jsxs("div",{className:"sale-summary",children:[o.jsxs("div",{className:"summary-row",children:[o.jsx("span",{children:"Sale Price:"}),o.jsx("strong",{className:"sale-price-value",children:B(Vs())})]}),(C||pe.buyerName)&&o.jsxs("div",{className:"summary-row",children:[o.jsx("span",{children:"Buyer:"}),o.jsx("strong",{children:C?`${C.firstName} ${C.lastName}`:pe.buyerName})]})]})]})}),o.jsx(Qb,{isOpen:N,onClose:()=>S(!1),onSelect:fe=>{A(fe),J(Ae=>({...Ae,buyerName:""}))},title:"Select Buyer Contact",allowCreate:!0})]})}const PN=t=>{if(!t)return"";const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},rhe=[{id:"table",label:"Table",icon:"table"},{id:"sidebar",label:"Sidebar",icon:"sidebar"},{id:"kanban",label:"Kanban",icon:"kanban"}];function she(){const{can:t,PERMISSIONS:e}=Js(),{data:n,loading:r}=pn("blogs",[qr("createdAt","desc")]),{create:s,loading:i}=Ms("blogs"),{success:a,error:l}=qt(),[c,u]=b.useState("all"),[d,h]=b.useState(""),[f,p]=b.useState("table"),[m,g]=b.useState(null),[y,x]=b.useState(!1),[w,N]=b.useState(""),S=b.useRef(null),C=b.useRef(null),[A,j]=b.useState(!1),[_,E]=b.useState(!1),I=()=>{if(C.current){const{scrollLeft:L,scrollWidth:B,clientWidth:$}=C.current;j(L>5),E(L<B-$-5)}},T=L=>{C.current&&(C.current.scrollBy({left:L==="left"?-300:300,behavior:"smooth"}),setTimeout(I,350))},P=b.useMemo(()=>({all:n.length,idea:n.filter(L=>L.status==="idea").length,draft:n.filter(L=>L.status==="draft").length,published:n.filter(L=>L.status==="published").length,archived:n.filter(L=>L.status==="archived").length}),[n]),O=b.useMemo(()=>n.filter(L=>{if(c!=="all"&&L.status!==c)return!1;if(d){const B=d.toLowerCase(),$=(L.title||"").toLowerCase(),q=PN(L.content||"").toLowerCase();if(!$.includes(B)&&!q.includes(B))return!1}return!0}),[n,c,d]);b.useEffect(()=>{if(f==="kanban"){const L=setTimeout(I,100);return window.addEventListener("resize",I),()=>{clearTimeout(L),window.removeEventListener("resize",I)}}},[f,O]);const H=L=>(L.author||L.createdByName||"Unknown").split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2),X=async L=>{if(L.preventDefault(),!!w.trim())try{const B=w.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");await s({title:w.trim(),slug:B,content:"",excerpt:"",category:"",tags:[],status:"idea"}),a("Idea saved"),N(""),x(!1)}catch(B){l("Failed to save idea"),console.error(B)}},se=L=>{L.key==="Escape"&&(x(!1),N(""))};return r?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"blog-page",children:[o.jsxs("div",{className:"blog-header",children:[o.jsxs("div",{className:"blog-header-left",children:[o.jsx("h1",{children:"Blog Posts"}),o.jsxs("span",{className:"blog-count",children:[n.length," posts"]})]}),o.jsx("div",{className:"blog-header-right",children:t(e.BLOGS_CREATE)&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"idea-btn",onClick:()=>{x(!0),setTimeout(()=>{var L;return(L=S.current)==null?void 0:L.focus()},50)},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"}),o.jsx("path",{d:"M9 21h6"}),o.jsx("path",{d:"M9 18h6"})]}),"Quick Idea"]}),o.jsx(at,{to:"/blog/new",children:o.jsx(K,{children:"New Post"})})]})})]}),y&&o.jsxs("form",{className:"idea-input-form",onSubmit:X,children:[o.jsx("input",{ref:S,type:"text",placeholder:"What's your post idea? Press Enter to save as draft...",value:w,onChange:L=>N(L.target.value),onKeyDown:se,disabled:i}),o.jsxs("div",{className:"idea-input-actions",children:[o.jsx("button",{type:"submit",className:"idea-save-btn",disabled:!w.trim()||i,children:i?"Saving...":"Save"}),o.jsx("button",{type:"button",className:"idea-cancel-btn",onClick:()=>{x(!1),N("")},children:"Cancel"})]})]}),o.jsxs("div",{className:"blog-toolbar",children:[f!=="kanban"?o.jsx("div",{className:"blog-status-tabs",children:["all","idea","draft","published","archived"].map(L=>{const B={all:"All",idea:"Ideas",draft:"Draft",published:"Published",archived:"Archived"};return o.jsxs("button",{className:`blog-status-tab ${c===L?"active":""}`,onClick:()=>u(L),children:[B[L],o.jsx("span",{className:"tab-count",children:P[L]})]},L)})}):o.jsx("div",{className:"blog-toolbar-spacer"}),o.jsxs("div",{className:"blog-toolbar-right",children:[o.jsxs("div",{className:"blog-search",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search posts...",value:d,onChange:L=>h(L.target.value)})]}),o.jsx("div",{className:"blog-view-switcher",children:rhe.map(L=>o.jsxs("button",{className:`view-btn ${f===L.id?"active":""}`,onClick:()=>{p(L.id),L.id==="kanban"&&u("all")},title:L.label,children:[L.id==="table"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),o.jsx("line",{x1:"3",y1:"15",x2:"21",y2:"15"}),o.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),L.id==="sidebar"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),L.id==="kanban"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"5",height:"18",rx:"1"}),o.jsx("rect",{x:"10",y:"3",width:"5",height:"12",rx:"1"}),o.jsx("rect",{x:"17",y:"3",width:"5",height:"8",rx:"1"})]})]},L.id))})]})]}),O.length===0?o.jsxs("div",{className:"blog-empty",children:[o.jsx("p",{children:d?"No posts match your search":"No blog posts yet"}),!d&&t(e.BLOGS_CREATE)&&o.jsx(at,{to:"/blog/new",children:o.jsx(K,{variant:"secondary",children:"Write your first post"})})]}):o.jsxs(o.Fragment,{children:[f==="table"&&o.jsx(ihe,{posts:O,can:t,PERMISSIONS:e,getAuthorInitials:H}),f==="sidebar"&&o.jsx(ahe,{posts:O,can:t,PERMISSIONS:e,getAuthorInitials:H,selectedPost:m,setSelectedPost:g}),f==="kanban"&&o.jsxs("div",{className:"blog-kanban-wrapper",children:[A&&o.jsx("button",{className:"scroll-indicator scroll-left",onClick:()=>T("left"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),_&&o.jsx("button",{className:"scroll-indicator scroll-right",onClick:()=>T("right"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx(ohe,{posts:O,can:t,PERMISSIONS:e,getAuthorInitials:H,kanbanRef:C,onScroll:I})]})]})]})}function ihe({posts:t,can:e,PERMISSIONS:n,getAuthorInitials:r}){return o.jsx("div",{className:"blog-table-container",children:o.jsxs("table",{className:"blog-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Title"}),o.jsx("th",{children:"Author"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Date"}),o.jsx("th",{children:"Actions"})]})}),o.jsx("tbody",{children:t.map(s=>{var i,a;return o.jsxs("tr",{className:"blog-table-row",children:[o.jsx("td",{className:"blog-title-cell",children:o.jsxs("div",{className:"blog-title-content",children:[o.jsx("h4",{children:s.title}),o.jsxs("p",{className:"blog-excerpt",children:[(i=PN(s.excerpt||s.content))==null?void 0:i.substring(0,80),"..."]})]})}),o.jsx("td",{children:o.jsxs("div",{className:"blog-author",children:[o.jsx("div",{className:"blog-avatar",children:r(s)}),o.jsx("span",{children:s.author||s.createdByName||"Unknown"})]})}),o.jsx("td",{children:o.jsx("span",{className:`blog-status-badge status-${s.status}`,children:s.status})}),o.jsx("td",{className:"blog-date",children:(a=s.createdAt)!=null&&a.toDate?rt(s.createdAt.toDate(),"MMM d, yyyy"):""}),o.jsx("td",{children:o.jsxs("div",{className:"blog-actions",children:[e(n.BLOGS_EDIT)&&o.jsx(at,{to:`/blog/${s.id}/edit`,className:"blog-action-btn",children:"Edit"}),s.status==="published"&&s.slug&&o.jsx("a",{href:`/blog/${s.slug}`,target:"_blank",rel:"noopener noreferrer",className:"blog-action-btn",children:"View"})]})})]},s.id)})})]})})}function ahe({posts:t,can:e,PERMISSIONS:n,getAuthorInitials:r,selectedPost:s,setSelectedPost:i}){var l;const a=s?t.find(c=>c.id===s):t[0];return o.jsxs("div",{className:"blog-sidebar-view",children:[o.jsx("div",{className:"blog-sidebar-list",children:t.map(c=>{var u;return o.jsxs("div",{className:`blog-sidebar-item ${(a==null?void 0:a.id)===c.id?"active":""}`,onClick:()=>i(c.id),children:[o.jsx("div",{className:"sidebar-item-title",children:c.title}),o.jsxs("div",{className:"sidebar-item-meta",children:[o.jsx("span",{className:`status-dot status-${c.status}`}),c.status,"  ",(u=c.createdAt)!=null&&u.toDate?rt(c.createdAt.toDate(),"MMM d"):""]})]},c.id)})}),o.jsx("div",{className:"blog-sidebar-preview",children:a?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"preview-header",children:[o.jsxs("div",{className:"preview-header-content",children:[o.jsx("h2",{children:a.title}),o.jsx("span",{className:`blog-status-badge status-${a.status}`,children:a.status})]}),e(n.BLOGS_EDIT)&&o.jsx(at,{to:`/blog/${a.id}/edit`,children:o.jsx(K,{children:"Edit Post"})})]}),o.jsxs("div",{className:"preview-content",children:[o.jsx("p",{className:"preview-excerpt",children:PN(a.excerpt||a.content)}),o.jsxs("div",{className:"preview-meta",children:[o.jsxs("div",{className:"meta-item",children:[o.jsx("span",{className:"meta-label",children:"Author"}),o.jsxs("span",{className:"meta-value",children:[o.jsx("div",{className:"blog-avatar small",children:r(a)}),a.author||a.createdByName||"Unknown"]})]}),o.jsxs("div",{className:"meta-item",children:[o.jsx("span",{className:"meta-label",children:"Created"}),o.jsx("span",{className:"meta-value",children:(l=a.createdAt)!=null&&l.toDate?rt(a.createdAt.toDate(),"MMMM d, yyyy"):""})]}),a.tags&&a.tags.length>0&&o.jsxs("div",{className:"meta-item",children:[o.jsx("span",{className:"meta-label",children:"Tags"}),o.jsx("div",{className:"meta-tags",children:a.tags.map(c=>o.jsx("span",{className:"meta-tag",children:c},c))})]})]})]})]}):o.jsx("div",{className:"preview-empty",children:o.jsx("p",{children:"Select a post to preview"})})})]})}function ohe({posts:t,can:e,PERMISSIONS:n,getAuthorInitials:r,kanbanRef:s,onScroll:i}){const a={idea:{label:"Ideas",color:"#8b5cf6",posts:t.filter(l=>l.status==="idea")},draft:{label:"Draft",color:"#f59e0b",posts:t.filter(l=>l.status==="draft")},published:{label:"Published",color:"#22c55e",posts:t.filter(l=>l.status==="published")},archived:{label:"Archived",color:"#9ca3af",posts:t.filter(l=>l.status==="archived")}};return o.jsx("div",{className:"blog-kanban-view",ref:s,onScroll:i,children:Object.entries(a).map(([l,c])=>o.jsxs("div",{className:"kanban-column",children:[o.jsxs("div",{className:"kanban-column-header",children:[o.jsxs("div",{className:"kanban-column-title",children:[o.jsx("span",{className:"kanban-dot",style:{background:c.color}}),c.label]}),o.jsx("span",{className:"kanban-count",children:c.posts.length})]}),o.jsxs("div",{className:"kanban-cards",children:[c.posts.map(u=>{var d;return o.jsxs("div",{className:"kanban-card",children:[o.jsx("h4",{className:"kanban-card-title",children:u.title}),o.jsxs("p",{className:"kanban-card-excerpt",children:[(d=PN(u.excerpt||u.content))==null?void 0:d.substring(0,60),"..."]}),o.jsxs("div",{className:"kanban-card-footer",children:[o.jsxs("div",{className:"kanban-card-author",children:[o.jsx("div",{className:"blog-avatar small",children:r(u)}),o.jsx("span",{children:u.author||u.createdByName||"Unknown"})]}),e(n.BLOGS_EDIT)&&o.jsx(at,{to:`/blog/${u.id}/edit`,className:"kanban-edit-link",children:"Edit"})]})]},u.id)}),c.posts.length===0&&o.jsxs("div",{className:"kanban-empty",children:["No ",c.label.toLowerCase()," posts"]})]})]},l))})}function is(t){this.content=t}is.prototype={constructor:is,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new is(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new is(n)},addToStart:function(t,e){return new is([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new is(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new is(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=is.from(t),t.size?new is(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=is.from(t),t.size?new is(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=is.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};is.from=function(t){if(t instanceof is)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new is(e)};function mW(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let a=0;s.text[a]==i.text[a];a++)n++;return n}if(s.content.size||i.content.size){let a=mW(s.content,i.content,n+1);if(a!=null)return a}n+=s.nodeSize}}function gW(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let a=t.child(--s),l=e.child(--i),c=a.nodeSize;if(a==l){n-=c,r-=c;continue}if(!a.sameMarkup(l))return{a:n,b:r};if(a.isText&&a.text!=l.text){let u=0,d=Math.min(a.text.length,l.text.length);for(;u<d&&a.text[a.text.length-u-1]==l.text[l.text.length-u-1];)u++,n--,r--;return{a:n,b:r}}if(a.content.size||l.content.size){let u=gW(a.content,l.content,n-1,r-1);if(u)return u}n-=c,r-=c}}class we{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let a=0,l=0;l<n;a++){let c=this.content[a],u=l+c.nodeSize;if(u>e&&r(c,s+l,i||null,a)!==!1&&c.content.size){let d=l+1;c.nodesBetween(Math.max(0,e-d),Math.min(c.content.size,n-d),r,s+d)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",a=!0;return this.nodesBetween(e,n,(l,c)=>{let u=l.isText?l.text.slice(Math.max(e,c)-c,n-c):l.isLeaf?s?typeof s=="function"?s(l):s:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&u||l.isTextblock)&&r&&(a?a=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new we(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,a=0;a<n;i++){let l=this.content[i],c=a+l.nodeSize;c>e&&((a<e||c>n)&&(l.isText?l=l.cut(Math.max(0,e-a),Math.min(l.text.length,n-a)):l=l.cut(Math.max(0,e-a-1),Math.min(l.content.size,n-a-1))),r.push(l),s+=l.nodeSize),a=c}return new we(r,s)}cutByIndex(e,n){return e==n?we.empty:e==0&&n==this.content.length?this:new we(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new we(s,i)}addToStart(e){return new we([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new we(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return mW(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return gW(this,e,n,r)}findIndex(e){if(e==0)return Lx(0,e);if(e==this.size)return Lx(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Lx(n+1,i):Lx(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return we.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new we(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return we.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new we(n||e,r)}static from(e){if(!e)return we.empty;if(e instanceof we)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new we([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}we.empty=new we([],0);const J_={index:0,offset:0};function Lx(t,e){return J_.index=t,J_.offset=e,J_}function Jb(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Jb(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Jb(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let ln=class kC{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Jb(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return kC.none;if(e instanceof kC)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};ln.none=[];class Zb extends Error{}class Ve{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=vW(this.content,e+this.openStart,n);return r&&new Ve(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Ve(yW(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Ve.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ve(we.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new Ve(e,r,s)}}Ve.empty=new Ve(we.empty,0,0);function yW(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:a,offset:l}=t.findIndex(n);if(s==e||i.isText){if(l!=n&&!t.child(a).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=a)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(yW(i.content,e-s-1,n-s-1)))}function vW(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),a=t.maybeChild(s);if(i==e||a.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let l=vW(a.content,e-i-1,n,a);return l&&t.replaceChild(s,a.copy(l))}function lhe(t,e,n){if(n.openStart>t.depth)throw new Zb("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Zb("Inconsistent open depths");return xW(t,e,n,0)}function xW(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let a=xW(t,e,n,r+1);return i.copy(i.content.replaceChild(s,a))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let a=t.parent,l=a.content;return _d(a,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}else{let{start:a,end:l}=che(n,t);return _d(i,wW(t,a,l,e,r))}else return _d(i,ew(t,e,r))}function bW(t,e){if(!e.type.compatibleContent(t.type))throw new Zb("Cannot join "+e.type.name+" onto "+t.type.name)}function IC(t,e,n){let r=t.node(n);return bW(r,e.node(n)),r}function Sd(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Ng(t,e,n,r){let s=(e||t).node(n),i=0,a=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Sd(t.nodeAfter,r),i++));for(let l=i;l<a;l++)Sd(s.child(l),r);e&&e.depth==n&&e.textOffset&&Sd(e.nodeBefore,r)}function _d(t,e){return t.type.checkContent(e),t.copy(e)}function wW(t,e,n,r,s){let i=t.depth>s&&IC(t,e,s+1),a=r.depth>s&&IC(n,r,s+1),l=[];return Ng(null,t,s,l),i&&a&&e.index(s)==n.index(s)?(bW(i,a),Sd(_d(i,wW(t,e,n,r,s+1)),l)):(i&&Sd(_d(i,ew(t,e,s+1)),l),Ng(e,n,s,l),a&&Sd(_d(a,ew(n,r,s+1)),l)),Ng(r,null,s,l),new we(l)}function ew(t,e,n){let r=[];if(Ng(null,t,n,r),t.depth>n){let s=IC(t,e,n+1);Sd(_d(s,ew(t,e,n+1)),r)}return Ng(e,null,n,r),new we(r)}function che(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(we.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class gy{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return ln.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let l=r;r=s,s=l}let i=r.marks;for(var a=0;a<i.length;a++)i[a].type.spec.inclusive===!1&&(!s||!i[a].isInSet(s.marks))&&(i=i[a--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new tw(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let a=e;;){let{index:l,offset:c}=a.content.findIndex(i),u=i-c;if(r.push(a,l,s+c),!u||(a=a.child(l),a.isText))break;i=u-1,s+=c+1}return new gy(n,r,i)}static resolveCached(e,n){let r=ZM.get(e);if(r)for(let i=0;i<r.elts.length;i++){let a=r.elts[i];if(a.pos==n)return a}else ZM.set(e,r=new uhe);let s=r.elts[r.i]=gy.resolve(e,n);return r.i=(r.i+1)%dhe,s}}class uhe{constructor(){this.elts=[],this.i=0}}const dhe=12,ZM=new WeakMap;class tw{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const hhe=Object.create(null);let Yc=class PC{constructor(e,n,r,s=ln.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||we.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Jb(this.attrs,n||e.defaultAttrs||hhe)&&ln.sameSet(this.marks,r||ln.none)}copy(e=null){return e==this.content?this:new PC(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new PC(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Ve.empty;let s=this.resolve(e),i=this.resolve(n),a=r?0:s.sharedDepth(n),l=s.start(a),u=s.node(a).content.cut(s.pos-l,i.pos-l);return new Ve(u,s.depth-a,i.depth-a)}replace(e,n,r){return lhe(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return gy.resolveCached(this,e)}resolveNoCache(e){return gy.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),NW(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=we.empty,s=0,i=r.childCount){let a=this.contentMatchAt(e).matchFragment(r,s,i),l=a&&a.matchFragment(this.content,n);if(!l||!l.validEnd)return!1;for(let c=s;c<i;c++)if(!this.type.allowsMarks(r.child(c).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),a=i&&i.matchFragment(this.content,n);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=ln.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!ln.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=we.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Yc.prototype.text=void 0;class nw extends Yc{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):NW(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new nw(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new nw(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function NW(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Jd{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new fhe(e,n);if(r.next==null)return Jd.empty;let s=SW(r);r.next&&r.err("Unexpected trailing text");let i=bhe(xhe(s));return whe(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(a,l){let c=a.matchFragment(e,r);if(c&&(!n||c.validEnd))return we.from(l.map(u=>u.createAndFill()));for(let u=0;u<a.next.length;u++){let{type:d,next:h}=a.next[u];if(!(d.isText||d.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=i(h,l.concat(d));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let a=[];for(let l=s;l.type;l=l.via)a.push(l.type);return a.reverse()}for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in n)&&(!s.type||c.validEnd)&&(r.push({match:l.contentMatch,type:l,via:s}),n[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let a=0;a<r.next.length;a++)i+=(a?", ":"")+r.next[a].type.name+"->"+e.indexOf(r.next[a].next);return i}).join(`
`)}}Jd.empty=new Jd(!0);class fhe{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function SW(t){let e=[];do e.push(phe(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function phe(t){let e=[];do e.push(mhe(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function mhe(t){let e=vhe(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=ghe(t,e);else break;return e}function eL(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function ghe(t,e){let n=eL(t),r=n;return t.eat(",")&&(t.next!="}"?r=eL(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function yhe(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let a=n[i];a.isInGroup(e)&&s.push(a)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function vhe(t){if(t.eat("(")){let e=SW(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=yhe(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function xhe(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(a,l,c){let u={term:c,to:l};return e[a].push(u),u}function s(a,l){a.forEach(c=>c.to=l)}function i(a,l){if(a.type=="choice")return a.exprs.reduce((c,u)=>c.concat(i(u,l)),[]);if(a.type=="seq")for(let c=0;;c++){let u=i(a.exprs[c],l);if(c==a.exprs.length-1)return u;s(u,l=n())}else if(a.type=="star"){let c=n();return r(l,c),s(i(a.expr,c),c),[r(c)]}else if(a.type=="plus"){let c=n();return s(i(a.expr,l),c),s(i(a.expr,c),c),[r(c)]}else{if(a.type=="opt")return[r(l)].concat(i(a.expr,l));if(a.type=="range"){let c=l;for(let u=0;u<a.min;u++){let d=n();s(i(a.expr,c),d),c=d}if(a.max==-1)s(i(a.expr,c),c);else for(let u=a.min;u<a.max;u++){let d=n();r(c,d),s(i(a.expr,c),d),c=d}return[r(c)]}else{if(a.type=="name")return[r(l,void 0,a.value)];throw new Error("Unknown expr type")}}}}function _W(t,e){return e-t}function tL(t,e){let n=[];return r(e),n.sort(_W);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let a=0;a<i.length;a++){let{term:l,to:c}=i[a];!l&&n.indexOf(c)==-1&&r(c)}}}function bhe(t){let e=Object.create(null);return n(tL(t,0));function n(r){let s=[];r.forEach(a=>{t[a].forEach(({term:l,to:c})=>{if(!l)return;let u;for(let d=0;d<s.length;d++)s[d][0]==l&&(u=s[d][1]);tL(t,c).forEach(d=>{u||s.push([l,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let i=e[r.join(",")]=new Jd(r.indexOf(t.length-1)>-1);for(let a=0;a<s.length;a++){let l=s[a][1].sort(_W);i.next.push({type:s[a][0],next:e[l.join(",")]||n(l)})}return i}}function whe(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,a=[];for(let l=0;l<s.next.length;l++){let{type:c,next:u}=s.next[l];a.push(c.name),i&&!(c.isText||c.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function jW(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function EW(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function CW(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function TW(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new She(t,r,e[r]);return n}let nL=class AW{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=TW(e,r.attrs),this.defaultAttrs=jW(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Jd.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:EW(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Yc(this,this.computeAttrs(e),we.from(n),ln.setFrom(r))}createChecked(e=null,n,r){return n=we.from(n),this.checkContent(n),new Yc(this,this.computeAttrs(e),n,ln.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=we.from(n),n.size){let a=this.contentMatch.fillBefore(n);if(!a)return null;n=a.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(we.empty,!0);return i?new Yc(this,e,n.append(i),ln.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){CW(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:ln.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,a)=>r[i]=new AW(i,n,a));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Nhe(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class She{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Nhe(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class ON{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=TW(e,s.attrs),this.excluded=null;let i=jW(this.attrs);this.instance=i?new ln(this,i):null}create(e=null){return!e&&this.instance?this.instance:new ln(this,EW(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,a)=>r[i]=new ON(i,s++,n,a)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){CW(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class kW{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=is.from(e.nodes),n.marks=is.from(e.marks||{}),this.nodes=nL.compile(this.spec.nodes,this),this.marks=ON.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],a=i.spec.content||"",l=i.spec.marks;if(i.contentMatch=r[a]||(r[a]=Jd.parse(a,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=l=="_"?null:l?rL(this,l.split(" ")):l==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],a=i.spec.excludes;i.excluded=a==null?[i]:a==""?[]:rL(this,a.split(" "))}this.nodeFromJSON=s=>Yc.fromJSON(this,s),this.markFromJSON=s=>ln.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof nL){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new nw(r,r.defaultAttrs,e,ln.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function rL(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],a=i;if(i)n.push(i);else for(let l in t.marks){let c=t.marks[l];(s=="_"||c.spec.group&&c.spec.group.split(" ").indexOf(s)>-1)&&n.push(a=c)}if(!a)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function _he(t){return t.tag!=null}function jhe(t){return t.style!=null}class Qc{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(_he(s))this.tags.push(s);else if(jhe(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new iL(this,n,!1);return r.addAll(e,ln.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new iL(this,n,!0);return r.addAll(e,ln.none,n.from,n.to),Ve.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(The(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let a=i.getAttrs(e);if(a===!1)continue;i.attrs=a||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let a=this.styles[i],l=a.style;if(!(l.indexOf(e)!=0||a.context&&!r.matchesContext(a.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=n))){if(a.getAttrs){let c=a.getAttrs(n);if(c===!1)continue;a.attrs=c||void 0}return a}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,a=0;for(;a<n.length;a++){let l=n[a];if((l.priority==null?50:l.priority)<i)break}n.splice(a,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(a=>{r(a=aL(a)),a.mark||a.ignore||a.clearMark||(a.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(a=>{r(a=aL(a)),a.node||a.ignore||a.mark||(a.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Qc(e,Qc.schemaRules(e)))}}const IW={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ehe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},PW={ol:!0,ul:!0},yy=1,OC=2,Sg=4;function sL(t,e,n){return e!=null?(e?yy:0)|(e==="full"?OC:0):t&&t.whitespace=="pre"?yy|OC:n&~Sg}class Fx{constructor(e,n,r,s,i,a){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=a,this.content=[],this.activeMarks=ln.none,this.match=i||(a&Sg?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(we.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&yy)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=we.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(we.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!IW.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class iL{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,a=sL(null,n.preserveWhitespace,0)|(r?Sg:0);s?i=new Fx(s.type,s.attrs,ln.none,!0,n.topMatch||s.type.contentMatch,a):r?i=new Fx(null,null,ln.none,!0,null,a):i=new Fx(e.schema.topNodeType,null,ln.none,!0,null,a),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&OC?"full":this.localPreserveWS||(s.options&yy)>0,{schema:a}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(a.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(a.linebreakReplacement.create())){let l=r.split(/\r?\n|\r/);for(let c=0;c<l.length;c++)c&&this.insertNode(a.linebreakReplacement.create(),n,!0),l[c]&&this.insertNode(a.text(l[c]),n,!/\S/.test(l[c]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let l=s.content[s.content.length-1],c=e.previousSibling;(!l||c&&c.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(r=r.slice(1))}r&&this.insertNode(a.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),l;PW.hasOwnProperty(a)&&this.parser.normalizeLists&&Che(e);let c=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,r));e:if(c?c.ignore:Ehe.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,n);else if(!c||c.skip||c.closeParent){c&&c.closeParent?this.open=Math.max(0,this.open-1):c&&c.skip.nodeType&&(e=c.skip);let u,d=this.needsBlock;if(IW.hasOwnProperty(a))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let h=c&&c.skip?n:this.readStyles(e,n);h&&this.addAll(e,h),u&&this.sync(i),this.needsBlock=d}else{let u=this.readStyles(e,n);u&&this.addElementByRule(e,c,u,c.consuming===!1?l:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],a=r.getPropertyValue(i);if(a)for(let l=void 0;;){let c=this.parser.matchStyle(i,a,this,l);if(!c)break;if(c.ignore)return null;if(c.clearMark?n=n.filter(u=>!c.clearMark(u)):n=n.concat(this.parser.schema.marks[c.mark].create(c.attrs)),c.consuming===!1)l=c;else break}}return n}addElementByRule(e,n,r,s){let i,a;if(n.node)if(a=this.parser.schema.nodes[n.node],a.isLeaf)this.insertNode(a.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let c=this.enter(a,n.attrs||null,r,n.preserveWhitespace);c&&(i=!0,r=c)}else{let c=this.parser.schema.marks[n.mark];r=r.concat(c.create(n.attrs))}let l=this.top;if(a&&a.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c,r,!1));else{let c=e;typeof n.contentElement=="string"?c=e.querySelector(n.contentElement):typeof n.contentElement=="function"?c=n.contentElement(e):n.contentElement&&(c=n.contentElement),this.findAround(e,c,!0),this.addAll(c,r),this.findAround(e,c,!1)}i&&this.sync(l)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let a=r?e.childNodes[r]:e.firstChild,l=s==null?null:e.childNodes[s];a!=l;a=a.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(a,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let a=this.open,l=0;a>=0;a--){let c=this.nodes[a],u=c.findWrapping(e);if(u&&(!s||s.length>u.length+l)&&(s=u,i=c,!u.length))break;if(c.solid){if(r)break;l+=2}}if(!s)return null;this.sync(i);for(let a=0;a<s.length;a++)n=this.enterInner(s[a],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let a=ln.none;for(let l of s.concat(e.marks))(i.type?i.type.allowsMarkType(l.type):oL(l.type,e.type))&&(a=l.addToSet(a));return i.content.push(e.mark(a)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let l=sL(e,i,a.options);a.options&Sg&&a.content.length==0&&(l|=Sg);let c=ln.none;return r=r.filter(u=>(a.type?a.type.allowsMarkType(u.type):oL(u.type,e))?(c=u.addToSet(c),!1):!0),this.nodes.push(new Fx(e,n,c,s,null,l)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=yy)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),a=(l,c)=>{for(;l>=0;l--){let u=n[l];if(u==""){if(l==n.length-1||l==0)continue;for(;c>=i;c--)if(a(l-1,c))return!0;return!1}else{let d=c>0||c==0&&s?this.nodes[c].type:r&&c>=i?r.node(c-i).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;c--}}return!0};return a(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function Che(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&PW.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function The(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function aL(t){let e={};for(let n in t)e[n]=t[n];return e}function oL(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],a=l=>{i.push(l);for(let c=0;c<l.edgeCount;c++){let{type:u,next:d}=l.edge(c);if(u==e||i.indexOf(d)<0&&a(d))return!0}};if(a(s.contentMatch))return!0}}class _h{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Z_(n).createDocumentFragment());let s=r,i=[];return e.forEach(a=>{if(i.length||a.marks.length){let l=0,c=0;for(;l<i.length&&c<a.marks.length;){let u=a.marks[c];if(!this.marks[u.type.name]){c++;continue}if(!u.eq(i[l][0])||u.type.spec.spanning===!1)break;l++,c++}for(;l<i.length;)s=i.pop()[1];for(;c<a.marks.length;){let u=a.marks[c++],d=this.serializeMark(u,a.isInline,n);d&&(i.push([u,s]),s.appendChild(d.dom),s=d.contentDOM||d.dom)}}s.appendChild(this.serializeNodeInner(a,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=V0(Z_(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&V0(Z_(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return V0(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new _h(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=lL(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return lL(e.marks)}}function lL(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Z_(t){return t.document||window.document}const cL=new WeakMap;function Ahe(t){let e=cL.get(t);return e===void 0&&cL.set(t,e=khe(t)),e}function khe(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function V0(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=Ahe(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=s.indexOf(" ");a>0&&(n=s.slice(0,a),s=s.slice(a+1));let l,c=n?t.createElementNS(n,s):t.createElement(s),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let h in u)if(u[h]!=null){let f=h.indexOf(" ");f>0?c.setAttributeNS(h.slice(0,f),h.slice(f+1),u[h]):h=="style"&&c.style?c.style.cssText=u[h]:c.setAttribute(h,u[h])}}for(let h=d;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:c,contentDOM:c}}else{let{dom:p,contentDOM:m}=V0(t,f,n,r);if(c.appendChild(p),m){if(l)throw new RangeError("Multiple content holes");l=m}}}return{dom:c,contentDOM:l}}const OW=65535,DW=Math.pow(2,16);function Ihe(t,e){return t+e*DW}function uL(t){return t&OW}function Phe(t){return(t-(t&OW))/DW}const RW=1,MW=2,$0=4,LW=8;class DC{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&LW)>0}get deletedBefore(){return(this.delInfo&(RW|$0))>0}get deletedAfter(){return(this.delInfo&(MW|$0))>0}get deletedAcross(){return(this.delInfo&$0)>0}}class Pi{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Pi.empty)return Pi.empty}recover(e){let n=0,r=uL(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+Phe(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,a=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?s:0);if(c>e)break;let u=this.ranges[l+i],d=this.ranges[l+a],h=c+u;if(e<=h){let f=u?e==c?-1:e==h?1:n:n,p=c+s+(f<0?0:d);if(r)return p;let m=e==(n<0?c:h)?null:Ihe(l/3,e-c),g=e==c?MW:e==h?RW:$0;return(n<0?e!=c:e!=h)&&(g|=LW),new DC(p,g,m)}s+=d-u}return r?e+s:new DC(e+s,0,null)}touches(e,n){let r=0,s=uL(n),i=this.inverted?2:1,a=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?r:0);if(c>e)break;let u=this.ranges[l+i],d=c+u;if(e<=d&&l==s*3)return!0;r+=this.ranges[l+a]-u}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let a=this.ranges[s],l=a-(this.inverted?i:0),c=a+(this.inverted?0:i),u=this.ranges[s+n],d=this.ranges[s+r];e(l,l+u,c,c+d),i+=d-u}}invert(){return new Pi(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Pi.empty:new Pi(e<0?[0,-e,0]:[0,0,e])}}Pi.empty=new Pi([]);class vy{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new vy(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new vy;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let a=this._maps[i],l=a.mapResult(e,n);if(l.recover!=null){let c=this.getMirror(i);if(c!=null&&c>i&&c<this.to){i=c,e=this._maps[c].recover(l.recover);continue}}s|=l.delInfo,e=l.pos}return r?e:new DC(e,s,null)}}const ej=Object.create(null);let Fs=class{getMap(){return Pi.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=ej[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in ej)throw new RangeError("Duplicate use of step JSON ID "+e);return ej[e]=n,n.prototype.jsonID=e,n}};class hr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new hr(e,null)}static fail(e){return new hr(null,e)}static fromReplace(e,n,r,s){try{return hr.ok(e.replace(n,r,s))}catch(i){if(i instanceof Zb)return hr.fail(i.message);throw i}}}function EI(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(EI(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return we.fromArray(r)}class Dc extends Fs{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new Ve(EI(n.content,(a,l)=>!a.isAtom||!l.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),s),n.openStart,n.openEnd);return hr.fromReplace(e,this.from,this.to,i)}invert(){return new vo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Dc(n.pos,r.pos,this.mark)}merge(e){return e instanceof Dc&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Dc(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Dc(n.from,n.to,e.markFromJSON(n.mark))}}Fs.jsonID("addMark",Dc);class vo extends Fs{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Ve(EI(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return hr.fromReplace(e,this.from,this.to,r)}invert(){return new Dc(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new vo(n.pos,r.pos,this.mark)}merge(e){return e instanceof vo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new vo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new vo(n.from,n.to,e.markFromJSON(n.mark))}}Fs.jsonID("removeMark",vo);class Rc extends Fs{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return hr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return hr.fromReplace(e,this.pos,this.pos+1,new Ve(we.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Rc(this.pos,n.marks[s]);return new Rc(this.pos,this.mark)}}return new Zd(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Rc(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Rc(n.pos,e.markFromJSON(n.mark))}}Fs.jsonID("addNodeMark",Rc);class Zd extends Fs{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return hr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return hr.fromReplace(e,this.pos,this.pos+1,new Ve(we.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Rc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Zd(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Zd(n.pos,e.markFromJSON(n.mark))}}Fs.jsonID("removeNodeMark",Zd);class Br extends Fs{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&RC(e,this.from,this.to)?hr.fail("Structure replace would overwrite content"):hr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Pi([this.from,this.to-this.from,this.slice.size])}invert(e){return new Br(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Br(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Br)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Ve.empty:new Ve(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Br(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Ve.empty:new Ve(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Br(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Br(n.from,n.to,Ve.fromJSON(e,n.slice),!!n.structure)}}Fs.jsonID("replace",Br);class zr extends Fs{constructor(e,n,r,s,i,a,l=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=a,this.structure=l}apply(e){if(this.structure&&(RC(e,this.from,this.gapFrom)||RC(e,this.gapTo,this.to)))return hr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return hr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?hr.fromReplace(e,this.from,this.to,r):hr.fail("Content does not fit in gap")}getMap(){return new Pi([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new zr(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new zr(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new zr(n.from,n.to,n.gapFrom,n.gapTo,Ve.fromJSON(e,n.slice),n.insert,!!n.structure)}}Fs.jsonID("replaceAround",zr);function RC(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let a=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,s--}}return!1}function Ohe(t,e,n,r){let s=[],i=[],a,l;t.doc.nodesBetween(e,n,(c,u,d)=>{if(!c.isInline)return;let h=c.marks;if(!r.isInSet(h)&&d.type.allowsMarkType(r.type)){let f=Math.max(u,e),p=Math.min(u+c.nodeSize,n),m=r.addToSet(h);for(let g=0;g<h.length;g++)h[g].isInSet(m)||(a&&a.to==f&&a.mark.eq(h[g])?a.to=p:s.push(a=new vo(f,p,h[g])));l&&l.to==f?l.to=p:i.push(l=new Dc(f,p,r))}}),s.forEach(c=>t.step(c)),i.forEach(c=>t.step(c))}function Dhe(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(a,l)=>{if(!a.isInline)return;i++;let c=null;if(r instanceof ON){let u=a.marks,d;for(;d=r.isInSet(u);)(c||(c=[])).push(d),u=d.removeFromSet(u)}else r?r.isInSet(a.marks)&&(c=[r]):c=a.marks;if(c&&c.length){let u=Math.min(l+a.nodeSize,n);for(let d=0;d<c.length;d++){let h=c[d],f;for(let p=0;p<s.length;p++){let m=s[p];m.step==i-1&&h.eq(s[p].style)&&(f=m)}f?(f.to=u,f.step=i):s.push({style:h,from:Math.max(l,e),to:u,step:i})}}}),s.forEach(a=>t.step(new vo(a.from,a.to,a.style)))}function CI(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),a=[],l=e+1;for(let c=0;c<i.childCount;c++){let u=i.child(c),d=l+u.nodeSize,h=r.matchType(u.type);if(!h)a.push(new Br(l,d,Ve.empty));else{r=h;for(let f=0;f<u.marks.length;f++)n.allowsMarkType(u.marks[f].type)||t.step(new vo(l,d,u.marks[f]));if(s&&u.isText&&n.whitespace!="pre"){let f,p=/\r?\n|\r/g,m;for(;f=p.exec(u.text);)m||(m=new Ve(we.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),a.push(new Br(l+f.index,l+f.index+f[0].length,m))}}l=d}if(!r.validEnd){let c=r.fillBefore(we.empty,!0);t.replace(l,l,new Ve(c,0,0))}for(let c=a.length-1;c>=0;c--)t.step(a[c])}function Rhe(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Kp(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let a=t.$from.node(r),l=t.$from.index(r)+s,c=t.$to.indexAfter(r)-i;if(r<t.depth&&a.canReplace(l,c,n))return r;if(r==0||a.type.spec.isolating||!Rhe(a,l,c))break;l&&(s=1),c<a.childCount&&(i=1)}return null}function Mhe(t,e,n){let{$from:r,$to:s,depth:i}=e,a=r.before(i+1),l=s.after(i+1),c=a,u=l,d=we.empty,h=0;for(let m=i,g=!1;m>n;m--)g||r.index(m)>0?(g=!0,d=we.from(r.node(m).copy(d)),h++):c--;let f=we.empty,p=0;for(let m=i,g=!1;m>n;m--)g||s.after(m+1)<s.end(m)?(g=!0,f=we.from(s.node(m).copy(f)),p++):u++;t.step(new zr(c,u,a,l,new Ve(d.append(f),h,p),d.size-h,!0))}function TI(t,e,n=null,r=t){let s=Lhe(t,e),i=s&&Fhe(r,e);return i?s.map(dL).concat({type:e,attrs:n}).concat(i.map(dL)):null}function dL(t){return{type:t,attrs:null}}function Lhe(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let a=i.length?i[0]:e;return n.canReplaceWith(r,s,a)?i:null}function Fhe(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),a=e.contentMatch.findWrapping(i.type);if(!a)return null;let c=(a.length?a[a.length-1]:e).contentMatch;for(let u=r;c&&u<s;u++)c=c.matchType(n.child(u).type);return!c||!c.validEnd?null:a}function Bhe(t,e,n){let r=we.empty;for(let a=n.length-1;a>=0;a--){if(r.size){let l=n[a].type.contentMatch.matchFragment(r);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=we.from(n[a].type.create(n[a].attrs,r))}let s=e.start,i=e.end;t.step(new zr(s,i,s,i,new Ve(r,0,0),n.length,!0))}function Vhe(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(a,l)=>{let c=typeof s=="function"?s(a):s;if(a.isTextblock&&!a.hasMarkup(r,c)&&$he(t.doc,t.mapping.slice(i).map(l),r)){let u=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",m=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!m?u=!1:!p&&m&&(u=!0)}u===!1&&BW(t,a,l,i),CI(t,t.mapping.slice(i).map(l,1),r,void 0,u===null);let d=t.mapping.slice(i),h=d.map(l,1),f=d.map(l+a.nodeSize,1);return t.step(new zr(h,f,h+1,f-1,new Ve(we.from(r.create(c,null,a.marks)),0,0),1,!0)),u===!0&&FW(t,a,l,i),!1}})}function FW(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let a,l=/\r?\n|\r/g;for(;a=l.exec(s.text);){let c=t.mapping.slice(r).map(n+1+i+a.index);t.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}}})}function BW(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let a=t.mapping.slice(r).map(n+1+i);t.replaceWith(a,a+1,e.type.schema.text(`
`))}})}function $he(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function Uhe(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let a=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,a);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new zr(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Ve(we.from(a),0,0),1,!0))}function xl(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,a=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!a.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,d=n-2;u>i;u--,d--){let h=s.node(u),f=s.index(u);if(h.type.spec.isolating)return!1;let p=h.content.cutByIndex(f,h.childCount),m=r&&r[d+1];m&&(p=p.replaceChild(0,m.type.create(m.attrs)));let g=r&&r[d]||h;if(!h.canReplace(f+1,h.childCount)||!g.type.validContent(p))return!1}let l=s.indexAfter(i),c=r&&r[0];return s.node(i).canReplaceWith(l,l,c?c.type:s.node(i+1).type)}function zhe(t,e,n=1,r){let s=t.doc.resolve(e),i=we.empty,a=we.empty;for(let l=s.depth,c=s.depth-n,u=n-1;l>c;l--,u--){i=we.from(s.node(l).copy(i));let d=r&&r[u];a=we.from(d?d.type.create(d.attrs,a):s.node(l).copy(a))}t.step(new Br(e,e,new Ve(i.append(a),n,n),!0))}function Ou(t,e){let n=t.resolve(e),r=n.index();return VW(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Hhe(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),a=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(a),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function VW(t,e){return!!(t&&e&&!t.isLeaf&&Hhe(t,e))}function DN(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,a,l=r.index(s);if(s==r.depth?(i=r.nodeBefore,a=r.nodeAfter):n>0?(i=r.node(s+1),l++,a=r.node(s).maybeChild(l)):(i=r.node(s).maybeChild(l-1),a=r.node(s+1)),i&&!i.isTextblock&&VW(i,a)&&r.node(s).canReplace(l,l+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function Whe(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),a=i.node().type;if(s&&a.inlineContent){let d=a.whitespace=="pre",h=!!a.contentMatch.matchType(s);d&&!h?r=!1:!d&&h&&(r=!0)}let l=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);BW(t,d.node(),d.before(),l)}a.inlineContent&&CI(t,e+n-1,a,i.node().contentMatchAt(i.index()),r==null);let c=t.mapping.slice(l),u=c.map(e-n);if(t.step(new Br(u,c.map(e+n,-1),Ve.empty,!0)),r===!0){let d=t.doc.resolve(u);FW(t,d.node(),d.before(),t.steps.length)}return t}function qhe(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function $W(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let a=r.depth;a>=0;a--){let l=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,c=r.index(a)+(l>0?1:0),u=r.node(a),d=!1;if(i==1)d=u.canReplace(c,c,s);else{let h=u.contentMatchAt(c).findWrapping(s.firstChild.type);d=h&&u.canReplaceWith(c,c,h[0])}if(d)return l==0?r.pos:l<0?r.before(a+1):r.after(a+1)}return null}function RN(t,e,n=e,r=Ve.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return UW(s,i,r)?new Br(e,n,r):new Ghe(s,i,r).fit()}function UW(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Ghe{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=we.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=we.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,a=r.depth,l=s.depth;for(;a&&l&&i.childCount==1;)i=i.firstChild.content,a--,l--;let c=new Ve(i,a,l);return e>-1?new zr(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new Br(r.pos,s.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=tj(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let a=s.firstChild;for(let l=this.depth;l>=0;l--){let{type:c,match:u}=this.frontier[l],d,h=null;if(n==1&&(a?u.matchType(a.type)||(h=u.fillBefore(we.from(a),!1)):i&&c.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:l,parent:i,inject:h};if(n==2&&a&&(d=u.findWrapping(a.type)))return{sliceDepth:r,frontierDepth:l,parent:i,wrap:d};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=tj(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Ve(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=tj(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new Ve(Jm(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Ve(Jm(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let g=0;g<i.length;g++)this.openFrontierNode(i[g]);let a=this.unplaced,l=r?r.content:a.content,c=a.openStart-e,u=0,d=[],{match:h,type:f}=this.frontier[n];if(s){for(let g=0;g<s.childCount;g++)d.push(s.child(g));h=h.matchFragment(s)}let p=l.size+e-(a.content.size-a.openEnd);for(;u<l.childCount;){let g=l.child(u),y=h.matchType(g.type);if(!y)break;u++,(u>1||c==0||g.content.size)&&(h=y,d.push(zW(g.mark(f.allowedMarks(g.marks)),u==1?c:0,u==l.childCount?p:-1)))}let m=u==l.childCount;m||(p=-1),this.placed=Zm(this.placed,n,we.from(d)),this.frontier[n].match=h,m&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,y=l;g<p;g++){let x=y.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),y=x.content}this.unplaced=m?e==0?Ve.empty:new Ve(Jm(a.content,e-1,1),e-1,p<0?a.openEnd:e-1):new Ve(Jm(a.content,e,u),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!nj(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),a=nj(e,n,s,r,i);if(a){for(let l=n-1;l>=0;l--){let{match:c,type:u}=this.frontier[l],d=nj(e,l,u,c,!0);if(!d||d.childCount)continue e}return{depth:n,fit:a,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Zm(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Zm(this.placed,this.depth,we.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(we.empty,!0);n.childCount&&(this.placed=Zm(this.placed,this.frontier.length,n))}}function Jm(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Jm(t.firstChild.content,e-1,n)))}function Zm(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Zm(t.lastChild.content,e-1,n)))}function tj(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function zW(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,zW(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(we.empty,!0)))),t.copy(r)}function nj(t,e,n,r,s){let i=t.node(e),a=s?t.indexAfter(e):t.index(e);if(a==i.childCount&&!n.compatibleContent(i.type))return null;let l=r.fillBefore(i.content,!0,a);return l&&!Khe(n,i.content,a)?l:null}function Khe(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Yhe(t){return t.spec.defining||t.spec.definingForContent}function Qhe(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(UW(s,i,r))return t.step(new Br(e,n,r));let a=WW(s,i);a[a.length-1]==0&&a.pop();let l=-(s.depth+1);a.unshift(l);for(let f=s.depth,p=s.pos-1;f>0;f--,p--){let m=s.node(f).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;a.indexOf(f)>-1?l=f:s.before(f)==p&&a.splice(1,0,-f)}let c=a.indexOf(l),u=[],d=r.openStart;for(let f=r.content,p=0;;p++){let m=f.firstChild;if(u.push(m),p==r.openStart)break;f=m.content}for(let f=d-1;f>=0;f--){let p=u[f],m=Yhe(p.type);if(m&&!p.sameMarkup(s.node(Math.abs(l)-1)))d=f;else if(m||!p.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let p=(f+d+1)%(r.openStart+1),m=u[p];if(m)for(let g=0;g<a.length;g++){let y=a[(g+c)%a.length],x=!0;y<0&&(x=!1,y=-y);let w=s.node(y-1),N=s.index(y-1);if(w.canReplaceWith(N,N,m.type,m.marks))return t.replace(s.before(y),x?i.after(y):n,new Ve(HW(r.content,0,r.openStart,p),p,r.openEnd))}}let h=t.steps.length;for(let f=a.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>h));f--){let p=a[f];p<0||(e=s.before(p),n=i.after(p))}}function HW(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(HW(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),a=i.fillBefore(t).append(t);t=a.append(i.matchFragment(a).fillBefore(we.empty,!0))}return t}function Xhe(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=qhe(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new Ve(we.from(r),0,0))}function Jhe(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=WW(r,s);for(let a=0;a<i.length;a++){let l=i[a],c=a==i.length-1;if(c&&l==0||r.node(l).type.contentMatch.validEnd)return t.delete(r.start(l),s.end(l));if(l>0&&(c||r.node(l-1).canReplace(r.index(l-1),s.indexAfter(l-1))))return t.delete(r.before(l),s.after(l))}for(let a=1;a<=r.depth&&a<=s.depth;a++)if(e-r.start(a)==r.depth-a&&n>r.end(a)&&s.end(a)-n!=s.depth-a&&r.start(a-1)==s.start(a-1)&&r.node(a-1).canReplace(r.index(a-1),s.index(a-1)))return t.delete(r.before(a),n);t.delete(e,n)}function WW(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class Of extends Fs{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return hr.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return hr.fromReplace(e,this.pos,this.pos+1,new Ve(we.from(s),0,n.isLeaf?0:1))}getMap(){return Pi.empty}invert(e){return new Of(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Of(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Of(n.pos,n.attr,n.value)}}Fs.jsonID("attr",Of);class xy extends Fs{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return hr.ok(r)}getMap(){return Pi.empty}invert(e){return new xy(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new xy(n.attr,n.value)}}Fs.jsonID("docAttr",xy);let op=class extends Error{};op=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};op.prototype=Object.create(Error.prototype);op.prototype.constructor=op;op.prototype.name="TransformError";class qW{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new vy}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new op(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,n=-1e9;for(let r=0;r<this.mapping.maps.length;r++){let s=this.mapping.maps[r];r&&(e=s.map(e,1),n=s.map(n,-1)),s.forEach((i,a,l,c)=>{e=Math.min(e,l),n=Math.max(n,c)})}return e==1e9?null:{from:e,to:n}}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Ve.empty){let s=RN(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new Ve(we.from(r),0,0))}delete(e,n){return this.replace(e,n,Ve.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Qhe(this,e,n,r),this}replaceRangeWith(e,n,r){return Xhe(this,e,n,r),this}deleteRange(e,n){return Jhe(this,e,n),this}lift(e,n){return Mhe(this,e,n),this}join(e,n=1){return Whe(this,e,n),this}wrap(e,n){return Bhe(this,e,n),this}setBlockType(e,n=e,r,s=null){return Vhe(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return Uhe(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new Of(e,n,r)),this}setDocAttribute(e,n){return this.step(new xy(e,n)),this}addNodeMark(e,n){return this.step(new Rc(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof ln)n.isInSet(r.marks)&&this.step(new Zd(e,n));else{let s=r.marks,i,a=[];for(;i=n.isInSet(s);)a.push(new Zd(e,i)),s=i.removeFromSet(s);for(let l=a.length-1;l>=0;l--)this.step(a[l])}return this}split(e,n=1,r){return zhe(this,e,n,r),this}addMark(e,n,r){return Ohe(this,e,n,r),this}removeMark(e,n,r){return Dhe(this,e,n,r),this}clearIncompatible(e,n,r){return CI(this,e,n,r),this}}const rj=Object.create(null);class jt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Zhe(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Ve.empty){let r=n.content.lastChild,s=null;for(let l=0;l<n.openEnd;l++)s=r,r=r.lastChild;let i=e.steps.length,a=this.ranges;for(let l=0;l<a.length;l++){let{$from:c,$to:u}=a[l],d=e.mapping.slice(i);e.replaceRange(d.map(c.pos),d.map(u.pos),l?Ve.empty:n),l==0&&pL(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:a,$to:l}=s[i],c=e.mapping.slice(r),u=c.map(a.pos),d=c.map(l.pos);i?e.deleteRange(u,d):(e.replaceRangeWith(u,d,n),pL(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new pt(e):Yh(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let a=n<0?Yh(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Yh(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(a)return a}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Vi(e.node(0))}static atStart(e){return Yh(e,e,0,0,1)||new Vi(e)}static atEnd(e){return Yh(e,e,e.content.size,e.childCount,-1)||new Vi(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=rj[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in rj)throw new RangeError("Duplicate use of selection JSON ID "+e);return rj[e]=n,n.prototype.jsonID=e,n}getBookmark(){return pt.between(this.$anchor,this.$head).getBookmark()}}jt.prototype.visible=!0;class Zhe{constructor(e,n){this.$from=e,this.$to=n}}let hL=!1;function fL(t){!hL&&!t.parent.inlineContent&&(hL=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class pt extends jt{constructor(e,n=e){fL(e),fL(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return jt.near(r);let s=e.resolve(n.map(this.anchor));return new pt(s.parent.inlineContent?s:r,r)}replace(e,n=Ve.empty){if(super.replace(e,n),n==Ve.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof pt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new MN(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new pt(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=jt.findFrom(n,r,!0)||jt.findFrom(n,-r,!0);if(i)n=i.$head;else return jt.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(jt.findFrom(e,-r,!0)||jt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new pt(e,n)}}jt.jsonID("text",pt);class MN{constructor(e,n){this.anchor=e,this.head=n}map(e){return new MN(e.map(this.anchor),e.map(this.head))}resolve(e){return pt.between(e.resolve(this.anchor),e.resolve(this.head))}}class nt extends jt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?jt.near(i):new nt(i)}content(){return new Ve(we.from(this.node),0,0)}eq(e){return e instanceof nt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new AI(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new nt(e.resolve(n.anchor))}static create(e,n){return new nt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}nt.prototype.visible=!1;jt.jsonID("node",nt);class AI{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new MN(r,r):new AI(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&nt.isSelectable(r)?new nt(n):jt.near(n)}}class Vi extends jt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Ve.empty){if(n==Ve.empty){e.delete(0,e.doc.content.size);let r=jt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Vi(e)}map(e){return new Vi(e)}eq(e){return e instanceof Vi}getBookmark(){return efe}}jt.jsonID("all",Vi);const efe={map(){return this},resolve(t){return new Vi(t)}};function Yh(t,e,n,r,s,i=!1){if(e.inlineContent)return pt.create(t,n);for(let a=r-(s>0?0:1);s>0?a<e.childCount:a>=0;a+=s){let l=e.child(a);if(l.isAtom){if(!i&&nt.isSelectable(l))return nt.create(t,n-(s<0?l.nodeSize:0))}else{let c=Yh(t,l,n+s,s<0?l.childCount:0,s,i);if(c)return c}n+=l.nodeSize*s}return null}function pL(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof Br||s instanceof zr))return;let i=t.mapping.maps[r],a;i.forEach((l,c,u,d)=>{a==null&&(a=d)}),t.setSelection(jt.near(t.doc.resolve(a),n))}const mL=1,Bx=2,gL=4;class tfe extends qW{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|mL)&~Bx,this.storedMarks=null,this}get selectionSet(){return(this.updated&mL)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Bx,this}ensureMarks(e){return ln.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Bx)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Bx,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||ln.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let a=this.doc.resolve(n);i=r==n?a.marks():a.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(jt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=gL,this}get scrolledIntoView(){return(this.updated&gL)>0}}function yL(t,e){return!e||!t?t:t.bind(e)}class eg{constructor(e,n,r){this.name=e,this.init=yL(n.init,r),this.apply=yL(n.apply,r)}}const nfe=[new eg("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new eg("selection",{init(t,e){return t.selection||jt.atStart(e.doc)},apply(t){return t.selection}}),new eg("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new eg("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class sj{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=nfe.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new eg(r.key,r.spec.state,r))})}}class mf{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let a=0;a<this.config.plugins.length;a++){let l=this.config.plugins[a];if(l.spec.appendTransaction){let c=s?s[a].n:0,u=s?s[a].state:this,d=c<n.length&&l.spec.appendTransaction.call(l,c?n.slice(c):n,u,r);if(d&&r.filterTransaction(d,a)){if(d.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<a?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),i=!0}s&&(s[a]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new mf(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new tfe(this)}static create(e){let n=new sj(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new mf(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new sj(this.schema,e.plugins),r=n.fields,s=new mf(n);for(let i=0;i<r.length;i++){let a=r[i].name;s[a]=this.hasOwnProperty(a)?this[a]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new sj(e.schema,e.plugins),i=new mf(s);return s.fields.forEach(a=>{if(a.name=="doc")i.doc=Yc.fromJSON(e.schema,n.doc);else if(a.name=="selection")i.selection=jt.fromJSON(i.doc,n.selection);else if(a.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let l in r){let c=r[l],u=c.spec.state;if(c.key==a.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,l)){i[a.name]=u.fromJSON.call(c,e,n[l],i);return}}i[a.name]=a.init(e,i)}}),i}}function GW(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=GW(s,e,{})),n[r]=s}return n}class Ar{constructor(e){this.spec=e,this.props={},e.props&&GW(e.props,this,this.props),this.key=e.key?e.key.key:KW("plugin")}getState(e){return e[this.key]}}const ij=Object.create(null);function KW(t){return t in ij?t+"$"+ ++ij[t]:(ij[t]=0,t+"$")}class Zs{constructor(e="key"){this.key=KW(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const hs=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},lp=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let MC=null;const el=function(t,e,n){let r=MC||(MC=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},rfe=function(){MC=null},eh=function(t,e,n,r){return n&&(vL(t,e,n,r,-1)||vL(t,e,n,r,1))},sfe=/^(img|br|input|textarea|hr)$/i;function vL(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:pa(t))){let a=t.parentNode;if(!a||a.nodeType!=1||jv(t)||sfe.test(t.nodeName)||t.contentEditable=="false")return!1;e=hs(t)+(s<0?0:1),t=a}else if(t.nodeType==1){let a=t.childNodes[e+(s<0?-1:0)];if(a.nodeType==1&&a.contentEditable=="false")if(!((i=a.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=a,e=s<0?pa(t):0}else return!1}}function pa(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function ife(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=pa(t)}else if(t.parentNode&&!jv(t))e=hs(t),t=t.parentNode;else return null}}function afe(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!jv(t))e=hs(t)+1,t=t.parentNode;else return null}}function ofe(t,e,n){for(let r=e==0,s=e==pa(t);r||s;){if(t==n)return!0;let i=hs(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==pa(t)}}function jv(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const LN=function(t){return t.focusNode&&eh(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function id(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function lfe(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function cfe(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(pa(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(pa(r.startContainer),r.startOffset)}}}const Po=typeof navigator<"u"?navigator:null,xL=typeof document<"u"?document:null,Du=Po&&Po.userAgent||"",LC=/Edge\/(\d+)/.exec(Du),YW=/MSIE \d/.exec(Du),FC=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Du),wi=!!(YW||FC||LC),Xc=YW?document.documentMode:FC?+FC[1]:LC?+LC[1]:0,wa=!wi&&/gecko\/(\d+)/i.test(Du);wa&&+(/Firefox\/(\d+)/.exec(Du)||[0,0])[1];const BC=!wi&&/Chrome\/(\d+)/.exec(Du),Vr=!!BC,QW=BC?+BC[1]:0,vs=!wi&&!!Po&&/Apple Computer/.test(Po.vendor),cp=vs&&(/Mobile\/\w+/.test(Du)||!!Po&&Po.maxTouchPoints>2),da=cp||(Po?/Mac/.test(Po.platform):!1),XW=Po?/Win/.test(Po.platform):!1,hl=/Android \d/.test(Du),Ev=!!xL&&"webkitFontSmoothing"in xL.documentElement.style,ufe=Ev?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function dfe(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Ko(t,e){return typeof t=="number"?t:t[e]}function hfe(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function bL(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let a=n||t.dom;a;){if(a.nodeType!=1){a=lp(a);continue}let l=a,c=l==i.body,u=c?dfe(i):hfe(l),d=0,h=0;if(e.top<u.top+Ko(r,"top")?h=-(u.top-e.top+Ko(s,"top")):e.bottom>u.bottom-Ko(r,"bottom")&&(h=e.bottom-e.top>u.bottom-u.top?e.top+Ko(s,"top")-u.top:e.bottom-u.bottom+Ko(s,"bottom")),e.left<u.left+Ko(r,"left")?d=-(u.left-e.left+Ko(s,"left")):e.right>u.right-Ko(r,"right")&&(d=e.right-u.right+Ko(s,"right")),d||h)if(c)i.defaultView.scrollBy(d,h);else{let p=l.scrollLeft,m=l.scrollTop;h&&(l.scrollTop+=h),d&&(l.scrollLeft+=d);let g=l.scrollLeft-p,y=l.scrollTop-m;e={left:e.left-g,top:e.top-y,right:e.right-g,bottom:e.bottom-y}}let f=c?"fixed":getComputedStyle(a).position;if(/^(fixed|sticky)$/.test(f))break;a=f=="absolute"?a.offsetParent:lp(a)}}function ffe(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,a=n+1;a<Math.min(innerHeight,e.bottom);a+=5){let l=t.root.elementFromPoint(i,a);if(!l||l==t.dom||!t.dom.contains(l))continue;let c=l.getBoundingClientRect();if(c.top>=n-20){r=l,s=c.top;break}}return{refDOM:r,refTop:s,stack:JW(t.dom)}}function JW(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=lp(r));return e}function pfe({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;ZW(n,r==0?0:r-e)}function ZW(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Lh=null;function mfe(t){if(t.setActive)return t.setActive();if(Lh)return t.focus(Lh);let e=JW(t);t.focus(Lh==null?{get preventScroll(){return Lh={preventScroll:!0},!0}}:void 0),Lh||(Lh=!1,ZW(e,0))}function eq(t,e){let n,r=2e8,s,i=0,a=e.top,l=e.top,c,u;for(let d=t.firstChild,h=0;d;d=d.nextSibling,h++){let f;if(d.nodeType==1)f=d.getClientRects();else if(d.nodeType==3)f=el(d).getClientRects();else continue;for(let p=0;p<f.length;p++){let m=f[p];if(m.top<=a&&m.bottom>=l){a=Math.max(m.bottom,a),l=Math.min(m.top,l);let g=m.left>e.left?m.left-e.left:m.right<e.left?e.left-m.right:0;if(g<r){n=d,r=g,s=g&&n.nodeType==3?{left:m.right<e.left?m.right:m.left,top:e.top}:e,d.nodeType==1&&g&&(i=h+(e.left>=(m.left+m.right)/2?1:0));continue}}else m.top>e.top&&!c&&m.left<=e.left&&m.right>=e.left&&(c=d,u={left:Math.max(m.left,Math.min(m.right,e.left)),top:m.top});!n&&(e.left>=m.right&&e.top>=m.top||e.left>=m.left&&e.top>=m.bottom)&&(i=h+1)}}return!n&&c&&(n=c,s=u,r=0),n&&n.nodeType==3?gfe(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:eq(n,s)}function gfe(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let a=lc(r,1);if(a.top!=a.bottom&&kI(e,a)){s={node:t,offset:i+(e.left>=(a.left+a.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function kI(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function yfe(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function vfe(t,e,n){let{node:r,offset:s}=eq(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let a=r.getBoundingClientRect();i=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function xfe(t,e,n,r){let s=-1;for(let i=e,a=!1;i!=t.dom;){let l=t.docView.nearestDesc(i,!0),c;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((c=l.dom.getBoundingClientRect()).width||c.height)&&(l.node.isBlock&&l.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(l.dom.nodeName)&&(!a&&c.left>r.left||c.top>r.top?s=l.posBefore:(!a&&c.right<r.left||c.bottom<r.top)&&(s=l.posAfter),a=!0),!l.contentDOM&&s<0&&!l.node.isText))return(l.node.isBlock?r.top<(c.top+c.bottom)/2:r.left<(c.left+c.right)/2)?l.posBefore:l.posAfter;i=l.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function tq(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let a=t.childNodes[i];if(a.nodeType==1){let l=a.getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(kI(e,u))return tq(a,e,u)}}if((i=(i+1)%r)==s)break}return t}function bfe(t,e){let n=t.dom.ownerDocument,r,s=0,i=cfe(n,e.left,e.top);i&&({node:r,offset:s}=i);let a=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),l;if(!a||!t.dom.contains(a.nodeType!=1?a.parentNode:a)){let u=t.dom.getBoundingClientRect();if(!kI(e,u)||(a=tq(t.dom,e,u),!a))return null}if(vs)for(let u=a;r&&u;u=lp(u))u.draggable&&(r=void 0);if(a=yfe(a,e),r){if(wa&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let d=r.childNodes[s],h;d.nodeName=="IMG"&&(h=d.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let u;Ev&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?l=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(l=xfe(t,r,s,e))}l==null&&(l=vfe(t,a,e));let c=t.docView.nearestDesc(a,!0);return{pos:l,inside:c?c.posAtStart-c.border:-1}}function wL(t){return t.top<t.bottom||t.left<t.right}function lc(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(wL(r))return r}return Array.prototype.find.call(n,wL)||t.getBoundingClientRect()}const wfe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function nq(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),a=Ev||wa;if(r.nodeType==3)if(a&&(wfe.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let c=lc(el(r,s,s),n);if(wa&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=lc(el(r,s-1,s-1),-1);if(u.top==c.top){let d=lc(el(r,s,s+1),-1);if(d.top!=c.top)return km(d,d.left<u.left)}}return c}else{let c=s,u=s,d=n<0?1:-1;return n<0&&!s?(u++,d=-1):n>=0&&s==r.nodeValue.length?(c--,d=1):n<0?c--:u++,km(lc(el(r,c,u),d),d<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==pa(r))){let c=r.childNodes[s-1];if(c.nodeType==1)return aj(c.getBoundingClientRect(),!1)}if(i==null&&s<pa(r)){let c=r.childNodes[s];if(c.nodeType==1)return aj(c.getBoundingClientRect(),!0)}return aj(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==pa(r))){let c=r.childNodes[s-1],u=c.nodeType==3?el(c,pa(c)-(a?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(u)return km(lc(u,1),!1)}if(i==null&&s<pa(r)){let c=r.childNodes[s];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let u=c?c.nodeType==3?el(c,0,a?0:1):c.nodeType==1?c:null:null;if(u)return km(lc(u,-1),!0)}return km(lc(r.nodeType==3?el(r):r,-n),n>=0)}function km(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function aj(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function rq(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function Nfe(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return rq(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let l=t.docView.nearestDesc(i,!0);if(!l)break;if(l.node.isBlock){i=l.contentDOM||l.dom;break}i=l.dom.parentNode}let a=nq(t,s.pos,1);for(let l=i.firstChild;l;l=l.nextSibling){let c;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=el(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<c.length;u++){let d=c[u];if(d.bottom>d.top+1&&(n=="up"?a.top-d.top>(d.bottom-a.top)*2:d.bottom-a.bottom>(a.bottom-d.top)*2))return!1}}return!0})}const Sfe=/[\u0590-\u08ac]/;function _fe(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,a=s==r.parent.content.size,l=t.domSelection();return l?!Sfe.test(r.parent.textContent)||!l.modify?n=="left"||n=="backward"?i:a:rq(t,e,()=>{let{focusNode:c,focusOffset:u,anchorNode:d,anchorOffset:h}=t.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:m,focusOffset:g}=t.domSelectionRange(),y=m&&!p.contains(m.nodeType==1?m:m.parentNode)||c==m&&u==g;try{l.collapse(d,h),c&&(c!=d||u!=h)&&l.extend&&l.extend(c,u)}catch{}return f!=null&&(l.caretBidiLevel=f),y}):r.pos==r.start()||r.pos==r.end()}let NL=null,SL=null,_L=!1;function jfe(t,e,n){return NL==e&&SL==n?_L:(NL=e,SL=n,_L=n=="up"||n=="down"?Nfe(t,e,n):_fe(t,e,n))}const Na=0,jL=1,ud=2,Oo=3;class Cv{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Na,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,a;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((a=i.pmViewDesc)&&a.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(a)+a.size:this.posAtStart}else{let i,a;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((a=i.pmViewDesc)&&a.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(a):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>hs(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),a;if(i&&(!n||i.node))if(r&&(a=i.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let a=0;a<s.children.length;a++){let l=s.children[a];if(l.size){s=l;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let a=this.children[r],l=i+a.size;if(l>e||a instanceof iq){s=e-i;break}i=l}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof sq&&i.side>=0;r--);if(n<=0){let i,a=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,a=!1);return i&&n&&a&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?hs(i.dom)+1:0}}else{let i,a=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,a=!1);return i&&a&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?hs(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let a=r,l=0;;l++){let c=this.children[l],u=a+c.size;if(s==-1&&e<=u){let d=a+c.border;if(e>=d&&n<=u-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(e,n,d);e=a;for(let h=l;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=hs(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(u>n||l==this.children.length-1)){n=u;for(let d=l+1;d<this.children.length;d++){let h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=hs(h.dom);break}n+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}a=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),a=Math.max(e,n);for(let p=0,m=0;p<this.children.length;p++){let g=this.children[p],y=m+g.size;if(i>m&&a<y)return g.setSelection(e-m-g.border,n-m-g.border,r,s);m=y}let l=this.domFromPos(e,e?-1:1),c=n==e?l:this.domFromPos(n,n?-1:1),u=r.root.getSelection(),d=r.domSelectionRange(),h=!1;if((wa||vs)&&e==n){let{node:p,offset:m}=l;if(p.nodeType==3){if(h=!!(m&&p.nodeValue[m-1]==`
`),h&&m==p.nodeValue.length)for(let g=p,y;g;g=g.parentNode){if(y=g.nextSibling){y.nodeName=="BR"&&(l=c={node:y.parentNode,offset:hs(y)+1});break}let x=g.pmViewDesc;if(x&&x.node&&x.node.isBlock)break}}else{let g=p.childNodes[m-1];h=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(wa&&d.focusNode&&d.focusNode!=c.node&&d.focusNode.nodeType==1){let p=d.focusNode.childNodes[d.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||h&&vs)&&eh(l.node,l.offset,d.anchorNode,d.anchorOffset)&&eh(c.node,c.offset,d.focusNode,d.focusOffset))return;let f=!1;if((u.extend||e==n)&&!(h&&wa)){u.collapse(l.node,l.offset);try{e!=n&&u.extend(c.node,c.offset),f=!0}catch{}}if(!f){if(e>n){let m=l;l=c,c=m}let p=document.createRange();p.setEnd(c.node,c.offset),p.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],a=r+i.size;if(r==a?e<=a&&n>=r:e<a&&n>r){let l=r+i.border,c=a-i.border;if(e>=l&&n<=c){this.dirty=e==r||n==a?ud:jL,e==l&&n==c&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Oo:i.markDirty(e-l,n-l);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?ud:Oo}r=a}this.dirty=ud}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ud:jL;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class sq extends Cv{constructor(e,n,r,s){let i,a=n.type.toDOM;if(typeof a=="function"&&(a=a(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(a.nodeType!=1){let l=document.createElement("span");l.appendChild(a),a=l}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(e,[],a,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Na&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Efe extends Cv{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class th extends Cv{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],a=i&&i(n,s,r);return(!a||!a.dom)&&(a=_h.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new th(e,n,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&Oo||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Oo&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Na){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Na}}slice(e,n,r){let s=th.create(this.parent,this.mark,!0,r),i=this.children,a=this.size;n<a&&(i=$C(i,n,a,r)),e>0&&(i=$C(i,0,e,r));for(let l=0;l<i.length;l++)i[l].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Jc extends Cv{constructor(e,n,r,s,i,a,l,c,u){super(e,[],i,a),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=l}static create(e,n,r,s,i,a){let l=i.nodeViews[n.type.name],c,u=l&&l(n,i,()=>{if(!c)return a;if(c.parent)return c.parent.posBeforeChild(c)},r,s),d=u&&u.dom,h=u&&u.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:h}=_h.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!h&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let f=d;return d=lq(d,r,n),u?c=new Cfe(e,n,r,s,d,h||null,f,u,i,a+1):n.isText?new FN(e,n,r,s,d,f,i):new Jc(e,n,r,s,d,h||null,f,i,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>we.empty)}return e}matchesNode(e,n,r){return this.dirty==Na&&e.eq(this.node)&&rw(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,a=i&&i.pos>-1?i:null,l=i&&i.pos<0,c=new Afe(this,a&&a.node,e);Pfe(this.node,this.innerDeco,(u,d,h)=>{u.spec.marks?c.syncToMarks(u.spec.marks,r,e,d):u.type.side>=0&&!h&&c.syncToMarks(d==this.node.childCount?ln.none:this.node.child(d).marks,r,e,d),c.placeWidget(u,e,s)},(u,d,h,f)=>{c.syncToMarks(u.marks,r,e,f);let p;c.findNodeMatch(u,d,h,f)||l&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(p=c.findIndexWithChild(i.node))>-1&&c.updateNodeAt(u,d,h,p,e)||c.updateNextNode(u,d,h,e,f,s)||c.addNode(u,d,h,e,s),s+=u.nodeSize}),c.syncToMarks([],r,e,0),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==ud)&&(a&&this.protectLocalComposition(e,a),aq(this.contentDOM,this.children,e),cp&&Ofe(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof pt)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let a=i.nodeValue,l=Dfe(this.node.content,a,r-n,s-n);return l<0?null:{node:i,pos:l,text:a}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let a=new Efe(this,i,n,s);e.input.compositionNodes.push(a),this.children=$C(this.children,r,r+s.length,e,a)}update(e,n,r,s){return this.dirty==Oo||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Na}updateOuterDeco(e){if(rw(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=oq(this.dom,this.nodeDOM,VC(this.outerDeco,this.node,n),VC(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function EL(t,e,n,r,s){lq(r,e,t);let i=new Jc(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class FN extends Jc{constructor(e,n,r,s,i,a,l){super(e,n,r,s,i,null,a,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==Oo||this.dirty!=Na&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Na||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Na,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new FN(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Oo)}get domAtom(){return!1}isText(e){return this.node.text==e}}class iq extends Cv{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Na&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Cfe extends Jc{constructor(e,n,r,s,i,a,l,c,u,d){super(e,n,r,s,i,a,l,u,d),this.spec=c}update(e,n,r,s){if(this.dirty==Oo)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function aq(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let a=e[i],l=a.dom;if(l.parentNode==t){for(;l!=r;)r=CL(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(l,r);if(a instanceof th){let c=r?r.previousSibling:t.lastChild;aq(a.contentDOM,a.children,n),r=c?c.nextSibling:t.firstChild}}for(;r;)r=CL(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const _g=function(t){t&&(this.nodeName=t)};_g.prototype=Object.create(null);const dd=[new _g];function VC(t,e,n){if(t.length==0)return dd;let r=n?dd[0]:new _g,s=[r];for(let i=0;i<t.length;i++){let a=t[i].type.attrs;if(a){a.nodeName&&s.push(r=new _g(a.nodeName));for(let l in a){let c=a[l];c!=null&&(n&&s.length==1&&s.push(r=new _g(e.isInline?"span":"div")),l=="class"?r.class=(r.class?r.class+" ":"")+c:l=="style"?r.style=(r.style?r.style+";":"")+c:l!="nodeName"&&(r[l]=c))}}}return s}function oq(t,e,n,r){if(n==dd&&r==dd)return e;let s=e;for(let i=0;i<r.length;i++){let a=r[i],l=n[i];if(i){let c;l&&l.nodeName==a.nodeName&&s!=t&&(c=s.parentNode)&&c.nodeName.toLowerCase()==a.nodeName||(c=document.createElement(a.nodeName),c.pmIsDeco=!0,c.appendChild(s),l=dd[0]),s=c}Tfe(s,l||dd[0],a)}return s}function Tfe(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function lq(t,e,n){return oq(t,t,dd,VC(e,n,t.nodeType!=1))}function rw(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function CL(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Afe{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=kfe(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r,s){let i=0,a=this.stack.length>>1,l=Math.min(a,e.length);for(;i<l&&(i==a-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<a;)this.destroyRest(),this.top.dirty=Na,this.index=this.stack.pop(),this.top=this.stack.pop(),a--;for(;a<e.length;){this.stack.push(this.top,this.index+1);let c=-1,u=this.top.children.length;s<this.preMatch.index&&(u=Math.min(this.index+3,u));for(let d=this.index;d<u;d++){let h=this.top.children[d];if(h.matchesMark(e[a])&&!this.isLocked(h.dom)){c=d;break}}if(c>-1)c>this.index&&(this.changed=!0,this.destroyBetween(this.index,c)),this.top=this.top.children[this.index];else{let d=th.create(this.top,e[a],n,r);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,a++}}findNodeMatch(e,n,r,s){let i=-1,a;if(s>=this.preMatch.index&&(a=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&a.matchesNode(e,n,r))i=this.top.children.indexOf(a,this.index);else for(let l=this.index,c=Math.min(this.top.children.length,l+5);l<c;l++){let u=this.top.children[l];if(u.matchesNode(e,n,r)&&!this.preMatch.matched.has(u)){i=l;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let a=this.top.children[s];return a.dirty==Oo&&a.dom==a.contentDOM&&(a.dirty=ud),a.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,a){for(let l=this.index;l<this.top.children.length;l++){let c=this.top.children[l];if(c instanceof Jc){let u=this.preMatch.matched.get(c);if(u!=null&&u!=i)return!1;let d=c.dom,h,f=this.isLocked(d)&&!(e.isText&&c.node&&c.node.isText&&c.nodeDOM.nodeValue==e.text&&c.dirty!=Oo&&rw(n,c.outerDeco));if(!f&&c.update(e,n,r,s))return this.destroyBetween(this.index,l),c.dom!=d&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(c,e,n,r,s,a)))return this.destroyBetween(this.index,l),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=ud,h.updateChildren(s,a+1),h.dirty=Na),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,a){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!rw(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let l=Jc.create(this.top,n,r,s,i,a);if(l.contentDOM){l.children=e.children,e.children=[];for(let c of l.children)c.parent=l}return e.destroy(),l}addNode(e,n,r,s,i){let a=Jc.create(this.top,e,n,r,s,i);a.contentDOM&&a.updateChildren(s,i+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new sq(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof th;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof FN)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((vs||Vr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new iq(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function kfe(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,a=[];e:for(;s>0;){let l;for(;;)if(r){let u=n.children[r-1];if(u instanceof th)n=u,r=u.children.length;else{l=u,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let c=l.node;if(c){if(c!=t.child(s-1))break;--s,i.set(l,s),a.push(l)}}return{index:s,matched:i,matches:a.reverse()}}function Ife(t,e){return t.type.side-e.type.side}function Pfe(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);r(d,s,e.forChild(i,d),u),i+=d.nodeSize}return}let a=0,l=[],c=null;for(let u=0;;){let d,h;for(;a<s.length&&s[a].to==i;){let y=s[a++];y.widget&&(d?(h||(h=[d])).push(y):d=y)}if(d)if(h){h.sort(Ife);for(let y=0;y<h.length;y++)n(h[y],u,!!c)}else n(d,u,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(u<t.childCount)p=u,f=t.child(u++);else break;for(let y=0;y<l.length;y++)l[y].to<=i&&l.splice(y--,1);for(;a<s.length&&s[a].from<=i&&s[a].to>i;)l.push(s[a++]);let m=i+f.nodeSize;if(f.isText){let y=m;a<s.length&&s[a].from<y&&(y=s[a].from);for(let x=0;x<l.length;x++)l[x].to<y&&(y=l[x].to);y<m&&(c=f.cut(y-i),f=f.cut(0,y-i),m=y,p=-1)}else for(;a<s.length&&s[a].to<m;)a++;let g=f.isInline&&!f.isLeaf?l.filter(y=>!y.inline):l.slice();r(f,g,e.forChild(i,f),p),i=m}}function Ofe(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Dfe(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let a=t.child(s++),l=i;if(i+=a.nodeSize,!a.isText)continue;let c=a.text;for(;s<t.childCount;){let u=t.child(s++);if(i+=u.nodeSize,!u.isText)break;c+=u.text}if(i>=n){if(i>=r&&c.slice(r-e.length-l,r-l)==e)return r-e.length;let u=l<r?c.lastIndexOf(e,r-l-1):-1;if(u>=0&&u+e.length+l>=n)return l+u;if(n==r&&c.length>=r+e.length-l&&c.slice(r-l,r-l+e.length)==e)return r}}return-1}function $C(t,e,n,r,s){let i=[];for(let a=0,l=0;a<t.length;a++){let c=t[a],u=l,d=l+=c.size;u>=n||d<=e?i.push(c):(u<e&&i.push(c.slice(0,e-u,r)),s&&(i.push(s),s=void 0),d>n&&i.push(c.slice(n-u,c.size,r)))}return i}function II(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,a=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let l=r.resolve(a),c,u;if(LN(n)){for(c=a;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&nt.isSelectable(h)&&s.parent&&!(h.isInline&&ofe(n.focusNode,n.focusOffset,s.dom))){let f=s.posBefore;u=new nt(a==f?l:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let h=a,f=a;for(let p=0;p<n.rangeCount;p++){let m=n.getRangeAt(p);h=Math.min(h,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(h<0)return null;[c,a]=f==t.state.selection.anchor?[f,h]:[h,f],l=r.resolve(a)}else c=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(c<0)return null}let d=r.resolve(c);if(!u){let h=e=="pointer"||t.state.selection.head<l.pos&&!i?1:-1;u=PI(t,d,l,h)}return u}function cq(t){return t.editable?t.hasFocus():dq(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function bl(t,e=!1){let n=t.state.selection;if(uq(t,n),!!cq(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Vr){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&eh(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Mfe(t);else{let{anchor:r,head:s}=n,i,a;TL&&!(n instanceof pt)&&(n.$from.parent.inlineContent||(i=AL(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(a=AL(t,n.to))),t.docView.setSelection(r,s,t,e),TL&&(i&&kL(i),a&&kL(a)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Rfe(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const TL=vs||Vr&&QW<63;function AL(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(vs&&s&&s.contentEditable=="false")return oj(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return oj(s);if(i)return oj(i)}}function oj(t){return t.contentEditable="true",vs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function kL(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Rfe(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!cq(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Mfe(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,hs(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&wi&&Xc<=11&&(n.disabled=!0,n.disabled=!1)}function uq(t,e){if(e instanceof nt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(IL(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else IL(t)}function IL(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function PI(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||pt.between(e,n,r)}function PL(t){return t.editable&&!t.hasFocus()?!1:dq(t)}function dq(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Lfe(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return eh(e.node,e.offset,n.anchorNode,n.anchorOffset)}function UC(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&jt.findFrom(i,e)}function dc(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function OL(t,e,n){let r=t.state.selection;if(r instanceof pt)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let a=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return dc(t,new pt(r.$anchor,a))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=UC(t.state,e);return s&&s instanceof nt?dc(t,s):!1}else if(!(da&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,a;if(!i||i.isText)return!1;let l=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(a=t.docView.descAt(l))&&!a.contentDOM?nt.isSelectable(i)?dc(t,new nt(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Ev?dc(t,new pt(t.state.doc.resolve(e<0?l:l+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof nt&&r.node.isInline)return dc(t,new pt(e>0?r.$to:r.$from));{let s=UC(t.state,e);return s?dc(t,s):!1}}}function sw(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function jg(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Fh(t,e){return e<0?Ffe(t):Bfe(t)}function Ffe(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,a=!1;for(wa&&n.nodeType==1&&r<sw(n)&&jg(n.childNodes[r],-1)&&(a=!0);;)if(r>0){if(n.nodeType!=1)break;{let l=n.childNodes[r-1];if(jg(l,-1))s=n,i=--r;else if(l.nodeType==3)n=l,r=n.nodeValue.length;else break}}else{if(hq(n))break;{let l=n.previousSibling;for(;l&&jg(l,-1);)s=n.parentNode,i=hs(l),l=l.previousSibling;if(l)n=l,r=sw(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}a?zC(t,n,r):s&&zC(t,s,i)}function Bfe(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=sw(n),i,a;for(;;)if(r<s){if(n.nodeType!=1)break;let l=n.childNodes[r];if(jg(l,1))i=n,a=++r;else break}else{if(hq(n))break;{let l=n.nextSibling;for(;l&&jg(l,1);)i=l.parentNode,a=hs(l)+1,l=l.nextSibling;if(l)n=l,r=0,s=sw(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&zC(t,i,a)}function hq(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Vfe(t,e){for(;t&&e==t.childNodes.length&&!jv(t);)e=hs(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function $fe(t,e){for(;t&&!e&&!jv(t);)e=hs(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function zC(t,e,n){if(e.nodeType!=3){let i,a;(a=Vfe(e,n))?(e=a,n=0):(i=$fe(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(LN(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&bl(t)},50)}function DL(t,e){let n=t.state.doc.resolve(e);if(!(Vr||XW)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),a=(i.top+i.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),a=(i.top+i.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function RL(t,e,n){let r=t.state.selection;if(r instanceof pt&&!r.empty||n.indexOf("s")>-1||da&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let a=UC(t.state,e);if(a&&a instanceof nt)return dc(t,a)}if(!s.parent.inlineContent){let a=e<0?s:i,l=r instanceof Vi?jt.near(a,e):jt.findFrom(a,e);return l?dc(t,l):!1}return!1}function ML(t,e){if(!(t.state.selection instanceof pt))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let a=t.state.tr;return e<0?a.delete(n.pos-i.nodeSize,n.pos):a.delete(n.pos,n.pos+i.nodeSize),t.dispatch(a),!0}return!1}function LL(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Ufe(t){if(!vs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;LL(t,r,"true"),setTimeout(()=>LL(t,r,"false"),20)}return!1}function zfe(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Hfe(t,e){let n=e.keyCode,r=zfe(e);if(n==8||da&&n==72&&r=="c")return ML(t,-1)||Fh(t,-1);if(n==46&&!e.shiftKey||da&&n==68&&r=="c")return ML(t,1)||Fh(t,1);if(n==13||n==27)return!0;if(n==37||da&&n==66&&r=="c"){let s=n==37?DL(t,t.state.selection.from)=="ltr"?-1:1:-1;return OL(t,s,r)||Fh(t,s)}else if(n==39||da&&n==70&&r=="c"){let s=n==39?DL(t,t.state.selection.from)=="ltr"?1:-1:1;return OL(t,s,r)||Fh(t,s)}else{if(n==38||da&&n==80&&r=="c")return RL(t,-1,r)||Fh(t,-1);if(n==40||da&&n==78&&r=="c")return Ufe(t)||RL(t,1,r)||Fh(t,1);if(r==(da?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function OI(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let a=t.someProp("clipboardSerializer")||_h.fromSchema(t.state.schema),l=vq(),c=l.createElement("div");c.appendChild(a.serializeFragment(r,{document:l}));let u=c.firstChild,d,h=0;for(;u&&u.nodeType==1&&(d=yq[u.nodeName.toLowerCase()]);){for(let p=d.length-1;p>=0;p--){let m=l.createElement(d[p]);for(;c.firstChild;)m.appendChild(c.firstChild);c.appendChild(m),h++}u=c.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f,slice:e}}function fq(t,e,n,r,s){let i=s.parent.type.spec.code,a,l;if(!n&&!e)return null;let c=!!e&&(r||i||!n);if(c){if(t.someProp("transformPastedText",f=>{e=f(e,i||r,t)}),i)return l=new Ve(we.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{l=f(l,t,!0)}),l;let h=t.someProp("clipboardTextParser",f=>f(e,s,r,t));if(h)l=h;else{let f=s.marks(),{schema:p}=t.state,m=_h.fromSchema(p);a=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=a.appendChild(document.createElement("p"));g&&y.appendChild(m.serializeNode(p.text(g,f)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),a=Kfe(n),Ev&&Yfe(a);let u=a&&a.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let h=+d[3];h>0;h--){let f=a.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;a=f}if(l||(l=(t.someProp("clipboardParser")||t.someProp("domParser")||Qc.fromSchema(t.state.schema)).parseSlice(a,{preserveWhitespace:!!(c||d),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!Wfe.test(f.parentNode.nodeName)?{ignore:!0}:null}})),d)l=Qfe(FL(l,+d[1],+d[2]),d[4]);else if(l=Ve.maxOpen(qfe(l.content,s),!0),l.openStart||l.openEnd){let h=0,f=0;for(let p=l.content.firstChild;h<l.openStart&&!p.type.spec.isolating;h++,p=p.firstChild);for(let p=l.content.lastChild;f<l.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);l=FL(l,h,f)}return t.someProp("transformPasted",h=>{l=h(l,t,c)}),l}const Wfe=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function qfe(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,a=[];if(t.forEach(l=>{if(!a)return;let c=s.findWrapping(l.type),u;if(!c)return a=null;if(u=a.length&&i.length&&mq(c,i,l,a[a.length-1],0))a[a.length-1]=u;else{a.length&&(a[a.length-1]=gq(a[a.length-1],i.length));let d=pq(l,c);a.push(d),s=s.matchType(d.type),i=c}}),a)return we.from(a)}return t}function pq(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,we.from(t));return t}function mq(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=mq(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(we.from(pq(n,t,s+1))))}}function gq(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,gq(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(we.empty,!0);return t.copy(n.append(r))}function HC(t,e,n,r,s,i){let a=e<0?t.firstChild:t.lastChild,l=a.content;return t.childCount>1&&(i=0),s<r-1&&(l=HC(l,e,n,r,s+1,i)),s>=n&&(l=e<0?a.contentMatchAt(0).fillBefore(l,i<=s).append(l):l.append(a.contentMatchAt(a.childCount).fillBefore(we.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,a.copy(l))}function FL(t,e,n){return e<t.openStart&&(t=new Ve(HC(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Ve(HC(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const yq={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let BL=null;function vq(){return BL||(BL=document.implementation.createHTMLDocument("title"))}let lj=null;function Gfe(t){let e=window.trustedTypes;return e?(lj||(lj=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),lj.createHTML(t)):t}function Kfe(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=vq().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&yq[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=Gfe(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function Yfe(t){let e=t.querySelectorAll(Vr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Qfe(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:a}=t;for(let l=r.length-2;l>=0;l-=2){let c=n.nodes[r[l]];if(!c||c.hasRequiredAttrs())break;s=we.from(c.create(r[l+1],s)),i++,a++}return new Ve(s,i,a)}const Gs={},Ks={},Xfe={touchstart:!0,touchmove:!0};class Jfe{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Zfe(t){for(let e in Gs){let n=Gs[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{tpe(t,r)&&!DI(t,r)&&(t.editable||!(r.type in Ks))&&n(t,r)},Xfe[e]?{passive:!0}:void 0)}vs&&t.dom.addEventListener("input",()=>null),WC(t)}function Mc(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function epe(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function WC(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>DI(t,r))})}function DI(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function tpe(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function npe(t,e){!DI(t,e)&&Gs[e.type]&&(t.editable||!(e.type in Ks))&&Gs[e.type](t,e)}Ks.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!bq(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(hl&&Vr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),cp&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,id(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||Hfe(t,n)?n.preventDefault():Mc(t,"key")};Ks.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ks.keypress=(t,e)=>{let n=e;if(bq(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||da&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof pt)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",a=>a(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function BN(t){return{left:t.clientX,top:t.clientY}}function rpe(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function RI(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let a=i.depth+1;a>0;a--)if(t.someProp(e,l=>a>i.depth?l(t,n,i.nodeAfter,i.before(a),s,!0):l(t,n,i.node(a),i.before(a),s,!1)))return!0;return!1}function Df(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function spe(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&nt.isSelectable(r)?(Df(t,new nt(n)),!0):!1}function ipe(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof nt&&(r=n.node);let i=t.state.doc.resolve(e);for(let a=i.depth+1;a>0;a--){let l=a>i.depth?i.nodeAfter:i.node(a);if(nt.isSelectable(l)){r&&n.$from.depth>0&&a>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(a);break}}return s!=null?(Df(t,nt.create(t.state.doc,s)),!0):!1}function ape(t,e,n,r,s){return RI(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?ipe(t,n):spe(t,n))}function ope(t,e,n,r){return RI(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function lpe(t,e,n,r){return RI(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||cpe(t,n,r)}function cpe(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Df(t,pt.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let a=i>s.depth?s.nodeAfter:s.node(i),l=s.before(i);if(a.inlineContent)Df(t,pt.create(r,l+1,l+1+a.content.size));else if(nt.isSelectable(a))Df(t,nt.create(r,l));else continue;return!0}}function MI(t){return iw(t)}const xq=da?"metaKey":"ctrlKey";Gs.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=MI(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&rpe(n,t.input.lastClick)&&!n[xq]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let a=t.posAtCoords(BN(n));a&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new upe(t,a,n,!!r)):(i=="doubleClick"?ope:lpe)(t,a.pos,a.inside,n)?n.preventDefault():Mc(t,"pointer"))};class upe{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[xq],this.allowDefault=r.shiftKey;let i,a;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),a=n.inside;else{let d=e.state.doc.resolve(n.pos);i=d.parent,a=d.depth?d.before():0}const l=s?null:r.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c&&c.nodeDOM.nodeType==1?c.nodeDOM:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof nt&&u.from<=a&&u.to>a)&&(this.mightDrag={node:i,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&wa&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Mc(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>bl(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(BN(e))),this.updateAllowDefault(e),this.allowDefault||!n?Mc(this.view,"pointer"):ape(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||vs&&this.mightDrag&&!this.mightDrag.node.isAtom||Vr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Df(this.view,jt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Mc(this.view,"pointer")}move(e){this.updateAllowDefault(e),Mc(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Gs.touchstart=t=>{t.input.lastTouch=Date.now(),MI(t),Mc(t,"pointer")};Gs.touchmove=t=>{t.input.lastTouch=Date.now(),Mc(t,"pointer")};Gs.contextmenu=t=>MI(t);function bq(t,e){return t.composing?!0:vs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const dpe=hl?5e3:-1;Ks.compositionstart=Ks.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof pt&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Vr&&XW&&hpe(t)))t.markCursor=t.state.storedMarks||n.marks(),iw(t,!0),t.markCursor=null;else if(iw(t,!e.selection.empty),wa&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let a=i<0?s.lastChild:s.childNodes[i-1];if(!a)break;if(a.nodeType==3){let l=t.domSelection();l&&l.collapse(a,a.nodeValue.length);break}else s=a,i=-1}}t.input.composing=!0}wq(t,dpe)};function hpe(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Ks.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,wq(t,20))};function wq(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>iw(t),e))}function Nq(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=ppe());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function fpe(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=ife(e.focusNode,e.focusOffset),r=afe(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let a=n.pmViewDesc;if(!(!a||!a.isText(n.nodeValue)))return r}}return n||r}function ppe(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function iw(t,e=!1){if(!(hl&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Nq(t),e||t.docView&&t.docView.dirty){let n=II(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function mpe(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const by=wi&&Xc<15||cp&&ufe<604;Gs.copy=Ks.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=by?null:n.clipboardData,a=r.content(),{dom:l,text:c}=OI(t,a);i?(n.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",c)):mpe(t,l),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function gpe(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function ype(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?wy(t,r.value,null,s,e):wy(t,r.textContent,r.innerHTML,s,e)},50)}function wy(t,e,n,r,s){let i=fq(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",c=>c(t,s,i||Ve.empty)))return!0;if(!i)return!1;let a=gpe(i),l=a?t.state.tr.replaceSelectionWith(a,r):t.state.tr.replaceSelection(i);return t.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Sq(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ks.paste=(t,e)=>{let n=e;if(t.composing&&!hl)return;let r=by?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&wy(t,Sq(r),r.getData("text/html"),s,n)?n.preventDefault():ype(t,n)};class _q{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const vpe=da?"altKey":"ctrlKey";function jq(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[vpe]}Gs.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(BN(n)),a;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof nt?s.to-1:s.to))){if(r&&r.mightDrag)a=nt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let h=t.docView.nearestDesc(n.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(a=nt.create(t.state.doc,h.posBefore))}}let l=(a||t.state.selection).content(),{dom:c,text:u,slice:d}=OI(t,l);(!n.dataTransfer.files.length||!Vr||QW>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(by?"Text":"text/html",c.innerHTML),n.dataTransfer.effectAllowed="copyMove",by||n.dataTransfer.setData("text/plain",u),t.dragging=new _q(d,jq(t,n),a)};Gs.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ks.dragover=Ks.dragenter=(t,e)=>e.preventDefault();Ks.drop=(t,e)=>{try{xpe(t,e,t.dragging)}finally{t.dragging=null}};function xpe(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(BN(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",p=>{i=p(i,t,!1)}):i=fq(t,Sq(e.dataTransfer),by?null:e.dataTransfer.getData("text/html"),!1,s);let a=!!(n&&jq(t,e));if(t.someProp("handleDrop",p=>p(t,e,i||Ve.empty,a))){e.preventDefault();return}if(!i)return;e.preventDefault();let l=i?$W(t.state.doc,s.pos,i):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:p}=n;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,i.content.firstChild):c.replaceRange(u,u,i),c.doc.eq(h))return;let f=c.doc.resolve(u);if(d&&nt.isSelectable(i.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(i.content.firstChild))c.setSelection(new nt(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,y,x)=>p=x),c.setSelection(PI(t,f,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}Gs.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&bl(t)},20))};Gs.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Gs.beforeinput=(t,e)=>{if(Vr&&hl&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,id(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Ks)Gs[t]=Ks[t];function Ny(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class aw{constructor(e,n){this.toDOM=e,this.spec=n||jd,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:a}=e.mapResult(n.from+s,this.side<0?-1:1);return a?null:new Li(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof aw&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ny(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Zc{constructor(e,n){this.attrs=e,this.spec=n||jd}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,a=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=a?null:new Li(i,a,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Zc&&Ny(this.attrs,e.attrs)&&Ny(this.spec,e.spec)}static is(e){return e.type instanceof Zc}destroy(){}}class LI{constructor(e,n){this.attrs=e,this.spec=n||jd}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let a=e.mapResult(n.to+s,-1);return a.deleted||a.pos<=i.pos?null:new Li(i.pos-r,a.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof LI&&Ny(this.attrs,e.attrs)&&Ny(this.spec,e.spec)}destroy(){}}class Li{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Li(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Li(e,e,new aw(n,r))}static inline(e,n,r,s){return new Li(e,n,new Zc(r,s))}static node(e,n,r,s){return new Li(e,n,new LI(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Zc}get widget(){return this.type instanceof aw}}const Qh=[],jd={};class cr{constructor(e,n){this.local=e.length?e:Qh,this.children=n.length?n:Qh}static create(e,n){return n.length?ow(n,e,0,jd):Ts}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let a=0;a<this.local.length;a++){let l=this.local[a];l.from<=n&&l.to>=e&&(!i||i(l.spec))&&r.push(l.copy(l.from+s,l.to+s))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<n&&this.children[a+1]>e){let l=this.children[a]+1;this.children[a+2].findInner(e-l,n-l,r,s+l,i)}}map(e,n,r){return this==Ts||e.maps.length==0?this:this.mapInner(e,n,0,0,r||jd)}mapInner(e,n,r,s,i){let a;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,r,s);c&&c.type.valid(n,c)?(a||(a=[])).push(c):i.onRemove&&i.onRemove(this.local[l].spec)}return this.children.length?bpe(this.children,a||[],e,n,r,s,i):a?new cr(a.sort(Ed),Qh):Ts}add(e,n){return n.length?this==Ts?cr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((l,c)=>{let u=c+r,d;if(d=Cq(n,l,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<c;)i+=3;s[i]==c?s[i+2]=s[i+2].addInner(l,d,u+1):s.splice(i,0,c,c+l.nodeSize,ow(d,l,u+1,jd)),i+=3}});let a=Eq(i?Tq(n):n,-r);for(let l=0;l<a.length;l++)a[l].type.valid(e,a[l])||a.splice(l--,1);return new cr(a.length?this.local.concat(a).sort(Ed):this.local,s||this.children)}remove(e){return e.length==0||this==Ts?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let a,l=r[i]+n,c=r[i+1]+n;for(let d=0,h;d<e.length;d++)(h=e[d])&&h.from>l&&h.to<c&&(e[d]=null,(a||(a=[])).push(h));if(!a)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(a,l+1);u!=Ts?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,a;i<e.length;i++)if(a=e[i])for(let l=0;l<s.length;l++)s[l].eq(a,n)&&(s==this.local&&(s=this.local.slice()),s.splice(l--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new cr(s,r):Ts}forChild(e,n){if(this==Ts)return this;if(n.isLeaf)return cr.empty;let r,s;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let i=e+1,a=i+n.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<a&&c.to>i&&c.type instanceof Zc){let u=Math.max(i,c.from)-i,d=Math.min(a,c.to)-i;u<d&&(s||(s=[])).push(c.copy(u,d))}}if(s){let l=new cr(s.sort(Ed),Qh);return r?new Ec([l,r]):l}return r||Ts}eq(e){if(this==e)return!0;if(!(e instanceof cr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return FI(this.localsInner(e))}localsInner(e){if(this==Ts)return Qh;if(e.inlineContent||!this.local.some(Zc.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Zc||n.push(this.local[r]);return n}forEachSet(e){e(this)}}cr.empty=new cr([],[]);cr.removeOverlap=FI;const Ts=cr.empty;class Ec{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,jd));return Ec.from(r)}forChild(e,n){if(n.isLeaf)return cr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=Ts&&(i instanceof Ec?r=r.concat(i.members):r.push(i))}return Ec.from(r)}eq(e){if(!(e instanceof Ec)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let a=0;a<i.length;a++)n.push(i[a])}}return n?FI(r?n:n.sort(Ed)):Qh}static from(e){switch(e.length){case 0:return Ts;case 1:return e[0];default:return new Ec(e.every(n=>n instanceof cr)?e:e.reduce((n,r)=>n.concat(r instanceof cr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function bpe(t,e,n,r,s,i,a){let l=t.slice();for(let u=0,d=i;u<n.maps.length;u++){let h=0;n.maps[u].forEach((f,p,m,g)=>{let y=g-m-(p-f);for(let x=0;x<l.length;x+=3){let w=l[x+1];if(w<0||f>w+d-h)continue;let N=l[x]+d-h;p>=N?l[x+1]=f<=N?-2:-1:f>=d&&y&&(l[x]+=y,l[x+1]+=y)}h+=y}),d=n.maps[u].map(d,-1)}let c=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){c=!0,l[u+1]=-1;continue}let d=n.map(t[u]+i),h=d-s;if(h<0||h>=r.content.size){c=!0;continue}let f=n.map(t[u+1]+i,-1),p=f-s,{index:m,offset:g}=r.content.findIndex(h),y=r.maybeChild(m);if(y&&g==h&&g+y.nodeSize==p){let x=l[u+2].mapInner(n,y,d+1,t[u]+i+1,a);x!=Ts?(l[u]=h,l[u+1]=p,l[u+2]=x):(l[u+1]=-2,c=!0)}else c=!0}if(c){let u=wpe(l,t,e,n,s,i,a),d=ow(u,r,0,a);e=d.local;for(let h=0;h<l.length;h+=3)l[h+1]<0&&(l.splice(h,3),h-=3);for(let h=0,f=0;h<d.children.length;h+=3){let p=d.children[h];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,d.children[h],d.children[h+1],d.children[h+2])}}return new cr(e.sort(Ed),l)}function Eq(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Li(s.from+e,s.to+e,s.type))}return n}function wpe(t,e,n,r,s,i,a){function l(c,u){for(let d=0;d<c.local.length;d++){let h=c.local[d].map(r,s,u);h?n.push(h):a.onRemove&&a.onRemove(c.local[d].spec)}for(let d=0;d<c.children.length;d+=3)l(c.children[d+2],c.children[d]+u+1)}for(let c=0;c<t.length;c+=3)t[c+1]==-1&&l(t[c+2],e[c]+i+1);return n}function Cq(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,a;i<t.length;i++)(a=t[i])&&a.from>n&&a.to<r&&((s||(s=[])).push(a),t[i]=null);return s}function Tq(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function ow(t,e,n,r){let s=[],i=!1;e.forEach((l,c)=>{let u=Cq(t,l,c+n);if(u){i=!0;let d=ow(u,l,n+c+1,r);d!=Ts&&s.push(c,c+l.nodeSize,d)}});let a=Eq(i?Tq(t):t,-n).sort(Ed);for(let l=0;l<a.length;l++)a[l].type.valid(e,a[l])||(r.onRemove&&r.onRemove(a[l].spec),a.splice(l--,1));return a.length||s.length?new cr(a,s):Ts}function Ed(t,e){return t.from-e.from||t.to-e.to}function FI(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),VL(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),VL(e,s,r.copy(i.from,r.to)));break}}}return e}function VL(t,e,n){for(;e<t.length&&Ed(n,t[e])>0;)e++;t.splice(e,0,n)}function cj(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Ts&&e.push(r)}),t.cursorWrapper&&e.push(cr.create(t.state.doc,[t.cursorWrapper.deco])),Ec.from(e)}const Npe={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Spe=wi&&Xc<=11;class _pe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class jpe{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new _pe,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);wi&&Xc<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():vs&&e.composing&&r.some(s=>s.type=="childList"&&s.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),Spe&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Npe)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(PL(this.view)){if(this.suppressingSelectionUpdates)return bl(this.view);if(wi&&Xc<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&eh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=lp(i))n.add(i);for(let i=e.anchorNode;i;i=lp(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&PL(e)&&!this.ignoreSelectionChange(r),i=-1,a=-1,l=!1,c=[];if(e.editable)for(let d=0;d<n.length;d++){let h=this.registerMutation(n[d],c);h&&(i=i<0?h.from:Math.min(h.from,i),a=a<0?h.to:Math.max(h.to,a),h.typeOver&&(l=!0))}if(wa&&c.length){let d=c.filter(h=>h.nodeName=="BR");if(d.length==2){let[h,f]=d;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of d){let p=f.parentNode;p&&p.nodeName=="LI"&&(!h||Tpe(e,h)!=p)&&f.remove()}}}else if((Vr||vs)&&c.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of c)if(d.nodeName=="BR"&&d.parentNode){let h=d.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&d.parentNode.removeChild(d)}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&LN(r)&&(u=II(e))&&u.eq(jt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,bl(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,a),Epe(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,Ape(e,c)),this.handleDOMChange(i,a,l,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||bl(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let h=e.addedNodes[d];n.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(wi&&Xc<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:h,nextSibling:f}=e.addedNodes[d];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let a=s&&s.parentNode==e.target?hs(s)+1:0,l=r.localPosFromDOM(e.target,a,-1),c=i&&i.parentNode==e.target?hs(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,c,1);return{from:l,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let $L=new WeakMap,UL=!1;function Epe(t){if(!$L.has(t)&&($L.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=wa,UL)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),UL=!0}}function zL(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return eh(a.node,a.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function Cpe(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return zL(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?zL(t,n):null}function Tpe(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Ape(t,e){var n;let{focusNode:r,focusOffset:s}=t.domSelectionRange();for(let i of e)if(((n=i.parentNode)===null||n===void 0?void 0:n.nodeName)=="TR"){let a=i.nextSibling;for(;a&&a.nodeName!="TD"&&a.nodeName!="TH";)a=a.nextSibling;if(a){let l=a;for(;;){let c=l.firstChild;if(!c||c.nodeType!=1||c.contentEditable=="false"||/^(BR|IMG)$/.test(c.nodeName))break;l=c}l.insertBefore(i,l.firstChild),r==i&&t.domSelection().collapse(i,s)}else i.parentNode.removeChild(i)}}function kpe(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:a,to:l}=t.docView.parseRange(e,n),c=t.domSelectionRange(),u,d=c.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:c.anchorOffset}],LN(c)||u.push({node:c.focusNode,offset:c.focusOffset})),Vr&&t.input.lastKeyCode===8)for(let y=i;y>s;y--){let x=r.childNodes[y-1],w=x.pmViewDesc;if(x.nodeName=="BR"&&!w){i=y;break}if(!w||w.size)break}let h=t.state.doc,f=t.someProp("domParser")||Qc.fromSchema(t.state.schema),p=h.resolve(a),m=null,g=f.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:Ipe,context:p});if(u&&u[0].pos!=null){let y=u[0].pos,x=u[1]&&u[1].pos;x==null&&(x=y),m={anchor:y+a,head:x+a}}return{doc:g,sel:m,from:a,to:l}}function Ipe(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(vs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||vs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Ppe=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Ope(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let j=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,_=II(t,j);if(_&&!t.state.selection.eq(_)){if(Vr&&hl&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",I=>I(t,id(13,"Enter"))))return;let E=t.state.tr.setSelection(_);j=="pointer"?E.setMeta("pointer",!0):j=="key"&&E.scrollIntoView(),i&&E.setMeta("composition",i),t.dispatch(E)}return}let a=t.state.doc.resolve(e),l=a.sharedDepth(n);e=a.before(l+1),n=t.state.doc.resolve(n).after(l+1);let c=t.state.selection,u=kpe(t,e,n),d=t.state.doc,h=d.slice(u.from,u.to),f,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,p="end"):(f=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let m=Mpe(h.content,u.doc.content,u.from,f,p);if(m&&t.input.domChangeCount++,(cp&&t.input.lastIOSEnter>Date.now()-225||hl)&&s.some(j=>j.nodeType==1&&!Ppe.test(j.nodeName))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",j=>j(t,id(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!m)if(r&&c instanceof pt&&!c.empty&&c.$head.sameParent(c.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(u.sel){let j=HL(t,t.state.doc,u.sel);if(j&&!j.eq(t.state.selection)){let _=t.state.tr.setSelection(j);i&&_.setMeta("composition",i),t.dispatch(_)}}return}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof pt&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),wi&&Xc<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "&&(m.start--,m.endA--,m.endB--);let g=u.doc.resolveNoCache(m.start-u.from),y=u.doc.resolveNoCache(m.endB-u.from),x=d.resolve(m.start),w=g.sameParent(y)&&g.parent.inlineContent&&x.end()>=m.endA;if((cp&&t.input.lastIOSEnter>Date.now()-225&&(!w||s.some(j=>j.nodeName=="DIV"||j.nodeName=="P"))||!w&&g.pos<u.doc.content.size&&(!g.sameParent(y)||!g.parent.inlineContent)&&g.pos<y.pos&&!/\S/.test(u.doc.textBetween(g.pos,y.pos,"","")))&&t.someProp("handleKeyDown",j=>j(t,id(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>m.start&&Rpe(d,m.start,m.endA,g,y)&&t.someProp("handleKeyDown",j=>j(t,id(8,"Backspace")))){hl&&Vr&&t.domObserver.suppressSelectionUpdates();return}Vr&&m.endB==m.start&&(t.input.lastChromeDelete=Date.now()),hl&&!w&&g.start()!=y.start()&&y.parentOffset==0&&g.depth==y.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,y=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(j){return j(t,id(13,"Enter"))})},20));let N=m.start,S=m.endA,C=j=>{let _=j||t.state.tr.replace(N,S,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let E=HL(t,_.doc,u.sel);E&&!(Vr&&t.composing&&E.empty&&(m.start!=m.endB||t.input.lastChromeDelete<Date.now()-100)&&(E.head==N||E.head==_.mapping.map(S)-1)||wi&&E.empty&&E.head==N)&&_.setSelection(E)}return i&&_.setMeta("composition",i),_.scrollIntoView()},A;if(w)if(g.pos==y.pos){wi&&Xc<=11&&g.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>bl(t),20));let j=C(t.state.tr.delete(N,S)),_=d.resolve(m.start).marksAcross(d.resolve(m.endA));_&&j.ensureMarks(_),t.dispatch(j)}else if(m.endA==m.endB&&(A=Dpe(g.parent.content.cut(g.parentOffset,y.parentOffset),x.parent.content.cut(x.parentOffset,m.endA-x.start())))){let j=C(t.state.tr);A.type=="add"?j.addMark(N,S,A.mark):j.removeMark(N,S,A.mark),t.dispatch(j)}else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let j=g.parent.textBetween(g.parentOffset,y.parentOffset),_=()=>C(t.state.tr.insertText(j,N,S));t.someProp("handleTextInput",E=>E(t,N,S,j,_))||t.dispatch(_())}else t.dispatch(C());else t.dispatch(C())}function HL(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:PI(t,e.resolve(n.anchor),e.resolve(n.head))}function Dpe(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,a,l,c;for(let d=0;d<r.length;d++)s=r[d].removeFromSet(s);for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);if(s.length==1&&i.length==0)l=s[0],a="add",c=d=>d.mark(l.addToSet(d.marks));else if(s.length==0&&i.length==1)l=i[0],a="remove",c=d=>d.mark(l.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(c(e.child(d)));if(we.from(u).eq(t))return{mark:l,type:a}}function Rpe(t,e,n,r,s){if(n-e<=s.pos-r.pos||uj(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let l=i.nodeAfter;return l!=null&&n==e+l.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let a=t.resolve(uj(i,!0,!0));return!a.parent.isTextblock||a.pos>n||uj(a,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(a.parent.content)}function uj(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function Mpe(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a,b:l}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let c=Math.max(0,i-Math.min(a,l));r-=a+c-i}if(a<i&&t.size<e.size){let c=r<=i&&r>=a?i-r:0;i-=c,i&&i<e.size&&WL(e.textBetween(i-1,i+1))&&(i+=c?1:-1),l=i+(l-a),a=i}else if(l<i){let c=r<=i&&r>=l?i-r:0;i-=c,i&&i<t.size&&WL(t.textBetween(i-1,i+1))&&(i+=c?1:-1),a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}function WL(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class Aq{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Jfe,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(QL),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=KL(this),GL(this),this.nodeViews=YL(this),this.docView=EL(this.state.doc,qL(this),cj(this),this.dom,this),this.domObserver=new jpe(this,(r,s,i,a)=>Ope(this,r,s,i,a)),this.domObserver.start(),Zfe(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&WC(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(QL),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,a=!1;e.storedMarks&&this.composing&&(Nq(this),a=!0),this.state=e;let l=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(l||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=YL(this);Fpe(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(l||n.handleDOMEvents!=this._props.handleDOMEvents)&&WC(this),this.editable=KL(this),GL(this);let c=cj(this),u=qL(this),d=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,u,c);(h||!e.selection.eq(s.selection))&&(a=!0);let f=d=="preserve"&&a&&this.dom.style.overflowAnchor==null&&ffe(this);if(a){this.domObserver.stop();let p=h&&(wi||Vr)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&Lpe(s.selection,e.selection);if(h){let m=Vr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=fpe(this)),(i||!this.docView.update(e.doc,u,c,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=EL(e.doc,u,c,this.dom,this)),m&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Lfe(this))?bl(this,p):(uq(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():f&&pfe(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof nt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&bL(this,n.getBoundingClientRect(),e)}else bL(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new _q(e.slice,e.move,s<0?void 0:nt.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let a=0;a<this.directPlugins.length;a++){let l=this.directPlugins[a].props[e];if(l!=null&&(s=n?n(l):l))return s}let i=this.state.plugins;if(i)for(let a=0;a<i.length;a++){let l=i[a].props[e];if(l!=null&&(s=n?n(l):l))return s}}hasFocus(){if(wi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&mfe(this.dom),bl(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return bfe(this,e)}coordsAtPos(e,n=1){return nq(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return jfe(this,n||this.state,e)}pasteHTML(e,n){return wy(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return wy(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return OI(this,e)}destroy(){this.docView&&(epe(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],cj(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,rfe())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return npe(this,e)}domSelectionRange(){let e=this.domSelection();return e?vs&&this.root.nodeType===11&&lfe(this.dom.ownerDocument)==this.dom&&Cpe(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}Aq.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function qL(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Li.node(0,t.state.doc.content.size,e)]}function GL(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Li.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function KL(t){return!t.someProp("editable",e=>e(t.state)===!1)}function Lpe(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function YL(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Fpe(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function QL(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var yu={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},lw={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Bpe=typeof navigator<"u"&&/Mac/.test(navigator.platform),Vpe=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var fs=0;fs<10;fs++)yu[48+fs]=yu[96+fs]=String(fs);for(var fs=1;fs<=24;fs++)yu[fs+111]="F"+fs;for(var fs=65;fs<=90;fs++)yu[fs]=String.fromCharCode(fs+32),lw[fs]=String.fromCharCode(fs);for(var dj in yu)lw.hasOwnProperty(dj)||(lw[dj]=yu[dj]);function $pe(t){var e=Bpe&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Vpe&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?lw:yu)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const Upe=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),zpe=typeof navigator<"u"&&/Win/.test(navigator.platform);function Hpe(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,a;for(let l=0;l<e.length-1;l++){let c=e[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))Upe?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),a&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function Wpe(t){let e=Object.create(null);for(let n in t)e[Hpe(n)]=t[n];return e}function hj(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function qpe(t){return new Ar({props:{handleKeyDown:kq(t)}})}function kq(t){let e=Wpe(t);return function(n,r){let s=$pe(r),i,a=e[hj(s,r)];if(a&&a(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let l=e[hj(s,r,!1)];if(l&&l(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(zpe&&r.ctrlKey&&r.altKey)&&(i=yu[r.keyCode])&&i!=s){let l=e[hj(i,r)];if(l&&l(n.state,n.dispatch,n))return!0}}return!1}}const BI=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Iq(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const Pq=(t,e,n)=>{let r=Iq(t,n);if(!r)return!1;let s=VI(r);if(!s){let a=r.blockRange(),l=a&&Kp(a);return l==null?!1:(e&&e(t.tr.lift(a,l).scrollIntoView()),!0)}let i=s.nodeBefore;if($q(t,s,e,-1))return!0;if(r.parent.content.size==0&&(up(i,"end")||nt.isSelectable(i)))for(let a=r.depth;;a--){let l=RN(t.doc,r.before(a),r.after(a),Ve.empty);if(l&&l.slice.size<l.to-l.from){if(e){let c=t.tr.step(l);c.setSelection(up(i,"end")?jt.findFrom(c.doc.resolve(c.mapping.map(s.pos,-1)),-1):nt.create(c.doc,s.pos-i.nodeSize)),e(c.scrollIntoView())}return!0}if(a==1||r.node(a-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},Gpe=(t,e,n)=>{let r=Iq(t,n);if(!r)return!1;let s=VI(r);return s?Oq(t,s,e):!1},Kpe=(t,e,n)=>{let r=Rq(t,n);if(!r)return!1;let s=$I(r);return s?Oq(t,s,e):!1};function Oq(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let d=s.lastChild;if(!d)return!1;s=d}let a=e.nodeAfter,l=a,c=e.pos+1;for(;!l.isTextblock;c++){if(l.type.spec.isolating)return!1;let d=l.firstChild;if(!d)return!1;l=d}let u=RN(t.doc,i,c,Ve.empty);if(!u||u.from!=i||u instanceof Br&&u.slice.size>=c-i)return!1;if(n){let d=t.tr.step(u);d.setSelection(pt.create(d.doc,i)),n(d.scrollIntoView())}return!0}function up(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const Dq=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=VI(r)}let a=i&&i.nodeBefore;return!a||!nt.isSelectable(a)?!1:(e&&e(t.tr.setSelection(nt.create(t.doc,i.pos-a.nodeSize)).scrollIntoView()),!0)};function VI(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function Rq(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const Mq=(t,e,n)=>{let r=Rq(t,n);if(!r)return!1;let s=$I(r);if(!s)return!1;let i=s.nodeAfter;if($q(t,s,e,1))return!0;if(r.parent.content.size==0&&(up(i,"start")||nt.isSelectable(i))){let a=RN(t.doc,r.before(),r.after(),Ve.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(up(i,"start")?jt.findFrom(l.doc.resolve(l.mapping.map(s.pos)),1):nt.create(l.doc,l.mapping.map(s.pos))),e(l.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},Lq=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=$I(r)}let a=i&&i.nodeAfter;return!a||!nt.isSelectable(a)?!1:(e&&e(t.tr.setSelection(nt.create(t.doc,i.pos)).scrollIntoView()),!0)};function $I(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Ype=(t,e)=>{let n=t.selection,r=n instanceof nt,s;if(r){if(n.node.isTextblock||!Ou(t.doc,n.from))return!1;s=n.from}else if(s=DN(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(nt.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},Qpe=(t,e)=>{let n=t.selection,r;if(n instanceof nt){if(n.node.isTextblock||!Ou(t.doc,n.to))return!1;r=n.to}else if(r=DN(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},Xpe=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&Kp(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},Fq=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function UI(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Jpe=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),a=UI(s.contentMatchAt(i));if(!a||!s.canReplaceWith(i,i,a))return!1;if(e){let l=n.after(),c=t.tr.replaceWith(l,l,a.createAndFill());c.setSelection(jt.near(c.doc.resolve(l),1)),e(c.scrollIntoView())}return!0},Bq=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof Vi||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=UI(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let a=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,l=t.tr.insert(a,i.createAndFill());l.setSelection(pt.create(l.doc,a+1)),e(l.scrollIntoView())}return!0},Vq=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(xl(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&Kp(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)};function Zpe(t){return(e,n)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof nt&&e.selection.node.isBlock)return!r.parentOffset||!xl(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],a,l,c=!1,u=!1;for(let p=r.depth;;p--)if(r.node(p).isBlock){c=r.end(p)==r.pos+(r.depth-p),u=r.start(p)==r.pos-(r.depth-p),l=UI(r.node(p-1).contentMatchAt(r.indexAfter(p-1))),i.unshift(c&&l?{type:l}:null),a=p;break}else{if(p==1)return!1;i.unshift(null)}let d=e.tr;(e.selection instanceof pt||e.selection instanceof Vi)&&d.deleteSelection();let h=d.mapping.map(r.pos),f=xl(d.doc,h,i.length,i);if(f||(i[0]=l?{type:l}:null,f=xl(d.doc,h,i.length,i)),!f)return!1;if(d.split(h,i.length,i),!c&&u&&r.node(a).type!=l){let p=d.mapping.map(r.before(a)),m=d.doc.resolve(p);l&&r.node(a-1).canReplaceWith(m.index(),m.index()+1,l)&&d.setNodeMarkup(d.mapping.map(r.before(a)),l)}return n&&n(d.scrollIntoView()),!0}}const eme=Zpe(),tme=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(nt.create(t.doc,s))),!0)};function nme(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Ou(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function $q(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,a,l,c=s.type.spec.isolating||i.type.spec.isolating;if(!c&&nme(t,e,n))return!0;let u=!c&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(a=(l=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&l.matchType(a[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,m=we.empty;for(let x=a.length-1;x>=0;x--)m=we.from(a[x].create(null,m));m=we.from(s.copy(m));let g=t.tr.step(new zr(e.pos-1,p,e.pos,p,new Ve(m,1,0),a.length,!0)),y=g.doc.resolve(p+2*a.length);y.nodeAfter&&y.nodeAfter.type==s.type&&Ou(g.doc,y.pos)&&g.join(y.pos),n(g.scrollIntoView())}return!0}let d=i.type.spec.isolating||r>0&&c?null:jt.findFrom(e,1),h=d&&d.$from.blockRange(d.$to),f=h&&Kp(h);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(h,f).scrollIntoView()),!0;if(u&&up(i,"start",!0)&&up(s,"end")){let p=s,m=[];for(;m.push(p),!p.isTextblock;)p=p.lastChild;let g=i,y=1;for(;!g.isTextblock;g=g.firstChild)y++;if(p.canReplace(p.childCount,p.childCount,g.content)){if(n){let x=we.empty;for(let N=m.length-1;N>=0;N--)x=we.from(m[N].copy(x));let w=t.tr.step(new zr(e.pos-m.length,e.pos+i.nodeSize,e.pos+y,e.pos+i.nodeSize-y,new Ve(x,m.length,0),0,!0));n(w.scrollIntoView())}return!0}}return!1}function Uq(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(pt.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const rme=Uq(-1),sme=Uq(1);function ime(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,a=s.blockRange(i),l=a&&TI(a,t,e);return l?(r&&r(n.tr.wrap(a,l).scrollIntoView()),!0):!1}}function XL(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[i];n.doc.nodesBetween(a,l,(c,u)=>{if(s)return!1;if(!(!c.isTextblock||c.hasMarkup(t,e)))if(c.type==t)s=!0;else{let d=n.doc.resolve(u),h=d.index();s=d.parent.canReplaceWith(h,h+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let a=0;a<n.selection.ranges.length;a++){let{$from:{pos:l},$to:{pos:c}}=n.selection.ranges[a];i.setBlockType(l,c,t,e)}r(i.scrollIntoView())}return!0}}function zI(...t){return function(e,n,r){for(let s=0;s<t.length;s++)if(t[s](e,n,r))return!0;return!1}}zI(BI,Pq,Dq);zI(BI,Mq,Lq);zI(Fq,Bq,Vq,eme);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function ame(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,a=s.blockRange(i);if(!a)return!1;let l=r?n.tr:null;return ome(l,a,t,e)?(r&&r(l.scrollIntoView()),!0):!1}}function ome(t,e,n,r=null){let s=!1,i=e,a=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let c=a.resolve(e.start-2);i=new tw(c,c,e.depth),e.endIndex<e.parent.childCount&&(e=new tw(e.$from,a.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let l=TI(i,n,r,e);return l?(t&&lme(t,e,l,s,n),!0):!1}function lme(t,e,n,r,s){let i=we.empty;for(let d=n.length-1;d>=0;d--)i=we.from(n[d].type.create(n[d].attrs,i));t.step(new zr(e.start-(r?2:0),e.end,e.start,e.end,new Ve(i,0,0),n.length,!0));let a=0;for(let d=0;d<n.length;d++)n[d].type==s&&(a=d+1);let l=n.length-a,c=e.start+n.length-(r?2:0),u=e.parent;for(let d=e.startIndex,h=e.endIndex,f=!0;d<h;d++,f=!1)!f&&xl(t.doc,c,l)&&(t.split(c,l),c+=2*l),c+=u.child(d).nodeSize;return t}function cme(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,a=>a.childCount>0&&a.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?ume(e,n,t,i):dme(e,n,i):!0:!1}}function ume(t,e,n,r){let s=t.tr,i=r.end,a=r.$to.end(r.depth);i<a&&(s.step(new zr(i-1,a,i,a,new Ve(we.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new tw(s.doc.resolve(r.$from.pos),s.doc.resolve(a),r.depth));const l=Kp(r);if(l==null)return!1;s.lift(r,l);let c=s.doc.resolve(s.mapping.map(i,-1)-1);return Ou(s.doc,c.pos)&&c.nodeBefore.type==c.nodeAfter.type&&s.join(c.pos),e(s.scrollIntoView()),!0}function dme(t,e,n){let r=t.tr,s=n.parent;for(let p=n.end,m=n.endIndex-1,g=n.startIndex;m>g;m--)p-=s.child(m).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),a=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let l=n.startIndex==0,c=n.endIndex==s.childCount,u=i.node(-1),d=i.index(-1);if(!u.canReplace(d+(l?0:1),d+1,a.content.append(c?we.empty:we.from(s))))return!1;let h=i.pos,f=h+a.nodeSize;return r.step(new zr(h-(l?1:0),f+(c?1:0),h+1,f-1,new Ve((l?we.empty:we.from(s.copy(we.empty))).append(c?we.empty:we.from(s.copy(we.empty))),l?0:1,c?0:1),l?0:1)),e(r.scrollIntoView()),!0}function hme(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==t);if(!i)return!1;let a=i.startIndex;if(a==0)return!1;let l=i.parent,c=l.child(a-1);if(c.type!=t)return!1;if(n){let u=c.lastChild&&c.lastChild.type==l.type,d=we.from(u?t.create():null),h=new Ve(we.from(t.create(null,we.from(l.type.create(null,d)))),u?3:1,0),f=i.start,p=i.end;n(e.tr.step(new zr(f-(u?3:1),p,f,p,h,1,!0)).scrollIntoView())}return!0}}function VN(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class $N{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:i}=r,a=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([l,c])=>[l,(...d)=>{const h=c(...d)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:a}=s,l=[],c=!!e,u=e||i.tr,d=()=>(!c&&n&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(u),l.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(r).map(([f,p])=>[f,(...g)=>{const y=this.buildProps(u,n),x=p(...g)(y);return l.push(x),h}])),run:d};return h}createCan(e){const{rawCommands:n,state:r}=this,s=!1,i=e||r.tr,a=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(n).map(([c,u])=>[c,(...d)=>u(...d)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:i}=this,{view:a}=s,l={tr:e,editor:s,view:a,state:VN({state:i,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([c,u])=>[c,(...d)=>u(...d)(l)]))}};return l}}let fme=class{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}};function Ye(t,e,n){return t.config[e]===void 0&&t.parent?Ye(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ye(t.parent,e,n):null}):t.config[e]}function UN(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function zq(t){const e=[],{nodeExtensions:n,markExtensions:r}=UN(t),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(a=>{const l={name:a.name,options:a.options,storage:a.storage,extensions:s},c=Ye(a,"addGlobalAttributes",l);if(!c)return;c().forEach(d=>{d.types.forEach(h=>{Object.entries(d.attributes).forEach(([f,p])=>{e.push({type:h,name:f,attribute:{...i,...p}})})})})}),s.forEach(a=>{const l={name:a.name,options:a.options,storage:a.storage},c=Ye(a,"addAttributes",l);if(!c)return;const u=c();Object.entries(u).forEach(([d,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:a.name,name:d,attribute:f})})}),e}function Gr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function mr(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const l=i?String(i).split(" "):[],c=r[s]?r[s].split(" "):[],u=l.filter(d=>!c.includes(d));r[s]=[...c,...u].join(" ")}else if(s==="style"){const l=i?i.split(";").map(d=>d.trim()).filter(Boolean):[],c=r[s]?r[s].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;c.forEach(d=>{const[h,f]=d.split(":").map(p=>p.trim());u.set(h,f)}),l.forEach(d=>{const[h,f]=d.split(":").map(p=>p.trim());u.set(h,f)}),r[s]=Array.from(u.entries()).map(([d,h])=>`${d}: ${h}`).join("; ")}else r[s]=i}),r},{})}function qC(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>mr(n,r),{})}function Hq(t){return typeof t=="function"}function xt(t,e=void 0,...n){return Hq(t)?e?t.bind(e)(...n):t(...n):t}function pme(t={}){return Object.keys(t).length===0&&t.constructor===Object}function mme(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function JL(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,a)=>{const l=a.attribute.parseHTML?a.attribute.parseHTML(n):mme(n.getAttribute(a.name));return l==null?i:{...i,[a.name]:l}},{});return{...r,...s}}}}function ZL(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&pme(n)?!1:n!=null))}function gme(t,e){var n;const r=zq(t),{nodeExtensions:s,markExtensions:i}=UN(t),a=(n=s.find(u=>Ye(u,"topNode")))===null||n===void 0?void 0:n.name,l=Object.fromEntries(s.map(u=>{const d=r.filter(x=>x.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((x,w)=>{const N=Ye(w,"extendNodeSchema",h);return{...x,...N?N(u):{}}},{}),p=ZL({...f,content:xt(Ye(u,"content",h)),marks:xt(Ye(u,"marks",h)),group:xt(Ye(u,"group",h)),inline:xt(Ye(u,"inline",h)),atom:xt(Ye(u,"atom",h)),selectable:xt(Ye(u,"selectable",h)),draggable:xt(Ye(u,"draggable",h)),code:xt(Ye(u,"code",h)),whitespace:xt(Ye(u,"whitespace",h)),linebreakReplacement:xt(Ye(u,"linebreakReplacement",h)),defining:xt(Ye(u,"defining",h)),isolating:xt(Ye(u,"isolating",h)),attrs:Object.fromEntries(d.map(x=>{var w;return[x.name,{default:(w=x==null?void 0:x.attribute)===null||w===void 0?void 0:w.default}]}))}),m=xt(Ye(u,"parseHTML",h));m&&(p.parseDOM=m.map(x=>JL(x,d)));const g=Ye(u,"renderHTML",h);g&&(p.toDOM=x=>g({node:x,HTMLAttributes:qC(x,d)}));const y=Ye(u,"renderText",h);return y&&(p.toText=y),[u.name,p]})),c=Object.fromEntries(i.map(u=>{const d=r.filter(y=>y.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((y,x)=>{const w=Ye(x,"extendMarkSchema",h);return{...y,...w?w(u):{}}},{}),p=ZL({...f,inclusive:xt(Ye(u,"inclusive",h)),excludes:xt(Ye(u,"excludes",h)),group:xt(Ye(u,"group",h)),spanning:xt(Ye(u,"spanning",h)),code:xt(Ye(u,"code",h)),attrs:Object.fromEntries(d.map(y=>{var x;return[y.name,{default:(x=y==null?void 0:y.attribute)===null||x===void 0?void 0:x.default}]}))}),m=xt(Ye(u,"parseHTML",h));m&&(p.parseDOM=m.map(y=>JL(y,d)));const g=Ye(u,"renderHTML",h);return g&&(p.toDOM=y=>g({mark:y,HTMLAttributes:qC(y,d)})),[u.name,p]}));return new kW({topNode:a,nodes:l,marks:c})}function fj(t,e){return e.nodes[t]||e.marks[t]||null}function eF(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function HI(t,e){const n=_h.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}const yme=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,a,l)=>{var c,u;const d=((u=(c=s.type.spec).toText)===null||u===void 0?void 0:u.call(c,{node:s,pos:i,parent:a,index:l}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?d:d.slice(0,Math.max(0,r-i))}),n};function WI(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class zN{constructor(e){this.find=e.find,this.handler=e.handler}}const vme=(t,e)=>{if(WI(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Vx(t){var e;const{editor:n,from:r,to:s,text:i,rules:a,plugin:l}=t,{view:c}=n;if(c.composing)return!1;const u=c.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let d=!1;const h=yme(u)+i;return a.forEach(f=>{if(d)return;const p=vme(h,f.find);if(!p)return;const m=c.state.tr,g=VN({state:c.state,transaction:m}),y={from:r-(p[0].length-i.length),to:s},{commands:x,chain:w,can:N}=new $N({editor:n,state:g});f.handler({state:g,range:y,match:p,commands:x,chain:w,can:N})===null||!m.steps.length||(m.setMeta(l,{transform:m,from:r,to:s,text:i}),c.dispatch(m),d=!0)}),d}function xme(t){const{editor:e,rules:n}=t,r=new Ar({state:{init(){return null},apply(s,i,a){const l=s.getMeta(r);if(l)return l;const c=s.getMeta("applyInputRules");return!!c&&setTimeout(()=>{let{text:d}=c;typeof d=="string"?d=d:d=HI(we.from(d),a.schema);const{from:h}=c,f=h+d.length;Vx({editor:e,from:h,to:f,text:d,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,a,l){return Vx({editor:e,from:i,to:a,text:l,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Vx({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:a}=s.state.selection;return a?Vx({editor:e,from:a.pos,to:a.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function bme(t){return Object.prototype.toString.call(t).slice(8,-1)}function $x(t){return bme(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function HN(t,e){const n={...t};return $x(t)&&$x(e)&&Object.keys(e).forEach(r=>{$x(e[r])&&$x(t[r])?n[r]=HN(t[r],e[r]):n[r]=e[r]}),n}class Do{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=xt(Ye(this,"addOptions",{name:this.name}))),this.storage=xt(Ye(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Do(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>HN(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Do(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=xt(Ye(n,"addOptions",{name:n.name})),n.storage=xt(Ye(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(u=>(u==null?void 0:u.type.name)===n.name))return!1;const c=a.find(u=>(u==null?void 0:u.type.name)===n.name);return c&&r.removeStoredMark(c),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function wme(t){return typeof t=="number"}class Wq{constructor(e){this.find=e.find,this.handler=e.handler}}const Nme=(t,e,n)=>{if(WI(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function Sme(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:a,dropEvent:l}=t,{commands:c,chain:u,can:d}=new $N({editor:e,state:n}),h=[];return n.doc.nodesBetween(r,s,(p,m)=>{if(!p.isTextblock||p.type.spec.code)return;const g=Math.max(r,m),y=Math.min(s,m+p.content.size),x=p.textBetween(g-m,y-m,void 0,"");Nme(x,i.find,a).forEach(N=>{if(N.index===void 0)return;const S=g+N.index+1,C=S+N[0].length,A={from:n.tr.mapping.map(S),to:n.tr.mapping.map(C)},j=i.handler({state:n,range:A,match:N,commands:c,chain:u,can:d,pasteEvent:a,dropEvent:l});h.push(j)})}),h.every(p=>p!==null)}let Ux=null;const _me=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function jme(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const c=({state:d,from:h,to:f,rule:p,pasteEvt:m})=>{const g=d.tr,y=VN({state:d,transaction:g});if(!(!Sme({editor:e,state:y,from:Math.max(h-1,0),to:f.b-1,rule:p,pasteEvent:m,dropEvent:l})||!g.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return n.map(d=>new Ar({view(h){const f=m=>{var g;r=!((g=h.dom.parentElement)===null||g===void 0)&&g.contains(m.target)?h.dom.parentElement:null,r&&(Ux=e)},p=()=>{Ux&&(Ux=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=r===h.dom.parentElement,l=f,!i){const p=Ux;p!=null&&p.isEditable&&setTimeout(()=>{const m=p.state.selection;m&&p.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(h,f)=>{var p;const m=(p=f.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return a=f,s=!!(m!=null&&m.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,p)=>{const m=h[0],g=m.getMeta("uiEvent")==="paste"&&!s,y=m.getMeta("uiEvent")==="drop"&&!i,x=m.getMeta("applyPasteRules"),w=!!x;if(!g&&!y&&!w)return;if(w){let{text:C}=x;typeof C=="string"?C=C:C=HI(we.from(C),p.schema);const{from:A}=x,j=A+C.length,_=_me(C);return c({rule:d,state:p,from:A,to:{b:j},pasteEvt:_})}const N=f.doc.content.findDiffStart(p.doc.content),S=f.doc.content.findDiffEnd(p.doc.content);if(!(!wme(N)||!S||N===S.b))return c({rule:d,state:p,from:N,to:S,pasteEvt:a})}}))}function Eme(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class gf{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=gf.resolve(e),this.schema=gme(this.extensions,n),this.setupExtensions()}static resolve(e){const n=gf.sort(gf.flatten(e)),r=Eme(n.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=Ye(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=Ye(r,"priority")||100,a=Ye(s,"priority")||100;return i>a?-1:i<a?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:fj(n.name,this.schema)},s=Ye(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=gf.sort([...this.extensions].reverse()),r=[],s=[],i=n.map(a=>{const l={name:a.name,options:a.options,storage:a.storage,editor:e,type:fj(a.name,this.schema)},c=[],u=Ye(a,"addKeyboardShortcuts",l);let d={};if(a.type==="mark"&&Ye(a,"exitable",l)&&(d.ArrowRight=()=>Do.handleExit({editor:e,mark:a})),u){const g=Object.fromEntries(Object.entries(u()).map(([y,x])=>[y,()=>x({editor:e})]));d={...d,...g}}const h=qpe(d);c.push(h);const f=Ye(a,"addInputRules",l);eF(a,e.options.enableInputRules)&&f&&r.push(...f());const p=Ye(a,"addPasteRules",l);eF(a,e.options.enablePasteRules)&&p&&s.push(...p());const m=Ye(a,"addProseMirrorPlugins",l);if(m){const g=m();c.push(...g)}return c}).flat();return[xme({editor:e,rules:r}),...jme({editor:e,rules:s}),...i]}get attributes(){return zq(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=UN(this.extensions);return Object.fromEntries(n.filter(r=>!!Ye(r,"addNodeView")).map(r=>{const s=this.attributes.filter(c=>c.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:Gr(r.name,this.schema)},a=Ye(r,"addNodeView",i);if(!a)return[];const l=(c,u,d,h,f)=>{const p=qC(c,s);return a()({node:c,view:u,getPos:d,decorations:h,innerDecorations:f,editor:e,extension:r,HTMLAttributes:p})};return[r.name,l]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:fj(e.name,this.schema)};e.type==="mark"&&(!((n=xt(Ye(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=Ye(e,"onBeforeCreate",r),i=Ye(e,"onCreate",r),a=Ye(e,"onUpdate",r),l=Ye(e,"onSelectionUpdate",r),c=Ye(e,"onTransaction",r),u=Ye(e,"onFocus",r),d=Ye(e,"onBlur",r),h=Ye(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),a&&this.editor.on("update",a),l&&this.editor.on("selectionUpdate",l),c&&this.editor.on("transaction",c),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),h&&this.editor.on("destroy",h)})}}class Kr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=xt(Ye(this,"addOptions",{name:this.name}))),this.storage=xt(Ye(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Kr(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>HN(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Kr({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=xt(Ye(n,"addOptions",{name:n.name})),n.storage=xt(Ye(n,"addStorage",{name:n.name,options:n.options})),n}}function qq(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:a={}}=n||{};let l="";return t.nodesBetween(r,s,(c,u,d,h)=>{var f;c.isBlock&&u>r&&(l+=i);const p=a==null?void 0:a[c.type.name];if(p)return d&&(l+=p({node:c,pos:u,parent:d,index:h,range:e})),!1;c.isText&&(l+=(f=c==null?void 0:c.text)===null||f===void 0?void 0:f.slice(Math.max(r,u)-u,s-u))}),l}function Gq(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const Cme=Kr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Ar({key:new Zs("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,a=Math.min(...i.map(d=>d.$from.pos)),l=Math.max(...i.map(d=>d.$to.pos)),c=Gq(n);return qq(r,{from:a,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),Tme=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Ame=(t=!1)=>({commands:e})=>e.setContent("",t),kme=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:a})=>{t.doc.nodesBetween(i.pos,a.pos,(l,c)=>{if(l.type.isText)return;const{doc:u,mapping:d}=e,h=u.resolve(d.map(c)),f=u.resolve(d.map(c+l.nodeSize)),p=h.blockRange(f);if(!p)return;const m=Kp(p);if(l.type.isTextblock){const{defaultType:g}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(p.start,g)}(m||m===0)&&e.lift(p,m)})}),!0},Ime=t=>e=>t(e),Pme=()=>({state:t,dispatch:e})=>Bq(t,e),Ome=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const a=r.mapping.map(e);return r.insert(a,i.content),r.setSelection(new pt(r.doc.resolve(Math.max(a-1,0)))),!0},Dme=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const l=s.before(i),c=s.after(i);t.delete(l,c).scrollIntoView()}return!0}return!1},Rme=t=>({tr:e,state:n,dispatch:r})=>{const s=Gr(t,n.schema),i=e.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===s){if(r){const c=i.before(a),u=i.after(a);e.delete(c,u).scrollIntoView()}return!0}return!1},Mme=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},Lme=()=>({state:t,dispatch:e})=>BI(t,e),Fme=()=>({commands:t})=>t.keyboardShortcut("Enter"),Bme=()=>({state:t,dispatch:e})=>Jpe(t,e);function cw(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:WI(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function Kq(t,e,n={}){return t.find(r=>r.type===e&&cw(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function tF(t,e,n={}){return!!Kq(t,e,n)}function qI(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(d=>d.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(d=>d.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!Kq([...s.node.marks],e,n)))return;let a=s.index,l=t.start()+s.offset,c=a+1,u=l+s.node.nodeSize;for(;a>0&&tF([...t.parent.child(a-1).marks],e,n);)a-=1,l-=t.parent.child(a).nodeSize;for(;c<t.parent.childCount&&tF([...t.parent.child(c).marks],e,n);)u+=t.parent.child(c).nodeSize,c+=1;return{from:l,to:u}}function Ru(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Vme=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=Ru(t,r.schema),{doc:a,selection:l}=n,{$from:c,from:u,to:d}=l;if(s){const h=qI(c,i,e);if(h&&h.from<=u&&h.to>=d){const f=pt.create(a,h.from,h.to);n.setSelection(f)}}return!0},$me=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function GI(t){return t instanceof pt}function fl(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Yq(t,e=null){if(!e)return null;const n=jt.atStart(t),r=jt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?pt.create(t,fl(0,s,i),fl(t.content.size,s,i)):pt.create(t,fl(e,s,i),fl(e,s,i))}function nF(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function uw(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Ume(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}const zme=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const a=()=>{(uw()||nF())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),Ume()&&!uw()&&!nF()&&r.dom.focus({preventScroll:!0}))})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!GI(n.state.selection))return a(),!0;const l=Yq(s.doc,t)||n.state.selection,c=n.state.selection.eq(l);return i&&(c||s.setSelection(l),c&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},Hme=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),Wme=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),Qq=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&Qq(r)}return t};function zx(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return Qq(n)}function Sy(t,e,n){if(t instanceof Yc||t instanceof we)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return we.fromArray(t.map(l=>e.nodeFromJSON(l)));const a=e.nodeFromJSON(t);return n.errorOnInvalidContent&&a.check(),a}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),Sy("",e,n)}if(s){if(n.errorOnInvalidContent){let a=!1,l="";const c=new kW({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(a=!0,l=typeof u=="string"?u:u.outerHTML,null)}]}})});if(n.slice?Qc.fromSchema(c).parseSlice(zx(t),n.parseOptions):Qc.fromSchema(c).parse(zx(t),n.parseOptions),n.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const i=Qc.fromSchema(e);return n.slice?i.parseSlice(zx(t),n.parseOptions).content:i.parse(zx(t),n.parseOptions)}return Sy("",e,n)}function qme(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof Br||s instanceof zr))return;const i=t.mapping.maps[r];let a=0;i.forEach((l,c,u,d)=>{a===0&&(a=d)}),t.setSelection(jt.near(t.doc.resolve(a),n))}const Gme=t=>!("type"in t),Kme=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var a;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let l;const c=y=>{i.emit("contentError",{editor:i,error:y,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{Sy(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(y){c(y)}try{l=Sy(e,i.schema,{parseOptions:u,errorOnInvalidContent:(a=n.errorOnInvalidContent)!==null&&a!==void 0?a:i.options.enableContentCheck})}catch(y){return c(y),!1}let{from:d,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,p=!0;if((Gme(l)?l:[l]).forEach(y=>{y.check(),f=f?y.isText&&y.marks.length===0:!1,p=p?y.isBlock:!1}),d===h&&p){const{parent:y}=r.doc.resolve(d);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(d-=1,h+=1)}let g;if(f){if(Array.isArray(e))g=e.map(y=>y.text||"").join("");else if(e instanceof we){let y="";e.forEach(x=>{x.text&&(y+=x.text)}),g=y}else typeof e=="object"&&e&&e.text?g=e.text:g=e;r.insertText(g,d,h)}else g=l,r.replaceWith(d,h,g);n.updateSelection&&qme(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:g}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:g})}return!0},Yme=()=>({state:t,dispatch:e})=>Ype(t,e),Qme=()=>({state:t,dispatch:e})=>Qpe(t,e),Xme=()=>({state:t,dispatch:e})=>Pq(t,e),Jme=()=>({state:t,dispatch:e})=>Mq(t,e),Zme=()=>({state:t,dispatch:e,tr:n})=>{try{const r=DN(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},ege=()=>({state:t,dispatch:e,tr:n})=>{try{const r=DN(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},tge=()=>({state:t,dispatch:e})=>Gpe(t,e),nge=()=>({state:t,dispatch:e})=>Kpe(t,e);function Xq(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function rge(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,a;for(let l=0;l<e.length-1;l+=1){const c=e[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))i=!0;else if(/^mod$/i.test(c))uw()||Xq()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),a&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}const sge=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=rge(t).split(/-(?!$)/),a=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),l=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction(()=>{n.someProp("handleKeyDown",u=>u(n,l))});return c==null||c.steps.forEach(u=>{const d=u.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function _y(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,a=e?Gr(e,t.schema):null,l=[];t.doc.nodesBetween(r,s,(h,f)=>{if(h.isText)return;const p=Math.max(r,f),m=Math.min(s,f+h.nodeSize);l.push({node:h,from:p,to:m})});const c=s-r,u=l.filter(h=>a?a.name===h.node.type.name:!0).filter(h=>cw(h.node.attrs,n,{strict:!1}));return i?!!u.length:u.reduce((h,f)=>h+f.to-f.from,0)>=c}const ige=(t,e={})=>({state:n,dispatch:r})=>{const s=Gr(t,n.schema);return _y(n,s,e)?Xpe(n,r):!1},age=()=>({state:t,dispatch:e})=>Vq(t,e),oge=t=>({state:e,dispatch:n})=>{const r=Gr(t,e.schema);return cme(r)(e,n)},lge=()=>({state:t,dispatch:e})=>Fq(t,e);function WN(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function rF(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const cge=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,a=null;const l=WN(typeof t=="string"?t:t.name,r.schema);return l?(l==="node"&&(i=Gr(t,r.schema)),l==="mark"&&(a=Ru(t,r.schema)),s&&n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{i&&i===u.type&&n.setNodeMarkup(d,void 0,rF(u.attrs,e)),a&&u.marks.length&&u.marks.forEach(h=>{a===h.type&&n.addMark(d,d+u.nodeSize,a.create(rF(h.attrs,e)))})})}),!0):!1},uge=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),dge=()=>({tr:t,dispatch:e})=>{if(e){const n=new Vi(t.doc);t.setSelection(n)}return!0},hge=()=>({state:t,dispatch:e})=>Dq(t,e),fge=()=>({state:t,dispatch:e})=>Lq(t,e),pge=()=>({state:t,dispatch:e})=>tme(t,e),mge=()=>({state:t,dispatch:e})=>sme(t,e),gge=()=>({state:t,dispatch:e})=>rme(t,e);function GC(t,e,n={},r={}){return Sy(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const yge=(t,e=!1,n={},r={})=>({editor:s,tr:i,dispatch:a,commands:l})=>{var c,u;const{doc:d}=i;if(n.preserveWhitespace!=="full"){const h=GC(t,s.schema,n,{errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:s.options.enableContentCheck});return a&&i.replaceWith(0,d.content.size,h).setMeta("preventUpdate",!e),!0}return a&&i.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function Jq(t,e){const n=Ru(e,t.schema),{from:r,to:s,empty:i}=t.selection,a=[];i?(t.storedMarks&&a.push(...t.storedMarks),a.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,c=>{a.push(...c.marks)});const l=a.find(c=>c.type.name===n.name);return l?{...l.attrs}:{}}function vge(t,e){const n=new qW(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function xge(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function bge(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function wge(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function KI(t){return e=>wge(e.$from,t)}function Nge(t,e){const n={from:0,to:t.content.size};return qq(t,n,e)}function Sge(t,e){const n=Gr(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,l=>{i.push(l)});const a=i.reverse().find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function Zq(t,e){const n=WN(typeof e=="string"?e:e.name,t.schema);return n==="node"?Sge(t,e):n==="mark"?Jq(t,e):{}}function _ge(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function jge(t){const e=_ge(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,a)=>a!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function Ege(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const a=[];if(s.ranges.length)s.forEach((l,c)=>{a.push({from:l,to:c})});else{const{from:l,to:c}=n[i];if(l===void 0||c===void 0)return;a.push({from:l,to:c})}a.forEach(({from:l,to:c})=>{const u=e.slice(i).map(l,-1),d=e.slice(i).map(c),h=e.invert().map(u,-1),f=e.invert().map(d);r.push({oldRange:{from:h,to:f},newRange:{from:u,to:d}})})}),jge(r)}function YI(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),a=qI(i,s.type);a&&r.push({mark:s,...a})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(a=>({from:i,to:i+s.nodeSize,mark:a})))}),r}function U0(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function KC(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?Ru(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>cw(h.attrs,n,{strict:!1}));let a=0;const l=[];if(s.forEach(({$from:h,$to:f})=>{const p=h.pos,m=f.pos;t.doc.nodesBetween(p,m,(g,y)=>{if(!g.isText&&!g.marks.length)return;const x=Math.max(p,y),w=Math.min(m,y+g.nodeSize),N=w-x;a+=N,l.push(...g.marks.map(S=>({mark:S,from:x,to:w})))})}),a===0)return!1;const c=l.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>cw(h.mark.attrs,n,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),u=l.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(c>0?c+u:c)>=a}function Cge(t,e,n={}){if(!e)return _y(t,null,n)||KC(t,null,n);const r=WN(e,t.schema);return r==="node"?_y(t,e,n):r==="mark"?KC(t,e,n):!1}function sF(t,e){const{nodeExtensions:n}=UN(e),r=n.find(a=>a.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=xt(Ye(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function qN(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(qN(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function e9(t){return t instanceof nt}function Tge(t,e,n){const s=t.state.doc.content.size,i=fl(e,0,s),a=fl(n,0,s),l=t.coordsAtPos(i),c=t.coordsAtPos(a,-1),u=Math.min(l.top,c.top),d=Math.max(l.bottom,c.bottom),h=Math.min(l.left,c.left),f=Math.max(l.right,c.right),p=f-h,m=d-u,x={top:u,bottom:d,left:h,right:f,width:p,height:m,x:h,y:u};return{...x,toJSON:()=>x}}function Age(t,e,n){var r;const{selection:s}=e;let i=null;if(GI(s)&&(i=s.$cursor),i){const l=(r=t.storedMarks)!==null&&r!==void 0?r:i.marks();return!!n.isInSet(l)||!l.some(c=>c.type.excludes(n))}const{ranges:a}=s;return a.some(({$from:l,$to:c})=>{let u=l.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(l.pos,c.pos,(d,h,f)=>{if(u)return!1;if(d.isInline){const p=!f||f.type.allowsMarkType(n),m=!!n.isInSet(d.marks)||!d.marks.some(g=>g.type.excludes(n));u=p&&m}return!u}),u})}const kge=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:a,ranges:l}=i,c=Ru(t,r.schema);if(s)if(a){const u=Jq(r,c);n.addStoredMark(c.create({...u,...e}))}else l.forEach(u=>{const d=u.$from.pos,h=u.$to.pos;r.doc.nodesBetween(d,h,(f,p)=>{const m=Math.max(p,d),g=Math.min(p+f.nodeSize,h);f.marks.find(x=>x.type===c)?f.marks.forEach(x=>{c===x.type&&n.addMark(m,g,c.create({...x.attrs,...e}))}):n.addMark(m,g,c.create(e))})});return Age(r,n,c)},Ige=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Pge=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Gr(t,n.schema);let a;return n.selection.$anchor.sameParent(n.selection.$head)&&(a=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:l})=>XL(i,{...a,...e})(n)?!0:l.clearNodes()).command(({state:l})=>XL(i,{...a,...e})(l,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Oge=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=fl(t,0,r.content.size),i=nt.create(r,s);e.setSelection(i)}return!0},Dge=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,a=pt.atStart(r).from,l=pt.atEnd(r).to,c=fl(s,a,l),u=fl(i,a,l),d=pt.create(r,c,u);e.setSelection(d)}return!0},Rge=t=>({state:e,dispatch:n})=>{const r=Gr(t,e.schema);return hme(r)(e,n)};function iF(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}const Mge=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:a}=e,{$from:l,$to:c}=i,u=s.extensionManager.attributes,d=U0(u,l.node().type.name,l.node().attrs);if(i instanceof nt&&i.node.isBlock)return!l.parentOffset||!xl(a,l.pos)?!1:(r&&(t&&iF(n,s.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const h=c.parentOffset===c.parent.content.size,f=l.depth===0?void 0:xge(l.node(-1).contentMatchAt(l.indexAfter(-1)));let p=h&&f?[{type:f,attrs:d}]:void 0,m=xl(e.doc,e.mapping.map(l.pos),1,p);if(!p&&!m&&xl(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(m=!0,p=f?[{type:f,attrs:d}]:void 0),r){if(m&&(i instanceof pt&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,p),f&&!h&&!l.parentOffset&&l.parent.type!==f)){const g=e.mapping.map(l.before()),y=e.doc.resolve(g);l.node(-1).canReplaceWith(y.index(),y.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}t&&iF(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},Lge=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var a;const l=Gr(t,r.schema),{$from:c,$to:u}=r.selection,d=r.selection.node;if(d&&d.isBlock||c.depth<2||!c.sameParent(u))return!1;const h=c.node(-1);if(h.type!==l)return!1;const f=i.extensionManager.attributes;if(c.parent.content.size===0&&c.node(-1).childCount===c.indexAfter(-1)){if(c.depth===2||c.node(-3).type!==l||c.index(-2)!==c.node(-2).childCount-1)return!1;if(s){let x=we.empty;const w=c.index(-1)?1:c.index(-2)?2:3;for(let _=c.depth-w;_>=c.depth-3;_-=1)x=we.from(c.node(_).copy(x));const N=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3,S={...U0(f,c.node().type.name,c.node().attrs),...e},C=((a=l.contentMatch.defaultType)===null||a===void 0?void 0:a.createAndFill(S))||void 0;x=x.append(we.from(l.createAndFill(null,C)||void 0));const A=c.before(c.depth-(w-1));n.replace(A,c.after(-N),new Ve(x,4-w,0));let j=-1;n.doc.nodesBetween(A,n.doc.content.size,(_,E)=>{if(j>-1)return!1;_.isTextblock&&_.content.size===0&&(j=E+1)}),j>-1&&n.setSelection(pt.near(n.doc.resolve(j))),n.scrollIntoView()}return!0}const p=u.pos===c.end()?h.contentMatchAt(0).defaultType:null,m={...U0(f,h.type.name,h.attrs),...e},g={...U0(f,c.node().type.name,c.node().attrs),...e};n.delete(c.pos,u.pos);const y=p?[{type:l,attrs:m},{type:p,attrs:g}]:[{type:l,attrs:m}];if(!xl(n.doc,c.pos,2))return!1;if(s){const{selection:x,storedMarks:w}=r,{splittableMarks:N}=i.extensionManager,S=w||x.$to.parentOffset&&x.$from.marks();if(n.split(c.pos,2,y).scrollIntoView(),!S||!s)return!0;const C=S.filter(A=>N.includes(A.type.name));n.ensureMarks(C)}return!0},pj=(t,e)=>{const n=KI(a=>a.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Ou(t.doc,n.pos)&&t.join(n.pos),!0},mj=(t,e)=>{const n=KI(a=>a.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Ou(t.doc,r)&&t.join(r),!0},Fge=(t,e,n,r={})=>({editor:s,tr:i,state:a,dispatch:l,chain:c,commands:u,can:d})=>{const{extensions:h,splittableMarks:f}=s.extensionManager,p=Gr(t,a.schema),m=Gr(e,a.schema),{selection:g,storedMarks:y}=a,{$from:x,$to:w}=g,N=x.blockRange(w),S=y||g.$to.parentOffset&&g.$from.marks();if(!N)return!1;const C=KI(A=>sF(A.type.name,h))(g);if(N.depth>=1&&C&&N.depth-C.depth<=1){if(C.node.type===p)return u.liftListItem(m);if(sF(C.node.type.name,h)&&p.validContent(C.node.content)&&l)return c().command(()=>(i.setNodeMarkup(C.pos,p),!0)).command(()=>pj(i,p)).command(()=>mj(i,p)).run()}return!n||!S||!l?c().command(()=>d().wrapInList(p,r)?!0:u.clearNodes()).wrapInList(p,r).command(()=>pj(i,p)).command(()=>mj(i,p)).run():c().command(()=>{const A=d().wrapInList(p,r),j=S.filter(_=>f.includes(_.type.name));return i.ensureMarks(j),A?!0:u.clearNodes()}).wrapInList(p,r).command(()=>pj(i,p)).command(()=>mj(i,p)).run()},Bge=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,a=Ru(t,r.schema);return KC(r,a,e)?s.unsetMark(a,{extendEmptyMarkRange:i}):s.setMark(a,e)},Vge=(t,e,n={})=>({state:r,commands:s})=>{const i=Gr(t,r.schema),a=Gr(e,r.schema),l=_y(r,i,n);let c;return r.selection.$anchor.sameParent(r.selection.$head)&&(c=r.selection.$anchor.parent.attrs),l?s.setNode(a,c):s.setNode(i,{...c,...n})},$ge=(t,e={})=>({state:n,commands:r})=>{const s=Gr(t,n.schema);return _y(n,s,e)?r.lift(s):r.wrapIn(s,e)},Uge=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const a=t.tr,l=i.transform;for(let c=l.steps.length-1;c>=0;c-=1)a.step(l.steps[c].invert(l.docs[c]));if(i.text){const c=a.doc.resolve(i.from).marks();a.replaceWith(i.from,i.to,t.schema.text(i.text,c))}else a.delete(i.from,i.to)}return!0}}return!1},zge=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},Hge=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:a=!1}=e,{selection:l}=n,c=Ru(t,r.schema),{$from:u,empty:d,ranges:h}=l;if(!s)return!0;if(d&&a){let{from:f,to:p}=l;const m=(i=u.marks().find(y=>y.type===c))===null||i===void 0?void 0:i.attrs,g=qI(u,c,m);g&&(f=g.from,p=g.to),n.removeMark(f,p,c)}else h.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,c)});return n.removeStoredMark(c),!0},Wge=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,a=null;const l=WN(typeof t=="string"?t:t.name,r.schema);return l?(l==="node"&&(i=Gr(t,r.schema)),l==="mark"&&(a=Ru(t,r.schema)),s&&n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(g,y)=>{i&&i===g.type&&(p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):r.doc.nodesBetween(u,d,(g,y)=>{y<u&&i&&i===g.type&&(p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(i&&i===g.type&&n.setNodeMarkup(y,void 0,{...g.attrs,...e}),a&&g.marks.length&&g.marks.forEach(x=>{if(a===x.type){const w=Math.max(y,u),N=Math.min(y+g.nodeSize,d);n.addMark(w,N,a.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&n.setNodeMarkup(h,void 0,{...f.attrs,...e}),a&&f.marks.length&&f.marks.forEach(g=>{a===g.type&&n.addMark(p,m,a.create({...g.attrs,...e}))}))}),!0):!1},qge=(t,e={})=>({state:n,dispatch:r})=>{const s=Gr(t,n.schema);return ime(s,e)(n,r)},Gge=(t,e={})=>({state:n,dispatch:r})=>{const s=Gr(t,n.schema);return ame(s,e)(n,r)};var Kge=Object.freeze({__proto__:null,blur:Tme,clearContent:Ame,clearNodes:kme,command:Ime,createParagraphNear:Pme,cut:Ome,deleteCurrentNode:Dme,deleteNode:Rme,deleteRange:Mme,deleteSelection:Lme,enter:Fme,exitCode:Bme,extendMarkRange:Vme,first:$me,focus:zme,forEach:Hme,insertContent:Wme,insertContentAt:Kme,joinBackward:Xme,joinDown:Qme,joinForward:Jme,joinItemBackward:Zme,joinItemForward:ege,joinTextblockBackward:tge,joinTextblockForward:nge,joinUp:Yme,keyboardShortcut:sge,lift:ige,liftEmptyBlock:age,liftListItem:oge,newlineInCode:lge,resetAttributes:cge,scrollIntoView:uge,selectAll:dge,selectNodeBackward:hge,selectNodeForward:fge,selectParentNode:pge,selectTextblockEnd:mge,selectTextblockStart:gge,setContent:yge,setMark:kge,setMeta:Ige,setNode:Pge,setNodeSelection:Oge,setTextSelection:Dge,sinkListItem:Rge,splitBlock:Mge,splitListItem:Lge,toggleList:Fge,toggleMark:Bge,toggleNode:Vge,toggleWrap:$ge,undoInputRule:Uge,unsetAllMarks:zge,unsetMark:Hge,updateAttributes:Wge,wrapIn:qge,wrapInList:Gge});const Yge=Kr.create({name:"commands",addCommands(){return{...Kge}}}),Qge=Kr.create({name:"drop",addProseMirrorPlugins(){return[new Ar({key:new Zs("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),Xge=Kr.create({name:"editable",addProseMirrorPlugins(){return[new Ar({key:new Zs("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Jge=new Zs("focusEvents"),Zge=Kr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Ar({key:Jge,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),eye=Kr.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:l})=>{const{selection:c,doc:u}=l,{empty:d,$anchor:h}=c,{pos:f,parent:p}=h,m=h.parent.isTextblock&&f>0?l.doc.resolve(f-1):h,g=m.parent.type.spec.isolating,y=h.pos-h.parentOffset,x=g&&m.parent.childCount===1?y===h.pos:jt.atStart(u).from===f;return!d||!p.type.isTextblock||p.textContent.length||!x||x&&h.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return uw()||Xq()?i:s},addProseMirrorPlugins(){return[new Ar({key:new Zs("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(g=>g.getMeta("composition")))return;const r=t.some(g=>g.docChanged)&&!e.doc.eq(n.doc),s=t.some(g=>g.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:a,to:l}=e.selection,c=jt.atStart(e.doc).from,u=jt.atEnd(e.doc).to;if(i||!(a===c&&l===u)||!qN(n.doc))return;const f=n.tr,p=VN({state:n,transaction:f}),{commands:m}=new $N({editor:this.editor,state:p});if(m.clearNodes(),!!f.steps.length)return f}})]}}),tye=Kr.create({name:"paste",addProseMirrorPlugins(){return[new Ar({key:new Zs("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),nye=Kr.create({name:"tabindex",addProseMirrorPlugins(){return[new Ar({key:new Zs("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class ad{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new ad(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ad(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ad(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,a=this.pos+r+(i?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(a);if(!s&&l.depth<=this.depth)return;const c=new ad(l,this.editor,s,s?n:null);s&&(c.actualDepth=this.depth+1),e.push(new ad(l,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,a=Object.keys(n);for(let l=0;l<a.length;l+=1){const c=a[l];if(i[c]!==n[c])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(a=>{r&&s.length>0||(a.node.type.name===e&&i.every(c=>n[c]===a.node.attrs[c])&&s.push(a),!(r&&s.length>0)&&(s=s.concat(a.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const rye=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function sye(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}class iye extends fme{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:s})=>this.options.onDrop(n,r,s)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=sye(rye,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=Hq(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;r=r.filter(l=>!l.key.startsWith(a))}),n.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,n;const s=[...this.options.enableCoreExtensions?[Xge,Cme.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),Yge,Zge,eye,nye,Qge,tye].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new gf(s,this)}createCommandManager(){this.commandManager=new $N({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=GC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(a){if(!(a instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(a.message))throw a;this.emit("contentError",{editor:this,error:a,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(l=>l.name!=="collaboration"),this.createExtensionManager()}}),n=GC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=Yq(n,this.options.autofocus);this.view=new Aq(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:mf.create({doc:n,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(a=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(a)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Zq(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,s=typeof e=="string"?n:e;return Cge(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return HI(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Nge(this.state.doc,{blockSeparator:n,textSerializers:{...Gq(this.schema),...r}})}get isEmpty(){return qN(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new ad(n,this)}get $doc(){return this.$pos(0)}}function dp(t){return new zN({find:t.find,handler:({state:e,range:n,match:r})=>{const s=xt(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,a=r[r.length-1],l=r[0];if(a){const c=l.search(/\S/),u=n.from+l.indexOf(a),d=u+a.length;if(YI(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>u).length)return null;d<n.to&&i.delete(d,n.to),u>n.from&&i.delete(n.from+c,u);const f=n.from+c+a.length;i.addMark(n.from+c,f,t.type.create(s||{})),i.removeStoredMark(t.type)}}})}function t9(t){return new zN({find:t.find,handler:({state:e,range:n,match:r})=>{const s=xt(t.getAttributes,void 0,r)||{},{tr:i}=e,a=n.from;let l=n.to;const c=t.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let d=a+u;d>l?d=l:l=d+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,a+r[0].length-1),i.replaceWith(d,l,c)}else if(r[0]){const u=t.type.isInline?a:a-1;i.insert(u,t.type.create(s)).delete(i.mapping.map(a),i.mapping.map(l))}i.scrollIntoView()}})}function YC(t){return new zN({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=xt(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function jy(t){return new zN({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=xt(t.getAttributes,void 0,r)||{},a=e.tr.delete(n.from,n.to),c=a.doc.resolve(n.from).blockRange(),u=c&&TI(c,t.type,i);if(!u)return null;if(a.wrap(c,u),t.keepMarks&&t.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:p}=t.editor.extensionManager,m=f||h.$to.parentOffset&&h.$from.marks();if(m){const g=m.filter(y=>p.includes(y.type.name));a.ensureMarks(g)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const d=a.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Ou(a.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&a.join(n.from-1)}})}class Ls{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=xt(Ye(this,"addOptions",{name:this.name}))),this.storage=xt(Ye(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ls(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>HN(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Ls(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=xt(Ye(n,"addOptions",{name:n.name})),n.storage=xt(Ye(n,"addStorage",{name:n.name,options:n.options})),n}}function nh(t){return new Wq({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=xt(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:a}=e,l=r[r.length-1],c=r[0];let u=n.to;if(l){const d=c.search(/\S/),h=n.from+c.indexOf(l),f=h+l.length;if(YI(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(y=>y===t.type&&y!==m.mark.type)).filter(m=>m.to>h).length)return null;f<n.to&&a.delete(f,n.to),h>n.from&&a.delete(n.from+d,h),u=n.from+d+l.length,a.addMark(n.from+d,u,t.type.create(i||{})),a.removeStoredMark(t.type)}}})}function aye(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof nt){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function oye(t){return new Wq({find:t.find,handler({match:e,chain:n,range:r,pasteEvent:s}){const i=xt(t.getAttributes,void 0,e,s),a=xt(t.getContent,void 0,i);if(i===!1||i===null)return null;const l={type:t.type.name,attrs:i};a&&(l.content=a),e.input&&n().deleteRange(r).insertContentAt(r.from,l)}})}var Ni="top",Ea="bottom",Ca="right",Si="left",QI="auto",Tv=[Ni,Ea,Ca,Si],hp="start",Ey="end",lye="clippingParents",n9="viewport",Im="popper",cye="reference",aF=Tv.reduce(function(t,e){return t.concat([e+"-"+hp,e+"-"+Ey])},[]),r9=[].concat(Tv,[QI]).reduce(function(t,e){return t.concat([e,e+"-"+hp,e+"-"+Ey])},[]),uye="beforeRead",dye="read",hye="afterRead",fye="beforeMain",pye="main",mye="afterMain",gye="beforeWrite",yye="write",vye="afterWrite",xye=[uye,dye,hye,fye,pye,mye,gye,yye,vye];function Ro(t){return t?(t.nodeName||"").toLowerCase():null}function qi(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function rh(t){var e=qi(t).Element;return t instanceof e||t instanceof Element}function Sa(t){var e=qi(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function XI(t){if(typeof ShadowRoot>"u")return!1;var e=qi(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function bye(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var r=e.styles[n]||{},s=e.attributes[n]||{},i=e.elements[n];!Sa(i)||!Ro(i)||(Object.assign(i.style,r),Object.keys(s).forEach(function(a){var l=s[a];l===!1?i.removeAttribute(a):i.setAttribute(a,l===!0?"":l)}))})}function wye(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(r){var s=e.elements[r],i=e.attributes[r]||{},a=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:n[r]),l=a.reduce(function(c,u){return c[u]="",c},{});!Sa(s)||!Ro(s)||(Object.assign(s.style,l),Object.keys(i).forEach(function(c){s.removeAttribute(c)}))})}}const s9={name:"applyStyles",enabled:!0,phase:"write",fn:bye,effect:wye,requires:["computeStyles"]};function Co(t){return t.split("-")[0]}var Cd=Math.max,dw=Math.min,fp=Math.round;function QC(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function i9(){return!/^((?!chrome|android).)*safari/i.test(QC())}function pp(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r=t.getBoundingClientRect(),s=1,i=1;e&&Sa(t)&&(s=t.offsetWidth>0&&fp(r.width)/t.offsetWidth||1,i=t.offsetHeight>0&&fp(r.height)/t.offsetHeight||1);var a=rh(t)?qi(t):window,l=a.visualViewport,c=!i9()&&n,u=(r.left+(c&&l?l.offsetLeft:0))/s,d=(r.top+(c&&l?l.offsetTop:0))/i,h=r.width/s,f=r.height/i;return{width:h,height:f,top:d,right:u+h,bottom:d+f,left:u,x:u,y:d}}function JI(t){var e=pp(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function a9(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&XI(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Pl(t){return qi(t).getComputedStyle(t)}function Nye(t){return["table","td","th"].indexOf(Ro(t))>=0}function Mu(t){return((rh(t)?t.ownerDocument:t.document)||window.document).documentElement}function GN(t){return Ro(t)==="html"?t:t.assignedSlot||t.parentNode||(XI(t)?t.host:null)||Mu(t)}function oF(t){return!Sa(t)||Pl(t).position==="fixed"?null:t.offsetParent}function Sye(t){var e=/firefox/i.test(QC()),n=/Trident/i.test(QC());if(n&&Sa(t)){var r=Pl(t);if(r.position==="fixed")return null}var s=GN(t);for(XI(s)&&(s=s.host);Sa(s)&&["html","body"].indexOf(Ro(s))<0;){var i=Pl(s);if(i.transform!=="none"||i.perspective!=="none"||i.contain==="paint"||["transform","perspective"].indexOf(i.willChange)!==-1||e&&i.willChange==="filter"||e&&i.filter&&i.filter!=="none")return s;s=s.parentNode}return null}function Av(t){for(var e=qi(t),n=oF(t);n&&Nye(n)&&Pl(n).position==="static";)n=oF(n);return n&&(Ro(n)==="html"||Ro(n)==="body"&&Pl(n).position==="static")?e:n||Sye(t)||e}function ZI(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Eg(t,e,n){return Cd(t,dw(e,n))}function _ye(t,e,n){var r=Eg(t,e,n);return r>n?n:r}function o9(){return{top:0,right:0,bottom:0,left:0}}function l9(t){return Object.assign({},o9(),t)}function c9(t,e){return e.reduce(function(n,r){return n[r]=t,n},{})}var jye=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,l9(typeof e!="number"?e:c9(e,Tv))};function Eye(t){var e,n=t.state,r=t.name,s=t.options,i=n.elements.arrow,a=n.modifiersData.popperOffsets,l=Co(n.placement),c=ZI(l),u=[Si,Ca].indexOf(l)>=0,d=u?"height":"width";if(!(!i||!a)){var h=jye(s.padding,n),f=JI(i),p=c==="y"?Ni:Si,m=c==="y"?Ea:Ca,g=n.rects.reference[d]+n.rects.reference[c]-a[c]-n.rects.popper[d],y=a[c]-n.rects.reference[c],x=Av(i),w=x?c==="y"?x.clientHeight||0:x.clientWidth||0:0,N=g/2-y/2,S=h[p],C=w-f[d]-h[m],A=w/2-f[d]/2+N,j=Eg(S,A,C),_=c;n.modifiersData[r]=(e={},e[_]=j,e.centerOffset=j-A,e)}}function Cye(t){var e=t.state,n=t.options,r=n.element,s=r===void 0?"[data-popper-arrow]":r;s!=null&&(typeof s=="string"&&(s=e.elements.popper.querySelector(s),!s)||a9(e.elements.popper,s)&&(e.elements.arrow=s))}const Tye={name:"arrow",enabled:!0,phase:"main",fn:Eye,effect:Cye,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mp(t){return t.split("-")[1]}var Aye={top:"auto",right:"auto",bottom:"auto",left:"auto"};function kye(t,e){var n=t.x,r=t.y,s=e.devicePixelRatio||1;return{x:fp(n*s)/s||0,y:fp(r*s)/s||0}}function lF(t){var e,n=t.popper,r=t.popperRect,s=t.placement,i=t.variation,a=t.offsets,l=t.position,c=t.gpuAcceleration,u=t.adaptive,d=t.roundOffsets,h=t.isFixed,f=a.x,p=f===void 0?0:f,m=a.y,g=m===void 0?0:m,y=typeof d=="function"?d({x:p,y:g}):{x:p,y:g};p=y.x,g=y.y;var x=a.hasOwnProperty("x"),w=a.hasOwnProperty("y"),N=Si,S=Ni,C=window;if(u){var A=Av(n),j="clientHeight",_="clientWidth";if(A===qi(n)&&(A=Mu(n),Pl(A).position!=="static"&&l==="absolute"&&(j="scrollHeight",_="scrollWidth")),A=A,s===Ni||(s===Si||s===Ca)&&i===Ey){S=Ea;var E=h&&A===C&&C.visualViewport?C.visualViewport.height:A[j];g-=E-r.height,g*=c?1:-1}if(s===Si||(s===Ni||s===Ea)&&i===Ey){N=Ca;var I=h&&A===C&&C.visualViewport?C.visualViewport.width:A[_];p-=I-r.width,p*=c?1:-1}}var T=Object.assign({position:l},u&&Aye),P=d===!0?kye({x:p,y:g},qi(n)):{x:p,y:g};if(p=P.x,g=P.y,c){var O;return Object.assign({},T,(O={},O[S]=w?"0":"",O[N]=x?"0":"",O.transform=(C.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",O))}return Object.assign({},T,(e={},e[S]=w?g+"px":"",e[N]=x?p+"px":"",e.transform="",e))}function Iye(t){var e=t.state,n=t.options,r=n.gpuAcceleration,s=r===void 0?!0:r,i=n.adaptive,a=i===void 0?!0:i,l=n.roundOffsets,c=l===void 0?!0:l,u={placement:Co(e.placement),variation:mp(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:s,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,lF(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:c})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,lF(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Pye={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Iye,data:{}};var Hx={passive:!0};function Oye(t){var e=t.state,n=t.instance,r=t.options,s=r.scroll,i=s===void 0?!0:s,a=r.resize,l=a===void 0?!0:a,c=qi(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return i&&u.forEach(function(d){d.addEventListener("scroll",n.update,Hx)}),l&&c.addEventListener("resize",n.update,Hx),function(){i&&u.forEach(function(d){d.removeEventListener("scroll",n.update,Hx)}),l&&c.removeEventListener("resize",n.update,Hx)}}const Dye={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Oye,data:{}};var Rye={left:"right",right:"left",bottom:"top",top:"bottom"};function z0(t){return t.replace(/left|right|bottom|top/g,function(e){return Rye[e]})}var Mye={start:"end",end:"start"};function cF(t){return t.replace(/start|end/g,function(e){return Mye[e]})}function eP(t){var e=qi(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function tP(t){return pp(Mu(t)).left+eP(t).scrollLeft}function Lye(t,e){var n=qi(t),r=Mu(t),s=n.visualViewport,i=r.clientWidth,a=r.clientHeight,l=0,c=0;if(s){i=s.width,a=s.height;var u=i9();(u||!u&&e==="fixed")&&(l=s.offsetLeft,c=s.offsetTop)}return{width:i,height:a,x:l+tP(t),y:c}}function Fye(t){var e,n=Mu(t),r=eP(t),s=(e=t.ownerDocument)==null?void 0:e.body,i=Cd(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),a=Cd(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),l=-r.scrollLeft+tP(t),c=-r.scrollTop;return Pl(s||n).direction==="rtl"&&(l+=Cd(n.clientWidth,s?s.clientWidth:0)-i),{width:i,height:a,x:l,y:c}}function nP(t){var e=Pl(t),n=e.overflow,r=e.overflowX,s=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+r)}function u9(t){return["html","body","#document"].indexOf(Ro(t))>=0?t.ownerDocument.body:Sa(t)&&nP(t)?t:u9(GN(t))}function Cg(t,e){var n;e===void 0&&(e=[]);var r=u9(t),s=r===((n=t.ownerDocument)==null?void 0:n.body),i=qi(r),a=s?[i].concat(i.visualViewport||[],nP(r)?r:[]):r,l=e.concat(a);return s?l:l.concat(Cg(GN(a)))}function XC(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Bye(t,e){var n=pp(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function uF(t,e,n){return e===n9?XC(Lye(t,n)):rh(e)?Bye(e,n):XC(Fye(Mu(t)))}function Vye(t){var e=Cg(GN(t)),n=["absolute","fixed"].indexOf(Pl(t).position)>=0,r=n&&Sa(t)?Av(t):t;return rh(r)?e.filter(function(s){return rh(s)&&a9(s,r)&&Ro(s)!=="body"}):[]}function $ye(t,e,n,r){var s=e==="clippingParents"?Vye(t):[].concat(e),i=[].concat(s,[n]),a=i[0],l=i.reduce(function(c,u){var d=uF(t,u,r);return c.top=Cd(d.top,c.top),c.right=dw(d.right,c.right),c.bottom=dw(d.bottom,c.bottom),c.left=Cd(d.left,c.left),c},uF(t,a,r));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function d9(t){var e=t.reference,n=t.element,r=t.placement,s=r?Co(r):null,i=r?mp(r):null,a=e.x+e.width/2-n.width/2,l=e.y+e.height/2-n.height/2,c;switch(s){case Ni:c={x:a,y:e.y-n.height};break;case Ea:c={x:a,y:e.y+e.height};break;case Ca:c={x:e.x+e.width,y:l};break;case Si:c={x:e.x-n.width,y:l};break;default:c={x:e.x,y:e.y}}var u=s?ZI(s):null;if(u!=null){var d=u==="y"?"height":"width";switch(i){case hp:c[u]=c[u]-(e[d]/2-n[d]/2);break;case Ey:c[u]=c[u]+(e[d]/2-n[d]/2);break}}return c}function Cy(t,e){e===void 0&&(e={});var n=e,r=n.placement,s=r===void 0?t.placement:r,i=n.strategy,a=i===void 0?t.strategy:i,l=n.boundary,c=l===void 0?lye:l,u=n.rootBoundary,d=u===void 0?n9:u,h=n.elementContext,f=h===void 0?Im:h,p=n.altBoundary,m=p===void 0?!1:p,g=n.padding,y=g===void 0?0:g,x=l9(typeof y!="number"?y:c9(y,Tv)),w=f===Im?cye:Im,N=t.rects.popper,S=t.elements[m?w:f],C=$ye(rh(S)?S:S.contextElement||Mu(t.elements.popper),c,d,a),A=pp(t.elements.reference),j=d9({reference:A,element:N,placement:s}),_=XC(Object.assign({},N,j)),E=f===Im?_:A,I={top:C.top-E.top+x.top,bottom:E.bottom-C.bottom+x.bottom,left:C.left-E.left+x.left,right:E.right-C.right+x.right},T=t.modifiersData.offset;if(f===Im&&T){var P=T[s];Object.keys(I).forEach(function(O){var H=[Ca,Ea].indexOf(O)>=0?1:-1,X=[Ni,Ea].indexOf(O)>=0?"y":"x";I[O]+=P[X]*H})}return I}function Uye(t,e){e===void 0&&(e={});var n=e,r=n.placement,s=n.boundary,i=n.rootBoundary,a=n.padding,l=n.flipVariations,c=n.allowedAutoPlacements,u=c===void 0?r9:c,d=mp(r),h=d?l?aF:aF.filter(function(m){return mp(m)===d}):Tv,f=h.filter(function(m){return u.indexOf(m)>=0});f.length===0&&(f=h);var p=f.reduce(function(m,g){return m[g]=Cy(t,{placement:g,boundary:s,rootBoundary:i,padding:a})[Co(g)],m},{});return Object.keys(p).sort(function(m,g){return p[m]-p[g]})}function zye(t){if(Co(t)===QI)return[];var e=z0(t);return[cF(t),e,cF(e)]}function Hye(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var s=n.mainAxis,i=s===void 0?!0:s,a=n.altAxis,l=a===void 0?!0:a,c=n.fallbackPlacements,u=n.padding,d=n.boundary,h=n.rootBoundary,f=n.altBoundary,p=n.flipVariations,m=p===void 0?!0:p,g=n.allowedAutoPlacements,y=e.options.placement,x=Co(y),w=x===y,N=c||(w||!m?[z0(y)]:zye(y)),S=[y].concat(N).reduce(function(Z,W){return Z.concat(Co(W)===QI?Uye(e,{placement:W,boundary:d,rootBoundary:h,padding:u,flipVariations:m,allowedAutoPlacements:g}):W)},[]),C=e.rects.reference,A=e.rects.popper,j=new Map,_=!0,E=S[0],I=0;I<S.length;I++){var T=S[I],P=Co(T),O=mp(T)===hp,H=[Ni,Ea].indexOf(P)>=0,X=H?"width":"height",se=Cy(e,{placement:T,boundary:d,rootBoundary:h,altBoundary:f,padding:u}),L=H?O?Ca:Si:O?Ea:Ni;C[X]>A[X]&&(L=z0(L));var B=z0(L),$=[];if(i&&$.push(se[P]<=0),l&&$.push(se[L]<=0,se[B]<=0),$.every(function(Z){return Z})){E=T,_=!1;break}j.set(T,$)}if(_)for(var q=m?3:1,Y=function(W){var Q=S.find(function(U){var pe=j.get(U);if(pe)return pe.slice(0,W).every(function(J){return J})});if(Q)return E=Q,"break"},R=q;R>0;R--){var G=Y(R);if(G==="break")break}e.placement!==E&&(e.modifiersData[r]._skip=!0,e.placement=E,e.reset=!0)}}const Wye={name:"flip",enabled:!0,phase:"main",fn:Hye,requiresIfExists:["offset"],data:{_skip:!1}};function dF(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function hF(t){return[Ni,Ca,Ea,Si].some(function(e){return t[e]>=0})}function qye(t){var e=t.state,n=t.name,r=e.rects.reference,s=e.rects.popper,i=e.modifiersData.preventOverflow,a=Cy(e,{elementContext:"reference"}),l=Cy(e,{altBoundary:!0}),c=dF(a,r),u=dF(l,s,i),d=hF(c),h=hF(u);e.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:d,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":h})}const Gye={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:qye};function Kye(t,e,n){var r=Co(t),s=[Si,Ni].indexOf(r)>=0?-1:1,i=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,a=i[0],l=i[1];return a=a||0,l=(l||0)*s,[Si,Ca].indexOf(r)>=0?{x:l,y:a}:{x:a,y:l}}function Yye(t){var e=t.state,n=t.options,r=t.name,s=n.offset,i=s===void 0?[0,0]:s,a=r9.reduce(function(d,h){return d[h]=Kye(h,e.rects,i),d},{}),l=a[e.placement],c=l.x,u=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=a}const Qye={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Yye};function Xye(t){var e=t.state,n=t.name;e.modifiersData[n]=d9({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Jye={name:"popperOffsets",enabled:!0,phase:"read",fn:Xye,data:{}};function Zye(t){return t==="x"?"y":"x"}function eve(t){var e=t.state,n=t.options,r=t.name,s=n.mainAxis,i=s===void 0?!0:s,a=n.altAxis,l=a===void 0?!1:a,c=n.boundary,u=n.rootBoundary,d=n.altBoundary,h=n.padding,f=n.tether,p=f===void 0?!0:f,m=n.tetherOffset,g=m===void 0?0:m,y=Cy(e,{boundary:c,rootBoundary:u,padding:h,altBoundary:d}),x=Co(e.placement),w=mp(e.placement),N=!w,S=ZI(x),C=Zye(S),A=e.modifiersData.popperOffsets,j=e.rects.reference,_=e.rects.popper,E=typeof g=="function"?g(Object.assign({},e.rects,{placement:e.placement})):g,I=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),T=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(A){if(i){var O,H=S==="y"?Ni:Si,X=S==="y"?Ea:Ca,se=S==="y"?"height":"width",L=A[S],B=L+y[H],$=L-y[X],q=p?-_[se]/2:0,Y=w===hp?j[se]:_[se],R=w===hp?-_[se]:-j[se],G=e.elements.arrow,Z=p&&G?JI(G):{width:0,height:0},W=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:o9(),Q=W[H],U=W[X],pe=Eg(0,j[se],Z[se]),J=N?j[se]/2-q-pe-Q-I.mainAxis:Y-pe-Q-I.mainAxis,ge=N?-j[se]/2+q+pe+U+I.mainAxis:R+pe+U+I.mainAxis,me=e.elements.arrow&&Av(e.elements.arrow),ue=me?S==="y"?me.clientTop||0:me.clientLeft||0:0,st=(O=T==null?void 0:T[S])!=null?O:0,Ke=L+J-st-ue,ot=L+ge-st,lt=Eg(p?dw(B,Ke):B,L,p?Cd($,ot):$);A[S]=lt,P[S]=lt-L}if(l){var bt,mt=S==="x"?Ni:Si,V=S==="x"?Ea:Ca,re=A[C],ie=C==="y"?"height":"width",Fe=re+y[mt],Qe=re-y[V],At=[Ni,Si].indexOf(x)!==-1,Jn=(bt=T==null?void 0:T[C])!=null?bt:0,Pt=At?Fe:re-j[ie]-_[ie]-Jn+I.altAxis,gt=At?re+j[ie]+_[ie]-Jn-I.altAxis:Qe,Pn=p&&At?_ye(Pt,re,gt):Eg(p?Pt:Fe,re,p?gt:Qe);A[C]=Pn,P[C]=Pn-re}e.modifiersData[r]=P}}const tve={name:"preventOverflow",enabled:!0,phase:"main",fn:eve,requiresIfExists:["offset"]};function nve(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function rve(t){return t===qi(t)||!Sa(t)?eP(t):nve(t)}function sve(t){var e=t.getBoundingClientRect(),n=fp(e.width)/t.offsetWidth||1,r=fp(e.height)/t.offsetHeight||1;return n!==1||r!==1}function ive(t,e,n){n===void 0&&(n=!1);var r=Sa(e),s=Sa(e)&&sve(e),i=Mu(e),a=pp(t,s,n),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&((Ro(e)!=="body"||nP(i))&&(l=rve(e)),Sa(e)?(c=pp(e,!0),c.x+=e.clientLeft,c.y+=e.clientTop):i&&(c.x=tP(i))),{x:a.left+l.scrollLeft-c.x,y:a.top+l.scrollTop-c.y,width:a.width,height:a.height}}function ave(t){var e=new Map,n=new Set,r=[];t.forEach(function(i){e.set(i.name,i)});function s(i){n.add(i.name);var a=[].concat(i.requires||[],i.requiresIfExists||[]);a.forEach(function(l){if(!n.has(l)){var c=e.get(l);c&&s(c)}}),r.push(i)}return t.forEach(function(i){n.has(i.name)||s(i)}),r}function ove(t){var e=ave(t);return xye.reduce(function(n,r){return n.concat(e.filter(function(s){return s.phase===r}))},[])}function lve(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function cve(t){var e=t.reduce(function(n,r){var s=n[r.name];return n[r.name]=s?Object.assign({},s,r,{options:Object.assign({},s.options,r.options),data:Object.assign({},s.data,r.data)}):r,n},{});return Object.keys(e).map(function(n){return e[n]})}var fF={placement:"bottom",modifiers:[],strategy:"absolute"};function pF(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function uve(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,r=n===void 0?[]:n,s=e.defaultOptions,i=s===void 0?fF:s;return function(l,c,u){u===void 0&&(u=i);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},fF,i),modifiersData:{},elements:{reference:l,popper:c},attributes:{},styles:{}},h=[],f=!1,p={state:d,setOptions:function(x){var w=typeof x=="function"?x(d.options):x;g(),d.options=Object.assign({},i,d.options,w),d.scrollParents={reference:rh(l)?Cg(l):l.contextElement?Cg(l.contextElement):[],popper:Cg(c)};var N=ove(cve([].concat(r,d.options.modifiers)));return d.orderedModifiers=N.filter(function(S){return S.enabled}),m(),p.update()},forceUpdate:function(){if(!f){var x=d.elements,w=x.reference,N=x.popper;if(pF(w,N)){d.rects={reference:ive(w,Av(N),d.options.strategy==="fixed"),popper:JI(N)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(I){return d.modifiersData[I.name]=Object.assign({},I.data)});for(var S=0;S<d.orderedModifiers.length;S++){if(d.reset===!0){d.reset=!1,S=-1;continue}var C=d.orderedModifiers[S],A=C.fn,j=C.options,_=j===void 0?{}:j,E=C.name;typeof A=="function"&&(d=A({state:d,options:_,name:E,instance:p})||d)}}}},update:lve(function(){return new Promise(function(y){p.forceUpdate(),y(d)})}),destroy:function(){g(),f=!0}};if(!pF(l,c))return p;p.setOptions(u).then(function(y){!f&&u.onFirstUpdate&&u.onFirstUpdate(y)});function m(){d.orderedModifiers.forEach(function(y){var x=y.name,w=y.options,N=w===void 0?{}:w,S=y.effect;if(typeof S=="function"){var C=S({state:d,name:x,instance:p,options:N}),A=function(){};h.push(C||A)}})}function g(){h.forEach(function(y){return y()}),h=[]}return p}}var dve=[Dye,Jye,Pye,s9,Qye,Wye,tve,Tye,Gye],hve=uve({defaultModifiers:dve}),fve="tippy-box",h9="tippy-content",pve="tippy-backdrop",f9="tippy-arrow",p9="tippy-svg-arrow",Xu={passive:!0,capture:!0},m9=function(){return document.body};function gj(t,e,n){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(n)?n[e]:n)}return t}function rP(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function g9(t,e){return typeof t=="function"?t.apply(void 0,e):t}function mF(t,e){if(e===0)return t;var n;return function(r){clearTimeout(n),n=setTimeout(function(){t(r)},e)}}function mve(t){return t.split(/\s+/).filter(Boolean)}function Xh(t){return[].concat(t)}function gF(t,e){t.indexOf(e)===-1&&t.push(e)}function gve(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function yve(t){return t.split("-")[0]}function hw(t){return[].slice.call(t)}function yF(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function Tg(){return document.createElement("div")}function KN(t){return["Element","Fragment"].some(function(e){return rP(t,e)})}function vve(t){return rP(t,"NodeList")}function xve(t){return rP(t,"MouseEvent")}function bve(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function wve(t){return KN(t)?[t]:vve(t)?hw(t):Array.isArray(t)?t:hw(document.querySelectorAll(t))}function yj(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function vF(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function Nve(t){var e,n=Xh(t),r=n[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function Sve(t,e){var n=e.clientX,r=e.clientY;return t.every(function(s){var i=s.popperRect,a=s.popperState,l=s.props,c=l.interactiveBorder,u=yve(a.placement),d=a.modifiersData.offset;if(!d)return!0;var h=u==="bottom"?d.top.y:0,f=u==="top"?d.bottom.y:0,p=u==="right"?d.left.x:0,m=u==="left"?d.right.x:0,g=i.top-r+h>c,y=r-i.bottom-f>c,x=i.left-n+p>c,w=n-i.right-m>c;return g||y||x||w})}function vj(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(s){t[r](s,n)})}function xF(t,e){for(var n=e;n;){var r;if(t.contains(n))return!0;n=n.getRootNode==null||(r=n.getRootNode())==null?void 0:r.host}return!1}var uo={isTouch:!1},bF=0;function _ve(){uo.isTouch||(uo.isTouch=!0,window.performance&&document.addEventListener("mousemove",y9))}function y9(){var t=performance.now();t-bF<20&&(uo.isTouch=!1,document.removeEventListener("mousemove",y9)),bF=t}function jve(){var t=document.activeElement;if(bve(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Eve(){document.addEventListener("touchstart",_ve,Xu),window.addEventListener("blur",jve)}var Cve=typeof window<"u"&&typeof document<"u",Tve=Cve?!!window.msCrypto:!1,Ave={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},kve={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},za=Object.assign({appendTo:m9,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Ave,kve),Ive=Object.keys(za),Pve=function(e){var n=Object.keys(e);n.forEach(function(r){za[r]=e[r]})};function v9(t){var e=t.plugins||[],n=e.reduce(function(r,s){var i=s.name,a=s.defaultValue;if(i){var l;r[i]=t[i]!==void 0?t[i]:(l=za[i])!=null?l:a}return r},{});return Object.assign({},t,n)}function Ove(t,e){var n=e?Object.keys(v9(Object.assign({},za,{plugins:e}))):Ive,r=n.reduce(function(s,i){var a=(t.getAttribute("data-tippy-"+i)||"").trim();if(!a)return s;if(i==="content")s[i]=a;else try{s[i]=JSON.parse(a)}catch{s[i]=a}return s},{});return r}function wF(t,e){var n=Object.assign({},e,{content:g9(e.content,[t])},e.ignoreAttributes?{}:Ove(t,e.plugins));return n.aria=Object.assign({},za.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var Dve=function(){return"innerHTML"};function JC(t,e){t[Dve()]=e}function NF(t){var e=Tg();return t===!0?e.className=f9:(e.className=p9,KN(t)?e.appendChild(t):JC(e,t)),e}function SF(t,e){KN(e.content)?(JC(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?JC(t,e.content):t.textContent=e.content)}function ZC(t){var e=t.firstElementChild,n=hw(e.children);return{box:e,content:n.find(function(r){return r.classList.contains(h9)}),arrow:n.find(function(r){return r.classList.contains(f9)||r.classList.contains(p9)}),backdrop:n.find(function(r){return r.classList.contains(pve)})}}function x9(t){var e=Tg(),n=Tg();n.className=fve,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Tg();r.className=h9,r.setAttribute("data-state","hidden"),SF(r,t.props),e.appendChild(n),n.appendChild(r),s(t.props,t.props);function s(i,a){var l=ZC(e),c=l.box,u=l.content,d=l.arrow;a.theme?c.setAttribute("data-theme",a.theme):c.removeAttribute("data-theme"),typeof a.animation=="string"?c.setAttribute("data-animation",a.animation):c.removeAttribute("data-animation"),a.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?c.setAttribute("role",a.role):c.removeAttribute("role"),(i.content!==a.content||i.allowHTML!==a.allowHTML)&&SF(u,t.props),a.arrow?d?i.arrow!==a.arrow&&(c.removeChild(d),c.appendChild(NF(a.arrow))):c.appendChild(NF(a.arrow)):d&&c.removeChild(d)}return{popper:e,onUpdate:s}}x9.$$tippy=!0;var Rve=1,Wx=[],xj=[];function Mve(t,e){var n=wF(t,Object.assign({},za,v9(yF(e)))),r,s,i,a=!1,l=!1,c=!1,u=!1,d,h,f,p=[],m=mF(Ke,n.interactiveDebounce),g,y=Rve++,x=null,w=gve(n.plugins),N={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},S={id:y,reference:t,popper:Tg(),popperInstance:x,props:n,state:N,plugins:w,clearDelayTimeouts:Pt,setProps:gt,setContent:Pn,show:ji,hide:Zi,hideWithInteractivity:ri,enable:At,disable:Jn,unmount:Bs,destroy:ea};if(!n.render)return S;var C=n.render(S),A=C.popper,j=C.onUpdate;A.setAttribute("data-tippy-root",""),A.id="tippy-"+S.id,S.popper=A,t._tippy=S,A._tippy=S;var _=w.map(function(he){return he.fn(S)}),E=t.hasAttribute("aria-expanded");return me(),q(),L(),B("onCreate",[S]),n.showOnCreate&&Fe(),A.addEventListener("mouseenter",function(){S.props.interactive&&S.state.isVisible&&S.clearDelayTimeouts()}),A.addEventListener("mouseleave",function(){S.props.interactive&&S.props.trigger.indexOf("mouseenter")>=0&&H().addEventListener("mousemove",m)}),S;function I(){var he=S.props.touch;return Array.isArray(he)?he:[he,0]}function T(){return I()[0]==="hold"}function P(){var he;return!!((he=S.props.render)!=null&&he.$$tippy)}function O(){return g||t}function H(){var he=O().parentNode;return he?Nve(he):document}function X(){return ZC(A)}function se(he){return S.state.isMounted&&!S.state.isVisible||uo.isTouch||d&&d.type==="focus"?0:gj(S.props.delay,he?0:1,za.delay)}function L(he){he===void 0&&(he=!1),A.style.pointerEvents=S.props.interactive&&!he?"":"none",A.style.zIndex=""+S.props.zIndex}function B(he,Me,Se){if(Se===void 0&&(Se=!0),_.forEach(function(it){it[he]&&it[he].apply(it,Me)}),Se){var vt;(vt=S.props)[he].apply(vt,Me)}}function $(){var he=S.props.aria;if(he.content){var Me="aria-"+he.content,Se=A.id,vt=Xh(S.props.triggerTarget||t);vt.forEach(function(it){var kt=it.getAttribute(Me);if(S.state.isVisible)it.setAttribute(Me,kt?kt+" "+Se:Se);else{var an=kt&&kt.replace(Se,"").trim();an?it.setAttribute(Me,an):it.removeAttribute(Me)}})}}function q(){if(!(E||!S.props.aria.expanded)){var he=Xh(S.props.triggerTarget||t);he.forEach(function(Me){S.props.interactive?Me.setAttribute("aria-expanded",S.state.isVisible&&Me===O()?"true":"false"):Me.removeAttribute("aria-expanded")})}}function Y(){H().removeEventListener("mousemove",m),Wx=Wx.filter(function(he){return he!==m})}function R(he){if(!(uo.isTouch&&(c||he.type==="mousedown"))){var Me=he.composedPath&&he.composedPath()[0]||he.target;if(!(S.props.interactive&&xF(A,Me))){if(Xh(S.props.triggerTarget||t).some(function(Se){return xF(Se,Me)})){if(uo.isTouch||S.state.isVisible&&S.props.trigger.indexOf("click")>=0)return}else B("onClickOutside",[S,he]);S.props.hideOnClick===!0&&(S.clearDelayTimeouts(),S.hide(),l=!0,setTimeout(function(){l=!1}),S.state.isMounted||Q())}}}function G(){c=!0}function Z(){c=!1}function W(){var he=H();he.addEventListener("mousedown",R,!0),he.addEventListener("touchend",R,Xu),he.addEventListener("touchstart",Z,Xu),he.addEventListener("touchmove",G,Xu)}function Q(){var he=H();he.removeEventListener("mousedown",R,!0),he.removeEventListener("touchend",R,Xu),he.removeEventListener("touchstart",Z,Xu),he.removeEventListener("touchmove",G,Xu)}function U(he,Me){J(he,function(){!S.state.isVisible&&A.parentNode&&A.parentNode.contains(A)&&Me()})}function pe(he,Me){J(he,Me)}function J(he,Me){var Se=X().box;function vt(it){it.target===Se&&(vj(Se,"remove",vt),Me())}if(he===0)return Me();vj(Se,"remove",h),vj(Se,"add",vt),h=vt}function ge(he,Me,Se){Se===void 0&&(Se=!1);var vt=Xh(S.props.triggerTarget||t);vt.forEach(function(it){it.addEventListener(he,Me,Se),p.push({node:it,eventType:he,handler:Me,options:Se})})}function me(){T()&&(ge("touchstart",st,{passive:!0}),ge("touchend",ot,{passive:!0})),mve(S.props.trigger).forEach(function(he){if(he!=="manual")switch(ge(he,st),he){case"mouseenter":ge("mouseleave",ot);break;case"focus":ge(Tve?"focusout":"blur",lt);break;case"focusin":ge("focusout",lt);break}})}function ue(){p.forEach(function(he){var Me=he.node,Se=he.eventType,vt=he.handler,it=he.options;Me.removeEventListener(Se,vt,it)}),p=[]}function st(he){var Me,Se=!1;if(!(!S.state.isEnabled||bt(he)||l)){var vt=((Me=d)==null?void 0:Me.type)==="focus";d=he,g=he.currentTarget,q(),!S.state.isVisible&&xve(he)&&Wx.forEach(function(it){return it(he)}),he.type==="click"&&(S.props.trigger.indexOf("mouseenter")<0||a)&&S.props.hideOnClick!==!1&&S.state.isVisible?Se=!0:Fe(he),he.type==="click"&&(a=!Se),Se&&!vt&&Qe(he)}}function Ke(he){var Me=he.target,Se=O().contains(Me)||A.contains(Me);if(!(he.type==="mousemove"&&Se)){var vt=ie().concat(A).map(function(it){var kt,an=it._tippy,wt=(kt=an.popperInstance)==null?void 0:kt.state;return wt?{popperRect:it.getBoundingClientRect(),popperState:wt,props:n}:null}).filter(Boolean);Sve(vt,he)&&(Y(),Qe(he))}}function ot(he){var Me=bt(he)||S.props.trigger.indexOf("click")>=0&&a;if(!Me){if(S.props.interactive){S.hideWithInteractivity(he);return}Qe(he)}}function lt(he){S.props.trigger.indexOf("focusin")<0&&he.target!==O()||S.props.interactive&&he.relatedTarget&&A.contains(he.relatedTarget)||Qe(he)}function bt(he){return uo.isTouch?T()!==he.type.indexOf("touch")>=0:!1}function mt(){V();var he=S.props,Me=he.popperOptions,Se=he.placement,vt=he.offset,it=he.getReferenceClientRect,kt=he.moveTransition,an=P()?ZC(A).arrow:null,wt=it?{getBoundingClientRect:it,contextElement:it.contextElement||O()}:t,Lt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(si){var Zr=si.state;if(P()){var Vs=X(),$n=Vs.box;["placement","reference-hidden","escaped"].forEach(function(fe){fe==="placement"?$n.setAttribute("data-placement",Zr.placement):Zr.attributes.popper["data-popper-"+fe]?$n.setAttribute("data-"+fe,""):$n.removeAttribute("data-"+fe)}),Zr.attributes.popper={}}}},Vn=[{name:"offset",options:{offset:vt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!kt}},Lt];P()&&an&&Vn.push({name:"arrow",options:{element:an,padding:3}}),Vn.push.apply(Vn,(Me==null?void 0:Me.modifiers)||[]),S.popperInstance=hve(wt,A,Object.assign({},Me,{placement:Se,onFirstUpdate:f,modifiers:Vn}))}function V(){S.popperInstance&&(S.popperInstance.destroy(),S.popperInstance=null)}function re(){var he=S.props.appendTo,Me,Se=O();S.props.interactive&&he===m9||he==="parent"?Me=Se.parentNode:Me=g9(he,[Se]),Me.contains(A)||Me.appendChild(A),S.state.isMounted=!0,mt()}function ie(){return hw(A.querySelectorAll("[data-tippy-root]"))}function Fe(he){S.clearDelayTimeouts(),he&&B("onTrigger",[S,he]),W();var Me=se(!0),Se=I(),vt=Se[0],it=Se[1];uo.isTouch&&vt==="hold"&&it&&(Me=it),Me?r=setTimeout(function(){S.show()},Me):S.show()}function Qe(he){if(S.clearDelayTimeouts(),B("onUntrigger",[S,he]),!S.state.isVisible){Q();return}if(!(S.props.trigger.indexOf("mouseenter")>=0&&S.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(he.type)>=0&&a)){var Me=se(!1);Me?s=setTimeout(function(){S.state.isVisible&&S.hide()},Me):i=requestAnimationFrame(function(){S.hide()})}}function At(){S.state.isEnabled=!0}function Jn(){S.hide(),S.state.isEnabled=!1}function Pt(){clearTimeout(r),clearTimeout(s),cancelAnimationFrame(i)}function gt(he){if(!S.state.isDestroyed){B("onBeforeUpdate",[S,he]),ue();var Me=S.props,Se=wF(t,Object.assign({},Me,yF(he),{ignoreAttributes:!0}));S.props=Se,me(),Me.interactiveDebounce!==Se.interactiveDebounce&&(Y(),m=mF(Ke,Se.interactiveDebounce)),Me.triggerTarget&&!Se.triggerTarget?Xh(Me.triggerTarget).forEach(function(vt){vt.removeAttribute("aria-expanded")}):Se.triggerTarget&&t.removeAttribute("aria-expanded"),q(),L(),j&&j(Me,Se),S.popperInstance&&(mt(),ie().forEach(function(vt){requestAnimationFrame(vt._tippy.popperInstance.forceUpdate)})),B("onAfterUpdate",[S,he])}}function Pn(he){S.setProps({content:he})}function ji(){var he=S.state.isVisible,Me=S.state.isDestroyed,Se=!S.state.isEnabled,vt=uo.isTouch&&!S.props.touch,it=gj(S.props.duration,0,za.duration);if(!(he||Me||Se||vt)&&!O().hasAttribute("disabled")&&(B("onShow",[S],!1),S.props.onShow(S)!==!1)){if(S.state.isVisible=!0,P()&&(A.style.visibility="visible"),L(),W(),S.state.isMounted||(A.style.transition="none"),P()){var kt=X(),an=kt.box,wt=kt.content;yj([an,wt],0)}f=function(){var Vn;if(!(!S.state.isVisible||u)){if(u=!0,A.offsetHeight,A.style.transition=S.props.moveTransition,P()&&S.props.animation){var Zn=X(),si=Zn.box,Zr=Zn.content;yj([si,Zr],it),vF([si,Zr],"visible")}$(),q(),gF(xj,S),(Vn=S.popperInstance)==null||Vn.forceUpdate(),B("onMount",[S]),S.props.animation&&P()&&pe(it,function(){S.state.isShown=!0,B("onShown",[S])})}},re()}}function Zi(){var he=!S.state.isVisible,Me=S.state.isDestroyed,Se=!S.state.isEnabled,vt=gj(S.props.duration,1,za.duration);if(!(he||Me||Se)&&(B("onHide",[S],!1),S.props.onHide(S)!==!1)){if(S.state.isVisible=!1,S.state.isShown=!1,u=!1,a=!1,P()&&(A.style.visibility="hidden"),Y(),Q(),L(!0),P()){var it=X(),kt=it.box,an=it.content;S.props.animation&&(yj([kt,an],vt),vF([kt,an],"hidden"))}$(),q(),S.props.animation?P()&&U(vt,S.unmount):S.unmount()}}function ri(he){H().addEventListener("mousemove",m),gF(Wx,m),m(he)}function Bs(){S.state.isVisible&&S.hide(),S.state.isMounted&&(V(),ie().forEach(function(he){he._tippy.unmount()}),A.parentNode&&A.parentNode.removeChild(A),xj=xj.filter(function(he){return he!==S}),S.state.isMounted=!1,B("onHidden",[S]))}function ea(){S.state.isDestroyed||(S.clearDelayTimeouts(),S.unmount(),ue(),delete t._tippy,S.state.isDestroyed=!0,B("onDestroy",[S]))}}function kv(t,e){e===void 0&&(e={});var n=za.plugins.concat(e.plugins||[]);Eve();var r=Object.assign({},e,{plugins:n}),s=wve(t),i=s.reduce(function(a,l){var c=l&&Mve(l,r);return c&&a.push(c),a},[]);return KN(t)?i[0]:i}kv.defaultProps=za;kv.setDefaultProps=Pve;kv.currentInput=uo;Object.assign({},s9,{effect:function(e){var n=e.state,r={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,r.popper),n.styles=r,n.elements.arrow&&Object.assign(n.elements.arrow.style,r.arrow)}});kv.setDefaultProps({render:x9});class Lve{constructor({editor:e,element:n,view:r,tippyOptions:s={},updateDelay:i=250,shouldShow:a}){this.preventHide=!1,this.shouldShow=({view:l,state:c,from:u,to:d})=>{const{doc:h,selection:f}=c,{empty:p}=f,m=!h.textBetween(u,d).length&&GI(c.selection),g=this.element.contains(document.activeElement);return!(!(l.hasFocus()||g)||p||m||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:l})=>{var c;if(this.preventHide){this.preventHide=!1;return}l!=null&&l.relatedTarget&&(!((c=this.element.parentNode)===null||c===void 0)&&c.contains(l.relatedTarget))||(l==null?void 0:l.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=l=>{this.blurHandler({event:l})},this.handleDebouncedUpdate=(l,c)=>{const u=!(c!=null&&c.selection.eq(l.state.selection)),d=!(c!=null&&c.doc.eq(l.state.doc));!u&&!d||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(l,u,d,c)},this.updateDelay))},this.updateHandler=(l,c,u,d)=>{var h,f,p;const{state:m,composing:g}=l,{selection:y}=m;if(g||!c&&!u)return;this.createTooltip();const{ranges:w}=y,N=Math.min(...w.map(A=>A.$from.pos)),S=Math.max(...w.map(A=>A.$to.pos));if(!((h=this.shouldShow)===null||h===void 0?void 0:h.call(this,{editor:this.editor,element:this.element,view:l,state:m,oldState:d,from:N,to:S}))){this.hide();return}(f=this.tippy)===null||f===void 0||f.setProps({getReferenceClientRect:((p=this.tippyOptions)===null||p===void 0?void 0:p.getReferenceClientRect)||(()=>{if(e9(m.selection)){let A=l.nodeDOM(N);if(A){const j=A.dataset.nodeViewWrapper?A:A.querySelector("[data-node-view-wrapper]");if(j&&(A=j.firstChild),A)return A.getBoundingClientRect()}}return Tge(l,N,S)})}),this.show()},this.editor=e,this.element=n,this.view=r,this.updateDelay=i,a&&(this.shouldShow=a),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=s,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,n=!!e.parentElement;this.element.tabIndex=0,!(this.tippy||!n)&&(this.tippy=kv(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,n){const{state:r}=e,s=r.selection.from!==r.selection.to;if(this.updateDelay>0&&s){this.handleDebouncedUpdate(e,n);return}const i=!(n!=null&&n.selection.eq(e.state.selection)),a=!(n!=null&&n.doc.eq(e.state.doc));this.updateHandler(e,i,a,n)}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,n;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(n=this.tippy)===null||n===void 0||n.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const b9=t=>new Ar({key:typeof t.pluginKey=="string"?new Zs(t.pluginKey):t.pluginKey,view:e=>new Lve({view:e,...t})});Kr.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[b9({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});function Fve(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var w9={exports:{}},bj={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _F;function Bve(){if(_F)return bj;_F=1;var t=Fr;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,s=t.useEffect,i=t.useLayoutEffect,a=t.useDebugValue;function l(h,f){var p=f(),m=r({inst:{value:p,getSnapshot:f}}),g=m[0].inst,y=m[1];return i(function(){g.value=p,g.getSnapshot=f,c(g)&&y({inst:g})},[h,p,f]),s(function(){return c(g)&&y({inst:g}),h(function(){c(g)&&y({inst:g})})},[h]),a(p),p}function c(h){var f=h.getSnapshot;h=h.value;try{var p=f();return!n(h,p)}catch{return!0}}function u(h,f){return f()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return bj.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,bj}w9.exports=Bve();var sP=w9.exports;const Vve=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},$ve=({contentComponent:t})=>{const e=sP.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return Fr.createElement(Fr.Fragment,null,Object.values(e))};function Uve(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,r){e={...e,[n]:XJ.createPortal(r.reactElement,r.element,n)},t.forEach(s=>s())},removeRenderer(n){const r={...e};delete r[n],e=r,t.forEach(s=>s())}}}class zve extends Fr.Component{constructor(e){var n;super(e),this.editorContentRef=Fr.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((n=e.editor)===null||n===void 0)&&n.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.options.element.childNodes),e.setOptions({element:n}),e.contentComponent=Uve(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})}render(){const{editor:e,innerRef:n,...r}=this.props;return Fr.createElement(Fr.Fragment,null,Fr.createElement("div",{ref:Vve(n,this.editorContentRef),...r}),(e==null?void 0:e.contentComponent)&&Fr.createElement($ve,{contentComponent:e.contentComponent}))}}const Hve=b.forwardRef((t,e)=>{const n=Fr.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Fr.createElement(zve,{key:n,innerRef:e,...t})}),Wve=Fr.memo(Hve);var qve=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,s,i;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(s=r;s--!==0;)if(!t(e[s],n[s]))return!1;return!0}if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(s of e.entries())if(!n.has(s[0]))return!1;for(s of e.entries())if(!t(s[1],n.get(s[0])))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(s of e.entries())if(!n.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if(r=e.length,r!=n.length)return!1;for(s=r;s--!==0;)if(e[s]!==n[s])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(n).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=r;s--!==0;){var a=i[s];if(!(a==="_owner"&&e.$$typeof)&&!t(e[a],n[a]))return!1}return!0}return e!==e&&n!==n},Gve=Fve(qve),N9={exports:{}},wj={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jF;function Kve(){if(jF)return wj;jF=1;var t=Fr,e=sP;function n(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var r=typeof Object.is=="function"?Object.is:n,s=e.useSyncExternalStore,i=t.useRef,a=t.useEffect,l=t.useMemo,c=t.useDebugValue;return wj.useSyncExternalStoreWithSelector=function(u,d,h,f,p){var m=i(null);if(m.current===null){var g={hasValue:!1,value:null};m.current=g}else g=m.current;m=l(function(){function x(A){if(!w){if(w=!0,N=A,A=f(A),p!==void 0&&g.hasValue){var j=g.value;if(p(j,A))return S=j}return S=A}if(j=S,r(N,A))return j;var _=f(A);return p!==void 0&&p(j,_)?j:(N=A,S=_)}var w=!1,N,S,C=h===void 0?null:h;return[function(){return x(d())},C===null?void 0:function(){return x(C())}]},[d,h,f,p]);var y=s(u,m[0],m[1]);return a(function(){g.hasValue=!0,g.value=y},[y]),c(y),y},wj}N9.exports=Kve();var Yve=N9.exports;const Qve=typeof window<"u"?b.useLayoutEffect:b.useEffect;class Xve{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const n=()=>{this.transactionNumber+=1,this.subscribers.forEach(s=>s())},r=this.editor;return r.on("transaction",n),()=>{r.off("transaction",n)}}}}function Jve(t){var e;const[n]=b.useState(()=>new Xve(t.editor)),r=Yve.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!==null&&e!==void 0?e:Gve);return Qve(()=>n.watch(t.editor),[t.editor,n]),b.useDebugValue(r),r}const Zve=!1,eT=typeof window>"u",exe=eT||!!(typeof window<"u"&&window.next);class iP{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?eT||exe?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)===null||i===void 0?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)===null||i===void 0?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)===null||i===void 0?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)===null||i===void 0?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)===null||i===void 0?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)===null||i===void 0?void 0:i.call(s,...r)}};return new iye(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((s,i)=>{var a;return s===((a=n.extensions)===null||a===void 0?void 0:a[i])}):e[r]===n[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?iP.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function txe(t={},e=[]){const n=b.useRef(t);n.current=t;const[r]=b.useState(()=>new iP(n)),s=sP.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return b.useDebugValue(s),b.useEffect(r.onRender(e)),Jve({editor:s,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1?null:t.immediatelyRender&&i===0?0:i+1}),s}const S9=b.createContext({editor:null});S9.Consumer;const nxe=()=>b.useContext(S9),rxe=t=>{const[e,n]=b.useState(null),{editor:r}=nxe();return b.useEffect(()=>{var s;if(!e||!((s=t.editor)===null||s===void 0)&&s.isDestroyed||r!=null&&r.isDestroyed)return;const{pluginKey:i="bubbleMenu",editor:a,tippyOptions:l={},updateDelay:c,shouldShow:u=null}=t,d=a||r;if(!d){console.warn("BubbleMenu component is not rendered inside of an editor component or does not have editor prop.");return}const h=b9({updateDelay:c,editor:d,element:e,pluginKey:i,shouldShow:u,tippyOptions:l});return d.registerPlugin(h),()=>{d.unregisterPlugin(i)}},[t.editor,r,e]),Fr.createElement("div",{ref:n,className:t.className,style:{visibility:"hidden"}},t.children)},sxe=b.createContext({onDragStart:void 0}),ixe=()=>b.useContext(sxe);Fr.forwardRef((t,e)=>{const{onDragStart:n}=ixe(),r=t.as||"div";return Fr.createElement(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});const axe=/^\s*>\s$/,oxe=Ls.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[jy({find:axe,type:this.type})]}}),lxe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,cxe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,uxe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,dxe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,hxe=Do.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[dp({find:lxe,type:this.type}),dp({find:uxe,type:this.type})]},addPasteRules(){return[nh({find:cxe,type:this.type}),nh({find:dxe,type:this.type})]}}),fxe="listItem",EF="textStyle",CF=/^\s*([-+*])\s$/,pxe=Ls.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(fxe,this.editor.getAttributes(EF)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=jy({find:CF,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=jy({find:CF,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(EF),editor:this.editor})),[t]}}),mxe=/(^|[^`])`([^`]+)`(?!`)/,gxe=/(^|[^`])`([^`]+)`(?!`)/g,yxe=Do.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[dp({find:mxe,type:this.type})]},addPasteRules(){return[nh({find:gxe,type:this.type})]}}),vxe=/^```([a-z]+)?[\s\n]$/,xxe=/^~~~([a-z]+)?[\s\n]$/,bxe=Ls.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(a=>a.startsWith(n)).map(a=>a.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",mr(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,a=r.parent.textContent.endsWith(`

`);return!i||!a?!1:t.chain().command(({tr:l})=>(l.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const l=s.after();return l===void 0?!1:r.nodeAt(l)?t.commands.command(({tr:u})=>(u.setSelection(jt.near(r.resolve(l))),!0)):t.commands.exitCode()}}},addInputRules(){return[YC({find:vxe,type:this.type,getAttributes:t=>({language:t[1]})}),YC({find:xxe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Ar({key:new Zs("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:a,schema:l}=t.state,c=l.text(n.replace(/\r\n?/g,`
`));return a.replaceSelectionWith(this.type.create({language:i},c)),a.selection.$from.parent.type!==this.type&&a.setSelection(pt.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.setMeta("paste",!0),t.dispatch(a),!0}}})]}}),wxe=Ls.create({name:"doc",topNode:!0,content:"block+"});function Nxe(t={}){return new Ar({view(e){return new Sxe(e,t)}})}class Sxe{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=a=>{this[s](a)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),a=i.width/s.offsetWidth,l=i.height/s.offsetHeight;if(n){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let p=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(p){let m=p.getBoundingClientRect(),g=h?m.bottom:m.top;h&&f&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let y=this.width/2*l;r={left:m.left,right:m.right,top:g-y,bottom:g+y}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*a;r={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let c=this.editorView.dom.offsetParent;this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let u,d;if(!c||c==document.body&&getComputedStyle(c).position=="static")u=-pageXOffset,d=-pageYOffset;else{let h=c.getBoundingClientRect(),f=h.width/c.offsetWidth,p=h.height/c.offsetHeight;u=h.left-c.scrollLeft*f,d=h.top-c.scrollTop*p}this.element.style.left=(r.left-u)/a+"px",this.element.style.top=(r.top-d)/l+"px",this.element.style.width=(r.right-r.left)/a+"px",this.element.style.height=(r.bottom-r.top)/l+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let a=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=$W(this.editorView.state.doc,a,this.editorView.dragging.slice);l!=null&&(a=l)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const _xe=Kr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Nxe(this.options)]}});class Kn extends jt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Kn.valid(r)?new Kn(r):jt.near(r)}content(){return Ve.empty}eq(e){return e instanceof Kn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Kn(e.resolve(n.pos))}getBookmark(){return new aP(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!jxe(e)||!Exe(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Kn.valid(e))return e;let s=e.pos,i=null;for(let a=e.depth;;a--){let l=e.node(a);if(n>0?e.indexAfter(a)<l.childCount:e.index(a)>0){i=l.child(n>0?e.indexAfter(a):e.index(a)-1);break}else if(a==0)return null;s+=n;let c=e.doc.resolve(s);if(Kn.valid(c))return c}for(;;){let a=n>0?i.firstChild:i.lastChild;if(!a){if(i.isAtom&&!i.isText&&!nt.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=a,s+=n;let l=e.doc.resolve(s);if(Kn.valid(l))return l}return null}}}Kn.prototype.visible=!1;Kn.findFrom=Kn.findGapCursorFrom;jt.jsonID("gapcursor",Kn);class aP{constructor(e){this.pos=e}map(e){return new aP(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Kn.valid(n)?new Kn(n):jt.near(n)}}function _9(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function jxe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||_9(s.type))return!0;if(s.inlineContent)return!1}}return!0}function Exe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||_9(s.type))return!0;if(s.inlineContent)return!1}}return!0}function Cxe(){return new Ar({props:{decorations:Ixe,createSelectionBetween(t,e,n){return e.pos==n.pos&&Kn.valid(n)?new Kn(n):null},handleClick:Axe,handleKeyDown:Txe,handleDOMEvents:{beforeinput:kxe}}})}const Txe=kq({ArrowLeft:qx("horiz",-1),ArrowRight:qx("horiz",1),ArrowUp:qx("vert",-1),ArrowDown:qx("vert",1)});function qx(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let a=r.selection,l=e>0?a.$to:a.$from,c=a.empty;if(a instanceof pt){if(!i.endOfTextblock(n)||l.depth==0)return!1;c=!1,l=r.doc.resolve(e>0?l.after():l.before())}let u=Kn.findGapCursorFrom(l,e,c);return u?(s&&s(r.tr.setSelection(new Kn(u))),!0):!1}}function Axe(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Kn.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&nt.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Kn(r))),!0)}function kxe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Kn))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=we.empty;for(let a=r.length-1;a>=0;a--)s=we.from(r[a].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new Ve(s,0,0));return i.setSelection(pt.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function Ixe(t){if(!(t.selection instanceof Kn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",cr.create(t.doc,[Li.widget(t.selection.head,e,{key:"gapcursor"})])}const Pxe=Kr.create({name:"gapCursor",addProseMirrorPlugins(){return[Cxe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=xt(Ye(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Oxe=Ls.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",mr(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:a}=this.options,{splittableMarks:l}=r.extensionManager,c=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&c&&a){const h=c.filter(f=>l.includes(f.type.name));u.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Dxe=Ls.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,mr(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>YC({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var fw=200,Hr=function(){};Hr.prototype.append=function(e){return e.length?(e=Hr.from(e),!this.length&&e||e.length<fw&&this.leafAppend(e)||this.length<fw&&e.leafPrepend(this)||this.appendInner(e)):this};Hr.prototype.prepend=function(e){return e.length?Hr.from(e).append(this):this};Hr.prototype.appendInner=function(e){return new Rxe(this,e)};Hr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Hr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Hr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Hr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Hr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,a){return s.push(e(i,a))},n,r),s};Hr.from=function(e){return e instanceof Hr?e:e&&e.length?new j9(e):Hr.empty};var j9=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,a,l){for(var c=i;c<a;c++)if(s(this.values[c],l+c)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,a,l){for(var c=i-1;c>=a;c--)if(s(this.values[c],l+c)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=fw)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=fw)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Hr);Hr.empty=new j9([]);var Rxe=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,a){var l=this.left.length;if(s<l&&this.left.forEachInner(r,s,Math.min(i,l),a)===!1||i>l&&this.right.forEachInner(r,Math.max(s-l,0),Math.min(this.length,i)-l,a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,a){var l=this.left.length;if(s>l&&this.right.forEachInvertedInner(r,s-l,Math.max(i,l)-l,a+l)===!1||i<l&&this.left.forEachInvertedInner(r,Math.min(s,l),i,a)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Hr);const Mxe=500;class Ba{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let a=e.tr,l,c,u=[],d=[];return this.items.forEach((h,f)=>{if(!h.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,d.push(h);return}if(s){d.push(new oo(h.map));let p=h.step.map(s.slice(i)),m;p&&a.maybeStep(p).doc&&(m=a.mapping.maps[a.mapping.maps.length-1],u.push(new oo(m,void 0,void 0,u.length+d.length))),i--,m&&s.appendMap(m,i)}else a.maybeStep(h.step);if(h.selection)return l=s?h.selection.map(s.slice(i)):h.selection,c=new Ba(this.items.slice(0,r).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:a,selection:l}}addTransform(e,n,r,s){let i=[],a=this.eventCount,l=this.items,c=!s&&l.length?l.get(l.length-1):null;for(let d=0;d<e.steps.length;d++){let h=e.steps[d].invert(e.docs[d]),f=new oo(e.mapping.maps[d],h,n),p;(p=c&&c.merge(f))&&(f=p,d?i.pop():l=l.slice(0,l.length-1)),i.push(f),n&&(a++,n=void 0),s||(c=f)}let u=a-r.depth;return u>Fxe&&(l=Lxe(l,u),a-=u),new Ba(l.append(i),a)}remapping(e,n){let r=new vy;return this.items.forEach((s,i)=>{let a=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,a)},e,n),r}addMaps(e){return this.eventCount==0?this:new Ba(this.items.append(e.map(n=>new oo(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,a=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},s);let c=n;this.items.forEach(f=>{let p=i.getMirror(--c);if(p==null)return;a=Math.min(a,p);let m=i.maps[p];if(f.step){let g=e.steps[p].invert(e.docs[p]),y=f.selection&&f.selection.map(i.slice(c+1,p));y&&l++,r.push(new oo(m,g,y))}else r.push(new oo(m))},s);let u=[];for(let f=n;f<a;f++)u.push(new oo(i.maps[f]));let d=this.items.slice(0,s).append(u).append(r),h=new Ba(d,l);return h.emptyItemCount()>Mxe&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((a,l)=>{if(l>=e)s.push(a),a.selection&&i++;else if(a.step){let c=a.step.map(n.slice(r)),u=c&&c.getMap();if(r--,u&&n.appendMap(u,r),c){let d=a.selection&&a.selection.map(n.slice(r));d&&i++;let h=new oo(u.invert(),c,d),f,p=s.length-1;(f=s.length&&s[p].merge(h))?s[p]=f:s.push(h)}}else a.map&&r--},this.items.length,0),new Ba(Hr.from(s.reverse()),i)}}Ba.empty=new Ba(Hr.empty,0);function Lxe(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class oo{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new oo(n.getMap().invert(),n,this.selection)}}}class hc{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const Fxe=20;function Bxe(t,e,n,r){let s=n.getMeta(Td),i;if(s)return s.historyState;n.getMeta(Uxe)&&(t=new hc(t.done,t.undone,null,0,-1));let a=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(a&&a.getMeta(Td))return a.getMeta(Td).redo?new hc(t.done.addTransform(n,void 0,r,H0(e)),t.undone,TF(n.mapping.maps),t.prevTime,t.prevComposition):new hc(t.done,t.undone.addTransform(n,void 0,r,H0(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let l=n.getMeta("composition"),c=t.prevTime==0||!a&&t.prevComposition!=l&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Vxe(n,t.prevRanges)),u=a?Nj(t.prevRanges,n.mapping):TF(n.mapping.maps);return new hc(t.done.addTransform(n,c?e.selection.getBookmark():void 0,r,H0(e)),Ba.empty,u,n.time,l??t.prevComposition)}else return(i=n.getMeta("rebased"))?new hc(t.done.rebased(n,i),t.undone.rebased(n,i),Nj(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new hc(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Nj(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Vxe(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function TF(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,a)=>e.push(i,a));return e}function Nj(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function $xe(t,e,n){let r=H0(e),s=Td.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let a=i.selection.resolve(i.transform.doc),l=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),c=new hc(n?l:i.remaining,n?i.remaining:l,null,0,-1);return i.transform.setSelection(a).setMeta(Td,{redo:n,historyState:c})}let Sj=!1,AF=null;function H0(t){let e=t.plugins;if(AF!=e){Sj=!1,AF=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Sj=!0;break}}return Sj}const Td=new Zs("history"),Uxe=new Zs("closeHistory");function zxe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ar({key:Td,state:{init(){return new hc(Ba.empty,Ba.empty,null,0,-1)},apply(e,n,r){return Bxe(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?C9:r=="historyRedo"?T9:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function E9(t,e){return(n,r)=>{let s=Td.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=$xe(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const C9=E9(!1,!0),T9=E9(!0,!0),Hxe=Kr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>C9(t,e),redo:()=>({state:t,dispatch:e})=>T9(t,e)}},addProseMirrorPlugins(){return[zxe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),Wxe=Ls.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",mr(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!aye(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,i=t();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):e9(n)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:a,dispatch:l})=>{var c;if(l){const{$to:u}=a.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?a.setSelection(pt.create(a.doc,u.pos+1)):u.nodeAfter.isBlock?a.setSelection(nt.create(a.doc,u.pos)):a.setSelection(pt.create(a.doc,u.pos));else{const h=(c=u.parent.type.contentMatch.defaultType)===null||c===void 0?void 0:c.create();h&&(a.insert(d,h),a.setSelection(pt.create(a.doc,d+1)))}a.scrollIntoView()}return!0}).run()}}},addInputRules(){return[t9({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),qxe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Gxe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Kxe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Yxe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Qxe=Do.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[dp({find:qxe,type:this.type}),dp({find:Kxe,type:this.type})]},addPasteRules(){return[nh({find:Gxe,type:this.type}),nh({find:Yxe,type:this.type})]}}),Xxe=Ls.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",mr(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Jxe="listItem",kF="textStyle",IF=/^(\d+)\.\s$/,Zxe=Ls.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",mr(this.options.HTMLAttributes,n),0]:["ol",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Jxe,this.editor.getAttributes(kF)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=jy({find:IF,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=jy({find:IF,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(kF)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),e0e=Ls.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),t0e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,n0e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,r0e=Do.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[dp({find:t0e,type:this.type})]},addPasteRules(){return[nh({find:n0e,type:this.type})]}}),s0e=Ls.create({name:"text",group:"inline"}),i0e=Kr.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(hxe.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(oxe.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(pxe.configure(this.options.bulletList)),this.options.code!==!1&&t.push(yxe.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(bxe.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(wxe.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(_xe.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(Pxe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(Oxe.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(Dxe.configure(this.options.heading)),this.options.history!==!1&&t.push(Hxe.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(Wxe.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(Qxe.configure(this.options.italic)),this.options.listItem!==!1&&t.push(Xxe.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(Zxe.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(e0e.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(r0e.configure(this.options.strike)),this.options.text!==!1&&t.push(s0e.configure(this.options.text)),t}}),a0e=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,o0e=Ls.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",mr(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[t9({find:a0e,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),l0e="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",c0e="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",tT="numeric",nT="ascii",rT="alpha",Ag="asciinumeric",tg="alphanumeric",sT="domain",A9="emoji",u0e="scheme",d0e="slashscheme",_j="whitespace";function h0e(t,e){return t in e||(e[t]=[]),e[t]}function hd(t,e,n){e[tT]&&(e[Ag]=!0,e[tg]=!0),e[nT]&&(e[Ag]=!0,e[rT]=!0),e[Ag]&&(e[tg]=!0),e[rT]&&(e[tg]=!0),e[tg]&&(e[sT]=!0),e[A9]&&(e[sT]=!0);for(const r in e){const s=h0e(r,n);s.indexOf(t)<0&&s.push(t)}}function f0e(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function ui(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}ui.groups={};ui.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||ui.groups;let s;return e&&e.j?s=e:(s=new ui(e),n&&r&&hd(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let a=0;a<i-1;a++)s=s.tt(t[a]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||ui.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let a,l=s.go(t);if(l?(a=new ui,Object.assign(a.j,l.j),a.jr.push.apply(a.jr,l.jr),a.jd=l.jd,a.t=l.t):a=new ui,i){if(r)if(a.t&&typeof a.t=="string"){const c=Object.assign(f0e(a.t,r),n);hd(i,c,r)}else n&&hd(i,n,r);a.t=i}return s.j[t]=a,a}};const St=(t,e,n,r,s)=>t.ta(e,n,r,s),zn=(t,e,n,r,s)=>t.tr(e,n,r,s),PF=(t,e,n,r,s)=>t.ts(e,n,r,s),_e=(t,e,n,r,s)=>t.tt(e,n,r,s),Jo="WORD",iT="UWORD",k9="ASCIINUMERICAL",I9="ALPHANUMERICAL",Ty="LOCALHOST",aT="TLD",oT="UTLD",W0="SCHEME",Jh="SLASH_SCHEME",oP="NUM",lT="WS",lP="NL",kg="OPENBRACE",Ig="CLOSEBRACE",pw="OPENBRACKET",mw="CLOSEBRACKET",gw="OPENPAREN",yw="CLOSEPAREN",vw="OPENANGLEBRACKET",xw="CLOSEANGLEBRACKET",bw="FULLWIDTHLEFTPAREN",ww="FULLWIDTHRIGHTPAREN",Nw="LEFTCORNERBRACKET",Sw="RIGHTCORNERBRACKET",_w="LEFTWHITECORNERBRACKET",jw="RIGHTWHITECORNERBRACKET",Ew="FULLWIDTHLESSTHAN",Cw="FULLWIDTHGREATERTHAN",Tw="AMPERSAND",Aw="APOSTROPHE",kw="ASTERISK",fc="AT",Iw="BACKSLASH",Pw="BACKTICK",Ow="CARET",Cc="COLON",cP="COMMA",Dw="DOLLAR",lo="DOT",Rw="EQUALS",uP="EXCLAMATION",ua="HYPHEN",Pg="PERCENT",Mw="PIPE",Lw="PLUS",Fw="POUND",Og="QUERY",dP="QUOTE",P9="FULLWIDTHMIDDLEDOT",hP="SEMI",co="SLASH",Dg="TILDE",Bw="UNDERSCORE",O9="EMOJI",Vw="SYM";var D9=Object.freeze({__proto__:null,ALPHANUMERICAL:I9,AMPERSAND:Tw,APOSTROPHE:Aw,ASCIINUMERICAL:k9,ASTERISK:kw,AT:fc,BACKSLASH:Iw,BACKTICK:Pw,CARET:Ow,CLOSEANGLEBRACKET:xw,CLOSEBRACE:Ig,CLOSEBRACKET:mw,CLOSEPAREN:yw,COLON:Cc,COMMA:cP,DOLLAR:Dw,DOT:lo,EMOJI:O9,EQUALS:Rw,EXCLAMATION:uP,FULLWIDTHGREATERTHAN:Cw,FULLWIDTHLEFTPAREN:bw,FULLWIDTHLESSTHAN:Ew,FULLWIDTHMIDDLEDOT:P9,FULLWIDTHRIGHTPAREN:ww,HYPHEN:ua,LEFTCORNERBRACKET:Nw,LEFTWHITECORNERBRACKET:_w,LOCALHOST:Ty,NL:lP,NUM:oP,OPENANGLEBRACKET:vw,OPENBRACE:kg,OPENBRACKET:pw,OPENPAREN:gw,PERCENT:Pg,PIPE:Mw,PLUS:Lw,POUND:Fw,QUERY:Og,QUOTE:dP,RIGHTCORNERBRACKET:Sw,RIGHTWHITECORNERBRACKET:jw,SCHEME:W0,SEMI:hP,SLASH:co,SLASH_SCHEME:Jh,SYM:Vw,TILDE:Dg,TLD:aT,UNDERSCORE:Bw,UTLD:oT,UWORD:iT,WORD:Jo,WS:lT});const Yo=/[a-z]/,Pm=new RegExp("\\p{L}","u"),jj=new RegExp("\\p{Emoji}","u"),Qo=/\d/,Ej=/\s/,OF="\r",Cj=`
`,p0e="",m0e="",Tj="";let Gx=null,Kx=null;function g0e(t=[]){const e={};ui.groups=e;const n=new ui;Gx==null&&(Gx=DF(l0e)),Kx==null&&(Kx=DF(c0e)),_e(n,"'",Aw),_e(n,"{",kg),_e(n,"}",Ig),_e(n,"[",pw),_e(n,"]",mw),_e(n,"(",gw),_e(n,")",yw),_e(n,"<",vw),_e(n,">",xw),_e(n,"",bw),_e(n,"",ww),_e(n,"",Nw),_e(n,"",Sw),_e(n,"",_w),_e(n,"",jw),_e(n,"",Ew),_e(n,"",Cw),_e(n,"&",Tw),_e(n,"*",kw),_e(n,"@",fc),_e(n,"`",Pw),_e(n,"^",Ow),_e(n,":",Cc),_e(n,",",cP),_e(n,"$",Dw),_e(n,".",lo),_e(n,"=",Rw),_e(n,"!",uP),_e(n,"-",ua),_e(n,"%",Pg),_e(n,"|",Mw),_e(n,"+",Lw),_e(n,"#",Fw),_e(n,"?",Og),_e(n,'"',dP),_e(n,"/",co),_e(n,";",hP),_e(n,"~",Dg),_e(n,"_",Bw),_e(n,"\\",Iw),_e(n,"",P9);const r=zn(n,Qo,oP,{[tT]:!0});zn(r,Qo,r);const s=zn(r,Yo,k9,{[Ag]:!0}),i=zn(r,Pm,I9,{[tg]:!0}),a=zn(n,Yo,Jo,{[nT]:!0});zn(a,Qo,s),zn(a,Yo,a),zn(s,Qo,s),zn(s,Yo,s);const l=zn(n,Pm,iT,{[rT]:!0});zn(l,Yo),zn(l,Qo,i),zn(l,Pm,l),zn(i,Qo,i),zn(i,Yo),zn(i,Pm,i);const c=_e(n,Cj,lP,{[_j]:!0}),u=_e(n,OF,lT,{[_j]:!0}),d=zn(n,Ej,lT,{[_j]:!0});_e(n,Tj,d),_e(u,Cj,c),_e(u,Tj,d),zn(u,Ej,d),_e(d,OF),_e(d,Cj),zn(d,Ej,d),_e(d,Tj,d);const h=zn(n,jj,O9,{[A9]:!0});_e(h,"#"),zn(h,jj,h),_e(h,p0e,h);const f=_e(h,m0e);_e(f,"#"),zn(f,jj,h);const p=[[Yo,a],[Qo,s]],m=[[Yo,null],[Pm,l],[Qo,i]];for(let g=0;g<Gx.length;g++)oc(n,Gx[g],aT,Jo,p);for(let g=0;g<Kx.length;g++)oc(n,Kx[g],oT,iT,m);hd(aT,{tld:!0,ascii:!0},e),hd(oT,{utld:!0,alpha:!0},e),oc(n,"file",W0,Jo,p),oc(n,"mailto",W0,Jo,p),oc(n,"http",Jh,Jo,p),oc(n,"https",Jh,Jo,p),oc(n,"ftp",Jh,Jo,p),oc(n,"ftps",Jh,Jo,p),hd(W0,{scheme:!0,ascii:!0},e),hd(Jh,{slashscheme:!0,ascii:!0},e),t=t.sort((g,y)=>g[0]>y[0]?1:-1);for(let g=0;g<t.length;g++){const y=t[g][0],w=t[g][1]?{[u0e]:!0}:{[d0e]:!0};y.indexOf("-")>=0?w[sT]=!0:Yo.test(y)?Qo.test(y)?w[Ag]=!0:w[nT]=!0:w[tT]=!0,PF(n,y,y,w)}return PF(n,"localhost",Ty,{ascii:!0}),n.jd=new ui(Vw),{start:n,tokens:Object.assign({groups:e},D9)}}function R9(t,e){const n=y0e(e.replace(/[A-Z]/g,l=>l.toLowerCase())),r=n.length,s=[];let i=0,a=0;for(;a<r;){let l=t,c=null,u=0,d=null,h=-1,f=-1;for(;a<r&&(c=l.go(n[a]));)l=c,l.accepts()?(h=0,f=0,d=l):h>=0&&(h+=n[a].length,f++),u+=n[a].length,i+=n[a].length,a++;i-=h,a-=f,u-=h,s.push({t:d.t,v:e.slice(i-u,i),s:i-u,e:i})}return s}function y0e(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,a=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(a),r+=a.length}return e}function oc(t,e,n,r,s){let i;const a=e.length;for(let l=0;l<a-1;l++){const c=e[l];t.j[c]?i=t.j[c]:(i=new ui(r),i.jr=s.slice(),t.j[c]=i),t=i}return i=new ui(n),i.jr=s.slice(),t.j[e[a-1]]=i,i}function DF(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let a=parseInt(t.substring(r,r+i),10);a>0;a--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Ay={defaultProtocol:"http",events:null,format:RF,formatHref:RF,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function fP(t,e=null){let n=Object.assign({},Ay);t&&(n=Object.assign(n,t instanceof fP?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}fP.prototype={o:Ay,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Ay[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function RF(t){return t}function M9(t,e){this.t="token",this.v=t,this.tk=e}M9.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Ay.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),a={},l=t.get("className",n,e),c=t.get("target",n,e),u=t.get("rel",n,e),d=t.getObj("attributes",n,e),h=t.getObj("events",n,e);return a.href=r,l&&(a.class=l),c&&(a.target=c),u&&(a.rel=u),d&&Object.assign(a,d),{tagName:s,attributes:a,content:i,eventListeners:h}}};function YN(t,e){class n extends M9{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const MF=YN("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),LF=YN("text"),v0e=YN("nl"),Yx=YN("url",{isLink:!0,toHref(t=Ay.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Ty&&t[1].t===Cc}}),aa=t=>new ui(t);function x0e({groups:t}){const e=t.domain.concat([Tw,kw,fc,Iw,Pw,Ow,Dw,Rw,ua,oP,Pg,Mw,Lw,Fw,co,Vw,Dg,Bw]),n=[Aw,Cc,cP,lo,uP,Pg,Og,dP,hP,vw,xw,kg,Ig,mw,pw,gw,yw,bw,ww,Nw,Sw,_w,jw,Ew,Cw],r=[Tw,Aw,kw,Iw,Pw,Ow,Dw,Rw,ua,kg,Ig,Pg,Mw,Lw,Fw,Og,co,Vw,Dg,Bw],s=aa(),i=_e(s,Dg);St(i,r,i),St(i,t.domain,i);const a=aa(),l=aa(),c=aa();St(s,t.domain,a),St(s,t.scheme,l),St(s,t.slashscheme,c),St(a,r,i),St(a,t.domain,a);const u=_e(a,fc);_e(i,fc,u),_e(l,fc,u),_e(c,fc,u);const d=_e(i,lo);St(d,r,i),St(d,t.domain,i);const h=aa();St(u,t.domain,h),St(h,t.domain,h);const f=_e(h,lo);St(f,t.domain,h);const p=aa(MF);St(f,t.tld,p),St(f,t.utld,p),_e(u,Ty,p);const m=_e(h,ua);_e(m,ua,m),St(m,t.domain,h),St(p,t.domain,h),_e(p,lo,f),_e(p,ua,m);const g=_e(p,Cc);St(g,t.numeric,MF);const y=_e(a,ua),x=_e(a,lo);_e(y,ua,y),St(y,t.domain,a),St(x,r,i),St(x,t.domain,a);const w=aa(Yx);St(x,t.tld,w),St(x,t.utld,w),St(w,t.domain,a),St(w,r,i),_e(w,lo,x),_e(w,ua,y),_e(w,fc,u);const N=_e(w,Cc),S=aa(Yx);St(N,t.numeric,S);const C=aa(Yx),A=aa();St(C,e,C),St(C,n,A),St(A,e,C),St(A,n,A),_e(w,co,C),_e(S,co,C);const j=_e(l,Cc),_=_e(c,Cc),E=_e(_,co),I=_e(E,co);St(l,t.domain,a),_e(l,lo,x),_e(l,ua,y),St(c,t.domain,a),_e(c,lo,x),_e(c,ua,y),St(j,t.domain,C),_e(j,co,C),_e(j,Og,C),St(I,t.domain,C),St(I,e,C),_e(I,co,C);const T=[[kg,Ig],[pw,mw],[gw,yw],[vw,xw],[bw,ww],[Nw,Sw],[_w,jw],[Ew,Cw]];for(let P=0;P<T.length;P++){const[O,H]=T[P],X=_e(C,O);_e(A,O,X),_e(X,H,C);const se=aa(Yx);St(X,e,se);const L=aa();St(X,n),St(se,e,se),St(se,n,L),St(L,e,se),St(L,n,L),_e(se,H,C),_e(L,H,C)}return _e(s,Ty,w),_e(s,lP,v0e),{start:s,tokens:D9}}function b0e(t,e,n){let r=n.length,s=0,i=[],a=[];for(;s<r;){let l=t,c=null,u=null,d=0,h=null,f=-1;for(;s<r&&!(c=l.go(n[s].t));)a.push(n[s++]);for(;s<r&&(u=c||l.go(n[s].t));)c=null,l=u,l.accepts()?(f=0,h=l):f>=0&&f++,s++,d++;if(f<0)s-=d,s<r&&(a.push(n[s]),s++);else{a.length>0&&(i.push(Aj(LF,e,a)),a=[]),s-=f,d-=f;const p=h.t,m=n.slice(s-d,s);i.push(Aj(p,e,m))}}return a.length>0&&i.push(Aj(LF,e,a)),i}function Aj(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const w0e=typeof console<"u"&&console&&console.warn||(()=>{}),N0e="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",xn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function S0e(){return ui.groups={},xn.scanner=null,xn.parser=null,xn.tokenQueue=[],xn.pluginQueue=[],xn.customSchemes=[],xn.initialized=!1,xn}function FF(t,e=!1){if(xn.initialized&&w0e(`linkifyjs: already initialized - will not register custom scheme "${t}" ${N0e}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);xn.customSchemes.push([t,e])}function _0e(){xn.scanner=g0e(xn.customSchemes);for(let t=0;t<xn.tokenQueue.length;t++)xn.tokenQueue[t][1]({scanner:xn.scanner});xn.parser=x0e(xn.scanner.tokens);for(let t=0;t<xn.pluginQueue.length;t++)xn.pluginQueue[t][1]({scanner:xn.scanner,parser:xn.parser});return xn.initialized=!0,xn}function pP(t){return xn.initialized||_0e(),b0e(xn.parser.start,t,R9(xn.scanner.start,t))}pP.scan=R9;function L9(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new fP(n),s=pP(t),i=[];for(let a=0;a<s.length;a++){const l=s[a];l.isLink&&(!e||l.t===e)&&r.check(l)&&i.push(l.toFormattedObject(r))}return i}const mP="[\0- -\u2029]",j0e=new RegExp(mP),E0e=new RegExp(`${mP}$`),C0e=new RegExp(mP,"g");function T0e(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function A0e(t){return new Ar({key:new Zs("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(u=>u.docChanged)&&!n.doc.eq(r.doc),i=e.some(u=>u.getMeta("preventAutolink"));if(!s||i)return;const{tr:a}=r,l=vge(n.doc,[...e]);if(Ege(l).forEach(({newRange:u})=>{const d=bge(r.doc,u,p=>p.isTextblock);let h,f;if(d.length>1)h=d[0],f=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(d.length){const p=r.doc.textBetween(u.from,u.to," "," ");if(!E0e.test(p))return;h=d[0],f=r.doc.textBetween(h.pos,u.to,void 0," ")}if(h&&f){const p=f.split(j0e).filter(Boolean);if(p.length<=0)return!1;const m=p[p.length-1],g=h.pos+f.lastIndexOf(m);if(!m)return!1;const y=pP(m).map(x=>x.toObject(t.defaultProtocol));if(!T0e(y))return!1;y.filter(x=>x.isLink).map(x=>({...x,from:g+x.start+1,to:g+x.end+1})).filter(x=>r.schema.marks.code?!r.doc.rangeHasMark(x.from,x.to,r.schema.marks.code):!0).filter(x=>t.validate(x.value)).filter(x=>t.shouldAutoLink(x.value)).forEach(x=>{YI(x.from,x.to,r.doc).some(w=>w.mark.type===t.type)||a.addMark(x.from,x.to,t.type.create({href:x.href}))})}}),!!a.steps.length)return a}})}function k0e(t){return new Ar({key:new Zs("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0||!e.editable)return!1;let a=r.target;const l=[];for(;a.nodeName!=="DIV";)l.push(a),a=a.parentNode;if(!l.find(f=>f.nodeName==="A"))return!1;const c=Zq(e.state,t.type.name),u=r.target,d=(s=u==null?void 0:u.href)!==null&&s!==void 0?s:c.href,h=(i=u==null?void 0:u.target)!==null&&i!==void 0?i:c.target;return u&&d?(window.open(d,h),!0):!1}}})}function I0e(t){return new Ar({key:new Zs("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:i}=s,{empty:a}=i;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=L9(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function Hu(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(C0e,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const P0e=Do.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){FF(t);return}FF(t.scheme,t.optionalSlashes)})},onDestroy(){S0e()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Hu(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Hu(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Hu(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",mr(this.options.HTMLAttributes,t),0]:["a",mr(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Hu(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Hu(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[nh({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=L9(t).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:a=>!!Hu(a,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(i=>e.push({text:i.value,data:{href:i.href},index:i.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(A0e({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!Hu(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(k0e({type:this.type})),this.options.linkOnPaste&&t.push(I0e({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),O0e=Kr.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).every(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(e=>e),toggleTextAlign:t=>({editor:e,commands:n})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),D0e=Do.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",mr(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),R0e=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,M0e=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/g,F9=t=>t.match(R0e),L0e=(t,e)=>e?"https://www.youtube-nocookie.com/embed/videoseries?list=":t?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",F0e=t=>t.searchParams.has("v")?{id:t.searchParams.get("v")}:t.hostname==="youtu.be"||t.pathname.includes("shorts")||t.pathname.includes("live")?{id:t.pathname.split("/").pop()}:t.searchParams.has("list")?{id:t.searchParams.get("list"),isPlaylist:!0}:null,B0e=t=>{var e;const{url:n,allowFullscreen:r,autoplay:s,ccLanguage:i,ccLoadPolicy:a,controls:l,disableKBcontrols:c,enableIFrameApi:u,endTime:d,interfaceLanguage:h,ivLoadPolicy:f,loop:p,modestBranding:m,nocookie:g,origin:y,playlist:x,progressBarColor:w,startAt:N,rel:S}=t;if(!F9(n))return null;if(n.includes("/embed/"))return n;const C=new URL(n),{id:A,isPlaylist:j}=(e=F0e(C))!==null&&e!==void 0?e:{};if(!A)return null;const _=new URL(`${L0e(g,j)}${A}`);return C.searchParams.has("t")&&_.searchParams.set("start",C.searchParams.get("t").replaceAll("s","")),r===!1&&_.searchParams.set("fs","0"),s&&_.searchParams.set("autoplay","1"),i&&_.searchParams.set("cc_lang_pref",i),a&&_.searchParams.set("cc_load_policy","1"),l||_.searchParams.set("controls","0"),c&&_.searchParams.set("disablekb","1"),u&&_.searchParams.set("enablejsapi","1"),d&&_.searchParams.set("end",d.toString()),h&&_.searchParams.set("hl",h),f&&_.searchParams.set("iv_load_policy",f.toString()),p&&_.searchParams.set("loop","1"),m&&_.searchParams.set("modestbranding","1"),y&&_.searchParams.set("origin",y),x&&_.searchParams.set("playlist",x),N&&_.searchParams.set("start",N.toString()),w&&_.searchParams.set("color",w),S!==void 0&&_.searchParams.set("rel",S.toString()),_.toString()},V0e=Ls.create({name:"youtube",addOptions(){return{addPasteHandler:!0,allowFullscreen:!0,autoplay:!1,ccLanguage:void 0,ccLoadPolicy:void 0,controls:!0,disableKBcontrols:!1,enableIFrameApi:!1,endTime:0,height:480,interfaceLanguage:void 0,ivLoadPolicy:0,loop:!1,modestBranding:!1,HTMLAttributes:{},inline:!1,nocookie:!1,origin:"",playlist:"",progressBarColor:void 0,width:640,rel:1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},start:{default:0},width:{default:this.options.width},height:{default:this.options.height}}},parseHTML(){return[{tag:"div[data-youtube-video] iframe"}]},addCommands(){return{setYoutubeVideo:t=>({commands:e})=>F9(t.src)?e.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[oye({find:M0e,type:this.type,getAttributes:t=>({src:t.input})})]:[]},renderHTML({HTMLAttributes:t}){const e=B0e({url:t.src,allowFullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,controls:this.options.controls,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,nocookie:this.options.nocookie,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,startAt:t.start||0,rel:this.options.rel});return t.src=e,["div",{"data-youtube-video":""},["iframe",mr(this.options.HTMLAttributes,{width:this.options.width,height:this.options.height,allowfullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,rel:this.options.rel},t)]]}}),$0e=Kr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Ar({key:new Zs("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((a,l)=>{const c=r>=l&&r<=l+a.nodeSize,u=!a.isLeaf&&qN(a);if((c||!this.options.showOnlyCurrent)&&u){const d=[this.options.emptyNodeClass];i&&d.push(this.options.emptyEditorClass);const h=Li.node(l,l+a.nodeSize,{class:d.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:l,hasAnchor:c}):this.options.placeholder});s.push(h)}return this.options.includeChildren}),cr.create(t,s)}}})]}});function U0e({isOpen:t,onClose:e,onInsert:n}){const[r,s]=b.useState("upload"),[i,a]=b.useState(""),[l,c]=b.useState(!1),[u,d]=b.useState(0),[h,f]=b.useState(""),[p,m]=b.useState(""),g=()=>{s("upload"),a(""),c(!1),d(0),f(""),m("")},y=()=>{g(),e()},x=b.useCallback(async S=>{var A;const C=(A=S.target.files)==null?void 0:A[0];if(C){if(!C.type.startsWith("image/")){m("Please select an image file");return}if(C.size>10*1024*1024){m("Image must be less than 10MB");return}m(""),c(!0);try{const j=Date.now(),_=C.name.replace(/[^a-zA-Z0-9.-]/g,"_"),E=`blog/${j}_${_}`,I=Yd(Qd,E),T=TN(I,C);T.on("state_changed",P=>{const O=P.bytesTransferred/P.totalBytes*100;d(O)},P=>{console.error("Upload error:",P),m("Failed to upload image"),c(!1)},async()=>{const P=await bv(T.snapshot.ref);f(P),a(P),c(!1)})}catch(j){console.error("Upload error:",j),m("Failed to upload image"),c(!1)}}},[]),w=S=>{const C=S.target.value;a(C),f(C||"")},N=()=>{i&&(n(i),g())};return o.jsx(ut,{isOpen:t,onClose:y,title:"Insert Image",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:y,children:"Cancel"}),o.jsx(K,{onClick:N,disabled:!i||l,children:"Insert Image"})]}),children:o.jsxs("div",{className:"image-upload-modal",children:[o.jsxs("div",{className:"upload-tabs",children:[o.jsx("button",{type:"button",className:`upload-tab ${r==="upload"?"active":""}`,onClick:()=>s("upload"),children:"Upload"}),o.jsx("button",{type:"button",className:`upload-tab ${r==="url"?"active":""}`,onClick:()=>s("url"),children:"URL"})]}),r==="upload"?o.jsx("div",{className:"upload-area",children:l?o.jsxs("div",{className:"upload-progress",children:[o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-fill",style:{width:`${u}%`}})}),o.jsxs("p",{children:["Uploading... ",Math.round(u),"%"]})]}):h?o.jsxs("div",{className:"upload-preview",children:[o.jsx("img",{src:h,alt:"Preview"}),o.jsx("button",{type:"button",className:"preview-change-btn",onClick:()=>{f(""),a("")},children:"Change image"})]}):o.jsxs("label",{className:"upload-dropzone",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:x,style:{display:"none"}}),o.jsxs("div",{className:"dropzone-content",children:[o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("p",{children:"Click to upload or drag and drop"}),o.jsx("span",{children:"PNG, JPG, GIF up to 10MB"})]})]})}):o.jsxs("div",{className:"url-area",children:[o.jsx(ye,{label:"Image URL",value:i,onChange:w,placeholder:"https://example.com/image.jpg"}),h&&o.jsx("div",{className:"url-preview",children:o.jsx("img",{src:h,alt:"Preview",onError:()=>f("")})})]}),p&&o.jsx("p",{className:"upload-error",children:p})]})})}const Qx=[{name:"blue",bg:"#dbeafe",border:"#93c5fd",text:"#1e40af"},{name:"green",bg:"#dcfce7",border:"#86efac",text:"#166534"},{name:"purple",bg:"#f3e8ff",border:"#d8b4fe",text:"#7c3aed"},{name:"pink",bg:"#fce7f3",border:"#f9a8d4",text:"#be185d"},{name:"orange",bg:"#ffedd5",border:"#fdba74",text:"#c2410c"},{name:"teal",bg:"#ccfbf1",border:"#5eead4",text:"#0f766e"},{name:"yellow",bg:"#fef9c3",border:"#fde047",text:"#a16207"},{name:"red",bg:"#fee2e2",border:"#fca5a5",text:"#b91c1c"},{name:"indigo",bg:"#e0e7ff",border:"#a5b4fc",text:"#4338ca"},{name:"cyan",bg:"#cffafe",border:"#67e8f9",text:"#0e7490"}];function B9(){const[t,e]=b.useState([]),[n,r]=b.useState(!0);b.useEffect(()=>{(async()=>{r(!0);try{const f=We(ke,"settings","media_tags"),p=await us(f);p.exists()?e(p.data().tags||[]):e([])}catch(f){console.error("Error fetching media tags:",f),e([])}r(!1)})()},[]);const s=async h=>{try{const f=We(ke,"settings","media_tags");return await mu(f,{tags:h}),e(h),!0}catch(f){return console.error("Error saving media tags:",f),!1}},i=()=>{const h=t.map(f=>f.color);for(const f of Qx)if(!h.includes(f.name))return f;return Qx[t.length%Qx.length]};return{tags:t,loading:n,createTag:async h=>{if(!h.trim())return!1;const f=h.trim();if(t.some(g=>g.name.toLowerCase()===f.toLowerCase()))return!1;const p=i(),m={id:`tag_${Date.now()}`,name:f,color:p.name,bg:p.bg,border:p.border,text:p.text,createdAt:new Date().toISOString()};return await s([...t,m])},deleteTag:async h=>{const f=t.filter(p=>p.id!==h);return await s(f)},renameTag:async(h,f)=>{if(!f.trim())return!1;const p=f.trim();if(t.some(g=>g.id!==h&&g.name.toLowerCase()===p.toLowerCase()))return!1;const m=t.map(g=>g.id===h?{...g,name:p}:g);return await s(m)},getTag:h=>t.find(f=>f.id===h),getTagsByIds:h=>t.filter(f=>h.includes(f.id)),TAG_COLORS:Qx}}function z0e({isOpen:t,onClose:e,onInsert:n}){const[r,s]=b.useState("library"),[i,a]=b.useState([]),[l,c]=b.useState(!1),[u,d]=b.useState(0),[h,f]=b.useState(""),[p,m]=b.useState(""),[g,y]=b.useState([]),{data:x}=pn("media",[qr("createdAt","desc")]),{tags:w,getTagsByIds:N}=B9(),S=g.length===0?x:x.filter(L=>g.some(B=>{var $;return($=L.tags)==null?void 0:$.includes(B)})),C=()=>{s("library"),a([]),c(!1),d(0),f(""),m(""),y([])},A=()=>{C(),e()},j=L=>{y(B=>B.includes(L)?B.filter($=>$!==L):[...B,L])},_=()=>{const L=S.map(B=>{var $;return{url:B.url,alt:(($=B.originalFilename)==null?void 0:$.replace(/\.[^/.]+$/,"").replace(/[_-]/g," "))||"Image"}});a(B=>{const $=new Set(B.map(Y=>Y.url)),q=L.filter(Y=>!$.has(Y.url));return[...B,...q]})},E=L=>{i.some(B=>B.url===L.url)||a(B=>{var $;return[...B,{url:L.url,alt:(($=L.originalFilename)==null?void 0:$.replace(/\.[^/.]+$/,"").replace(/[_-]/g," "))||"Image"}]})},I=L=>i.some(B=>B.url===L),T=b.useCallback(async L=>{const B=Array.from(L.target.files||[]);if(B.length===0)return;const $=B.filter(R=>!(!R.type.startsWith("image/")||R.size>10*1024*1024));if($.length===0){m("Please select valid image files (max 10MB each)");return}m(""),c(!0);const q=[];let Y=0;for(const R of $)try{const G=Date.now(),Z=R.name.replace(/[^a-zA-Z0-9.-]/g,"_"),W=`blog/carousel/${G}_${Z}`,Q=Yd(Qd,W),U=TN(Q,R);await new Promise((pe,J)=>{U.on("state_changed",ge=>{const me=ge.bytesTransferred/ge.totalBytes,ue=(Y+me)/$.length*100;d(ue)},J,async()=>{const ge=await bv(U.snapshot.ref);q.push({url:ge,alt:R.name.replace(/\.[^/.]+$/,"").replace(/[_-]/g," ")}),Y++,pe()})})}catch(G){console.error("Upload error:",G)}a(R=>[...R,...q]),c(!1),d(0),L.target.value=""},[]),P=()=>{h.trim()&&(a(L=>[...L,{url:h.trim(),alt:"Image"}]),f(""))},O=L=>{a(B=>B.filter(($,q)=>q!==L))},H=(L,B)=>{a($=>$.map((q,Y)=>Y===L?{...q,alt:B}:q))},X=(L,B)=>{const $=L+B;if($<0||$>=i.length)return;const q=[...i];[q[L],q[$]]=[q[$],q[L]],a(q)},se=()=>{i.length>=2&&(n(i),C())};return o.jsx(ut,{isOpen:t,onClose:A,title:"Create Image Carousel",size:"large",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:A,children:"Cancel"}),o.jsxs(K,{onClick:se,disabled:i.length<2,children:["Insert Carousel (",i.length," images)"]})]}),children:o.jsxs("div",{className:"carousel-modal",children:[o.jsxs("div",{className:"carousel-mode-tabs",children:[o.jsxs("button",{type:"button",className:`carousel-mode-tab ${r==="library"?"active":""}`,onClick:()=>s("library"),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]}),"Media Library"]}),o.jsxs("button",{type:"button",className:`carousel-mode-tab ${r==="upload"?"active":""}`,onClick:()=>s("upload"),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),"Upload New"]})]}),r==="library"?o.jsxs("div",{className:"carousel-library-section",children:[o.jsxs("div",{className:"carousel-tag-filters",children:[o.jsx("span",{className:"filter-label",children:"Filter by tag:"}),o.jsxs("div",{className:"carousel-tag-list",children:[w.map(L=>o.jsx("button",{type:"button",className:`carousel-tag-btn ${g.includes(L.id)?"selected":""}`,onClick:()=>j(L.id),style:{"--tag-bg":L.bg,"--tag-border":L.border,"--tag-text":L.text},children:L.name},L.id)),w.length===0&&o.jsx("span",{className:"no-tags-text",children:"No tags created yet"})]}),g.length>0&&S.length>0&&o.jsxs(K,{size:"small",variant:"secondary",onClick:_,children:["Add all ",S.length," images"]})]}),o.jsx("div",{className:"carousel-media-grid",children:S.length===0?o.jsx("div",{className:"carousel-no-media",children:g.length>0?"No images with selected tags":"No images in media library"}):S.map(L=>{var B;return o.jsxs("div",{className:`carousel-media-item ${I(L.url)?"selected":""}`,onClick:()=>E(L),children:[o.jsx("img",{src:L.url,alt:L.originalFilename}),I(L.url)&&o.jsx("div",{className:"carousel-media-check",children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})}),((B=L.tags)==null?void 0:B.length)>0&&o.jsx("div",{className:"carousel-media-tags",children:N(L.tags).slice(0,2).map($=>o.jsx("span",{className:"carousel-media-tag",style:{background:$.bg,color:$.text},children:$.name},$.id))})]},L.id)})})]}):o.jsxs("div",{className:"carousel-upload-section",children:[o.jsxs("div",{className:"carousel-upload-options",children:[o.jsxs("label",{className:"carousel-upload-btn",children:[o.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:T,style:{display:"none"},disabled:l}),o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("span",{children:"Upload Images"})]}),o.jsxs("div",{className:"carousel-url-input",children:[o.jsx(ye,{placeholder:"Or paste image URL",value:h,onChange:L=>f(L.target.value),onKeyDown:L=>L.key==="Enter"&&P()}),o.jsx(K,{onClick:P,disabled:!h.trim(),children:"Add"})]})]}),l&&o.jsxs("div",{className:"carousel-upload-progress",children:[o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-fill",style:{width:`${u}%`}})}),o.jsxs("p",{children:["Uploading... ",Math.round(u),"%"]})]})]}),p&&o.jsx("p",{className:"upload-error",children:p}),i.length>0&&o.jsxs("div",{className:"carousel-images",children:[o.jsxs("p",{className:"carousel-hint",children:[i.length," image(s) selected. Drag to reorder. Need at least 2 for carousel."]}),o.jsx("div",{className:"carousel-image-list",children:i.map((L,B)=>o.jsxs("div",{className:"carousel-image-item",children:[o.jsxs("div",{className:"carousel-image-preview",children:[o.jsx("img",{src:L.url,alt:L.alt}),o.jsx("span",{className:"carousel-image-number",children:B+1})]}),o.jsxs("div",{className:"carousel-image-controls",children:[o.jsx(ye,{placeholder:"Alt text",value:L.alt,onChange:$=>H(B,$.target.value)}),o.jsxs("div",{className:"carousel-image-actions",children:[o.jsx("button",{type:"button",onClick:()=>X(B,-1),disabled:B===0,title:"Move left",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsx("button",{type:"button",onClick:()=>X(B,1),disabled:B===i.length-1,title:"Move right",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx("button",{type:"button",onClick:()=>O(B),className:"delete-btn",title:"Remove",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})]},B))})]}),i.length===0&&!l&&o.jsx("div",{className:"carousel-empty",children:o.jsx("p",{children:r==="library"?"Click images to add them to the carousel":"Upload images or paste URLs to create a carousel"})})]})})}function V9({content:t,onChange:e,placeholder:n="Start writing..."}){const[r,s]=b.useState(!1),[i,a]=b.useState(!1),[l,c]=b.useState(!1),[u,d]=b.useState(!1),[h,f]=b.useState(""),p=txe({extensions:[i0e.configure({heading:{levels:[1,2,3]}}),o0e.configure({HTMLAttributes:{class:"editor-image"}}),P0e.configure({openOnClick:!1,HTMLAttributes:{class:"editor-link"}}),O0e.configure({types:["heading","paragraph"]}),D0e,V0e.configure({width:640,height:360,HTMLAttributes:{class:"editor-youtube"}}),$0e.configure({placeholder:n})],content:t,onUpdate:({editor:N})=>{e(N.getHTML())}}),m=b.useCallback(()=>{h?p.chain().focus().extendMarkRange("link").setLink({href:h}).run():p.chain().focus().extendMarkRange("link").unsetLink().run(),s(!1),f("")},[p,h]),g=()=>{const N=p.getAttributes("link").href;f(N||""),s(!0)},y=N=>{N&&p.chain().focus().setImage({src:N}).run(),a(!1)},x=N=>{N&&p.chain().focus().setYoutubeVideo({src:N}).run(),c(!1)},w=N=>{if(N&&N.length>0){const S=`
        <div class="image-carousel" data-images='${JSON.stringify(N)}'>
          <div class="carousel-placeholder">
            Image Carousel (${N.length} images)
          </div>
        </div>
      `;p.chain().focus().insertContent(S).run()}d(!1)};return p?o.jsxs("div",{className:"rich-text-editor",children:[o.jsxs("div",{className:"editor-toolbar",children:[o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBold().run(),className:`toolbar-btn ${p.isActive("bold")?"active":""}`,title:"Bold (Ctrl+B)",children:o.jsx("strong",{children:"B"})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleItalic().run(),className:`toolbar-btn ${p.isActive("italic")?"active":""}`,title:"Italic (Ctrl+I)",children:o.jsx("em",{children:"I"})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleUnderline().run(),className:`toolbar-btn ${p.isActive("underline")?"active":""}`,title:"Underline (Ctrl+U)",children:o.jsx("u",{children:"U"})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleStrike().run(),className:`toolbar-btn ${p.isActive("strike")?"active":""}`,title:"Strikethrough",children:o.jsx("s",{children:"S"})})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:1}).run(),className:`toolbar-btn ${p.isActive("heading",{level:1})?"active":""}`,title:"Heading 1",children:"H1"}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:2}).run(),className:`toolbar-btn ${p.isActive("heading",{level:2})?"active":""}`,title:"Heading 2",children:"H2"}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:3}).run(),className:`toolbar-btn ${p.isActive("heading",{level:3})?"active":""}`,title:"Heading 3",children:"H3"})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("left").run(),className:`toolbar-btn ${p.isActive({textAlign:"left"})?"active":""}`,title:"Align left",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"3",y1:"12",x2:"15",y2:"12"}),o.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("center").run(),className:`toolbar-btn ${p.isActive({textAlign:"center"})?"active":""}`,title:"Align center",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"6",y1:"12",x2:"18",y2:"12"}),o.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("right").run(),className:`toolbar-btn ${p.isActive({textAlign:"right"})?"active":""}`,title:"Align right",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"9",y1:"12",x2:"21",y2:"12"}),o.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBulletList().run(),className:`toolbar-btn ${p.isActive("bulletList")?"active":""}`,title:"Bullet list",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"4",cy:"6",r:"1.5",fill:"currentColor"}),o.jsx("line",{x1:"9",y1:"6",x2:"21",y2:"6"}),o.jsx("circle",{cx:"4",cy:"12",r:"1.5",fill:"currentColor"}),o.jsx("line",{x1:"9",y1:"12",x2:"21",y2:"12"}),o.jsx("circle",{cx:"4",cy:"18",r:"1.5",fill:"currentColor"}),o.jsx("line",{x1:"9",y1:"18",x2:"21",y2:"18"})]})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleOrderedList().run(),className:`toolbar-btn ${p.isActive("orderedList")?"active":""}`,title:"Numbered list",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("text",{x:"2",y:"8",fontSize:"8",fill:"currentColor",children:"1"}),o.jsx("line",{x1:"9",y1:"6",x2:"21",y2:"6"}),o.jsx("text",{x:"2",y:"14",fontSize:"8",fill:"currentColor",children:"2"}),o.jsx("line",{x1:"9",y1:"12",x2:"21",y2:"12"}),o.jsx("text",{x:"2",y:"20",fontSize:"8",fill:"currentColor",children:"3"}),o.jsx("line",{x1:"9",y1:"18",x2:"21",y2:"18"})]})})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBlockquote().run(),className:`toolbar-btn ${p.isActive("blockquote")?"active":""}`,title:"Blockquote",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M6 6h4l-2 6h4l-4 6"}),o.jsx("path",{d:"M14 6h4l-2 6h4l-4 6"})]})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().setHorizontalRule().run(),className:"toolbar-btn",title:"Horizontal rule",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"})})})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:g,className:`toolbar-btn ${p.isActive("link")?"active":""}`,title:"Insert link",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),o.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}),o.jsx("button",{type:"button",onClick:()=>a(!0),className:"toolbar-btn",title:"Insert image",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),o.jsx("button",{type:"button",onClick:()=>c(!0),className:"toolbar-btn",title:"Insert YouTube video",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"}),o.jsx("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02",fill:"currentColor"})]})}),o.jsx("button",{type:"button",onClick:()=>d(!0),className:"toolbar-btn",title:"Insert image carousel",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"2",y:"6",width:"14",height:"12",rx:"2"}),o.jsx("rect",{x:"8",y:"4",width:"14",height:"12",rx:"2"})]})})]}),o.jsxs("div",{className:"toolbar-group",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().undo().run(),disabled:!p.can().undo(),className:"toolbar-btn",title:"Undo (Ctrl+Z)",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"1 4 1 10 7 10"}),o.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().redo().run(),disabled:!p.can().redo(),className:"toolbar-btn",title:"Redo (Ctrl+Y)",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"23 4 23 10 17 10"}),o.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]})})]})]}),o.jsx(Wve,{editor:p,className:"editor-content"}),p&&o.jsx(rxe,{editor:p,tippyOptions:{duration:100},children:o.jsxs("div",{className:"bubble-menu",children:[o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBold().run(),className:p.isActive("bold")?"active":"",children:"B"}),o.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleItalic().run(),className:p.isActive("italic")?"active":"",children:"I"}),o.jsx("button",{type:"button",onClick:g,className:p.isActive("link")?"active":"",children:"Link"})]})}),o.jsx(ut,{isOpen:r,onClose:()=>s(!1),title:"Insert Link",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>s(!1),children:"Cancel"}),o.jsx(K,{onClick:m,children:"Insert"})]}),children:o.jsx(ye,{label:"URL",value:h,onChange:N=>f(N.target.value),placeholder:"https://example.com",autoFocus:!0})}),o.jsx(U0e,{isOpen:i,onClose:()=>a(!1),onInsert:y}),o.jsx(H0e,{isOpen:l,onClose:()=>c(!1),onInsert:x}),o.jsx(z0e,{isOpen:u,onClose:()=>d(!1),onInsert:w})]}):null}function H0e({isOpen:t,onClose:e,onInsert:n}){const[r,s]=b.useState(""),i=()=>{n(r),s("")};return o.jsx(ut,{isOpen:t,onClose:e,title:"Insert YouTube Video",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:e,children:"Cancel"}),o.jsx(K,{onClick:i,disabled:!r,children:"Insert"})]}),children:o.jsx(ye,{label:"YouTube URL",value:r,onChange:a=>s(a.target.value),placeholder:"https://www.youtube.com/watch?v=...",helpText:"Paste a YouTube video URL",autoFocus:!0})})}function W0e(){const t=rr(),{success:e,error:n}=qt(),{create:r,loading:s}=Ms("blogs"),[i,a]=b.useState({title:"",slug:"",content:"",excerpt:"",category:"",tags:"",status:"draft"}),[l,c]=b.useState("idle"),[u,d]=b.useState([]),h=b.useCallback(async x=>{if(!x||x.length<2){c("idle"),d([]);return}c("checking");try{const w=Wi(fr(ke,"blogs"),ba("slug","==",x));if((await Io(w)).empty)c("available"),d([]);else{c("taken");const S=[`${x}-2`,`${x}-${new Date().getFullYear()}`,`${x}-new`];d(S)}}catch(w){console.error("Error checking slug:",w),c("idle")}},[]);b.useEffect(()=>{const x=setTimeout(()=>{h(i.slug)},400);return()=>clearTimeout(x)},[i.slug,h]);const f=x=>{const{name:w,value:N}=x.target;a(S=>({...S,[w]:N,...w==="title"&&!i.slug?{slug:N.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}:{}}))},p=x=>{const w=x.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"");a(N=>({...N,slug:w}))},m=x=>{a(w=>({...w,slug:x}))},g=x=>{a(w=>({...w,content:x}))},y=async x=>{if(x.preventDefault(),l==="taken"){n("Please choose a different URL slug");return}if(!i.slug){n("URL slug is required");return}try{const w={...i,tags:i.tags.split(",").map(S=>S.trim()).filter(Boolean),excerpt:i.excerpt||i.content.substring(0,200)},N=await r(w);e("Blog post created"),t(`/blog/${N}/edit`)}catch(w){n("Failed to create post"),console.error(w)}};return o.jsxs("div",{className:"blog-create",children:[o.jsx("div",{className:"page-header",children:o.jsx("h1",{children:"New Blog Post"})}),o.jsxs("form",{onSubmit:y,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx(ye,{label:"Title",name:"title",value:i.title,onChange:f,placeholder:"Enter post title",required:!0}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"URL Slug"}),o.jsxs("div",{className:"slug-input-wrapper",children:[o.jsx("input",{type:"text",name:"slug",value:i.slug,onChange:p,placeholder:"url-friendly-slug",className:`form-input slug-input ${l==="taken"?"slug-taken":""} ${l==="available"?"slug-available":""}`}),o.jsxs("div",{className:"slug-status",children:[l==="checking"&&o.jsx("span",{className:"slug-checking",children:o.jsx("span",{className:"slug-spinner"})}),l==="available"&&o.jsx("span",{className:"slug-available-icon",title:"Slug is available",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})}),l==="taken"&&o.jsx("span",{className:"slug-taken-icon",title:"Slug is already taken",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),l==="taken"&&u.length>0&&o.jsxs("div",{className:"slug-suggestions",children:[o.jsx("span",{children:"Try:"}),u.map(x=>o.jsx("button",{type:"button",className:"slug-suggestion",onClick:()=>m(x),children:x},x))]}),o.jsxs("span",{className:"form-help",children:["The URL will be: /blog/",i.slug||"your-slug"]})]})]}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content"}),o.jsx(V9,{content:i.content,onChange:g,placeholder:"Write your post content here..."})]})}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Category"}),o.jsxs("select",{name:"category",value:i.category,onChange:f,className:"form-select",children:[o.jsx("option",{value:"",children:"Select category"}),o.jsx("option",{value:"news",children:"Company News"}),o.jsx("option",{value:"guides",children:"Buyer's Guides"}),o.jsx("option",{value:"industry",children:"Industry News"}),o.jsx("option",{value:"maintenance",children:"Maintenance Tips"})]})]}),o.jsx(ye,{label:"Tags",name:"tags",value:i.tags,onChange:f,placeholder:"tag1, tag2, tag3",helpText:"Comma-separated"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsxs("select",{name:"status",value:i.status,onChange:f,className:"form-select",children:[o.jsx("option",{value:"draft",children:"Draft"}),o.jsx("option",{value:"published",children:"Published"})]})]})]})}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Excerpt"}),o.jsx("textarea",{name:"excerpt",value:i.excerpt,onChange:f,className:"form-textarea",rows:3,placeholder:"Brief summary (auto-generated if empty)"})]})}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{type:"button",variant:"secondary",onClick:()=>t("/blog"),children:"Cancel"}),o.jsx(K,{type:"submit",loading:s,children:"Create Post"})]})]})]})}function q0e(){const{id:t}=Op(),e=rr(),{success:n,error:r}=qt(),{update:s,remove:i,loading:a}=Ms("blogs"),[l,c]=b.useState(!0),[u,d]=b.useState({title:"",slug:"",content:"",excerpt:"",category:"",tags:"",status:"draft"}),[h,f]=b.useState(""),[p,m]=b.useState("idle"),[g,y]=b.useState([]);b.useEffect(()=>{(async()=>{try{const E=We(ke,"blogs",t),I=await us(E);if(I.exists()){const T=I.data();d({title:T.title||"",slug:T.slug||"",content:T.content||"",excerpt:T.excerpt||"",category:T.category||"",tags:Array.isArray(T.tags)?T.tags.join(", "):"",status:T.status||"draft"}),f(T.slug||"")}else r("Post not found"),e("/blog")}catch(E){console.error("Error fetching post:",E),r("Failed to load post")}finally{c(!1)}})()},[t,e,r]);const x=b.useCallback(async _=>{if(!_||_.length<2||_===h){m("idle"),y([]);return}m("checking");try{const E=Wi(fr(ke,"blogs"),ba("slug","==",_));if((await Io(E)).docs.filter(P=>P.id!==t).length===0)m("available"),y([]);else{m("taken");const P=[`${_}-2`,`${_}-${new Date().getFullYear()}`,`${_}-updated`];y(P)}}catch(E){console.error("Error checking slug:",E),m("idle")}},[t,h]);b.useEffect(()=>{const _=setTimeout(()=>{x(u.slug)},400);return()=>clearTimeout(_)},[u.slug,x]);const w=_=>{const{name:E,value:I}=_.target;d(T=>({...T,[E]:I}))},N=_=>{const E=_.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"");d(I=>({...I,slug:E}))},S=_=>{d(E=>({...E,slug:_}))},C=_=>{d(E=>({...E,content:_}))},A=async _=>{if(_.preventDefault(),p==="taken"){r("Please choose a different URL slug");return}if(!u.slug){r("URL slug is required");return}try{const E={...u,tags:u.tags.split(",").map(I=>I.trim()).filter(Boolean),excerpt:u.excerpt||u.content.substring(0,200)};u.status==="published"&&!u.publishedAt&&(E.publishedAt=new Date),await s(t,E),n("Blog post updated")}catch(E){r("Failed to update post"),console.error(E)}},j=async()=>{if(window.confirm("Are you sure you want to delete this post? This cannot be undone."))try{await i(t),n("Blog post deleted"),e("/blog")}catch(_){r("Failed to delete post"),console.error(_)}};return l?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"blog-edit",children:[o.jsxs(at,{to:"/blog",className:"back-link",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back to Blog Posts"]}),o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Edit Blog Post"}),o.jsx("p",{className:"page-subtitle",children:u.title||"Untitled"})]}),o.jsxs("div",{className:"page-header-actions",children:[u.status==="published"&&u.slug&&o.jsx("a",{href:`/blog/${u.slug}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary",children:"View Live"}),o.jsx(K,{variant:"danger",onClick:j,children:"Delete"})]})]}),o.jsxs("form",{onSubmit:A,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx(ye,{label:"Title",name:"title",value:u.title,onChange:w,placeholder:"Enter post title",required:!0}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"URL Slug"}),o.jsxs("div",{className:"slug-input-wrapper",children:[o.jsx("input",{type:"text",name:"slug",value:u.slug,onChange:N,placeholder:"url-friendly-slug",className:`form-input slug-input ${p==="taken"?"slug-taken":""} ${p==="available"?"slug-available":""}`}),o.jsxs("div",{className:"slug-status",children:[p==="checking"&&o.jsx("span",{className:"slug-checking",children:o.jsx("span",{className:"slug-spinner"})}),p==="available"&&o.jsx("span",{className:"slug-available-icon",title:"Slug is available",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})}),p==="taken"&&o.jsx("span",{className:"slug-taken-icon",title:"Slug is already taken",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),p==="taken"&&g.length>0&&o.jsxs("div",{className:"slug-suggestions",children:[o.jsx("span",{children:"Try:"}),g.map(_=>o.jsx("button",{type:"button",className:"slug-suggestion",onClick:()=>S(_),children:_},_))]}),o.jsxs("span",{className:"form-help",children:["The URL will be: /blog/",u.slug||"your-slug"]})]})]}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content"}),o.jsx(V9,{content:u.content,onChange:C,placeholder:"Write your post content here..."})]})}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Category"}),o.jsxs("select",{name:"category",value:u.category,onChange:w,className:"form-select",children:[o.jsx("option",{value:"",children:"Select category"}),o.jsx("option",{value:"news",children:"Company News"}),o.jsx("option",{value:"guides",children:"Buyer's Guides"}),o.jsx("option",{value:"industry",children:"Industry News"}),o.jsx("option",{value:"maintenance",children:"Maintenance Tips"})]})]}),o.jsx(ye,{label:"Tags",name:"tags",value:u.tags,onChange:w,placeholder:"tag1, tag2, tag3",helpText:"Comma-separated"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsxs("select",{name:"status",value:u.status,onChange:w,className:"form-select",children:[o.jsx("option",{value:"draft",children:"Draft"}),o.jsx("option",{value:"published",children:"Published"}),o.jsx("option",{value:"archived",children:"Archived"})]})]})]})}),o.jsx("div",{className:"form-section",children:o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Excerpt"}),o.jsx("textarea",{name:"excerpt",value:u.excerpt,onChange:w,className:"form-textarea",rows:3,placeholder:"Brief summary (auto-generated if empty)"})]})}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{type:"button",variant:"secondary",onClick:()=>e("/blog"),children:"Back to List"}),o.jsx(K,{type:"submit",loading:a,children:"Save Changes"})]})]})]})}function G0e(t=[]){const[e,n]=b.useState([]),[r,s]=b.useState(!0),[i,a]=b.useState(null);return b.useEffect(()=>{const l=Wi(fr(ke,"social_posts"),qr("createdAt","desc"),...t),c=Nh(l,u=>{const d=u.docs.map(h=>({id:h.id,...h.data()}));n(d),s(!1)},u=>{console.error("Social posts error:",u),a(u),s(!1)});return()=>c()},[JSON.stringify(t)]),{posts:e,loading:r,error:i}}function K0e(t){const[e,n]=b.useState(null),[r,s]=b.useState(!0),[i,a]=b.useState(null);return b.useEffect(()=>{if(!t){n(null),s(!1);return}const l=We(ke,"social_posts",t),c=Nh(l,u=>{u.exists()?n({id:u.id,...u.data()}):n(null),s(!1)},u=>{console.error("Social post error:",u),a(u),s(!1)});return()=>c()},[t]),{post:e,loading:r,error:i}}function gP(){const[t,e]=b.useState(!1),n=b.useCallback(async l=>{e(!0);try{const c=fo.currentUser,u=await ku(fr(ke,"social_posts"),{title:l.title||"",content:l.content||"",media:l.media||[],platforms:l.platforms||[],status:l.status||"idea",targetDate:l.targetDate||null,postedAt:null,assignments:l.assignments||{},tags:l.tags||[],createdAt:et(),updatedAt:et(),createdBy:(c==null?void 0:c.uid)||null,createdByName:(c==null?void 0:c.displayName)||(c==null?void 0:c.email)||null,lastModifiedBy:(c==null?void 0:c.uid)||null});return ds({action:"social_posts.create",resourceType:"social_posts",resourceId:u.id,resourceName:l.title||"Untitled Post"}),e(!1),u.id}catch(c){throw e(!1),c}},[]),r=b.useCallback(async(l,c)=>{e(!0);try{const u=fo.currentUser;await _t(We(ke,"social_posts",l),{...c,updatedAt:et(),lastModifiedBy:(u==null?void 0:u.uid)||null}),ds({action:"social_posts.update",resourceType:"social_posts",resourceId:l,resourceName:c.title||null,changes:c}),e(!1)}catch(u){throw e(!1),u}},[]),s=b.useCallback(async(l,c=null)=>{e(!0);try{await wh(We(ke,"social_posts",l)),ds({action:"social_posts.delete",resourceType:"social_posts",resourceId:l,resourceName:c}),e(!1)}catch(u){throw e(!1),u}},[]),i=b.useCallback(async l=>{e(!0);try{await _t(We(ke,"social_posts",l),{status:"posted",postedAt:et(),updatedAt:et()}),ds({action:"social_posts.mark_posted",resourceType:"social_posts",resourceId:l}),e(!1)}catch(c){throw e(!1),c}},[]),a=b.useCallback(async(l,c,u=null)=>{e(!0);try{const d={status:c,updatedAt:et()};c==="posted"&&(d.postedAt=et()),await _t(We(ke,"social_posts",l),d),ds({action:"social_posts.status_change",resourceType:"social_posts",resourceId:l,changes:{status:{from:u,to:c}}}),e(!1)}catch(d){throw e(!1),d}},[]);return{create:n,update:r,remove:s,markAsPosted:i,updateStatus:a,loading:t}}function Y0e(t){const[e,n]=b.useState([]),[r,s]=b.useState(!0),[i,a]=b.useState(null);b.useEffect(()=>{if(!t){n([]),s(!1);return}const u=Wi(fr(ke,"social_posts",t,"comments"),qr("createdAt","desc")),d=Nh(u,h=>{const f=h.docs.map(p=>({id:p.id,...p.data()}));n(f),s(!1)},h=>{console.error("Comments error:",h),a(h),s(!1)});return()=>d()},[t]);const l=b.useCallback(async u=>{if(!t||!u.trim())return;const d=fo.currentUser;await ku(fr(ke,"social_posts",t,"comments"),{text:u.trim(),createdAt:et(),createdBy:(d==null?void 0:d.uid)||null,createdByName:(d==null?void 0:d.displayName)||(d==null?void 0:d.email)||null})},[t]),c=b.useCallback(async u=>{!t||!u||await wh(We(ke,"social_posts",t,"comments",u))},[t]);return{comments:e,loading:r,error:i,addComment:l,deleteComment:c}}const cs={IDEA:"idea",DRAFTING:"drafting",REVIEW:"review",APPROVED:"approved",READY:"ready",POSTED:"posted",ARCHIVED:"archived"},To={[cs.IDEA]:{label:"Idea",color:"#8b5cf6",bgColor:"#f3e8ff",description:"Initial concept or topic"},[cs.DRAFTING]:{label:"Drafting",color:"#f59e0b",bgColor:"#fef3c7",description:"Content being written"},[cs.REVIEW]:{label:"Review",color:"#3b82f6",bgColor:"#dbeafe",description:"Awaiting review and feedback"},[cs.APPROVED]:{label:"Approved",color:"#10b981",bgColor:"#d1fae5",description:"Content approved by reviewer"},[cs.READY]:{label:"Ready",color:"#22c55e",bgColor:"#dcfce7",description:"Ready to be manually posted"},[cs.POSTED]:{label:"Posted",color:"#6366f1",bgColor:"#e0e7ff",description:"Manually posted to platform(s)"},[cs.ARCHIVED]:{label:"Archived",color:"#6b7280",bgColor:"#f3f4f6",description:"No longer active"}},Xx={INSTAGRAM:"instagram",TWITTER:"twitter",FACEBOOK:"facebook",LINKEDIN:"linkedin"},sh={[Xx.INSTAGRAM]:{label:"Instagram",icon:"instagram",color:"#E4405F",charLimit:2200,hashtagLimit:30},[Xx.TWITTER]:{label:"Twitter / X",icon:"twitter",color:"#000000",charLimit:280,hashtagLimit:null},[Xx.FACEBOOK]:{label:"Facebook",icon:"facebook",color:"#1877F2",charLimit:63206,hashtagLimit:null},[Xx.LINKEDIN]:{label:"LinkedIn",icon:"linkedin",color:"#0A66C2",charLimit:3e3,hashtagLimit:null}},Ii={TWEET:"tweet",SHORT_FORM:"short_form",LONG_FORM:"long_form",STORY:"story",REEL:"reel",CAROUSEL:"carousel"},QN={[Ii.TWEET]:{label:"Tweet",description:"Short text post (280 chars)",icon:"T"},[Ii.SHORT_FORM]:{label:"Short-form",description:"Quick update or announcement",icon:"S"},[Ii.LONG_FORM]:{label:"Long-form",description:"Detailed post or article",icon:"L"},[Ii.STORY]:{label:"Story",description:"24-hour temporary content",icon:"St"},[Ii.REEL]:{label:"Reel/Video",description:"Short video content",icon:"R"},[Ii.CAROUSEL]:{label:"Carousel",description:"Multiple images/slides",icon:"C"}};function yP(t){var e;return((e=QN[t])==null?void 0:e.label)||t}const kj={IDEATOR:"ideator",CREATOR:"creator",REVIEWER:"reviewer"},Q0e={[kj.IDEATOR]:{label:"Ideator",description:"Person who came up with the idea"},[kj.CREATOR]:{label:"Creator",description:"Person writing/creating the content"},[kj.REVIEWER]:{label:"Reviewer",description:"Person who reviews and approves"}},X0e=[cs.IDEA,cs.DRAFTING,cs.REVIEW,cs.APPROVED,cs.READY,cs.POSTED];function cT(t){var e;return((e=To[t])==null?void 0:e.label)||t}function $9(t){var e;return((e=To[t])==null?void 0:e.color)||"#6b7280"}function $w(t){var e;return((e=sh[t])==null?void 0:e.label)||t}function U9(t){var e;return((e=sh[t])==null?void 0:e.color)||"#6b7280"}function z9(t=[]){if(!t.length)return null;const e=t.map(n=>{var r;return(r=sh[n])==null?void 0:r.charLimit}).filter(Boolean);return e.length?Math.min(...e):null}const J0e=[{id:"list",label:"List"},{id:"kanban",label:"Kanban"},{id:"calendar",label:"Calendar"}];function Z0e(){const{can:t,PERMISSIONS:e}=Js(),{posts:n,loading:r}=G0e(),{create:s,remove:i,update:a,updateStatus:l,loading:c}=gP(),{success:u,error:d}=qt(),[h,f]=b.useState("list"),[p,m]=b.useState("all"),[g,y]=b.useState("all"),[x,w]=b.useState(""),[N,S]=b.useState(new Date),[C,A]=b.useState(!1),[j,_]=b.useState(""),[E,I]=b.useState(Ii.SHORT_FORM),T=b.useRef(null),[P,O]=b.useState(null),[H,X]=b.useState(null),se=b.useRef(null),[L,B]=b.useState(!1),[$,q]=b.useState(!1),Y=()=>{if(se.current){const{scrollLeft:V,scrollWidth:re,clientWidth:ie}=se.current;B(V>5),q(V<re-ie-5)}},R=V=>{se.current&&(se.current.scrollBy({left:V==="left"?-300:300,behavior:"smooth"}),setTimeout(Y,350))},G=b.useMemo(()=>{const V={all:n.length};return Object.keys(cs).forEach(re=>{const ie=cs[re];V[ie]=n.filter(Fe=>Fe.status===ie).length}),V},[n]),Z=b.useMemo(()=>n.filter(V=>{if(p!=="all"&&V.status!==p||g!=="all"&&!(V.platforms||[]).includes(g))return!1;if(x){const re=x.toLowerCase(),ie=(V.title||"").toLowerCase(),Fe=(V.content||"").toLowerCase();if(!ie.includes(re)&&!Fe.includes(re))return!1}return!0}),[n,p,g,x]);b.useEffect(()=>{if(h==="kanban"){const V=setTimeout(Y,100);return window.addEventListener("resize",Y),()=>{clearTimeout(V),window.removeEventListener("resize",Y)}}},[h,Z]);const W=async V=>{if(V.preventDefault(),!!j.trim())try{await s({title:j.trim(),content:"",contentType:E,status:"idea",platforms:[],tags:[]}),u("Idea saved"),_(""),I(Ii.SHORT_FORM),A(!1)}catch(re){d("Failed to save idea"),console.error(re)}},Q=V=>{V.key==="Escape"&&(A(!1),_(""),I(Ii.SHORT_FORM))},U=async()=>{if(P)try{await i(P.id,P.title),u("Post deleted"),O(null)}catch{d("Failed to delete post")}},pe=async(V,re,ie)=>{try{await l(V,re,ie),u(`Status updated to ${cT(re)}`)}catch{d("Failed to update status")}},J=(V,re)=>{X(re),V.dataTransfer.effectAllowed="move"},ge=V=>{V.preventDefault(),V.dataTransfer.dropEffect="move"},me=async(V,re)=>{if(V.preventDefault(),!H||H.status===re){X(null);return}try{await l(H.id,re,H.status),u(`Moved to ${cT(re)}`)}catch{d("Failed to update status")}X(null)},ue=()=>{X(null)},[st,Ke]=b.useState(null),ot=(V,re)=>{V.stopPropagation(),Ke(re),V.dataTransfer.effectAllowed="move",V.dataTransfer.setData("text/plain",re.id)},lt=V=>{V.preventDefault(),V.dataTransfer.dropEffect="move"},bt=async(V,re)=>{if(V.preventDefault(),!st){Ke(null);return}try{await a(st.id,{targetDate:un.fromDate(re)}),u(`Rescheduled to ${rt(re,"MMM d, yyyy")}`)}catch(ie){d("Failed to reschedule post"),console.error(ie)}Ke(null)},mt=()=>{Ke(null)};return r?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"social-page",children:[o.jsxs("div",{className:"social-header",children:[o.jsxs("div",{className:"social-header-left",children:[o.jsx("h1",{children:"Social Media Planner"}),o.jsxs("span",{className:"social-count",children:[n.length," posts"]})]}),o.jsx("div",{className:"social-header-right",children:t(e.SOCIAL_CREATE)&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"idea-btn",onClick:()=>{A(!0),setTimeout(()=>{var V;return(V=T.current)==null?void 0:V.focus()},50)},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"}),o.jsx("path",{d:"M9 21h6"}),o.jsx("path",{d:"M9 18h6"})]}),"Quick Idea"]}),o.jsx(at,{to:"/social/new",children:o.jsx(K,{children:"New Post"})})]})})]}),C&&o.jsxs("form",{className:"idea-input-form",onSubmit:W,children:[o.jsx("div",{className:"idea-type-selector",children:Object.entries(QN).map(([V,re])=>o.jsx("button",{type:"button",className:`idea-type-btn ${E===V?"active":""}`,onClick:()=>I(V),title:re.description,children:re.label},V))}),o.jsx("input",{ref:T,type:"text",placeholder:`What's your ${yP(E).toLowerCase()} idea?`,value:j,onChange:V=>_(V.target.value),onKeyDown:Q,disabled:c}),o.jsxs("div",{className:"idea-input-actions",children:[o.jsx("button",{type:"submit",className:"idea-save-btn",disabled:!j.trim()||c,children:c?"Saving...":"Save"}),o.jsx("button",{type:"button",className:"idea-cancel-btn",onClick:()=>{A(!1),_(""),I(Ii.SHORT_FORM)},children:"Cancel"})]})]}),o.jsxs("div",{className:"social-toolbar",children:[h==="list"?o.jsx("div",{className:"social-filters",children:o.jsxs("div",{className:"social-status-tabs",children:[o.jsxs("button",{className:`social-status-tab ${p==="all"?"active":""}`,onClick:()=>m("all"),children:["All",o.jsx("span",{className:"tab-count",children:G.all})]}),Object.entries(To).slice(0,5).map(([V,re])=>o.jsxs("button",{className:`social-status-tab ${p===V?"active":""}`,onClick:()=>m(V),children:[re.label,o.jsx("span",{className:"tab-count",children:G[V]||0})]},V))]})}):o.jsx("div",{className:"social-toolbar-spacer"}),o.jsxs("div",{className:"social-toolbar-right",children:[o.jsxs("select",{className:"social-platform-filter",value:g,onChange:V=>y(V.target.value),children:[o.jsx("option",{value:"all",children:"All Platforms"}),Object.entries(sh).map(([V,re])=>o.jsx("option",{value:V,children:re.label},V))]}),o.jsxs("div",{className:"social-search",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search posts...",value:x,onChange:V=>w(V.target.value)})]}),o.jsx("div",{className:"social-view-switcher",children:J0e.map(V=>o.jsxs("button",{className:`view-btn ${h===V.id?"active":""}`,onClick:()=>{f(V.id),V.id==="kanban"&&m("all")},title:V.label,children:[V.id==="list"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),o.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),o.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),o.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),o.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),V.id==="kanban"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"5",height:"18",rx:"1"}),o.jsx("rect",{x:"10",y:"3",width:"5",height:"12",rx:"1"}),o.jsx("rect",{x:"17",y:"3",width:"5",height:"8",rx:"1"})]}),V.id==="calendar"&&o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),o.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),o.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})]},V.id))})]})]}),Z.length===0&&h!=="calendar"?o.jsxs("div",{className:"social-empty",children:[o.jsx("p",{children:x?"No posts match your search":"No social posts yet"}),!x&&t(e.SOCIAL_CREATE)&&o.jsx(at,{to:"/social/new",children:o.jsx(K,{variant:"secondary",children:"Create your first post"})})]}):o.jsxs(o.Fragment,{children:[h==="list"&&o.jsx(ebe,{posts:Z,can:t,PERMISSIONS:e,onDelete:O,onStatusChange:pe}),h==="kanban"&&o.jsxs("div",{className:"social-kanban-wrapper",children:[L&&o.jsx("button",{className:"scroll-indicator scroll-left",onClick:()=>R("left"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),$&&o.jsx("button",{className:"scroll-indicator scroll-right",onClick:()=>R("right"),children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx(tbe,{posts:Z,can:t,PERMISSIONS:e,kanbanRef:se,onScroll:Y,draggedItem:H,onDragStart:J,onDragOver:ge,onDrop:me,onDragEnd:ue})]}),h==="calendar"&&o.jsx(nbe,{posts:n,calendarDate:N,setCalendarDate:S,can:t,PERMISSIONS:e,draggedItem:st,onDragStart:ot,onDragOver:lt,onDrop:bt,onDragEnd:mt})]}),o.jsxs(ut,{isOpen:!!P,onClose:()=>O(null),title:"Delete Post",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>O(null),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:U,disabled:c,children:c?"Deleting...":"Delete"})]}),children:[o.jsxs("p",{children:['Are you sure you want to delete "',P==null?void 0:P.title,'"?']}),o.jsx("p",{style:{color:"var(--color-text-muted)",marginTop:"8px"},children:"This action cannot be undone."})]})]})}function ebe({posts:t,can:e,PERMISSIONS:n,onDelete:r,onStatusChange:s}){return o.jsx("div",{className:"social-table-container",children:o.jsxs("table",{className:"social-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Title"}),o.jsx("th",{children:"Type"}),o.jsx("th",{children:"Platforms"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Target Date"}),o.jsx("th",{children:"Actions"})]})}),o.jsx("tbody",{children:t.map(i=>{var a,l;return o.jsxs("tr",{className:"social-table-row",children:[o.jsx("td",{className:"social-title-cell",children:o.jsxs("div",{className:"social-title-content",children:[o.jsx("h4",{children:i.title||"Untitled"}),o.jsxs("p",{className:"social-excerpt",children:[(i.content||"").substring(0,80),((a=i.content)==null?void 0:a.length)>80?"...":""]})]})}),o.jsx("td",{children:i.contentType?o.jsx("span",{className:"content-type-badge",children:yP(i.contentType)}):o.jsx("span",{className:"no-platform",children:""})}),o.jsx("td",{children:o.jsxs("div",{className:"platform-badges",children:[(i.platforms||[]).map(c=>o.jsx("span",{className:"platform-badge",style:{backgroundColor:U9(c)},title:$w(c),children:$w(c).charAt(0)},c)),(!i.platforms||i.platforms.length===0)&&o.jsx("span",{className:"no-platform",children:""})]})}),o.jsx("td",{children:o.jsx("select",{className:"status-select",value:i.status,onChange:c=>s(i.id,c.target.value,i.status),style:{borderColor:$9(i.status)},disabled:!e(n.SOCIAL_EDIT),children:Object.entries(To).map(([c,u])=>o.jsx("option",{value:c,children:u.label},c))})}),o.jsx("td",{className:"social-date",children:(l=i.targetDate)!=null&&l.toDate?rt(i.targetDate.toDate(),"MMM d, yyyy"):""}),o.jsx("td",{children:o.jsxs("div",{className:"social-actions",children:[e(n.SOCIAL_EDIT)&&o.jsx(at,{to:`/social/${i.id}/edit`,className:"social-action-btn",children:"Edit"}),e(n.SOCIAL_DELETE)&&o.jsx("button",{className:"social-action-btn danger",onClick:()=>r(i),children:"Delete"})]})})]},i.id)})})]})})}function tbe({posts:t,can:e,PERMISSIONS:n,kanbanRef:r,onScroll:s,draggedItem:i,onDragStart:a,onDragOver:l,onDrop:c,onDragEnd:u}){const d=X0e.map(f=>({status:f,...To[f],posts:t.filter(p=>p.status===f)})),h=e(n.SOCIAL_EDIT);return o.jsx("div",{className:"social-kanban-view",ref:r,onScroll:s,children:d.map(f=>o.jsxs("div",{className:`kanban-column ${i?"drop-target":""}`,onDragOver:h?l:void 0,onDrop:h?p=>c(p,f.status):void 0,children:[o.jsxs("div",{className:"kanban-column-header",children:[o.jsxs("div",{className:"kanban-column-title",children:[o.jsx("span",{className:"kanban-dot",style:{background:f.color}}),f.label]}),o.jsx("span",{className:"kanban-count",children:f.posts.length})]}),o.jsxs("div",{className:"kanban-cards",children:[f.posts.map(p=>{var m;return o.jsxs("div",{className:`kanban-card ${(i==null?void 0:i.id)===p.id?"dragging":""}`,draggable:h,onDragStart:h?g=>a(g,p):void 0,onDragEnd:h?u:void 0,children:[p.contentType&&o.jsx("div",{style:{padding:"8px 12px 0"},children:o.jsx("span",{className:"content-type-badge",children:yP(p.contentType)})}),o.jsx("h4",{className:"kanban-card-title",children:p.title||"Untitled"}),o.jsxs("div",{className:"kanban-card-meta",children:[((m=p.targetDate)==null?void 0:m.toDate)&&o.jsxs("div",{className:"kanban-card-date",children:[o.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),o.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),o.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),rt(p.targetDate.toDate(),"MMM d")]}),o.jsx("div",{className:"kanban-card-platforms",children:(p.platforms||[]).map(g=>o.jsx("span",{className:"platform-badge small",style:{backgroundColor:U9(g)},title:$w(g),children:$w(g).charAt(0)},g))})]}),o.jsx("div",{className:"kanban-card-footer",children:h&&o.jsx(at,{to:`/social/${p.id}/edit`,className:"kanban-edit-link",children:"Edit"})})]},p.id)}),f.posts.length===0&&o.jsxs("div",{className:"kanban-empty",children:["No ",f.label.toLowerCase()," posts"]})]})]},f.status))})}function BF({post:t,isDragging:e,canEdit:n,onDragStart:r,onDragEnd:s}){const[i,a]=b.useState(!1),l=rr(),c=h=>{a(!0),r(h,t)},u=h=>{s(h),setTimeout(()=>a(!1),100)},d=h=>{if(i){h.preventDefault();return}l(`/social/${t.id}/edit`)};return o.jsx("div",{className:`calendar-post ${e?"dragging":""}`,style:{borderLeftColor:$9(t.status)},draggable:n,onDragStart:n?c:void 0,onDragEnd:n?u:void 0,onClick:d,children:o.jsx("span",{className:"calendar-post-title",children:t.title||"Untitled"})})}function nbe({posts:t,calendarDate:e,setCalendarDate:n,can:r,PERMISSIONS:s,draggedItem:i,onDragStart:a,onDragOver:l,onDrop:c,onDragEnd:u}){const d=wue(e),h=GH(e),f=bue({start:d,end:h}),p=t.filter(N=>{var C;if(!((C=N.targetDate)!=null&&C.toDate))return!1;const S=N.targetDate.toDate();return Nde(S,e)}),m=t.filter(N=>!N.targetDate),g={};p.forEach(N=>{const S=rt(N.targetDate.toDate(),"yyyy-MM-dd");g[S]||(g[S]=[]),g[S].push(N)});const y=d.getDay(),x=Array(y).fill(null),w=r(s.SOCIAL_EDIT);return o.jsxs("div",{className:"social-calendar-layout",children:[o.jsxs("div",{className:"calendar-unscheduled",children:[o.jsxs("h3",{children:["Unscheduled (",m.length,")"]}),o.jsx("p",{className:"unscheduled-hint",children:"Drag posts to a date to schedule"}),o.jsxs("div",{className:"unscheduled-list",children:[m.slice(0,10).map(N=>o.jsx(BF,{post:N,isDragging:(i==null?void 0:i.id)===N.id,canEdit:w,onDragStart:a,onDragEnd:u},N.id)),m.length===0&&o.jsx("p",{className:"no-unscheduled",children:"All posts are scheduled"}),m.length>10&&o.jsxs("p",{className:"more-unscheduled",children:["+",m.length-10," more"]})]})]}),o.jsxs("div",{className:"social-calendar",children:[o.jsxs("div",{className:"calendar-header",children:[o.jsx("button",{className:"calendar-nav-btn",onClick:()=>n(Xo(e,1)),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsx("h2",{children:rt(e,"MMMM yyyy")}),o.jsx("button",{className:"calendar-nav-btn",onClick:()=>n(UH(e,1)),children:o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),i&&o.jsxs("div",{className:"calendar-drag-hint",children:['Drag to a date to reschedule "',i.title,'"']}),o.jsx("div",{className:"calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(N=>o.jsx("div",{className:"calendar-weekday",children:N},N))}),o.jsxs("div",{className:"calendar-grid",children:[x.map((N,S)=>o.jsx("div",{className:"calendar-day empty"},`empty-${S}`)),f.map(N=>{const S=rt(N,"yyyy-MM-dd"),C=g[S]||[],A=cue(N,new Date);return o.jsxs("div",{className:`calendar-day ${A?"today":""} ${C.length>0?"has-posts":""} ${i?"drop-target":""}`,onDragOver:w?l:void 0,onDrop:w?j=>c(j,N):void 0,children:[o.jsx("div",{className:"calendar-day-number",children:rt(N,"d")}),o.jsxs("div",{className:"calendar-day-posts",children:[C.slice(0,3).map(j=>o.jsx(BF,{post:j,isDragging:(i==null?void 0:i.id)===j.id,canEdit:w,onDragStart:a,onDragEnd:u},j.id)),C.length>3&&o.jsxs("div",{className:"calendar-more",children:["+",C.length-3," more"]})]})]},S)})]}),o.jsx("div",{className:"calendar-legend",children:Object.entries(To).slice(0,6).map(([N,S])=>o.jsxs("div",{className:"legend-item",children:[o.jsx("span",{className:"legend-dot",style:{backgroundColor:S.color}}),S.label]},N))})]})]})}function rbe(){const t=rr(),{create:e,loading:n}=gP(),{success:r,error:s}=qt(),[i,a]=b.useState({title:"",content:"",contentType:Ii.SHORT_FORM,platforms:[],status:"idea",targetDate:"",tags:""}),l=p=>{const{name:m,value:g}=p.target;a(y=>({...y,[m]:g}))},c=p=>{a(m=>({...m,platforms:m.platforms.includes(p)?m.platforms.filter(g=>g!==p):[...m.platforms,p]}))},u=async p=>{if(p.preventDefault(),!i.title.trim()){s("Title is required");return}try{const m={title:i.title.trim(),content:i.content.trim(),contentType:i.contentType,platforms:i.platforms,status:i.status,targetDate:i.targetDate?un.fromDate(new Date(i.targetDate)):null,tags:i.tags?i.tags.split(",").map(y=>y.trim()).filter(Boolean):[]},g=await e(m);r("Post created"),t(`/social/${g}/edit`)}catch(m){s("Failed to create post"),console.error(m)}},d=z9(i.platforms),h=i.content.length,f=d&&h>d;return o.jsxs("div",{className:"social-create-page",children:[o.jsx("div",{className:"page-header",children:o.jsxs("div",{className:"page-header-left",children:[o.jsxs(at,{to:"/social",className:"back-link",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back to Social"]}),o.jsx("h1",{children:"New Social Post"})]})}),o.jsx("form",{onSubmit:u,className:"social-form",children:o.jsxs("div",{className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Post Details"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content Type"}),o.jsx("div",{className:"content-type-selector",children:Object.entries(QN).map(([p,m])=>o.jsxs("label",{className:`content-type-option ${i.contentType===p?"selected":""}`,children:[o.jsx("input",{type:"radio",name:"contentType",value:p,checked:i.contentType===p,onChange:l}),o.jsx("span",{className:"content-type-label",children:m.label}),o.jsx("span",{className:"content-type-desc",children:m.description})]},p))})]}),o.jsx(ye,{label:"Title",name:"title",value:i.title,onChange:l,placeholder:"Enter post title or idea...",required:!0}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content"}),o.jsx("textarea",{name:"content",className:`form-textarea ${f?"form-input-error":""}`,value:i.content,onChange:l,placeholder:"Write your post content...",rows:6}),o.jsxs("div",{className:"content-meta",children:[o.jsxs("span",{className:`char-count ${f?"over-limit":""}`,children:[h," characters",d&&` / ${d} max`]}),f&&o.jsx("span",{className:"form-error",children:"Content exceeds platform limit"})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Target Platforms"}),o.jsx("p",{className:"form-help",style:{marginBottom:"12px"},children:"Select which platforms you plan to post to. This is for planning only - you'll manually post when ready."}),o.jsx("div",{className:"platform-selector",children:Object.entries(sh).map(([p,m])=>o.jsxs("label",{className:`platform-option ${i.platforms.includes(p)?"selected":""}`,style:{"--platform-color":m.color,borderColor:i.platforms.includes(p)?m.color:"var(--color-border)"},children:[o.jsx("input",{type:"checkbox",checked:i.platforms.includes(p),onChange:()=>c(p)}),o.jsx("span",{className:"platform-icon",style:{backgroundColor:m.color},children:m.label.charAt(0)}),o.jsx("span",{className:"platform-name",children:m.label}),o.jsxs("span",{className:"platform-limit",children:[m.charLimit," chars"]})]},p))})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Scheduling"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsx("select",{name:"status",className:"form-select",value:i.status,onChange:l,children:Object.entries(To).map(([p,m])=>o.jsx("option",{value:p,children:m.label},p))})]}),o.jsx(ye,{label:"Target Date",type:"date",name:"targetDate",value:i.targetDate,onChange:l,helpText:"When you plan to post this"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Organization"}),o.jsx(ye,{label:"Tags",name:"tags",value:i.tags,onChange:l,placeholder:"e.g., aircraft, sale, announcement (comma separated)",helpText:"Separate multiple tags with commas"})]}),o.jsxs("div",{className:"form-actions",children:[o.jsx(at,{to:"/social",children:o.jsx(K,{type:"button",variant:"secondary",children:"Cancel"})}),o.jsx(K,{type:"submit",disabled:n,children:n?"Creating...":"Create Post"})]})]})})]})}function sbe(){var q,Y,R,G,Z;const{id:t}=Op(),e=rr(),{can:n,PERMISSIONS:r}=Js(),{post:s,loading:i}=K0e(t),{update:a,remove:l,markAsPosted:c,loading:u}=gP(),{comments:d,addComment:h}=Y0e(t),{data:f}=pn("users"),{success:p,error:m}=qt(),[g,y]=b.useState({title:"",content:"",contentType:Ii.SHORT_FORM,platforms:[],status:"idea",targetDate:"",tags:"",assignments:{}}),[x,w]=b.useState(""),[N,S]=b.useState(!1),[C,A]=b.useState(!1);b.useEffect(()=>{var W;s&&y({title:s.title||"",content:s.content||"",contentType:s.contentType||Ii.SHORT_FORM,platforms:s.platforms||[],status:s.status||"idea",targetDate:(W=s.targetDate)!=null&&W.toDate?rt(s.targetDate.toDate(),"yyyy-MM-dd"):"",tags:(s.tags||[]).join(", "),assignments:s.assignments||{}})},[s]);const j=W=>{const{name:Q,value:U}=W.target;y(pe=>({...pe,[Q]:U}))},_=W=>{y(Q=>({...Q,platforms:Q.platforms.includes(W)?Q.platforms.filter(U=>U!==W):[...Q.platforms,W]}))},E=(W,Q)=>{const U=f.find(pe=>pe.id===Q);y(pe=>({...pe,assignments:{...pe.assignments,[W]:Q?{userId:Q,userName:(U==null?void 0:U.displayName)||(U==null?void 0:U.email)||"Unknown",assignedAt:new Date}:null}}))},I=async W=>{if(W.preventDefault(),!g.title.trim()){m("Title is required");return}try{const Q={title:g.title.trim(),content:g.content.trim(),contentType:g.contentType,platforms:g.platforms,status:g.status,targetDate:g.targetDate?un.fromDate(new Date(g.targetDate)):null,tags:g.tags?g.tags.split(",").map(U=>U.trim()).filter(Boolean):[],assignments:g.assignments};await a(t,Q),p("Post saved")}catch(Q){m("Failed to save post"),console.error(Q)}},T=async()=>{try{await l(t,s==null?void 0:s.title),p("Post deleted"),e("/social")}catch{m("Failed to delete post")}S(!1)},P=async()=>{try{await c(t),p("Post marked as posted")}catch{m("Failed to update post")}A(!1)},O=async W=>{if(W.preventDefault(),!!x.trim())try{await h(x),w("")}catch{m("Failed to add comment")}};if(i)return o.jsx(Qn,{fullScreen:!0});if(!s)return o.jsxs("div",{className:"social-not-found",children:[o.jsx("h2",{children:"Post Not Found"}),o.jsx("p",{children:"The post you're looking for doesn't exist or has been deleted."}),o.jsx(at,{to:"/social",children:o.jsx(K,{children:"Back to Social"})})]});const H=z9(g.platforms),X=g.content.length,se=H&&X>H,L=n(r.SOCIAL_EDIT),B=g.status===cs.READY,$=g.status===cs.POSTED;return o.jsxs("div",{className:"social-edit-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{className:"page-header-left",children:[o.jsxs(at,{to:"/social",className:"back-link",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back to Social"]}),o.jsx("h1",{children:"Edit Post"}),o.jsx("span",{className:"status-badge",style:{backgroundColor:(q=To[g.status])==null?void 0:q.bgColor,color:(Y=To[g.status])==null?void 0:Y.color},children:cT(g.status)})]}),o.jsxs("div",{className:"page-header-right",children:[B&&!$&&L&&o.jsx(K,{variant:"primary",onClick:()=>A(!0),children:"Mark as Posted"}),n(r.SOCIAL_DELETE)&&o.jsx(K,{variant:"danger",onClick:()=>S(!0),children:"Delete"})]})]}),o.jsxs("div",{className:"social-edit-layout",children:[o.jsx("form",{onSubmit:I,className:"social-edit-main",children:o.jsxs("div",{className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Post Details"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content Type"}),o.jsx("div",{className:"content-type-selector",children:Object.entries(QN).map(([W,Q])=>o.jsxs("label",{className:`content-type-option ${g.contentType===W?"selected":""} ${L?"":"disabled"}`,children:[o.jsx("input",{type:"radio",name:"contentType",value:W,checked:g.contentType===W,onChange:j,disabled:!L}),o.jsx("span",{className:"content-type-label",children:Q.label}),o.jsx("span",{className:"content-type-desc",children:Q.description})]},W))})]}),o.jsx(ye,{label:"Title",name:"title",value:g.title,onChange:j,placeholder:"Enter post title...",required:!0,disabled:!L}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Content"}),o.jsx("textarea",{name:"content",className:`form-textarea ${se?"form-input-error":""}`,value:g.content,onChange:j,placeholder:"Write your post content...",rows:8,disabled:!L}),o.jsxs("div",{className:"content-meta",children:[o.jsxs("span",{className:`char-count ${se?"over-limit":""}`,children:[X," characters",H&&` / ${H} max`]}),se&&o.jsx("span",{className:"form-error",children:"Content exceeds platform limit"})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Target Platforms"}),o.jsx("div",{className:"platform-selector",children:Object.entries(sh).map(([W,Q])=>o.jsxs("label",{className:`platform-option ${g.platforms.includes(W)?"selected":""} ${L?"":"disabled"}`,style:{"--platform-color":Q.color,borderColor:g.platforms.includes(W)?Q.color:"var(--color-border)"},children:[o.jsx("input",{type:"checkbox",checked:g.platforms.includes(W),onChange:()=>_(W),disabled:!L}),o.jsx("span",{className:"platform-icon",style:{backgroundColor:Q.color},children:Q.label.charAt(0)}),o.jsx("span",{className:"platform-name",children:Q.label}),o.jsxs("span",{className:"platform-limit",children:[Q.charLimit," chars"]})]},W))})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Scheduling"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsx("select",{name:"status",className:"form-select",value:g.status,onChange:j,disabled:!L,children:Object.entries(To).map(([W,Q])=>o.jsx("option",{value:W,children:Q.label},W))})]}),o.jsx(ye,{label:"Target Date",type:"date",name:"targetDate",value:g.targetDate,onChange:j,disabled:!L})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Organization"}),o.jsx(ye,{label:"Tags",name:"tags",value:g.tags,onChange:j,placeholder:"e.g., aircraft, sale, announcement (comma separated)",disabled:!L})]}),L&&o.jsx("div",{className:"form-actions",children:o.jsx(K,{type:"submit",disabled:u,children:u?"Saving...":"Save Changes"})})]})}),o.jsxs("div",{className:"social-edit-sidebar",children:[o.jsxs("div",{className:"sidebar-card",children:[o.jsx("h3",{children:"Assignments"}),o.jsx("div",{className:"assignments-list",children:Object.entries(Q0e).map(([W,Q])=>{var U;return o.jsxs("div",{className:"assignment-row",children:[o.jsx("label",{className:"assignment-label",children:Q.label}),o.jsxs("select",{className:"form-select",value:((U=g.assignments[W])==null?void 0:U.userId)||"",onChange:pe=>E(W,pe.target.value),disabled:!L,children:[o.jsx("option",{value:"",children:"Unassigned"}),f.map(pe=>o.jsx("option",{value:pe.id,children:pe.displayName||pe.email},pe.id))]})]},W)})})]}),o.jsxs("div",{className:"sidebar-card",children:[o.jsx("h3",{children:"Comments"}),o.jsx("div",{className:"comments-list",children:d.length===0?o.jsx("p",{className:"no-comments",children:"No comments yet"}):d.map(W=>{var Q;return o.jsxs("div",{className:"comment-item",children:[o.jsxs("div",{className:"comment-header",children:[o.jsx("span",{className:"comment-author",children:W.createdByName||"Unknown"}),o.jsx("span",{className:"comment-date",children:(Q=W.createdAt)!=null&&Q.toDate?rt(W.createdAt.toDate(),"MMM d, h:mm a"):""})]}),o.jsx("p",{className:"comment-text",children:W.text})]},W.id)})}),L&&o.jsxs("form",{onSubmit:O,className:"comment-form",children:[o.jsx("textarea",{className:"form-textarea",value:x,onChange:W=>w(W.target.value),placeholder:"Add a comment...",rows:2}),o.jsx(K,{type:"submit",size:"small",disabled:!x.trim(),children:"Add Comment"})]})]}),o.jsxs("div",{className:"sidebar-card",children:[o.jsx("h3",{children:"Post Info"}),o.jsxs("div",{className:"info-list",children:[o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Created"}),o.jsx("span",{className:"info-value",children:(R=s.createdAt)!=null&&R.toDate?rt(s.createdAt.toDate(),"MMM d, yyyy h:mm a"):""})]}),o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Created By"}),o.jsx("span",{className:"info-value",children:s.createdByName||""})]}),o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Last Updated"}),o.jsx("span",{className:"info-value",children:(G=s.updatedAt)!=null&&G.toDate?rt(s.updatedAt.toDate(),"MMM d, yyyy h:mm a"):""})]}),s.postedAt&&o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Posted At"}),o.jsx("span",{className:"info-value",children:(Z=s.postedAt)!=null&&Z.toDate?rt(s.postedAt.toDate(),"MMM d, yyyy h:mm a"):""})]})]})]}),o.jsxs("div",{className:"sidebar-card",children:[o.jsx("h3",{children:"Platform Previews"}),g.platforms.length===0?o.jsx("p",{className:"no-platforms",children:"Select platforms to see previews"}):o.jsx("div",{className:"platform-previews",children:g.platforms.map(W=>{const Q=sh[W],U=g.content.length>Q.charLimit;return o.jsxs("div",{className:"platform-preview",children:[o.jsxs("div",{className:"preview-header",style:{borderColor:Q.color},children:[o.jsx("span",{className:"preview-icon",style:{backgroundColor:Q.color},children:Q.label.charAt(0)}),Q.label,o.jsxs("span",{className:`preview-count ${U?"over":""}`,children:[g.content.length,"/",Q.charLimit]})]}),o.jsxs("div",{className:"preview-content",children:[g.content.substring(0,100),g.content.length>100?"...":""]})]},W)})})]})]})]}),o.jsxs(ut,{isOpen:N,onClose:()=>S(!1),title:"Delete Post",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>S(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:T,disabled:u,children:"Delete"})]}),children:[o.jsxs("p",{children:['Are you sure you want to delete "',s.title,'"?']}),o.jsx("p",{style:{color:"var(--color-text-muted)",marginTop:"8px"},children:"This action cannot be undone."})]}),o.jsxs(ut,{isOpen:C,onClose:()=>A(!1),title:"Mark as Posted",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),o.jsx(K,{onClick:P,disabled:u,children:"Confirm"})]}),children:[o.jsx("p",{children:"Have you manually posted this content to your social media platforms?"}),o.jsx("p",{style:{color:"var(--color-text-muted)",marginTop:"8px"},children:'This will mark the post as "Posted" and record the current timestamp.'})]})]})}function ibe(){const{data:t,loading:e}=pn("enquiries",[qr("createdAt","desc")]),[n,r]=b.useState("all"),s=t.filter(i=>n==="all"||i.status===n);return e?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"enquiries-page",children:[o.jsx("div",{className:"page-header",children:o.jsxs("div",{children:[o.jsx("h1",{children:"Enquiries"}),o.jsxs("p",{className:"page-subtitle",children:[t.length," total enquiries"]})]})}),o.jsx("div",{className:"filters-bar",children:o.jsxs("select",{className:"filter-select",value:n,onChange:i=>r(i.target.value),children:[o.jsx("option",{value:"all",children:"All Status"}),o.jsx("option",{value:"new",children:"New"}),o.jsx("option",{value:"in_progress",children:"In Progress"}),o.jsx("option",{value:"responded",children:"Responded"}),o.jsx("option",{value:"closed",children:"Closed"})]})}),s.length===0?o.jsx("div",{className:"empty-state",children:o.jsx("p",{children:"No enquiries found"})}):o.jsx("div",{className:"enquiries-list",children:s.map(i=>{var a,l,c;return o.jsxs(at,{to:`/enquiries/${i.id}`,className:"enquiry-card",children:[o.jsxs("div",{className:"enquiry-header",children:[o.jsx("span",{className:"enquiry-name",children:i.name||"Unknown"}),o.jsx("span",{className:`status-badge status-${i.status||"new"}`,children:i.status||"new"})]}),o.jsxs("p",{className:"enquiry-message",children:[(a=i.message)==null?void 0:a.substring(0,150),((l=i.message)==null?void 0:l.length)>150?"...":""]}),o.jsxs("div",{className:"enquiry-meta",children:[o.jsx("span",{children:i.email}),o.jsx("span",{children:(c=i.createdAt)!=null&&c.toDate?rt(i.createdAt.toDate(),"MMM d, yyyy"):"Unknown date"})]})]},i.id)})})]})}function abe({isOpen:t,onClose:e,enquiry:n}){const r=rr(),{success:s,error:i}=qt(),{createContact:a}=Ia(),{update:l}=Ms("enquiries"),[c,u]=b.useState(!1),[d,h]=b.useState({firstName:"",lastName:"",email:"",phone:"",company:"",status:"prospect",source:"website_enquiry",timeline:"exploring",internalNotes:""});b.useEffect(()=>{if(n&&t){const m=(n.name||"").trim().split(" "),g=m[0]||"",y=m.slice(1).join(" ")||"";h({firstName:g,lastName:y,email:n.email||"",phone:n.phone||"",company:"",status:"prospect",source:"website_enquiry",timeline:"exploring",internalNotes:n.message?`Original enquiry message:
${n.message}`:""})}},[n,t]);const f=m=>{const{name:g,value:y}=m.target;h(x=>({...x,[g]:y}))},p=async()=>{if(!d.firstName.trim()||!d.lastName.trim()){i("First and last name are required");return}u(!0);try{const m=await a({firstName:d.firstName.trim(),lastName:d.lastName.trim(),email:d.email.trim(),phone:d.phone.trim(),company:d.company.trim(),status:d.status,source:d.source,timeline:d.timeline,internalNotes:d.internalNotes,location:{city:"",country:"",region:""},aircraftInterests:[],budgetRange:{min:null,max:null,currency:"GBP"},linkedEnquiryIds:[n.id]});await l(n.id,{linkedContactId:m,convertedToContact:!0}),s("Contact created successfully"),e(),r(`/contacts/${m}`)}catch(m){console.error("Failed to convert enquiry:",m),i("Failed to create contact")}finally{u(!1)}};return n?o.jsx(ut,{isOpen:t,onClose:e,title:"Convert to Contact",size:"medium",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:e,children:"Cancel"}),o.jsx(K,{onClick:p,loading:c,disabled:!d.firstName.trim()||!d.lastName.trim(),children:"Create Contact"})]}),children:o.jsxs("div",{className:"convert-enquiry-modal",children:[o.jsx("p",{className:"convert-info",children:"Create a new contact from this enquiry. The contact will be linked to this enquiry for future reference."}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Contact Details"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"First Name *",name:"firstName",value:d.firstName,onChange:f,placeholder:"First name",required:!0}),o.jsx(ye,{label:"Last Name *",name:"lastName",value:d.lastName,onChange:f,placeholder:"Last name",required:!0}),o.jsx(ye,{label:"Email",name:"email",type:"email",value:d.email,onChange:f,placeholder:"email@example.com"}),o.jsx(ye,{label:"Phone",name:"phone",type:"tel",value:d.phone,onChange:f,placeholder:"Phone number"}),o.jsx(ye,{label:"Company",name:"company",value:d.company,onChange:f,placeholder:"Company name"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Classification"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status"}),o.jsx("select",{name:"status",value:d.status,onChange:f,className:"form-select",children:Iu.map(m=>o.jsx("option",{value:m.value,children:m.label},m.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Source"}),o.jsx("select",{name:"source",value:d.source,onChange:f,className:"form-select",children:Sv.map(m=>o.jsx("option",{value:m.value,children:m.label},m.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Timeline"}),o.jsx("select",{name:"timeline",value:d.timeline,onChange:f,className:"form-select",children:_v.map(m=>o.jsx("option",{value:m.value,children:m.label},m.value))})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Notes"}),o.jsx("div",{className:"form-group",children:o.jsx("textarea",{name:"internalNotes",value:d.internalNotes,onChange:f,className:"form-textarea",rows:4,placeholder:"Internal notes..."})})]})]})}):null}function obe(){var N;const{id:t}=Op(),e=rr(),{success:n,error:r}=qt(),{can:s,PERMISSIONS:i}=Js(),{data:a,loading:l}=wv("enquiries",t),{update:c}=Ms("enquiries"),[u,d]=b.useState(""),[h,f]=b.useState(""),[p,m]=b.useState(!1),[g,y]=b.useState(!1),x=async S=>{try{await c(t,{status:S}),n(`Status updated to ${S}`)}catch{r("Failed to update status")}},w=async()=>{if(h.trim())try{const S=a.internalNotes||[];await c(t,{internalNotes:[...S,{id:Date.now().toString(),note:h,createdAt:new Date}]}),f(""),n("Note added")}catch{r("Failed to add note")}};return l?o.jsx(Qn,{fullScreen:!0}):a?o.jsxs("div",{className:"enquiry-detail",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("button",{className:"back-link",onClick:()=>e("/enquiries"),children:"Back to Enquiries"}),o.jsxs("h1",{children:["Enquiry from ",a.name||"Unknown"]})]}),o.jsxs("div",{className:"header-actions",children:[s(i.CONTACTS_CREATE)&&!a.convertedToContact&&o.jsx(K,{variant:"secondary",onClick:()=>y(!0),children:"Convert to Contact"}),a.linkedContactId&&o.jsx(at,{to:`/contacts/${a.linkedContactId}`,children:o.jsx(K,{variant:"secondary",children:"View Contact"})}),o.jsxs("select",{className:"status-select",value:a.status||"new",onChange:S=>x(S.target.value),children:[o.jsx("option",{value:"new",children:"New"}),o.jsx("option",{value:"in_progress",children:"In Progress"}),o.jsx("option",{value:"responded",children:"Responded"}),o.jsx("option",{value:"closed",children:"Closed"})]})]})]}),o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-main",children:[o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Message"}),o.jsx("p",{className:"enquiry-message-full",children:a.message}),o.jsxs("div",{className:"enquiry-details",children:[o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Email:"}),o.jsx("a",{href:`mailto:${a.email}`,children:a.email})]}),a.phone&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Phone:"}),o.jsx("a",{href:`tel:${a.phone}`,children:a.phone})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Received:"}),o.jsx("span",{children:(N=a.createdAt)!=null&&N.toDate?rt(a.createdAt.toDate(),"MMMM d, yyyy h:mm a"):"Unknown"})]}),a.listingRef&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Regarding:"}),o.jsx("span",{children:a.listingRef})]})]})]}),s(i.ENQUIRIES_RESPOND)&&o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Send Response"}),o.jsx("textarea",{className:"form-textarea",rows:5,value:u,onChange:S=>d(S.target.value),placeholder:"Type your response..."}),o.jsx(K,{loading:p,disabled:!u.trim(),children:"Send Response"})]})]}),o.jsx("div",{className:"detail-sidebar",children:o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Internal Notes"}),o.jsx("div",{className:"notes-list",children:(a.internalNotes||[]).length===0?o.jsx("p",{className:"empty-notes",children:"No internal notes yet"}):a.internalNotes.map(S=>{var C;return o.jsxs("div",{className:"note-item",children:[o.jsx("p",{children:S.note}),o.jsx("span",{className:"note-date",children:(C=S.createdAt)!=null&&C.toDate?rt(S.createdAt.toDate(),"MMM d, h:mm a"):""})]},S.id)})}),s(i.ENQUIRIES_RESPOND)&&o.jsxs("div",{className:"add-note",children:[o.jsx("textarea",{className:"form-textarea",rows:3,value:h,onChange:S=>f(S.target.value),placeholder:"Add internal note..."}),o.jsx(K,{variant:"secondary",size:"small",onClick:w,disabled:!h.trim(),children:"Add Note"})]})]})})]}),o.jsx(abe,{isOpen:g,onClose:()=>y(!1),enquiry:a})]}):o.jsx("div",{className:"error-state",children:"Enquiry not found"})}function lbe({isOpen:t,onClose:e,onSuccess:n}){const{success:r,error:s,warning:i}=qt(),{createContact:a}=Ia(),[l,c]=b.useState(""),[u,d]=b.useState([]),[h,f]=b.useState([]),[p,m]=b.useState(!1),[g,y]=b.useState(null),[x,w]=b.useState("paste"),N=()=>{navigator.clipboard.writeText(Rde),r("CSV template copied to clipboard")},S=()=>{navigator.clipboard.writeText(GM),r("CSV headers copied to clipboard")},C=I=>{const T=I.trim().split(`
`);if(T.length<2)return{contacts:[],errors:["CSV must have a header row and at least one data row"]};const P=T[0].split(",").map(L=>L.trim().toLowerCase()),O=[],H=[],se=["firstname","lastname"].filter(L=>!P.includes(L));if(se.length>0)return{contacts:[],errors:[`Missing required headers: ${se.join(", ")}`]};for(let L=1;L<T.length;L++){const B=T[L].trim();if(!B)continue;const $=[];let q="",Y=!1;for(let Q=0;Q<B.length;Q++){const U=B[Q];U==='"'?Y=!Y:U===","&&!Y?($.push(q.trim()),q=""):q+=U}$.push(q.trim());const R={};P.forEach((Q,U)=>{R[Q]=$[U]||""});const G=[];R.firstname||G.push("Missing first name"),R.lastname||G.push("Missing last name");const Z=(R.type||"individual").toLowerCase();["individual","business"].includes(Z)||G.push(`Invalid type: ${R.type}`),R.status&&(Iu.map(U=>U.value).includes(R.status)||G.push(`Invalid status: ${R.status}`)),R.source&&(Sv.map(U=>U.value).includes(R.source)||G.push(`Invalid source: ${R.source}`)),R.timeline&&(_v.map(U=>U.value).includes(R.timeline)||G.push(`Invalid timeline: ${R.timeline}`));const W=R.budgetcurrency||"GBP";if(R.budgetcurrency&&!["GBP","USD","EUR"].includes(W.toUpperCase())&&G.push(`Invalid currency: ${R.budgetcurrency}`),G.length>0)H.push(`Row ${L+1}: ${G.join(", ")}`);else{const Q=R.tags?R.tags.split(";").map(ge=>ge.trim()).filter(Boolean):[],U=[];R.aircraftinterests&&R.aircraftinterests.split(";").forEach(me=>{const ue=me.trim().split(" ");if(ue.length>=2){const st=["high","medium","low"].includes(ue[ue.length-1].toLowerCase())?ue.pop().toLowerCase():"medium",Ke=ue[0],ot=ue.slice(1).join(" ");U.push({manufacturer:Ke,model:ot,priority:st})}});const pe=R.budgetmin?parseInt(R.budgetmin,10):null,J=R.budgetmax?parseInt(R.budgetmax,10):null;O.push({contactType:Z,firstName:R.firstname,lastName:R.lastname,email:R.email||"",phone:R.phone||"",jobTitle:R.jobtitle||"",companyName:R.companyname||"",companyEmail:R.companyemail||"",companyPhone:R.companyphone||"",companyWebsite:R.companywebsite||"",location:{city:R.city||"",country:R.country||"",region:R.region||""},status:R.status||"prospect",source:R.source||"other",sourceDetails:R.sourcedetails||"",timeline:R.timeline||"exploring",budgetRange:{min:pe,max:J,currency:W.toUpperCase()},aircraftInterests:U,assignedTo:R.assignedto||"",tags:Q,internalNotes:R.notes||""})}}return{contacts:O,errors:H}},A=()=>{if(!l.trim()){s("Please paste CSV data");return}const{contacts:I,errors:T}=C(l);d(I),f(T),I.length>0?w("preview"):T.length>0&&s("Failed to parse CSV. Check the errors below.")},j=async()=>{if(u.length===0)return;m(!0);const I={success:0,failed:0,errors:[]};for(let T=0;T<u.length;T++)try{await a(u[T]),I.success++}catch(P){I.failed++,I.errors.push(`${u[T].firstName} ${u[T].lastName}: ${P.message}`)}y(I),w("results"),m(!1),I.success>0&&(r(`Imported ${I.success} contact${I.success!==1?"s":""}`),n&&n())},_=()=>{c(""),d([]),f([]),y(null),w("paste"),e()},E=()=>{x==="preview"?w("paste"):x==="results"&&(w("paste"),c(""),d([]),f([]),y(null))};return o.jsx(ut,{isOpen:t,onClose:_,title:"Import Contacts from CSV",size:"large",footer:x==="paste"?o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:_,children:"Cancel"}),o.jsx(K,{onClick:A,disabled:!l.trim(),children:"Parse CSV"})]}):x==="preview"?o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:E,children:"Back"}),o.jsxs(K,{onClick:j,loading:p,children:["Import ",u.length," Contact",u.length!==1?"s":""]})]}):o.jsx(K,{onClick:_,children:"Done"}),children:o.jsxs("div",{className:"csv-import-modal",children:[x==="paste"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"csv-template-section",children:[o.jsx("h4",{children:"CSV Template"}),o.jsx("p",{className:"form-help",children:"Copy the template below to get started. Tags should be separated by semicolons (;) within the field."}),o.jsxs("div",{className:"csv-template-actions",children:[o.jsx(K,{variant:"secondary",size:"small",onClick:N,children:"Copy Full Template (with examples)"}),o.jsx(K,{variant:"secondary",size:"small",onClick:S,children:"Copy Headers Only"})]}),o.jsx("div",{className:"csv-template-preview",children:o.jsx("code",{children:GM})})]}),o.jsxs("div",{className:"csv-paste-section",children:[o.jsx("h4",{children:"Paste CSV Data"}),o.jsx("textarea",{className:"form-textarea csv-textarea",rows:10,value:l,onChange:I=>c(I.target.value),placeholder:"Paste your CSV data here..."})]}),o.jsxs("div",{className:"csv-format-guide",children:[o.jsx("h4",{children:"Field Guide"}),o.jsxs("div",{className:"format-grid",children:[o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"type *"}),o.jsx("span",{children:"individual, business"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"firstName *"}),o.jsx("span",{children:"Contact's first name"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"lastName *"}),o.jsx("span",{children:"Contact's last name"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"status"}),o.jsx("span",{children:"prospect, active_buyer, past_buyer, seller, broker, inactive"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"source"}),o.jsx("span",{children:"website_enquiry, referral, trade_show, cold_outreach, repeat_customer, other"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"timeline"}),o.jsx("span",{children:"immediate, 1_3_months, 3_6_months, 6_12_months, exploring"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"budgetCurrency"}),o.jsx("span",{children:"GBP, USD, EUR"})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"aircraftInterests"}),o.jsx("span",{children:'Format: "Manufacturer Model Priority" e.g., "Robinson R44 high;Bell 206 medium"'})]}),o.jsxs("div",{className:"format-item",children:[o.jsx("strong",{children:"tags"}),o.jsx("span",{children:'Semicolon-separated e.g., "VIP;Priority;Cash"'})]})]}),o.jsx("p",{className:"format-note",children:"* Required fields. Business contacts should include companyName, companyEmail, companyPhone, companyWebsite."})]})]}),x==="preview"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"csv-preview-header",children:[o.jsxs("h4",{children:["Preview (",u.length," contacts ready to import)"]}),h.length>0&&o.jsxs("div",{className:"csv-warnings",children:[o.jsx("strong",{children:"Skipped rows with errors:"}),o.jsx("ul",{children:h.map((I,T)=>o.jsx("li",{children:I},T))})]})]}),o.jsx("div",{className:"csv-preview-table-wrapper",children:o.jsxs("table",{className:"csv-preview-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Type"}),o.jsx("th",{children:"Name / Company"}),o.jsx("th",{children:"Contact"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Budget"}),o.jsx("th",{children:"Interests"}),o.jsx("th",{children:"Assigned"})]})}),o.jsx("tbody",{children:u.map((I,T)=>{var P,O,H,X,se;return o.jsxs("tr",{children:[o.jsx("td",{children:o.jsx("span",{className:`type-badge type-${I.contactType}`,children:I.contactType})}),o.jsx("td",{children:I.contactType==="business"?o.jsxs(o.Fragment,{children:[o.jsx("strong",{children:I.companyName}),o.jsxs("span",{className:"job-title",children:[I.firstName," ",I.lastName,I.jobTitle&&` (${I.jobTitle})`]})]}):o.jsxs(o.Fragment,{children:[I.firstName," ",I.lastName,I.companyName&&o.jsx("span",{className:"job-title",children:I.companyName})]})}),o.jsxs("td",{children:[o.jsx("span",{className:"preview-email",children:I.email||"-"}),I.phone&&o.jsx("span",{className:"preview-phone",children:I.phone})]}),o.jsx("td",{children:I.status}),o.jsx("td",{children:(P=I.budgetRange)!=null&&P.min||(O=I.budgetRange)!=null&&O.max?o.jsxs("span",{className:"preview-budget",children:[I.budgetRange.currency," ",((H=I.budgetRange.min)==null?void 0:H.toLocaleString())||"?"," - ",((X=I.budgetRange.max)==null?void 0:X.toLocaleString())||"?"]}):"-"}),o.jsx("td",{children:((se=I.aircraftInterests)==null?void 0:se.length)>0?o.jsx("span",{className:"preview-interests",children:I.aircraftInterests.map(L=>`${L.manufacturer} ${L.model}`).join(", ")}):"-"}),o.jsx("td",{children:I.assignedTo||"-"})]},T)})})]})})]}),x==="results"&&g&&o.jsxs("div",{className:"csv-results",children:[o.jsxs("div",{className:"results-summary",children:[o.jsxs("div",{className:"result-item result-success",children:[o.jsx("span",{className:"result-number",children:g.success}),o.jsx("span",{className:"result-label",children:"Imported"})]}),g.failed>0&&o.jsxs("div",{className:"result-item result-failed",children:[o.jsx("span",{className:"result-number",children:g.failed}),o.jsx("span",{className:"result-label",children:"Failed"})]})]}),g.errors.length>0&&o.jsxs("div",{className:"results-errors",children:[o.jsx("h4",{children:"Errors"}),o.jsx("ul",{children:g.errors.map((I,T)=>o.jsx("li",{children:I},T))})]})]})]})})}function cbe(){const t=rr(),{can:e,PERMISSIONS:n}=Js(),{data:r,loading:s}=pn("contacts",[qr("createdAt","desc")]),[i,a]=b.useState("all"),[l,c]=b.useState("all"),[u,d]=b.useState("all"),[h,f]=b.useState("all"),[p,m]=b.useState(""),[g,y]=b.useState(!1),[x,w]=b.useState(1),[N,S]=b.useState(25),C=b.useMemo(()=>r.filter(E=>{if(u!=="all"&&E.contactType!==u||i!=="all"&&E.status!==i||l!=="all"&&E.source!==l)return!1;if(h!=="all"){const I=E.levelOfInterest||"unknown";if(({highly_motivated:"high",very_interested:"high",interested:"medium",casual:"medium"}[I]||I)!==h)return!1}if(p){const I=p.toLowerCase(),T=`${E.firstName} ${E.lastName}`.toLowerCase(),P=(E.email||"").toLowerCase(),O=(E.companyName||"").toLowerCase(),H=(E.phone||"").toLowerCase();if(!T.includes(I)&&!P.includes(I)&&!O.includes(I)&&!H.includes(I))return!1}return!0}),[r,i,l,u,h,p]),A=Math.ceil(C.length/N),j=b.useMemo(()=>{const E=(x-1)*N;return C.slice(E,E+N)},[C,x,N]);b.useEffect(()=>{w(1)},[i,l,u,h,p]);const _=e(n.CONTACTS_CREATE);return s?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"contacts-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Contacts"}),o.jsxs("p",{className:"page-subtitle",children:[r.length," total contacts"]})]}),o.jsx("div",{className:"page-header-actions",children:_&&o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>y(!0),children:"Import CSV"}),o.jsx(K,{onClick:()=>t("/contacts/new"),children:"Add Contact"})]})})]}),o.jsxs("div",{className:"filters-bar",children:[o.jsx("input",{type:"text",className:"filter-search",placeholder:"Search contacts...",value:p,onChange:E=>m(E.target.value)}),o.jsxs("select",{className:"filter-select",value:u,onChange:E=>d(E.target.value),children:[o.jsx("option",{value:"all",children:"All Types"}),ZH.map(E=>o.jsx("option",{value:E.value,children:E.label},E.value))]}),o.jsxs("select",{className:"filter-select",value:i,onChange:E=>a(E.target.value),children:[o.jsx("option",{value:"all",children:"All Status"}),Iu.map(E=>o.jsx("option",{value:E.value,children:E.label},E.value))]}),o.jsxs("select",{className:"filter-select",value:l,onChange:E=>c(E.target.value),children:[o.jsx("option",{value:"all",children:"All Sources"}),Sv.map(E=>o.jsx("option",{value:E.value,children:E.label},E.value))]}),o.jsxs("select",{className:"filter-select",value:h,onChange:E=>f(E.target.value),children:[o.jsx("option",{value:"all",children:"All Interest Levels"}),kN.map(E=>o.jsx("option",{value:E.value,children:E.label},E.value))]})]}),(u!=="all"||i!=="all"||l!=="all"||h!=="all"||p)&&o.jsxs("p",{className:"results-count",children:["Showing ",C.length," of ",r.length," contacts"]}),C.length===0?o.jsx("div",{className:"empty-state",children:r.length===0?o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"No contacts yet"}),_&&o.jsxs("div",{className:"empty-state-actions",children:[o.jsx(K,{onClick:()=>t("/contacts/new"),children:"Add Your First Contact"}),o.jsx(K,{variant:"secondary",onClick:()=>y(!0),children:"Import from CSV"})]})]}):o.jsx("p",{children:"No contacts match your filters"})}):o.jsxs("div",{className:"contacts-table-wrapper",children:[o.jsxs("table",{className:"contacts-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Type"}),o.jsx("th",{children:"Name / Company"}),o.jsx("th",{children:"Contact"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Aircraft Interests"}),o.jsx("th",{children:"Timeline"}),o.jsx("th",{children:"Last Contact"})]})}),o.jsx("tbody",{children:j.map(E=>{var I,T,P;return o.jsxs("tr",{onClick:()=>t(`/contacts/${E.id}`),className:"contact-row",children:[o.jsx("td",{children:o.jsx("span",{className:`type-badge type-${E.contactType||"individual"}`,children:E.contactType==="business"?"Business":"Individual"})}),o.jsx("td",{children:o.jsxs("div",{className:"contact-name-cell",children:[E.contactType==="business"?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"contact-company-name",children:E.companyName}),o.jsxs("span",{className:"contact-person",children:[E.firstName," ",E.lastName,E.jobTitle&&` (${E.jobTitle})`]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("span",{className:"contact-name",children:[E.firstName," ",E.lastName]}),E.companyName&&o.jsx("span",{className:"contact-company-affiliation",children:E.companyName})]}),((I=E.location)==null?void 0:I.city)&&o.jsxs("span",{className:"contact-location",children:[E.location.city,E.location.country&&`, ${E.location.country}`]})]})}),o.jsx("td",{children:o.jsxs("div",{className:"contact-info-cell",children:[E.email&&o.jsx("a",{href:`mailto:${E.email}`,className:"contact-email",onClick:O=>O.stopPropagation(),children:E.email}),E.phone&&o.jsx("span",{className:"contact-phone",children:E.phone})]})}),o.jsx("td",{onClick:O=>O.stopPropagation(),children:o.jsx(jI,{contactId:E.id,currentStatus:E.status,compact:!0})}),o.jsx("td",{children:E.aircraftInterests&&E.aircraftInterests.length>0?o.jsxs("div",{className:"interest-tags",children:[E.aircraftInterests.slice(0,2).map((O,H)=>o.jsxs("span",{className:`interest-tag priority-${O.priority||"medium"}`,children:[O.manufacturer," ",O.model,O.priority&&o.jsx("span",{className:`priority-indicator priority-${O.priority}`,children:O.priority==="high"?"":O.priority==="medium"?"":""})]},H)),E.aircraftInterests.length>2&&o.jsxs("span",{className:"interest-more",children:["+",E.aircraftInterests.length-2]})]}):o.jsx("span",{className:"text-muted",children:""})}),o.jsx("td",{children:o.jsx("span",{className:"timeline-badge",children:_I(E.timeline)})}),o.jsx("td",{children:(P=(T=E.followUp)==null?void 0:T.lastContactedDate)!=null&&P.toDate?rt(E.followUp.lastContactedDate.toDate(),"MMM d, yyyy"):o.jsx("span",{className:"text-muted",children:"Never"})})]},E.id)})})]}),A>1&&o.jsxs("div",{className:"table-pagination",children:[o.jsxs("div",{className:"pagination-info",children:["Showing ",(x-1)*N+1,"-",Math.min(x*N,C.length)," of ",C.length]}),o.jsxs("div",{className:"pagination-controls",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>w(1),disabled:x===1,children:""}),o.jsx("button",{className:"pagination-btn",onClick:()=>w(E=>Math.max(1,E-1)),disabled:x===1,children:" Prev"}),o.jsxs("span",{className:"pagination-pages",children:["Page ",x," of ",A]}),o.jsx("button",{className:"pagination-btn",onClick:()=>w(E=>Math.min(A,E+1)),disabled:x===A,children:"Next "}),o.jsx("button",{className:"pagination-btn",onClick:()=>w(A),disabled:x===A,children:""})]}),o.jsxs("select",{className:"pagination-select",value:N,onChange:E=>{S(parseInt(E.target.value)),w(1)},children:[o.jsx("option",{value:10,children:"10 per page"}),o.jsx("option",{value:25,children:"25 per page"}),o.jsx("option",{value:50,children:"50 per page"}),o.jsx("option",{value:100,children:"100 per page"})]})]})]}),o.jsx(lbe,{isOpen:g,onClose:()=>y(!1),onSuccess:()=>y(!1)})]})}function H9({interests:t=[],onChange:e,manufacturers:n=[],getModelsForManufacturer:r}){const[s,i]=b.useState({manufacturer:"",model:"",condition:"either",priority:"medium"}),[a,l]=b.useState([]),c=y=>{const x=y.target.value;i(w=>({...w,manufacturer:x,model:""})),l(x&&r?r(x):[])},u=y=>{i(x=>({...x,model:y.target.value}))},d=y=>{i(x=>({...x,condition:y.target.value}))},h=y=>{i(x=>({...x,priority:y.target.value}))},f=()=>{!s.manufacturer||t.some(x=>x.manufacturer===s.manufacturer&&x.model===s.model&&x.condition===s.condition)||(e([...t,{...s}]),i({manufacturer:"",model:"",condition:"either",priority:"medium"}),l([]))},p=y=>{const x=t.filter((w,N)=>N!==y);e(x)},m=(y,x)=>{const w=t.map((N,S)=>S===y?{...N,priority:x}:N);e(w)},g=(y,x)=>{const w=t.map((N,S)=>S===y?{...N,condition:x}:N);e(w)};return o.jsxs("div",{className:"aircraft-interest-selector",children:[t.length>0&&o.jsx("div",{className:"interests-list",children:t.map((y,x)=>o.jsxs("div",{className:"interest-item",children:[o.jsxs("div",{className:"interest-info",children:[o.jsxs("span",{className:"interest-aircraft",children:[y.manufacturer,y.model&&` - ${y.model}`]}),o.jsxs("div",{className:"interest-selects",children:[o.jsx("select",{value:y.condition||"either",onChange:w=>g(x,w.target.value),className:"interest-condition-select",children:AC.map(w=>o.jsx("option",{value:w.value,children:w.label},w.value))}),o.jsx("select",{value:y.priority,onChange:w=>m(x,w.target.value),className:"interest-priority-select",children:TC.map(w=>o.jsx("option",{value:w.value,children:w.label},w.value))})]})]}),o.jsx("button",{type:"button",className:"interest-remove",onClick:()=>p(x),title:"Remove",children:""})]},x))}),o.jsx("div",{className:"add-interest-form",children:o.jsxs("div",{className:"add-interest-row",children:[o.jsxs("select",{value:s.manufacturer,onChange:c,className:"form-select",children:[o.jsx("option",{value:"",children:"Select manufacturer"}),n.map(y=>o.jsx("option",{value:y,children:y},y))]}),o.jsxs("select",{value:s.model,onChange:u,className:"form-select",disabled:!s.manufacturer,children:[o.jsx("option",{value:"",children:"Any model"}),a.map(y=>o.jsx("option",{value:y,children:y},y))]}),o.jsx("select",{value:s.condition,onChange:d,className:"form-select",children:AC.map(y=>o.jsx("option",{value:y.value,children:y.label},y.value))}),o.jsx("select",{value:s.priority,onChange:h,className:"form-select",children:TC.map(y=>o.jsx("option",{value:y.value,children:y.label},y.value))}),o.jsx(K,{type:"button",variant:"secondary",onClick:f,disabled:!s.manufacturer,children:"Add"})]})}),t.length===0&&o.jsx("p",{className:"form-help",children:"No aircraft interests added yet. Add manufacturers and models this contact is interested in."})]})}function W9({initialData:t={},onSubmit:e,loading:n,submitLabel:r="Save Contact"}){const s=rr(),{manufacturers:i,getModelsForManufacturer:a}=Pu(),{data:l}=pn("users"),[c,u]=b.useState({contactType:"individual",firstName:"",lastName:"",email:"",phone:"",jobTitle:"",companyName:"",companyEmail:"",companyPhone:"",companyWebsite:"",location:{city:"",country:"",region:""},status:"prospect",source:"website_enquiry",sourceDetails:"",levelOfInterest:"unknown",newUsedPreference:"any",aircraftInterests:[],buyerSituation:"first_time",budgetRange:{min:"",max:"",currency:"GBP"},timeline:"exploring",assignedTo:"",tags:[],internalNotes:"",...t}),[d,h]=b.useState("");b.useEffect(()=>{Object.keys(t).length>0&&u(N=>({...N,...t,contactType:t.contactType||"individual",location:{city:"",country:"",region:"",...t.location||{}},budgetRange:{min:"",max:"",currency:"GBP",...t.budgetRange||{}}}))},[t]);const f=N=>{const{name:S,value:C}=N.target;if(S.includes(".")){const[A,j]=S.split(".");u(_=>({..._,[A]:{..._[A],[j]:C}}))}else u(A=>({...A,[S]:C}))},p=N=>{u(S=>({...S,contactType:N,...N==="individual"?{companyEmail:"",companyPhone:"",companyWebsite:""}:{}}))},m=N=>{u(S=>({...S,aircraftInterests:N}))},g=()=>{d.trim()&&!c.tags.includes(d.trim())&&(u(N=>({...N,tags:[...N.tags,d.trim()]})),h(""))},y=N=>{u(S=>({...S,tags:S.tags.filter(C=>C!==N)}))},x=N=>{N.preventDefault();const S={...c,budgetRange:{...c.budgetRange,min:c.budgetRange.min?parseInt(c.budgetRange.min):null,max:c.budgetRange.max?parseInt(c.budgetRange.max):null}};e(S)},w=c.contactType==="business";return o.jsxs("form",{onSubmit:x,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Contact Type"}),o.jsx("div",{className:"contact-type-selector",children:ZH.map(N=>o.jsxs("button",{type:"button",className:`type-option ${c.contactType===N.value?"type-option-active":""}`,onClick:()=>p(N.value),children:[o.jsx("span",{className:"type-icon",children:N.value==="individual"?o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]}):o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),o.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),o.jsx("span",{className:"type-label",children:N.label}),o.jsx("span",{className:"type-desc",children:N.value==="individual"?"Private buyer or seller":"Company or organisation"})]},N.value))})]}),w&&o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Business Details"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Company Name *",name:"companyName",value:c.companyName,onChange:f,placeholder:"Company name",required:!0}),o.jsx(ye,{label:"Company Email",name:"companyEmail",type:"email",value:c.companyEmail,onChange:f,placeholder:"info@company.com"}),o.jsx(ye,{label:"Company Phone",name:"companyPhone",type:"tel",value:c.companyPhone,onChange:f,placeholder:"Main phone number"}),o.jsx(ye,{label:"Website",name:"companyWebsite",value:c.companyWebsite,onChange:f,placeholder:"https://company.com"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:w?"Primary Contact Person":"Contact Information"}),o.jsx("p",{className:"form-section-hint",children:w?"The main person you deal with at this company":"Personal details of the individual"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"First Name *",name:"firstName",value:c.firstName,onChange:f,placeholder:"First name",required:!0}),o.jsx(ye,{label:"Last Name *",name:"lastName",value:c.lastName,onChange:f,placeholder:"Last name",required:!0}),o.jsx(ye,{label:"Email",name:"email",type:"email",value:c.email,onChange:f,placeholder:"email@example.com"}),o.jsx(ye,{label:"Phone",name:"phone",type:"tel",value:c.phone,onChange:f,placeholder:"+44 7XXX XXX XXX"}),w&&o.jsx(ye,{label:"Job Title",name:"jobTitle",value:c.jobTitle,onChange:f,placeholder:"e.g., Fleet Manager"}),!w&&o.jsx(ye,{label:"Company (optional)",name:"companyName",value:c.companyName,onChange:f,placeholder:"If affiliated with a company"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Location"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"City",name:"location.city",value:c.location.city,onChange:f,placeholder:"City"}),o.jsx(ye,{label:"Country",name:"location.country",value:c.location.country,onChange:f,placeholder:"Country"}),o.jsx(ye,{label:"Region",name:"location.region",value:c.location.region,onChange:f,placeholder:"Region / State"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Classification & Assignment"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Status *"}),o.jsx("select",{name:"status",value:c.status,onChange:f,className:"form-select",required:!0,children:Iu.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Source"}),o.jsx("select",{name:"source",value:c.source,onChange:f,className:"form-select",children:Sv.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Level of Interest"}),o.jsx("select",{name:"levelOfInterest",value:c.levelOfInterest,onChange:f,className:"form-select",children:kN.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))}),o.jsx("span",{className:"form-help",children:"How motivated is this contact to purchase?"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"New/Used Preference"}),o.jsx("select",{name:"newUsedPreference",value:c.newUsedPreference,onChange:f,className:"form-select",children:Cde.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))}),o.jsx("span",{className:"form-help",children:"Does this contact prefer new or used aircraft?"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Assigned To"}),o.jsxs("select",{name:"assignedTo",value:c.assignedTo,onChange:f,className:"form-select",children:[o.jsx("option",{value:"",children:"Unassigned"}),l.map(N=>o.jsx("option",{value:N.displayName||N.email,children:N.displayName||N.email},N.id))]}),o.jsx("span",{className:"form-help",children:"Team member responsible for this contact"})]}),c.source==="other"&&o.jsx(ye,{label:"Source Details",name:"sourceDetails",value:c.sourceDetails,onChange:f,placeholder:"Specify source"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Aircraft Interests"}),o.jsxs("div",{className:"buyer-situation-selector",children:[o.jsx("label",{className:"form-label",children:"Buyer Situation"}),o.jsx("div",{className:"situation-options",children:eW.map(N=>o.jsxs("button",{type:"button",className:`situation-option ${c.buyerSituation===N.value?"situation-option-active":""}`,onClick:()=>u(S=>({...S,buyerSituation:N.value})),children:[o.jsx("span",{className:"situation-label",children:N.label}),o.jsx("span",{className:"situation-desc",children:N.description})]},N.value))})]}),o.jsxs("div",{style:{marginTop:"20px"},children:[o.jsx("label",{className:"form-label",children:"Aircraft Models of Interest"}),o.jsx(H9,{interests:c.aircraftInterests,onChange:m,manufacturers:i,getModelsForManufacturer:a})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Budget & Timeline"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Currency"}),o.jsx("select",{name:"budgetRange.currency",value:c.budgetRange.currency,onChange:f,className:"form-select",children:nW.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))})]}),o.jsx(ye,{label:"Min Budget",name:"budgetRange.min",type:"number",value:c.budgetRange.min,onChange:f,placeholder:"Minimum"}),o.jsx(ye,{label:"Max Budget",name:"budgetRange.max",type:"number",value:c.budgetRange.max,onChange:f,placeholder:"Maximum"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Timeline"}),o.jsx("select",{name:"timeline",value:c.timeline,onChange:f,className:"form-select",children:_v.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Tags"}),c.tags.length>0&&o.jsxs("div",{className:"selected-tags",children:[o.jsx("label",{className:"form-label",children:"Selected Tags"}),o.jsx("div",{className:"tags-list",children:c.tags.map(N=>o.jsxs("span",{className:"tag tag-selected",children:[N,o.jsx("button",{type:"button",className:"tag-remove",onClick:()=>y(N),children:""})]},N))})]}),o.jsxs("div",{className:"predefined-tags",children:[o.jsxs("div",{className:"tag-category",children:[o.jsx("label",{className:"tag-category-label",children:"Priority"}),o.jsx("div",{className:"tag-options",children:Tm.filter(N=>N.category==="priority").map(N=>o.jsx("button",{type:"button",className:`tag-option ${c.tags.includes(N.value)?"tag-option-selected":""}`,onClick:()=>{c.tags.includes(N.value)?y(N.value):u(S=>({...S,tags:[...S.tags,N.value]}))},children:N.label},N.value))})]}),o.jsxs("div",{className:"tag-category",children:[o.jsx("label",{className:"tag-category-label",children:"Buyer Type"}),o.jsx("div",{className:"tag-options",children:Tm.filter(N=>N.category==="buyer").map(N=>o.jsx("button",{type:"button",className:`tag-option ${c.tags.includes(N.value)?"tag-option-selected":""}`,onClick:()=>{c.tags.includes(N.value)?y(N.value):u(S=>({...S,tags:[...S.tags,N.value]}))},children:N.label},N.value))})]}),o.jsxs("div",{className:"tag-category",children:[o.jsx("label",{className:"tag-category-label",children:"Interest"}),o.jsx("div",{className:"tag-options",children:Tm.filter(N=>N.category==="interest").map(N=>o.jsx("button",{type:"button",className:`tag-option ${c.tags.includes(N.value)?"tag-option-selected":""}`,onClick:()=>{c.tags.includes(N.value)?y(N.value):u(S=>({...S,tags:[...S.tags,N.value]}))},children:N.label},N.value))})]}),o.jsxs("div",{className:"tag-category",children:[o.jsx("label",{className:"tag-category-label",children:"Region"}),o.jsx("div",{className:"tag-options",children:Tm.filter(N=>N.category==="region").map(N=>o.jsx("button",{type:"button",className:`tag-option ${c.tags.includes(N.value)?"tag-option-selected":""}`,onClick:()=>{c.tags.includes(N.value)?y(N.value):u(S=>({...S,tags:[...S.tags,N.value]}))},children:N.label},N.value))})]}),o.jsxs("div",{className:"tag-category",children:[o.jsx("label",{className:"tag-category-label",children:"Relationship"}),o.jsx("div",{className:"tag-options",children:Tm.filter(N=>N.category==="relationship").map(N=>o.jsx("button",{type:"button",className:`tag-option ${c.tags.includes(N.value)?"tag-option-selected":""}`,onClick:()=>{c.tags.includes(N.value)?y(N.value):u(S=>({...S,tags:[...S.tags,N.value]}))},children:N.label},N.value))})]})]}),o.jsxs("div",{className:"custom-tag-input",children:[o.jsx("label",{className:"tag-category-label",children:"Add Custom Tag"}),o.jsxs("div",{className:"tag-input-row",children:[o.jsx("input",{type:"text",value:d,onChange:N=>h(N.target.value),onKeyDown:N=>{N.key==="Enter"&&(N.preventDefault(),g())},className:"form-input",placeholder:"Type a custom tag..."}),o.jsx(K,{type:"button",variant:"secondary",onClick:g,children:"Add"})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Internal Notes"}),o.jsx("div",{className:"form-group",children:o.jsx("textarea",{name:"internalNotes",value:c.internalNotes,onChange:f,className:"form-textarea",rows:4,placeholder:"Private notes about this contact..."})})]}),o.jsxs("div",{className:"form-actions",children:[o.jsx(K,{type:"button",variant:"secondary",onClick:()=>s("/contacts"),children:"Cancel"}),o.jsx(K,{type:"submit",loading:n,children:r})]})]})}function ube(){const t=rr(),{success:e,error:n}=qt(),{createContact:r,loading:s}=Ia(),i=async a=>{try{const l=await r(a);e("Contact created successfully"),t(`/contacts/${l}`)}catch(l){console.error("Failed to create contact:",l),n("Failed to create contact")}};return o.jsxs("div",{className:"contact-create",children:[o.jsx("div",{className:"page-header",children:o.jsx("h1",{children:"Add New Contact"})}),o.jsx(W9,{onSubmit:i,loading:s,submitLabel:"Create Contact"})]})}function dbe({contactId:t}){const{activities:e,loading:n,addActivity:r,deleteActivity:s}=JH(t),{data:i}=pn("helicopters"),{success:a,error:l}=qt(),[c,u]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(null),[m,g]=b.useState(!1),[y,x]=b.useState(!1),[w,N]=b.useState(""),[S,C]=b.useState([]),[A,j]=b.useState("pending"),_=b.useRef(null),[E,I]=b.useState(0),[T,P]=b.useState({type:"note",title:"",description:"",date:new Date().toISOString().split("T")[0]}),O=i.filter(Y=>{var G,Z,W;if(!w)return!1;const R=w.toLowerCase();return((G=Y.registration)==null?void 0:G.toLowerCase().includes(R))||((Z=Y.model)==null?void 0:Z.toLowerCase().includes(R))||((W=Y.manufacturer)==null?void 0:W.toLowerCase().includes(R))}).slice(0,5),H=Y=>{const{name:R,value:G}=Y.target;if(P(Z=>({...Z,[R]:G})),R==="description"){const Z=Y.target.selectionStart;I(Z);const Q=G.slice(0,Z).match(/@([A-Za-z0-9-]*)$/);Q?(N(Q[1]),x(!0)):(x(!1),N(""))}},X=Y=>{var W;S.find(Q=>Q.id===Y.id)||C(Q=>[...Q,{id:Y.id,registration:Y.registration,manufacturer:Y.manufacturer,model:Y.model,year:Y.year}]);const R=T.description.slice(0,E),G=T.description.slice(E),Z=R.match(/@([A-Za-z0-9-]*)$/);if(Z){const Q=R.slice(0,Z.index)+`@${Y.registration} `;P(U=>({...U,description:Q+G}))}x(!1),N(""),(W=_.current)==null||W.focus()},se=Y=>{C(R=>R.filter(G=>G.id!==Y))},L=async()=>{if(!T.title.trim()){l("Please enter a title");return}g(!0);try{await r({type:T.type,title:T.title.trim(),description:T.description.trim(),date:new Date(T.date),linkedHelicopters:S.length>0?S:null,proposalOutcome:S.length>0?A:null}),a(S.length>0?`Activity added with ${S.length} aircraft linked`:"Activity added"),u(!1),P({type:"note",title:"",description:"",date:new Date().toISOString().split("T")[0]}),C([]),j("pending")}catch(Y){console.error("Failed to add activity:",Y),l("Failed to add activity")}finally{g(!1)}},B=async()=>{if(f){g(!0);try{await s(f.id),a("Activity deleted"),h(!1),p(null)}catch(Y){console.error("Failed to delete activity:",Y),l("Failed to delete activity")}finally{g(!1)}}},$=Y=>{p(Y),h(!0)},q=Y=>({call:"#3b82f6",email:"#8b5cf6",meeting:"#22c55e",note:"#6b7280",enquiry:"#f59e0b",follow_up:"#06b6d4",purchase:"#10b981"})[Y]||"#6b7280";return n?o.jsx("p",{className:"text-muted",children:"Loading activities..."}):o.jsxs("div",{className:"activity-timeline",children:[o.jsxs("div",{className:"timeline-header",children:[o.jsx("h3",{children:"Activity Timeline"}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>u(!0),children:"Add Activity"})]}),e.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:"No activities yet"}),o.jsx("p",{className:"text-muted",children:"Log calls, emails, and meetings to track your interactions."})]}):o.jsx("div",{className:"timeline",children:e.map(Y=>{var R,G;return o.jsxs("div",{className:"timeline-item",children:[o.jsx("div",{className:"timeline-icon",style:{backgroundColor:q(Y.type)},children:o.jsx("span",{className:"icon-placeholder",children:Y.type.charAt(0).toUpperCase()})}),o.jsxs("div",{className:"timeline-content",children:[o.jsxs("div",{className:"timeline-header-row",children:[o.jsx("span",{className:"timeline-type",children:Ide(Y.type)}),o.jsx("span",{className:"timeline-date",children:(R=Y.date)!=null&&R.toDate?rt(Y.date.toDate(),"MMM d, yyyy h:mm a"):"-"})]}),o.jsx("h4",{className:"timeline-title",children:Y.title}),Y.description&&o.jsx("p",{className:"timeline-description",children:Y.description}),((G=Y.linkedHelicopters)==null?void 0:G.length)>0&&o.jsxs("div",{className:"timeline-aircraft",children:[o.jsx("span",{className:"aircraft-label",children:"Aircraft:"}),Y.linkedHelicopters.map(Z=>o.jsx(at,{to:`/listings/${Z.id}`,className:"timeline-aircraft-link",children:Z.registration},Z.id)),Y.proposalOutcome&&o.jsx("span",{className:`proposal-outcome outcome-${Y.proposalOutcome}`,children:Y.proposalOutcome==="not_interested"?"Not Interested":Y.proposalOutcome.charAt(0).toUpperCase()+Y.proposalOutcome.slice(1)})]}),o.jsxs("div",{className:"timeline-meta",children:[o.jsxs("span",{className:"timeline-author",children:["by ",Y.createdByName||"Unknown"]}),o.jsx("button",{className:"timeline-delete",onClick:()=>$(Y),children:"Delete"})]})]})]},Y.id)})}),o.jsxs(ut,{isOpen:c,onClose:()=>u(!1),title:"Add Activity",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),o.jsx(K,{onClick:L,loading:m,children:"Add Activity"})]}),children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Type"}),o.jsx("select",{name:"type",value:T.type,onChange:H,className:"form-select",children:tW.map(Y=>o.jsx("option",{value:Y.value,children:Y.label},Y.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Date"}),o.jsx("input",{type:"date",name:"date",value:T.date,onChange:H,className:"form-input"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Title *"}),o.jsx("input",{type:"text",name:"title",value:T.title,onChange:H,className:"form-input",placeholder:"Brief summary of the activity"})]}),o.jsxs("div",{className:"form-group",style:{position:"relative"},children:[o.jsxs("label",{className:"form-label",children:["Description",o.jsx("span",{style:{fontWeight:"normal",color:"#666",marginLeft:"8px"},children:"Type @ to mention an aircraft"})]}),o.jsx("textarea",{ref:_,name:"description",value:T.description,onChange:H,className:"form-textarea",rows:4,placeholder:"Additional details... Use @registration to link aircraft"}),y&&O.length>0&&o.jsx("div",{className:"aircraft-mention-dropdown",children:O.map(Y=>o.jsxs("button",{type:"button",className:"aircraft-mention-option",onClick:()=>X(Y),children:[o.jsx("span",{className:"mention-reg",children:Y.registration||"N/A"}),o.jsxs("span",{className:"mention-details",children:[Y.year," ",Y.manufacturer," ",Y.model]})]},Y.id))})]}),S.length>0&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Linked Aircraft"}),o.jsx("div",{className:"linked-aircraft-list",children:S.map(Y=>o.jsxs("div",{className:"linked-aircraft-chip",children:[o.jsx("span",{className:"chip-reg",children:Y.registration}),o.jsxs("span",{className:"chip-model",children:[Y.year," ",Y.manufacturer," ",Y.model]}),o.jsx("button",{type:"button",className:"chip-remove",onClick:()=>se(Y.id),children:""})]},Y.id))}),o.jsxs("div",{style:{marginTop:"12px"},children:[o.jsx("label",{className:"form-label",children:"Outcome"}),o.jsxs("select",{value:A,onChange:Y=>j(Y.target.value),className:"form-select",children:[o.jsx("option",{value:"pending",children:"Pending / Awaiting Response"}),o.jsx("option",{value:"interested",children:"Interested"}),o.jsx("option",{value:"not_interested",children:"Not Interested"}),o.jsx("option",{value:"purchased",children:"Purchased"})]}),o.jsx("p",{className:"form-help",children:"This will be recorded in the aircraft's proposal history."})]})]})]}),o.jsxs(ut,{isOpen:d,onClose:()=>h(!1),title:"Delete Activity",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>h(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:B,loading:m,children:"Delete"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this activity?"}),f&&o.jsxs("p",{className:"form-help",style:{marginTop:"8px"},children:['"',f.title,'"']})]})]})}function hbe({contactId:t,ownedAircraft:e=[]}){const{success:n,error:r}=qt(),{addOwnedAircraft:s,updateOwnedAircraft:i,removeOwnedAircraft:a}=Ia(),{manufacturers:l,getModelsForManufacturer:c}=Pu(),[u,d]=b.useState(!1),[h,f]=b.useState(!1),[p,m]=b.useState(!1),[g,y]=b.useState(null),[x,w]=b.useState(!1),[N,S]=b.useState(""),[C,A]=b.useState(!1),[j,_]=b.useState(null),[E,I]=b.useState("search"),[T,P]=b.useState({helicopterId:null,year:"",manufacturer:"",model:"",registration:"",serialNumber:"",currentEngineHours:"",engineHoursUnknown:!1,engineTBO:"",engineTBOUnknown:!1,endOfLifeDate:"",endOfLifeUnknown:!1,lifecycleDataAsOf:"",lastServiceDate:"",nextServiceDue:"",serviceDataUnknown:!1,needsAttention:!1,attentionReason:"",isExternal:!1,notes:""}),[O,H]=b.useState([]),X=()=>{P({helicopterId:null,year:"",manufacturer:"",model:"",registration:"",serialNumber:"",currentEngineHours:"",engineHoursUnknown:!1,engineTBO:"",engineTBOUnknown:!1,endOfLifeDate:"",endOfLifeUnknown:!1,lifecycleDataAsOf:"",lastServiceDate:"",nextServiceDue:"",serviceDataUnknown:!1,needsAttention:!1,attentionReason:"",isExternal:!1,notes:""}),H([]),S(""),_(null),I("search")},se=async()=>{if(N.trim()){A(!0);try{const U=N.trim().toUpperCase(),pe=fr(ke,"helicopters"),J=Wi(pe,ba("registration","==",U)),ge=await Io(J);if(ge.empty)_("not_found"),P(me=>({...me,registration:U,isExternal:!0}));else{const me={id:ge.docs[0].id,...ge.docs[0].data()};_(me),P(ue=>{var st,Ke,ot;return{...ue,helicopterId:me.id,year:me.year||"",manufacturer:me.manufacturer||"",model:me.model||"",registration:me.registration||"",serialNumber:me.serialNumber||"",currentEngineHours:me.totalHours||((st=me.specs)==null?void 0:st.engineHours)||"",engineTBO:((Ke=me.specs)==null?void 0:Ke.engineTBO)||"",endOfLifeDate:((ot=me.specs)==null?void 0:ot.endOfLifeDate)||"",isExternal:!1}}),me.manufacturer&&H(c(me.manufacturer)),I("linked"),n(`Found: ${me.year} ${me.manufacturer} ${me.model}`)}}catch(U){console.error("Search error:",U),r("Error searching for aircraft"),_("not_found")}finally{A(!1)}}},L=U=>{const{name:pe,value:J,type:ge,checked:me}=U.target;pe==="manufacturer"?(P(ue=>({...ue,manufacturer:J,model:""})),H(c(J))):P(ue=>({...ue,[pe]:ge==="checkbox"?me:J}))},B=async()=>{if(!T.manufacturer||!T.model){r("Manufacturer and model are required");return}w(!0);try{await s(t,{helicopterId:T.helicopterId,year:parseInt(T.year)||null,manufacturer:T.manufacturer,model:T.model,registration:T.registration.toUpperCase(),serialNumber:T.serialNumber,currentEngineHours:T.engineHoursUnknown?null:parseInt(T.currentEngineHours)||null,engineHoursUnknown:T.engineHoursUnknown,engineTBO:T.engineTBOUnknown?null:parseInt(T.engineTBO)||null,engineTBOUnknown:T.engineTBOUnknown,endOfLifeDate:T.endOfLifeUnknown?null:T.endOfLifeDate||null,endOfLifeUnknown:T.endOfLifeUnknown,lifecycleDataAsOf:T.lifecycleDataAsOf||null,lastServiceDate:T.serviceDataUnknown?null:T.lastServiceDate||null,nextServiceDue:T.serviceDataUnknown?null:T.nextServiceDue||null,serviceDataUnknown:T.serviceDataUnknown,needsAttention:T.needsAttention,attentionReason:T.attentionReason,isExternal:T.isExternal,notes:T.notes}),n("Aircraft added"),d(!1),X()}catch(U){console.error("Failed to add aircraft:",U),r("Failed to add aircraft")}finally{w(!1)}},$=async()=>{if(g){w(!0);try{await i(t,g.id,{helicopterId:T.helicopterId,year:parseInt(T.year)||null,manufacturer:T.manufacturer,model:T.model,registration:T.registration.toUpperCase(),serialNumber:T.serialNumber,currentEngineHours:T.engineHoursUnknown?null:parseInt(T.currentEngineHours)||null,engineHoursUnknown:T.engineHoursUnknown,engineTBO:T.engineTBOUnknown?null:parseInt(T.engineTBO)||null,engineTBOUnknown:T.engineTBOUnknown,endOfLifeDate:T.endOfLifeUnknown?null:T.endOfLifeDate||null,endOfLifeUnknown:T.endOfLifeUnknown,lifecycleDataAsOf:T.lifecycleDataAsOf||null,lastServiceDate:T.serviceDataUnknown?null:T.lastServiceDate||null,nextServiceDue:T.serviceDataUnknown?null:T.nextServiceDue||null,serviceDataUnknown:T.serviceDataUnknown,needsAttention:T.needsAttention,attentionReason:T.attentionReason,isExternal:T.isExternal,notes:T.notes}),n("Aircraft updated"),f(!1),y(null),X()}catch(U){console.error("Failed to update aircraft:",U),r("Failed to update aircraft")}finally{w(!1)}}},q=async()=>{if(g){w(!0);try{await a(t,g.id),n("Aircraft removed"),m(!1),y(null)}catch(U){console.error("Failed to remove aircraft:",U),r("Failed to remove aircraft")}finally{w(!1)}}},Y=U=>{y(U),P({helicopterId:U.helicopterId||null,year:U.year||"",manufacturer:U.manufacturer||"",model:U.model||"",registration:U.registration||"",serialNumber:U.serialNumber||"",currentEngineHours:U.currentEngineHours||"",engineHoursUnknown:U.engineHoursUnknown||!1,engineTBO:U.engineTBO||"",engineTBOUnknown:U.engineTBOUnknown||!1,endOfLifeDate:U.endOfLifeDate||"",endOfLifeUnknown:U.endOfLifeUnknown||!1,lifecycleDataAsOf:U.lifecycleDataAsOf||"",lastServiceDate:U.lastServiceDate||"",nextServiceDue:U.nextServiceDue||"",serviceDataUnknown:U.serviceDataUnknown||!1,needsAttention:U.needsAttention||!1,attentionReason:U.attentionReason||"",isExternal:U.isExternal||!1,notes:U.notes||""}),U.manufacturer&&H(c(U.manufacturer)),I(U.helicopterId?"linked":"manual"),f(!0)},R=U=>{y(U),m(!0)},G=()=>{I("manual"),P(U=>({...U,registration:N.trim().toUpperCase(),isExternal:!0,helicopterId:null}))},Z=U=>{const pe=[];if(!U.engineHoursUnknown&&!U.engineTBOUnknown&&U.currentEngineHours&&U.engineTBO){const J=U.engineTBO-U.currentEngineHours;J<=0?pe.push({type:"danger",message:"Engine TBO exceeded"}):J<=100&&pe.push({type:"warning",message:`${J} hours until TBO`})}if(!U.endOfLifeUnknown&&U.endOfLifeDate){const J=new Date(U.endOfLifeDate),ge=dl(J,new Date);ge<=0?pe.push({type:"danger",message:"End of life date passed"}):ge<=90&&pe.push({type:"warning",message:`${ge} days until end of life`})}if(!U.serviceDataUnknown&&U.nextServiceDue){const J=new Date(U.nextServiceDue),ge=dl(J,new Date);ge<=0?pe.push({type:"danger",message:"Service overdue"}):ge<=30&&pe.push({type:"warning",message:`Service due in ${ge} days`})}return pe},W=()=>o.jsxs("div",{className:"reg-search-section",children:[o.jsx("p",{className:"search-instructions",children:"Enter the aircraft registration to search our database. If found, details will be auto-populated."}),o.jsxs("div",{className:"reg-search-form",children:[o.jsx("input",{type:"text",className:"form-input reg-input",value:N,onChange:U=>S(U.target.value.toUpperCase()),placeholder:"e.g., G-HQAV, N12345",onKeyDown:U=>{U.key==="Enter"&&(U.preventDefault(),se())}}),o.jsx(K,{onClick:se,disabled:!N.trim()||C,children:C?"Searching...":"Search"})]}),j==="not_found"&&o.jsxs("div",{className:"search-not-found",children:[o.jsxs("p",{className:"not-found-message",children:[o.jsx("strong",{children:N.toUpperCase()})," was not found in our database."]}),o.jsx("p",{className:"not-found-hint",children:"This could be an aircraft we haven't listed, or the registration might be different."}),o.jsx(K,{variant:"secondary",onClick:G,children:"Enter Details Manually"})]}),o.jsx("div",{className:"search-divider",children:o.jsx("span",{children:"or"})}),o.jsx(K,{variant:"secondary",onClick:()=>I("manual"),children:"Add Aircraft Without Registration Search"})]}),Q=()=>o.jsxs(o.Fragment,{children:[E==="linked"&&j&&j!=="not_found"&&o.jsxs("div",{className:"linked-aircraft-notice",children:[o.jsx("span",{className:"linked-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),o.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}),o.jsx("span",{children:"Linked to listing in our database"}),o.jsx("button",{type:"button",className:"unlink-btn",onClick:()=>{P(U=>({...U,helicopterId:null,isExternal:!0})),I("manual")},children:"Unlink"})]}),T.isExternal&&o.jsxs("div",{className:"external-aircraft-notice",children:[o.jsx("span",{className:"external-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),o.jsx("span",{children:"External aircraft (not in our inventory)"})]}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Registration",name:"registration",value:T.registration,onChange:L,placeholder:"e.g., G-HQAV",style:{textTransform:"uppercase"}}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Manufacturer *"}),o.jsxs("select",{name:"manufacturer",value:T.manufacturer,onChange:L,className:"form-select",required:!0,children:[o.jsx("option",{value:"",children:"Select manufacturer"}),l.map(U=>o.jsx("option",{value:U,children:U},U))]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Model *"}),o.jsxs("select",{name:"model",value:T.model,onChange:L,className:"form-select",disabled:!T.manufacturer,required:!0,children:[o.jsx("option",{value:"",children:"Select model"}),O.map(U=>o.jsx("option",{value:U,children:U},U))]})]}),o.jsx(ye,{label:"Year",name:"year",type:"number",value:T.year,onChange:L,placeholder:"e.g., 2020"}),o.jsx(ye,{label:"Serial Number",name:"serialNumber",value:T.serialNumber,onChange:L,placeholder:"Serial number"})]}),o.jsx("h4",{style:{marginTop:"20px",marginBottom:"12px"},children:"Engine & Lifecycle"}),o.jsxs("div",{className:"form-group",style:{marginBottom:"16px"},children:[o.jsx("label",{className:"form-label",children:"Data Accurate As Of"}),o.jsx("input",{type:"date",name:"lifecycleDataAsOf",value:T.lifecycleDataAsOf,onChange:L,className:"form-input",style:{maxWidth:"200px"}}),o.jsx("p",{className:"form-hint",style:{marginTop:"4px",fontSize:"0.8rem",color:"#666"},children:"When was this engine/lifecycle information last verified?"})]}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsxs("div",{className:"label-with-checkbox",children:[o.jsx("label",{className:"form-label",children:"Current Engine Hours"}),o.jsxs("label",{className:"form-checkbox-inline",children:[o.jsx("input",{type:"checkbox",name:"engineHoursUnknown",checked:T.engineHoursUnknown,onChange:L}),o.jsx("span",{children:"Unknown"})]})]}),o.jsx("input",{type:"number",name:"currentEngineHours",value:T.currentEngineHours,onChange:L,placeholder:"Hours",className:"form-input",disabled:T.engineHoursUnknown})]}),o.jsxs("div",{className:"form-group",children:[o.jsxs("div",{className:"label-with-checkbox",children:[o.jsx("label",{className:"form-label",children:"Engine TBO"}),o.jsxs("label",{className:"form-checkbox-inline",children:[o.jsx("input",{type:"checkbox",name:"engineTBOUnknown",checked:T.engineTBOUnknown,onChange:L}),o.jsx("span",{children:"Unknown"})]})]}),o.jsx("input",{type:"number",name:"engineTBO",value:T.engineTBO,onChange:L,placeholder:"TBO hours",className:"form-input",disabled:T.engineTBOUnknown})]}),o.jsxs("div",{className:"form-group",children:[o.jsxs("div",{className:"label-with-checkbox",children:[o.jsx("label",{className:"form-label",children:"End of Life Date"}),o.jsxs("label",{className:"form-checkbox-inline",children:[o.jsx("input",{type:"checkbox",name:"endOfLifeUnknown",checked:T.endOfLifeUnknown,onChange:L}),o.jsx("span",{children:"Unknown"})]})]}),o.jsx("input",{type:"date",name:"endOfLifeDate",value:T.endOfLifeDate,onChange:L,className:"form-input",disabled:T.endOfLifeUnknown})]})]}),o.jsx("h4",{style:{marginTop:"20px",marginBottom:"12px"},children:"Service"}),o.jsx("div",{style:{marginBottom:"12px"},children:o.jsxs("label",{className:"form-checkbox",children:[o.jsx("input",{type:"checkbox",name:"serviceDataUnknown",checked:T.serviceDataUnknown,onChange:L}),o.jsx("span",{children:"Service dates unknown"})]})}),!T.serviceDataUnknown&&o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Last Service Date"}),o.jsx("input",{type:"date",name:"lastServiceDate",value:T.lastServiceDate,onChange:L,className:"form-input"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Next Service Due"}),o.jsx("input",{type:"date",name:"nextServiceDue",value:T.nextServiceDue,onChange:L,className:"form-input"})]})]}),o.jsxs("div",{className:"form-group",style:{marginTop:"16px"},children:[o.jsx("label",{className:"form-label",children:"Notes"}),o.jsx("textarea",{name:"notes",value:T.notes,onChange:L,className:"form-textarea",rows:2,placeholder:"Any additional notes about this aircraft..."})]}),o.jsx("div",{className:"form-group",style:{marginTop:"16px"},children:o.jsxs("label",{className:"form-checkbox",children:[o.jsx("input",{type:"checkbox",name:"needsAttention",checked:T.needsAttention,onChange:L}),o.jsx("span",{children:"Needs Attention"})]})}),T.needsAttention&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Attention Reason"}),o.jsx("textarea",{name:"attentionReason",value:T.attentionReason,onChange:L,className:"form-textarea",rows:2,placeholder:"Why does this aircraft need attention?"})]})]});return o.jsxs("div",{className:"owned-aircraft-manager",children:[o.jsxs("div",{className:"manager-header",children:[o.jsx("h3",{children:"Owned Aircraft"}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>d(!0),children:"Add Aircraft"})]}),e.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:"No owned aircraft tracked"}),o.jsx("p",{className:"text-muted",children:"Add aircraft this contact owns to track maintenance and lifecycle."})]}):o.jsx("div",{className:"owned-aircraft-list",children:e.map(U=>{const pe=Z(U);return o.jsxs("div",{className:`owned-aircraft-card ${U.isExternal?"aircraft-external":""}`,children:[o.jsxs("div",{className:"aircraft-main",children:[o.jsxs("div",{className:"aircraft-identity",children:[o.jsxs("span",{className:"aircraft-name",children:[U.year&&`${U.year} `,U.manufacturer," ",U.model]}),U.registration&&o.jsx("span",{className:"aircraft-reg",children:U.registration}),U.isExternal&&o.jsx("span",{className:"external-badge",children:"External"}),U.helicopterId&&o.jsx("span",{className:"linked-badge",children:"In System"})]}),pe.length>0&&o.jsx("div",{className:"aircraft-alerts",children:pe.map((J,ge)=>o.jsx("span",{className:`alert-badge alert-${J.type}`,children:J.message},ge))}),U.needsAttention&&o.jsxs("div",{className:"attention-indicator",children:[o.jsx("span",{className:"attention-badge",children:"Needs Attention"}),U.attentionReason&&o.jsx("span",{className:"attention-reason",children:U.attentionReason})]})]}),o.jsxs("div",{className:"aircraft-details",children:[o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Engine:"}),o.jsxs("span",{children:[U.engineHoursUnknown?o.jsx("span",{className:"unknown-value",children:"Unknown"}):U.currentEngineHours?`${U.currentEngineHours} hrs`:"-"," / ",U.engineTBOUnknown?o.jsx("span",{className:"unknown-value",children:"Unknown TBO"}):U.engineTBO?`${U.engineTBO} TBO`:"-"]})]}),U.serviceDataUnknown?o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Service:"}),o.jsx("span",{className:"unknown-value",children:"Unknown"})]}):U.nextServiceDue&&o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Next Service:"}),o.jsx("span",{children:rt(new Date(U.nextServiceDue),"MMM d, yyyy")})]}),U.lifecycleDataAsOf&&o.jsxs("div",{className:"detail-item detail-as-of",children:[o.jsx("span",{className:"detail-label",children:"Data as of:"}),o.jsx("span",{children:rt(new Date(U.lifecycleDataAsOf),"MMM d, yyyy")})]}),U.notes&&o.jsxs("div",{className:"detail-item detail-notes",children:[o.jsx("span",{className:"detail-label",children:"Notes:"}),o.jsx("span",{children:U.notes})]})]}),o.jsxs("div",{className:"aircraft-actions",children:[o.jsx("button",{className:"action-btn",onClick:()=>Y(U),children:"Edit"}),o.jsx("button",{className:"action-btn action-btn-danger",onClick:()=>R(U),children:"Remove"})]})]},U.id)})}),o.jsx(ut,{isOpen:u,onClose:()=>{d(!1),X()},title:"Add Owned Aircraft",size:"large",footer:E!=="search"?o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>{E!=="search"?(I("search"),_(null)):(d(!1),X())},children:E!=="search"?"Back":"Cancel"}),o.jsx(K,{onClick:B,loading:x,children:"Add Aircraft"})]}):o.jsx(K,{variant:"secondary",onClick:()=>{d(!1),X()},children:"Cancel"}),children:E==="search"?W():Q()}),o.jsx(ut,{isOpen:h,onClose:()=>{f(!1),y(null),X()},title:"Edit Aircraft",size:"large",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>{f(!1),y(null),X()},children:"Cancel"}),o.jsx(K,{onClick:$,loading:x,children:"Save Changes"})]}),children:Q()}),o.jsx(ut,{isOpen:p,onClose:()=>{m(!1),y(null)},title:"Remove Aircraft",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>{m(!1),y(null)},children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:q,loading:x,children:"Remove"})]}),children:g&&o.jsxs("p",{children:["Are you sure you want to remove"," ",o.jsxs("strong",{children:[g.year&&`${g.year} `,g.manufacturer," ",g.model,g.registration&&` (${g.registration})`]}),"?"]})})]})}function fbe({contactId:t,contactName:e,followUp:n={}}){const{success:r,error:s}=qt(),{updateFollowUp:i}=Ia(),[a,l]=b.useState(!1),[c,u]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState({nextFollowUpDate:"",followUpPriority:"normal",followUpNotes:""});b.useEffect(()=>{var N;if(n){const S=(N=n.nextFollowUpDate)!=null&&N.toDate?rt(n.nextFollowUpDate.toDate(),"yyyy-MM-dd"):"";p({nextFollowUpDate:S,followUpPriority:n.followUpPriority||"normal",followUpNotes:n.followUpNotes||""})}},[n]);const m=N=>{const{name:S,value:C}=N.target;p(A=>({...A,[S]:C}))},g=async()=>{h(!0);try{await i(t,{nextFollowUpDate:f.nextFollowUpDate?new Date(f.nextFollowUpDate):null,followUpPriority:f.followUpPriority,followUpNotes:f.followUpNotes,lastContactedDate:n.lastContactedDate||null}),r("Follow-up updated"),l(!1)}catch(N){console.error("Failed to update follow-up:",N),s("Failed to update follow-up")}finally{h(!1)}},y=N=>{const S=$H(new Date,N);p(C=>({...C,nextFollowUpDate:rt(S,"yyyy-MM-dd")}))},x=()=>{if(!n.nextFollowUpDate)return null;const N=n.nextFollowUpDate.toDate?n.nextFollowUpDate.toDate():new Date(n.nextFollowUpDate);return rt(N,"MMM d, yyyy")},w=()=>{if(!n.lastContactedDate)return"Never";const N=n.lastContactedDate.toDate?n.lastContactedDate.toDate():new Date(n.lastContactedDate);return rt(N,"MMM d, yyyy")};return o.jsxs("div",{className:"followup-manager",children:[o.jsxs("div",{className:"followup-header",children:[o.jsx("h3",{children:"Follow-up"}),o.jsx(K,{variant:"secondary",size:"small",onClick:()=>l(!0),children:"Edit"})]}),o.jsxs("div",{className:"followup-content",children:[o.jsxs("div",{className:"followup-field",children:[o.jsx("span",{className:"field-label",children:"Next Follow-up"}),o.jsx("span",{className:"field-value",children:x()||"Not scheduled"})]}),o.jsxs("div",{className:"followup-field",children:[o.jsx("span",{className:"field-label",children:"Priority"}),o.jsx("span",{className:"priority-badge",style:{color:kde(n.followUpPriority||"normal")},children:Ade(n.followUpPriority||"normal")})]}),o.jsxs("div",{className:"followup-field",children:[o.jsx("span",{className:"field-label",children:"Last Contacted"}),o.jsx("span",{className:"field-value",children:w()})]}),n.followUpNotes&&o.jsxs("div",{className:"followup-notes",children:[o.jsx("span",{className:"field-label",children:"Notes"}),o.jsx("p",{children:n.followUpNotes})]}),o.jsx("div",{className:"followup-actions",children:o.jsx(K,{variant:"secondary",size:"small",onClick:()=>u(!0),children:"Log Contact"})})]}),o.jsx(Yb,{isOpen:c,onClose:()=>u(!1),contactId:t,contactName:e}),o.jsx(ut,{isOpen:a,onClose:()=>l(!1),title:"Edit Follow-up",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),o.jsx(K,{onClick:g,loading:d,children:"Save"})]}),children:o.jsxs("div",{className:"followup-edit-form",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Next Follow-up Date"}),o.jsx("input",{type:"date",name:"nextFollowUpDate",value:f.nextFollowUpDate,onChange:m,className:"form-input"}),o.jsxs("div",{className:"quick-schedule-buttons",children:[o.jsx("button",{type:"button",className:"quick-btn",onClick:()=>y(1),children:"Tomorrow"}),o.jsx("button",{type:"button",className:"quick-btn",onClick:()=>y(3),children:"3 Days"}),o.jsx("button",{type:"button",className:"quick-btn",onClick:()=>y(7),children:"1 Week"}),o.jsx("button",{type:"button",className:"quick-btn",onClick:()=>y(14),children:"2 Weeks"}),o.jsx("button",{type:"button",className:"quick-btn",onClick:()=>y(30),children:"1 Month"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Priority"}),o.jsx("select",{name:"followUpPriority",value:f.followUpPriority,onChange:m,className:"form-select",children:SI.map(N=>o.jsx("option",{value:N.value,children:N.label},N.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Follow-up Notes"}),o.jsx("textarea",{name:"followUpNotes",value:f.followUpNotes,onChange:m,className:"form-textarea",rows:3,placeholder:"What needs to be discussed or done?"})]})]})})]})}function pbe(){var X,se,L,B,$,q,Y,R,G,Z;const{id:t}=Op(),e=rr(),{can:n,PERMISSIONS:r}=Js(),{success:s,error:i}=qt(),{data:a,loading:l}=wv("contacts",t),{deleteContact:c}=Ia(),{update:u}=Ms("contacts"),{manufacturers:d,getModelsForManufacturer:h}=Pu(),[f,p]=b.useState("overview"),[m,g]=b.useState(!1),[y,x]=b.useState(!1),[w,N]=b.useState(!1),[S,C]=b.useState(!1),[A,j]=b.useState(!1),_=n(r.CONTACTS_EDIT),E=n(r.CONTACTS_DELETE),I=async()=>{N(!0);try{await c(t),s("Contact deleted"),e("/contacts")}catch(W){console.error("Failed to delete contact:",W),i("Failed to delete contact"),N(!1)}},T=async W=>{j(!0);try{await u(t,{aircraftInterests:W,updatedAt:new Date}),s("Aircraft interests updated")}catch(Q){console.error("Failed to update interests:",Q),i("Failed to update aircraft interests")}finally{j(!1)}},P=W=>{const Q=nW.find(U=>U.value===W);return(Q==null?void 0:Q.symbol)||W},O=W=>{if(!W||!W.min&&!W.max)return"Not specified";const Q=P(W.currency);return W.min&&W.max?`${Q}${W.min.toLocaleString()} - ${Q}${W.max.toLocaleString()}`:W.min?`${Q}${W.min.toLocaleString()}+`:W.max?`Up to ${Q}${W.max.toLocaleString()}`:"Not specified"};if(l)return o.jsx(Qn,{fullScreen:!0});if(!a)return o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:"Contact not found"}),o.jsx(K,{onClick:()=>e("/contacts"),children:"Back to Contacts"})]});const H=a.contactType==="business";return o.jsxs("div",{className:"contact-detail",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{className:"page-header-content",children:[o.jsx(at,{to:"/contacts",className:"back-link",children:"Back to Contacts"}),H?o.jsxs(o.Fragment,{children:[o.jsx("h1",{children:a.companyName}),o.jsxs("p",{className:"contact-header-subtitle",children:[a.firstName," ",a.lastName,a.jobTitle&&` - ${a.jobTitle}`]})]}):o.jsxs("h1",{children:[a.firstName," ",a.lastName]}),o.jsxs("div",{className:"contact-header-meta",children:[o.jsx("span",{className:`type-badge type-${a.contactType||"individual"}`,children:H?"Business":"Individual"}),o.jsx(jI,{contactId:t,currentStatus:a.status}),!H&&a.companyName&&o.jsx("span",{className:"contact-company",children:a.companyName})]})]}),o.jsxs("div",{className:"page-header-actions",children:[o.jsx(K,{variant:"secondary",onClick:()=>x(!0),children:"Log Contact"}),a.email&&o.jsx(K,{variant:"secondary",onClick:()=>window.location.href=`mailto:${a.email}`,children:"Send Email"}),_&&o.jsx(K,{onClick:()=>e(`/contacts/${t}/edit`),children:"Edit Contact"}),E&&o.jsx(K,{variant:"danger",onClick:()=>g(!0),children:"Delete"})]})]}),o.jsxs("div",{className:"detail-tabs",children:[o.jsx("button",{className:`tab ${f==="overview"?"tab-active":""}`,onClick:()=>p("overview"),children:"Overview"}),o.jsx("button",{className:`tab ${f==="activities"?"tab-active":""}`,onClick:()=>p("activities"),children:"Activities"}),o.jsx("button",{className:`tab ${f==="aircraft"?"tab-active":""}`,onClick:()=>p("aircraft"),children:"Aircraft"}),o.jsx("button",{className:`tab ${f==="enquiries"?"tab-active":""}`,onClick:()=>p("enquiries"),children:"Enquiries"})]}),o.jsxs("div",{className:"detail-content",children:[f==="overview"&&o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-main",children:[H&&o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Business Details"}),o.jsxs("div",{className:"detail-fields",children:[o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Company Name"}),o.jsx("span",{className:"field-value",children:a.companyName||"-"})]}),a.companyEmail&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Company Email"}),o.jsx("span",{className:"field-value",children:o.jsx("a",{href:`mailto:${a.companyEmail}`,children:a.companyEmail})})]}),a.companyPhone&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Company Phone"}),o.jsx("span",{className:"field-value",children:o.jsx("a",{href:`tel:${a.companyPhone}`,children:a.companyPhone})})]}),a.companyWebsite&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Website"}),o.jsx("span",{className:"field-value",children:o.jsx("a",{href:a.companyWebsite,target:"_blank",rel:"noopener noreferrer",children:a.companyWebsite})})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Location"}),o.jsx("span",{className:"field-value",children:(X=a.location)!=null&&X.city||(se=a.location)!=null&&se.country?o.jsxs(o.Fragment,{children:[a.location.city,a.location.city&&a.location.country&&", ",a.location.country,a.location.region&&` (${a.location.region})`]}):"-"})]})]})]}),o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:H?"Primary Contact Person":"Contact Information"}),o.jsxs("div",{className:"detail-fields",children:[o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Name"}),o.jsxs("span",{className:"field-value",children:[a.firstName," ",a.lastName]})]}),H&&a.jobTitle&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Job Title"}),o.jsx("span",{className:"field-value",children:a.jobTitle})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Email"}),o.jsx("span",{className:"field-value",children:a.email?o.jsx("a",{href:`mailto:${a.email}`,children:a.email}):"-"})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Phone"}),o.jsx("span",{className:"field-value",children:a.phone?o.jsx("a",{href:`tel:${a.phone}`,children:a.phone}):"-"})]}),!H&&a.companyName&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Company"}),o.jsx("span",{className:"field-value",children:a.companyName})]}),!H&&o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Location"}),o.jsx("span",{className:"field-value",children:(L=a.location)!=null&&L.city||(B=a.location)!=null&&B.country?o.jsxs(o.Fragment,{children:[a.location.city,a.location.city&&a.location.country&&", ",a.location.country,a.location.region&&` (${a.location.region})`]}):"-"})]})]})]}),o.jsxs("div",{className:"detail-card",children:[o.jsxs("div",{className:"detail-card-header",children:[o.jsx("h3",{children:"Aircraft Interests"}),_&&o.jsx(K,{variant:"secondary",size:"small",onClick:()=>C(!S),children:S?"Done":"Edit"})]}),S?o.jsxs("div",{className:"interests-editor",children:[A&&o.jsx("div",{className:"saving-indicator",children:"Saving..."}),o.jsx(H9,{interests:a.aircraftInterests||[],onChange:T,manufacturers:d,getModelsForManufacturer:h})]}):(($=a.aircraftInterests)==null?void 0:$.length)>0?o.jsx("div",{className:"interests-grid",children:a.aircraftInterests.map((W,Q)=>o.jsxs("div",{className:"interest-card",children:[o.jsxs("span",{className:"interest-aircraft",children:[W.manufacturer,W.model&&` - ${W.model}`]}),o.jsxs("div",{className:"interest-tags",children:[W.condition&&W.condition!=="either"&&o.jsx("span",{className:`interest-condition condition-${W.condition}`,children:W.condition==="new"?"New":"Used"}),o.jsx("span",{className:`interest-priority priority-${W.priority}`,children:W.priority})]})]},Q))}):o.jsxs("div",{className:"empty-interests",children:[o.jsx("p",{className:"text-muted",children:"No aircraft interests specified"}),_&&o.jsx(K,{variant:"secondary",size:"small",onClick:()=>C(!0),children:"Add Interest"})]})]}),a.internalNotes&&o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Internal Notes"}),o.jsx("p",{className:"notes-content",children:a.internalNotes})]})]}),o.jsxs("div",{className:"detail-sidebar",children:[o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Classification"}),o.jsxs("div",{className:"detail-fields",children:[o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Type"}),o.jsx("span",{className:"field-value",children:o.jsx("span",{className:`type-badge type-${a.contactType||"individual"}`,children:H?"Business":"Individual"})})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Status"}),o.jsx("span",{className:"field-value",children:o.jsx("span",{className:"status-badge",style:{backgroundColor:sW(a.status)},children:rW(a.status)})})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Source"}),o.jsx("span",{className:"field-value",children:Tde(a.source)})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Assigned To"}),o.jsx("span",{className:"field-value",children:a.assignedTo||"Unassigned"})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Timeline"}),o.jsx("span",{className:"field-value",children:_I(a.timeline)})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Buyer Situation"}),o.jsx("span",{className:"field-value",children:Pde(a.buyerSituation)})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Budget"}),o.jsx("span",{className:"field-value",children:O(a.budgetRange)})]})]})]}),o.jsx("div",{className:"detail-card",children:o.jsx(fbe,{contactId:t,contactName:`${a.firstName} ${a.lastName}`,followUp:a.followUp})}),((q=a.tags)==null?void 0:q.length)>0&&o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Tags"}),o.jsx("div",{className:"tags-list",children:a.tags.map(W=>o.jsx("span",{className:"tag",children:W},W))})]}),o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Record Info"}),o.jsxs("div",{className:"detail-fields",children:[o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Created"}),o.jsx("span",{className:"field-value",children:(Y=a.createdAt)!=null&&Y.toDate?rt(a.createdAt.toDate(),"MMM d, yyyy"):"-"})]}),o.jsxs("div",{className:"detail-field",children:[o.jsx("span",{className:"field-label",children:"Updated"}),o.jsx("span",{className:"field-value",children:(R=a.updatedAt)!=null&&R.toDate?rt(a.updatedAt.toDate(),"MMM d, yyyy"):"-"})]})]})]})]})]}),f==="activities"&&o.jsx("div",{className:"detail-card",children:o.jsx(dbe,{contactId:t})}),f==="aircraft"&&o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Purchase History"}),((G=a.purchaseHistory)==null?void 0:G.length)>0?o.jsx("div",{className:"purchase-list",children:a.purchaseHistory.map((W,Q)=>{var U,pe,J,ge,me,ue;return o.jsxs("div",{className:"purchase-item",children:[o.jsxs("div",{className:"purchase-info",children:[o.jsxs("span",{className:"purchase-aircraft",children:[(U=W.aircraft)==null?void 0:U.year," ",(pe=W.aircraft)==null?void 0:pe.manufacturer," ",(J=W.aircraft)==null?void 0:J.model]}),o.jsx("span",{className:"purchase-reg",children:(ge=W.aircraft)==null?void 0:ge.registration})]}),o.jsxs("div",{className:"purchase-meta",children:[o.jsxs("span",{className:"purchase-price",children:[P("GBP"),(me=W.salePrice)==null?void 0:me.toLocaleString()]}),o.jsx("span",{className:"purchase-date",children:(ue=W.purchaseDate)!=null&&ue.toDate?rt(W.purchaseDate.toDate(),"MMM d, yyyy"):"-"})]})]},Q)})}):o.jsx("p",{className:"text-muted",children:"No purchase history"})]}),o.jsx("div",{className:"detail-card",children:o.jsx(hbe,{contactId:t,ownedAircraft:a.ownedAircraft||[]})})]}),f==="enquiries"&&o.jsxs("div",{className:"detail-card",children:[o.jsx("h3",{children:"Linked Enquiries"}),((Z=a.linkedEnquiryIds)==null?void 0:Z.length)>0?o.jsx("p",{children:"Linked enquiries will appear here"}):o.jsx("p",{className:"text-muted",children:"No linked enquiries"})]})]}),o.jsxs(ut,{isOpen:m,onClose:()=>g(!1),title:"Delete Contact",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>g(!1),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:I,loading:w,children:"Delete Contact"})]}),children:[o.jsxs("p",{children:["Are you sure you want to delete ",o.jsxs("strong",{children:[a.firstName," ",a.lastName]}),"?"]}),o.jsx("p",{className:"form-help",style:{marginTop:"12px"},children:"This action cannot be undone. All activities and linked data will also be removed."})]}),o.jsx(Yb,{isOpen:y,onClose:()=>x(!1),contactId:t,contactName:`${a.firstName} ${a.lastName}`})]})}function mbe(){const{id:t}=Op(),e=rr(),{success:n,error:r}=qt(),{data:s,loading:i}=wv("contacts",t),{updateContact:a,loading:l}=Ia(),c=async u=>{try{await a(t,u),n("Contact updated successfully"),e(`/contacts/${t}`)}catch(d){console.error("Failed to update contact:",d),r("Failed to update contact")}};return i?o.jsx(Qn,{fullScreen:!0}):s?o.jsxs("div",{className:"contact-edit",children:[o.jsx("div",{className:"page-header",children:o.jsxs("h1",{children:["Edit Contact: ",s.firstName," ",s.lastName]})}),o.jsx(W9,{initialData:s,onSubmit:c,loading:l,submitLabel:"Save Changes"})]}):o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:"Contact not found"}),o.jsx(K,{onClick:()=>e("/contacts"),children:"Back to Contacts"})]})}function gbe(){const{success:t,error:e}=qt(),{data:n,loading:r}=pn("media",[qr("createdAt","desc")]),{create:s,update:i,remove:a}=Ms("media"),{tags:l,loading:c,createTag:u,deleteTag:d,renameTag:h,getTagsByIds:f}=B9(),[p,m]=b.useState(!1),[g,y]=b.useState(!1),[x,w]=b.useState("all"),[N,S]=b.useState(null),[C,A]=b.useState(!1),[j,_]=b.useState(!1),[E,I]=b.useState([]),[T,P]=b.useState([]),[O,H]=b.useState(""),[X,se]=b.useState(null),[L,B]=b.useState(""),[$,q]=b.useState(null),[Y,R]=b.useState({}),G=r||c,Z=V=>V<1024?V+" B":V<1024*1024?(V/1024).toFixed(1)+" KB":(V/(1024*1024)).toFixed(2)+" MB",W=E.reduce((V,re)=>V+re.size,0);b.useEffect(()=>{if(E.length===0){R({});return}E.forEach((V,re)=>{const ie=new Image;ie.onload=()=>{R(Fe=>({...Fe,[re]:{width:ie.width,height:ie.height}})),URL.revokeObjectURL(ie.src)},ie.src=URL.createObjectURL(V)})},[E]);const Q=x==="all"?n:n.filter(V=>{var re;return(re=V.tags)==null?void 0:re.includes(x)}),U=V=>{const re=Array.from(V).filter(ie=>ie.type.startsWith("image/"));if(re.length===0){e("Please select image files");return}I(re),P([]),_(!0)},pe=async()=>{m(!0),_(!1);try{for(const V of E){const ie=`${Date.now()}_${V.name}`,Fe=Yd(Qd,`media/general/${ie}`);await kce(Fe,V);const Qe=await bv(Fe);await s({filename:ie,originalFilename:V.name,url:Qe,path:`media/general/${ie}`,mimeType:V.type,size:V.size,folder:"/general",tags:T,usedIn:[]})}t(`${E.length} file(s) uploaded`),I([]),P([])}catch(V){e("Upload failed"),console.error(V)}finally{m(!1)}},J=b.useCallback(V=>{V.preventDefault(),y(!1);const re=Array.from(V.dataTransfer.files);re.length&&U(re)},[]),ge=V=>{V.preventDefault(),y(!0)},me=()=>{y(!1)},ue=V=>{const re=Array.from(V.target.files);re.length&&U(re),V.target.value=""},st=V=>{P(re=>re.includes(V)?re.filter(ie=>ie!==V):[...re,V])},Ke=async(V,re)=>{const ie=n.find(At=>At.id===V);if(!ie)return;const Fe=ie.tags||[],Qe=Fe.includes(re)?Fe.filter(At=>At!==re):[...Fe,re];N&&N.id===V&&S(At=>({...At,tags:Qe}));try{await i(V,{tags:Qe})}catch{e("Failed to update tags"),N&&N.id===V&&S(Jn=>({...Jn,tags:Fe}))}},ot=async()=>{if(!O.trim())return;await u(O)?(t("Tag created"),H("")):e("Tag already exists or failed to create")},lt=async()=>{if(!X||!L.trim())return;await h(X,L)?(t("Tag renamed"),se(null),B("")):e("Failed to rename tag")},bt=async V=>{if(await d(V)){const ie=n.filter(Fe=>{var Qe;return(Qe=Fe.tags)==null?void 0:Qe.includes(V)});for(const Fe of ie)await i(Fe.id,{tags:Fe.tags.filter(Qe=>Qe!==V)});t("Tag deleted"),x===V&&w("all")}else e("Failed to delete tag");q(null)},mt=async V=>{try{if(V.path){const re=Yd(Qd,V.path);await MH(re)}await a(V.id),t("Image deleted"),S(null)}catch(re){e("Failed to delete image"),console.error(re)}};return G?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"media-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Media Library"}),o.jsxs("p",{className:"page-subtitle",children:[Q.length," ",x==="all"?"total":""," files"]})]}),o.jsx(K,{onClick:()=>A(!0),children:"Manage Tags"})]}),o.jsxs("div",{className:"media-tag-bar",children:[o.jsx("button",{className:`media-tag-filter ${x==="all"?"active":""}`,onClick:()=>w("all"),children:"All"}),l.map(V=>o.jsxs("button",{className:`media-tag-filter ${x===V.id?"active":""}`,onClick:()=>w(V.id),style:{"--tag-bg":V.bg,"--tag-border":V.border,"--tag-text":V.text},children:[V.name,o.jsx("span",{className:"tag-count",children:n.filter(re=>{var ie;return(ie=re.tags)==null?void 0:ie.includes(V.id)}).length})]},V.id))]}),o.jsx("div",{className:`upload-zone ${g?"upload-zone-active":""}`,onDrop:J,onDragOver:ge,onDragLeave:me,children:p?o.jsx(Qn,{}):o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Drag and drop images here, or"}),o.jsxs("label",{className:"upload-button",children:[o.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:ue,style:{display:"none"}}),o.jsx("span",{className:"btn btn-primary btn-medium",children:"Browse Files"})]})]})}),Q.length===0?o.jsx("div",{className:"empty-state",children:o.jsx("p",{children:x==="all"?"No media uploaded yet":"No images with this tag"})}):o.jsx("div",{className:"media-grid",children:Q.map(V=>{var re;return o.jsxs("div",{className:"media-card",onClick:()=>S(V),children:[o.jsx("img",{src:V.url,alt:V.originalFilename,className:"media-thumb"}),o.jsxs("div",{className:"media-info",children:[o.jsx("span",{className:"media-filename",children:V.originalFilename}),o.jsxs("span",{className:"media-size",children:[(V.size/1024).toFixed(1)," KB"]})]}),((re=V.tags)==null?void 0:re.length)>0&&o.jsxs("div",{className:"media-tags-preview",children:[f(V.tags).slice(0,3).map(ie=>o.jsx("span",{className:"media-tag-dot",style:{background:ie.text},title:ie.name},ie.id)),V.tags.length>3&&o.jsxs("span",{className:"media-tag-more",children:["+",V.tags.length-3]})]})]},V.id)})}),o.jsx(ut,{isOpen:j,onClose:()=>{_(!1),I([]),P([])},title:"Upload Images",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>_(!1),children:"Cancel"}),o.jsxs(K,{onClick:pe,children:["Upload ",E.length," file(s)"]})]}),children:o.jsxs("div",{className:"upload-preview-modal",children:[o.jsxs("div",{className:"upload-summary",children:[o.jsxs("div",{className:"upload-stat",children:[o.jsx("span",{className:"upload-stat-value",children:E.length}),o.jsxs("span",{className:"upload-stat-label",children:["File",E.length!==1?"s":""]})]}),o.jsxs("div",{className:"upload-stat",children:[o.jsx("span",{className:"upload-stat-value",children:Z(W)}),o.jsx("span",{className:"upload-stat-label",children:"Total Size"})]})]}),o.jsx("div",{className:"upload-file-list",children:E.map((V,re)=>o.jsxs("div",{className:"upload-file-item",children:[o.jsx("div",{className:"upload-file-thumb",children:o.jsx("img",{src:URL.createObjectURL(V),alt:V.name})}),o.jsxs("div",{className:"upload-file-info",children:[o.jsx("p",{className:"upload-file-name",children:V.name}),o.jsxs("div",{className:"upload-file-meta",children:[o.jsx("span",{children:Z(V.size)}),o.jsx("span",{children:V.type.replace("image/","").toUpperCase()}),Y[re]&&o.jsxs("span",{children:[Y[re].width,"  ",Y[re].height," px"]})]})]})]},re))}),o.jsxs("div",{className:"upload-tags-section",children:[o.jsx("label",{className:"form-label",children:"Add to tags (optional)"}),o.jsxs("div",{className:"upload-tags-grid",children:[l.map(V=>o.jsxs("button",{type:"button",className:`media-tag-toggle ${T.includes(V.id)?"selected":""}`,onClick:()=>st(V.id),style:{"--tag-bg":V.bg,"--tag-border":V.border,"--tag-text":V.text},children:[T.includes(V.id)&&o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})}),V.name]},V.id)),l.length===0&&o.jsx("p",{className:"no-tags-hint",children:"No tags created yet. Create tags in Tag Manager."})]})]})]})}),o.jsx(ut,{isOpen:!!N,onClose:()=>S(null),title:"Edit Image Tags",size:"large",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"danger",onClick:()=>mt(N),children:"Delete Image"}),o.jsx(K,{onClick:()=>S(null),children:"Done"})]}),children:N&&o.jsxs("div",{className:"media-detail-modal",children:[o.jsx("div",{className:"media-detail-preview",children:o.jsx("img",{src:N.url,alt:N.altText||N.originalFilename})}),o.jsxs("div",{className:"media-detail-fields",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Filename"}),o.jsx("input",{type:"text",className:"form-input",value:N.displayName||N.originalFilename,onChange:V=>S(re=>({...re,displayName:V.target.value})),onBlur:()=>i(N.id,{displayName:N.displayName||N.originalFilename})})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Alt Text (SEO)"}),o.jsx("input",{type:"text",className:"form-input",placeholder:"Describe the image for search engines and accessibility",value:N.altText||"",onChange:V=>S(re=>({...re,altText:V.target.value})),onBlur:()=>i(N.id,{altText:N.altText||""})}),o.jsx("span",{className:"form-help",children:"Used for SEO and screen readers"})]}),o.jsxs("div",{className:"media-detail-meta",children:[o.jsxs("span",{children:[o.jsx("strong",{children:"Size:"})," ",Z(N.size)]}),o.jsxs("span",{children:[o.jsx("strong",{children:"Type:"})," ",N.mimeType]})]})]}),o.jsxs("div",{className:"media-detail-tags",children:[o.jsx("label",{className:"form-label",children:"Tags"}),o.jsxs("div",{className:"media-tags-grid",children:[l.map(V=>{var ie;const re=(ie=N.tags)==null?void 0:ie.includes(V.id);return o.jsxs("button",{type:"button",className:`media-tag-toggle ${re?"selected":""}`,onClick:()=>Ke(N.id,V.id),style:{"--tag-bg":V.bg,"--tag-border":V.border,"--tag-text":V.text},children:[re&&o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})}),V.name]},V.id)}),l.length===0&&o.jsx("p",{className:"no-tags-hint",children:"No tags available. Create tags first."})]})]})]})}),o.jsx(ut,{isOpen:C,onClose:()=>A(!1),title:"Manage Tags",size:"medium",children:o.jsxs("div",{className:"tag-manager",children:[o.jsxs("div",{className:"tag-create-form",children:[o.jsx(ye,{placeholder:"New tag name",value:O,onChange:V=>H(V.target.value),onKeyDown:V=>V.key==="Enter"&&ot()}),o.jsx(K,{onClick:ot,disabled:!O.trim(),children:"Create Tag"})]}),o.jsx("div",{className:"tag-list",children:l.length===0?o.jsx("p",{className:"no-tags-message",children:"No tags created yet"}):l.map(V=>o.jsx("div",{className:"tag-list-item",children:X===V.id?o.jsxs("div",{className:"tag-edit-form",children:[o.jsx("input",{type:"text",value:L,onChange:re=>B(re.target.value),onKeyDown:re=>re.key==="Enter"&&lt(),autoFocus:!0,className:"form-input"}),o.jsx("button",{className:"tag-action-btn save",onClick:lt,children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"20 6 9 17 4 12"})})}),o.jsx("button",{className:"tag-action-btn cancel",onClick:()=>{se(null),B("")},children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"tag-badge",style:{"--tag-bg":V.bg,"--tag-border":V.border,"--tag-text":V.text},children:V.name}),o.jsxs("span",{className:"tag-media-count",children:[n.filter(re=>{var ie;return(ie=re.tags)==null?void 0:ie.includes(V.id)}).length," images"]}),o.jsxs("div",{className:"tag-actions",children:[o.jsx("button",{className:"tag-action-btn edit",onClick:()=>{se(V.id),B(V.name)},title:"Rename",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})}),o.jsx("button",{className:"tag-action-btn delete",onClick:()=>q(V),title:"Delete",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]})},V.id))})]})}),o.jsx(ut,{isOpen:!!$,onClose:()=>q(null),title:"Delete Tag",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>q(null),children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:()=>bt($==null?void 0:$.id),children:"Delete Tag"})]}),children:$&&o.jsxs("p",{children:['Are you sure you want to delete the tag "',$.name,'"? This will remove the tag from ',n.filter(V=>{var re;return(re=V.tags)==null?void 0:re.includes($.id)}).length," image(s)."]})})]})}let Jx;const ybe=new Uint8Array(16);function vbe(){if(!Jx&&(Jx=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Jx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jx(ybe)}const ns=[];for(let t=0;t<256;++t)ns.push((t+256).toString(16).slice(1));function xbe(t,e=0){return ns[t[e+0]]+ns[t[e+1]]+ns[t[e+2]]+ns[t[e+3]]+"-"+ns[t[e+4]]+ns[t[e+5]]+"-"+ns[t[e+6]]+ns[t[e+7]]+"-"+ns[t[e+8]]+ns[t[e+9]]+"-"+ns[t[e+10]]+ns[t[e+11]]+ns[t[e+12]]+ns[t[e+13]]+ns[t[e+14]]+ns[t[e+15]]}const bbe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),VF={randomUUID:bbe};function wbe(t,e,n){if(VF.randomUUID&&!t)return VF.randomUUID();t=t||{};const r=t.random||(t.rng||vbe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,xbe(r)}function Nbe(){const{isSuperAdmin:t}=Js(),{success:e,error:n}=qt(),{data:r,loading:s}=pn("users"),{create:i}=Ms("invites"),[a,l]=b.useState(!1),[c,u]=b.useState(""),[d,h]=b.useState(Gn.EDITOR),[f,p]=b.useState(!1),m=async g=>{g.preventDefault(),p(!0);try{const y=wbe(),x=new Date;x.setHours(x.getHours()+48),await i({email:c,role:d,token:y,status:"pending",expiresAt:x}),e(`Invite sent to ${c}`),l(!1),u(""),h(Gn.EDITOR)}catch(y){n("Failed to send invite"),console.error(y)}finally{p(!1)}};return s?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"users-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Team Members"}),o.jsxs("p",{className:"page-subtitle",children:[r.length," users"]})]}),o.jsx(K,{onClick:()=>l(!0),children:"Invite User"})]}),r.length===0?o.jsx("div",{className:"empty-state",children:o.jsx("p",{children:"No team members yet"})}):o.jsx("div",{className:"users-grid",children:r.map(g=>{var y,x,w,N;return o.jsxs("div",{className:"user-card",children:[o.jsx("div",{className:"user-avatar-large",children:((y=g.displayName)==null?void 0:y[0])||((w=(x=g.email)==null?void 0:x[0])==null?void 0:w.toUpperCase())||"?"}),o.jsxs("div",{className:"user-card-info",children:[o.jsx("h3",{children:g.displayName||"Unnamed"}),o.jsx("p",{className:"user-email",children:g.email}),o.jsx("span",{className:`role-badge role-${g.role}`,children:BH(g.role)})]}),o.jsxs("div",{className:"user-card-meta",children:[o.jsxs("span",{children:["Last login: ",(N=g.lastLogin)!=null&&N.toDate?rt(g.lastLogin.toDate(),"MMM d, yyyy"):"Never"]}),o.jsx("span",{className:`status-indicator status-${g.status}`,children:g.status||"active"})]})]},g.id)})}),o.jsx(ut,{isOpen:a,onClose:()=>l(!1),title:"Invite Team Member",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),o.jsx(K,{onClick:m,loading:f,children:"Send Invite"})]}),children:o.jsxs("form",{onSubmit:m,children:[o.jsx(ye,{label:"Email Address",type:"email",value:c,onChange:g=>u(g.target.value),placeholder:"colleague@company.com",required:!0}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Role"}),o.jsxs("select",{className:"form-select",value:d,onChange:g=>h(g.target.value),children:[t()&&o.jsx("option",{value:Gn.SUPER_ADMIN,children:"Super Admin"}),o.jsx("option",{value:Gn.ADMIN,children:"Admin"}),o.jsx("option",{value:Gn.EDITOR,children:"Editor"}),o.jsx("option",{value:Gn.VIEWER,children:"Viewer"})]})]})]})})]})}const Sbe=[25,50,100],_be={all:{label:"All Actions",icon:""},listings:{label:"Listings",icon:""},contacts:{label:"Contacts",icon:""},blogs:{label:"Blog Posts",icon:""},enquiries:{label:"Enquiries",icon:""},users:{label:"Users",icon:""},media:{label:"Media",icon:""}},$F={all:{label:"All Time",days:null},today:{label:"Today",days:0},week:{label:"Last 7 Days",days:7},month:{label:"Last 30 Days",days:30},quarter:{label:"Last 90 Days",days:90},custom:{label:"Custom Range",days:null}};function jbe(){var Y;const{data:t,loading:e}=pn("audit_logs",[qr("timestamp","desc")]),[n,r]=b.useState(1),[s,i]=b.useState(25),[a,l]=b.useState("all"),[c,u]=b.useState("all"),[d,h]=b.useState("all"),[f,p]=b.useState(""),[m,g]=b.useState(""),[y,x]=b.useState(""),[w,N]=b.useState(null),[S,C]=b.useState(!1),A=b.useMemo(()=>{const R=new Map;return t.forEach(G=>{G.userId&&!R.has(G.userId)&&R.set(G.userId,{id:G.userId,name:G.userName||G.userEmail||"Unknown"})}),Array.from(R.values()).sort((G,Z)=>G.name.localeCompare(Z.name))},[t]),j=b.useMemo(()=>t.filter(R=>{var G,Z;if(a!=="all"&&!(R.action||"").toLowerCase().includes(a.replace("s",""))||c!=="all"&&R.userId!==c)return!1;if(d!=="all"&&((G=R.timestamp)!=null&&G.toDate)){const W=R.timestamp.toDate();if(d==="custom"){if(f&&m){const Q=Xd(new Date(f)),U=qH(new Date(m));if(!Sde(W,{start:Q,end:U}))return!1}}else{const Q=(Z=$F[d])==null?void 0:Z.days;if(Q!==null){const U=XH(new Date,Q);if(W<Xd(U))return!1}}}if(y){const W=y.toLowerCase();if(![R.action,R.resourceName,R.userName,R.userEmail,R.resourceId,JSON.stringify(R.changes)].filter(Boolean).join(" ").toLowerCase().includes(W))return!1}return!0}),[t,a,c,d,f,m,y]),_=Math.ceil(j.length/s),E=(n-1)*s,I=E+s,T=b.useMemo(()=>j.slice(E,I),[j,E,I]),P=b.useCallback(R=>G=>{R(G),r(1)},[]),O=R=>{i(R),r(1)},H=R=>({"listing.create":"Created listing","listing.update":"Updated listing","listing.delete":"Deleted listing","listing.sold":"Marked as sold","helicopters.create":"Created listing","helicopters.update":"Updated listing","helicopters.delete":"Deleted listing","contacts.create":"Created contact","contacts.update":"Updated contact","contacts.delete":"Deleted contact","blog.create":"Created blog post","blog.update":"Updated blog post","blog.delete":"Deleted blog post","blogs.create":"Created blog post","blogs.update":"Updated blog post","blogs.delete":"Deleted blog post","users.create":"Created user","users.update":"Updated user","users.delete":"Deleted user","user.invite_sent":"Sent invite","user.invite_accepted":"Accepted invite","user.login":"Logged in","user.logout":"Logged out","user.login_failed":"Failed login attempt","user.password_change":"Changed password","user.password_reset":"Reset password","user.permission_change":"Changed permissions","user.role_change":"Changed role","user.account_locked":"Account locked","user.account_unlocked":"Account unlocked","enquiries.create":"Created enquiry","enquiries.update":"Updated enquiry","enquiries.delete":"Deleted enquiry","enquiry.respond":"Responded to enquiry","media.create":"Uploaded media","media.update":"Updated media","media.delete":"Deleted media","settings.update":"Updated settings"})[R]||(R==null?void 0:R.replace("."," ").replace("_"," "))||R,X=R=>R!=null&&R.includes("helicopter")||R!=null&&R.includes("listing")?"":R!=null&&R.includes("contact")?"":R!=null&&R.includes("blog")?"":R!=null&&R.includes("user")||R!=null&&R.includes("login")||R!=null&&R.includes("password")?"":R!=null&&R.includes("enquir")?"":R!=null&&R.includes("media")?"":R!=null&&R.includes("setting")?"":"",se=R=>R!=null&&R.includes("create")||R!=null&&R.includes("login")&&!(R!=null&&R.includes("failed"))?"#22c55e":R!=null&&R.includes("update")?"#3b82f6":R!=null&&R.includes("delete")||R!=null&&R.includes("failed")||R!=null&&R.includes("locked")?"#ef4444":R!=null&&R.includes("sold")?"#8b5cf6":"#6b7280",L=()=>{const R=["Date","Time","Action","Resource","User","Email","Changes"],G=j.map(U=>{var pe,J;return[(pe=U.timestamp)!=null&&pe.toDate?rt(U.timestamp.toDate(),"yyyy-MM-dd"):"",(J=U.timestamp)!=null&&J.toDate?rt(U.timestamp.toDate(),"HH:mm:ss"):"",H(U.action),U.resourceName||U.resourceId||"",U.userName||"",U.userEmail||"",U.changes?JSON.stringify(U.changes):""]}),Z=[R.join(","),...G.map(U=>U.map(pe=>`"${String(pe).replace(/"/g,'""')}"`).join(","))].join(`
`),W=new Blob([Z],{type:"text/csv;charset=utf-8;"}),Q=document.createElement("a");Q.href=URL.createObjectURL(W),Q.download=`audit-log-${rt(new Date,"yyyy-MM-dd")}.csv`,Q.click(),C(!1)},B=()=>{const R=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Audit Log Export - ${rt(new Date,"yyyy-MM-dd")}</title>
        <style>
          body { font-family: Arial, sans-serif; font-size: 12px; padding: 20px; }
          h1 { font-size: 18px; margin-bottom: 10px; }
          .meta { color: #666; margin-bottom: 20px; }
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background: #f5f5f5; font-weight: bold; }
          tr:nth-child(even) { background: #fafafa; }
        </style>
      </head>
      <body>
        <h1>Audit Log Report</h1>
        <p class="meta">Generated: ${rt(new Date,"MMMM d, yyyy h:mm a")} | Total Entries: ${j.length}</p>
        <table>
          <thead>
            <tr>
              <th>Date/Time</th>
              <th>Action</th>
              <th>Resource</th>
              <th>User</th>
            </tr>
          </thead>
          <tbody>
            ${j.map(Z=>{var W;return`
              <tr>
                <td>${(W=Z.timestamp)!=null&&W.toDate?rt(Z.timestamp.toDate(),"MMM d, yyyy h:mm a"):""}</td>
                <td>${H(Z.action)}</td>
                <td>${Z.resourceName||Z.resourceId||"-"}</td>
                <td>${Z.userName||Z.userEmail||"-"}</td>
              </tr>
            `}).join("")}
          </tbody>
        </table>
      </body>
      </html>
    `,G=window.open("","_blank");G.document.write(R),G.document.close(),G.print(),C(!1)},$=R=>{if(!R||typeof R!="object")return null;const G=Object.entries(R);return G.length===0?null:o.jsx("div",{className:"audit-changes-detail",children:G.map(([Z,W])=>W&&typeof W=="object"&&("before"in W||"after"in W)?o.jsxs("div",{className:"change-row",children:[o.jsxs("span",{className:"change-field",children:[Z,":"]}),o.jsx("span",{className:"change-before",children:q(W.before)}),o.jsx("span",{className:"change-arrow",children:""}),o.jsx("span",{className:"change-after",children:q(W.after)})]},Z):o.jsxs("div",{className:"change-row",children:[o.jsxs("span",{className:"change-field",children:[Z,":"]}),o.jsx("span",{className:"change-value",children:q(W)})]},Z))})},q=R=>R==null?"(empty)":typeof R=="boolean"?R?"Yes":"No":typeof R=="object"?JSON.stringify(R):String(R);return e?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"audit-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Audit Log"}),o.jsxs("p",{className:"page-subtitle",children:[j.length," ",j.length===1?"entry":"entries",j.length!==t.length&&` (filtered from ${t.length})`]})]}),o.jsxs(K,{onClick:()=>C(!0),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"7 10 12 15 17 10"}),o.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Export"]})]}),o.jsxs("div",{className:"audit-filters",children:[o.jsxs("div",{className:"audit-filters-row",children:[o.jsxs("div",{className:"audit-search",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search logs...",value:y,onChange:R=>P(x)(R.target.value)}),y&&o.jsx("button",{className:"search-clear",onClick:()=>P(x)(""),children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("select",{value:a,onChange:R=>P(l)(R.target.value),className:"audit-filter-select",children:Object.entries(_be).map(([R,{label:G,icon:Z}])=>o.jsxs("option",{value:R,children:[Z," ",G]},R))}),o.jsxs("select",{value:c,onChange:R=>P(u)(R.target.value),className:"audit-filter-select",children:[o.jsx("option",{value:"all",children:"All Users"}),A.map(R=>o.jsx("option",{value:R.id,children:R.name},R.id))]}),o.jsx("select",{value:d,onChange:R=>P(h)(R.target.value),className:"audit-filter-select",children:Object.entries($F).map(([R,{label:G}])=>o.jsx("option",{value:R,children:G},R))})]}),d==="custom"&&o.jsxs("div",{className:"audit-custom-dates",children:[o.jsxs("label",{children:["From:",o.jsx("input",{type:"date",value:f,onChange:R=>p(R.target.value),className:"form-input"})]}),o.jsxs("label",{children:["To:",o.jsx("input",{type:"date",value:m,onChange:R=>g(R.target.value),className:"form-input"})]})]})]}),j.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:t.length===0?"No activity logged yet":"No entries match your filters"}),t.length>0&&o.jsx(K,{variant:"secondary",onClick:()=>{l("all"),u("all"),h("all"),x("")},children:"Clear Filters"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"audit-list",children:T.map(R=>{var G;return o.jsxs("div",{className:"audit-item",onClick:()=>N(R),children:[o.jsx("div",{className:"audit-icon",style:{backgroundColor:se(R.action)},children:X(R.action)}),o.jsxs("div",{className:"audit-content",children:[o.jsxs("div",{className:"audit-header",children:[o.jsx("span",{className:"audit-action",children:H(R.action)}),R.resourceName&&o.jsxs("span",{className:"audit-resource",children:['"',R.resourceName,'"']})]}),o.jsxs("div",{className:"audit-meta",children:[o.jsx("span",{className:"audit-user",children:R.userName||R.userEmail}),o.jsx("span",{className:"audit-dot",children:""}),o.jsx("span",{className:"audit-time",children:(G=R.timestamp)!=null&&G.toDate?rt(R.timestamp.toDate(),"MMM d, yyyy h:mm a"):""}),R.changes&&Object.keys(R.changes).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"audit-dot",children:""}),o.jsxs("span",{className:"audit-changes-count",children:[Object.keys(R.changes).length," change",Object.keys(R.changes).length!==1?"s":""]})]})]})]}),o.jsx("svg",{className:"audit-chevron",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})]},R.id)})}),o.jsxs("div",{className:"audit-pagination",children:[o.jsxs("div",{className:"pagination-info",children:["Showing ",E+1,"",Math.min(I,j.length)," of ",j.length," entries"]}),o.jsxs("div",{className:"pagination-controls",children:[o.jsxs("div",{className:"pagination-per-page",children:[o.jsx("span",{children:"Show:"}),o.jsx("select",{value:s,onChange:R=>O(Number(R.target.value)),className:"form-select",children:Sbe.map(R=>o.jsx("option",{value:R,children:R},R))})]}),o.jsxs("div",{className:"pagination-buttons",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>r(1),disabled:n===1,title:"First page",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"11 17 6 12 11 7"}),o.jsx("polyline",{points:"18 17 13 12 18 7"})]})}),o.jsx("button",{className:"pagination-btn",onClick:()=>r(R=>Math.max(1,R-1)),disabled:n===1,title:"Previous page",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsxs("span",{className:"pagination-page",children:["Page ",n," of ",_||1]}),o.jsx("button",{className:"pagination-btn",onClick:()=>r(R=>Math.min(_,R+1)),disabled:n===_||_===0,title:"Next page",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx("button",{className:"pagination-btn",onClick:()=>r(_),disabled:n===_||_===0,title:"Last page",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"13 17 18 12 13 7"}),o.jsx("polyline",{points:"6 17 11 12 6 7"})]})})]})]})]})]}),o.jsx(ut,{isOpen:!!w,onClose:()=>N(null),title:"Activity Details",size:"medium",children:w&&o.jsxs("div",{className:"audit-detail-modal",children:[o.jsxs("div",{className:"audit-detail-header",children:[o.jsx("div",{className:"audit-detail-icon",style:{backgroundColor:se(w.action)},children:X(w.action)}),o.jsxs("div",{children:[o.jsx("h3",{children:H(w.action)}),w.resourceName&&o.jsxs("p",{className:"audit-detail-resource",children:['"',w.resourceName,'"']})]})]}),o.jsxs("div",{className:"audit-detail-grid",children:[o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"User"}),o.jsx("span",{children:w.userName||"Unknown"})]}),o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"Email"}),o.jsx("span",{children:w.userEmail||"-"})]}),o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"User ID"}),o.jsx("span",{className:"audit-detail-id",children:w.userId||"-"})]}),o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"Timestamp"}),o.jsx("span",{children:(Y=w.timestamp)!=null&&Y.toDate?rt(w.timestamp.toDate(),"MMMM d, yyyy h:mm:ss a"):"-"})]}),o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"Resource ID"}),o.jsx("span",{className:"audit-detail-id",children:w.resourceId||"-"})]}),o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"Action Type"}),o.jsx("span",{className:"audit-detail-action",children:w.action})]}),w.ipAddress&&o.jsxs("div",{className:"audit-detail-item",children:[o.jsx("label",{children:"IP Address"}),o.jsx("span",{children:w.ipAddress})]}),w.userAgent&&o.jsxs("div",{className:"audit-detail-item full-width",children:[o.jsx("label",{children:"User Agent"}),o.jsx("span",{className:"audit-detail-ua",children:w.userAgent})]})]}),w.changes&&Object.keys(w.changes).length>0&&o.jsxs("div",{className:"audit-detail-changes",children:[o.jsx("h4",{children:"Changes Made"}),$(w.changes)]}),w.bulkOperationId&&o.jsxs("div",{className:"audit-detail-bulk",children:[o.jsx("span",{className:"bulk-badge",children:"Part of Bulk Operation"}),o.jsx("span",{className:"bulk-id",children:w.bulkOperationId})]})]})}),o.jsx(ut,{isOpen:S,onClose:()=>C(!1),title:"Export Audit Log",footer:o.jsx(o.Fragment,{children:o.jsx(K,{variant:"secondary",onClick:()=>C(!1),children:"Cancel"})}),children:o.jsxs("div",{className:"export-modal",children:[o.jsxs("p",{className:"export-info",children:["Export ",j.length," log entries based on current filters."]}),o.jsxs("div",{className:"export-options",children:[o.jsxs("button",{className:"export-option",onClick:L,children:[o.jsx("div",{className:"export-icon",children:""}),o.jsxs("div",{className:"export-details",children:[o.jsx("strong",{children:"CSV Spreadsheet"}),o.jsx("span",{children:"Compatible with Excel, Google Sheets"})]})]}),o.jsxs("button",{className:"export-option",onClick:B,children:[o.jsx("div",{className:"export-icon",children:""}),o.jsxs("div",{className:"export-details",children:[o.jsx("strong",{children:"PDF Report"}),o.jsx("span",{children:"Print-ready compliance document"})]})]})]})]})})]})}function Ebe(){const{success:t,error:e}=qt(),{data:n,loading:r}=wv("settings","config"),{update:s}=Ms("settings"),[i,a]=b.useState({companyName:"",companyEmail:"",companyPhone:"",defaultCurrency:"GBP",timezone:"Europe/London",googleAnalyticsId:""});b.useEffect(()=>{var u,d,h,f,p,m;n&&a({companyName:((u=n.company)==null?void 0:u.name)||"",companyEmail:((d=n.company)==null?void 0:d.email)||"",companyPhone:((h=n.company)==null?void 0:h.phone)||"",defaultCurrency:((f=n.defaults)==null?void 0:f.currency)||"GBP",timezone:((p=n.defaults)==null?void 0:p.timezone)||"Europe/London",googleAnalyticsId:((m=n.integrations)==null?void 0:m.googleAnalyticsId)||""})},[n]);const l=u=>{const{name:d,value:h}=u.target;a(f=>({...f,[d]:h}))},c=async u=>{u.preventDefault();try{await s("config",{company:{name:i.companyName,email:i.companyEmail,phone:i.companyPhone},defaults:{currency:i.defaultCurrency,timezone:i.timezone},integrations:{googleAnalyticsId:i.googleAnalyticsId}}),t("Settings saved")}catch(d){e("Failed to save settings"),console.error(d)}};return r?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"settings-page",children:[o.jsx("div",{className:"page-header",children:o.jsx("h1",{children:"Settings"})}),o.jsxs("form",{onSubmit:c,className:"form-card",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Company Information"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Company Name",name:"companyName",value:i.companyName,onChange:l,placeholder:"HQ Aviation"}),o.jsx(ye,{label:"Contact Email",name:"companyEmail",type:"email",value:i.companyEmail,onChange:l,placeholder:"info@company.com"}),o.jsx(ye,{label:"Contact Phone",name:"companyPhone",value:i.companyPhone,onChange:l,placeholder:"+44 1234 567890"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Defaults"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Default Currency"}),o.jsxs("select",{name:"defaultCurrency",value:i.defaultCurrency,onChange:l,className:"form-select",children:[o.jsx("option",{value:"GBP",children:"GBP (British Pound)"}),o.jsx("option",{value:"USD",children:"USD (US Dollar)"}),o.jsx("option",{value:"EUR",children:"EUR (Euro)"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Timezone"}),o.jsxs("select",{name:"timezone",value:i.timezone,onChange:l,className:"form-select",children:[o.jsx("option",{value:"Europe/London",children:"Europe/London"}),o.jsx("option",{value:"America/New_York",children:"America/New York"}),o.jsx("option",{value:"America/Los_Angeles",children:"America/Los Angeles"}),o.jsx("option",{value:"Europe/Paris",children:"Europe/Paris"})]})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h3",{children:"Integrations"}),o.jsx("div",{className:"form-grid",children:o.jsx(ye,{label:"Google Analytics ID",name:"googleAnalyticsId",value:i.googleAnalyticsId,onChange:l,placeholder:"G-XXXXXXXXXX"})})]}),o.jsx("div",{className:"form-actions",children:o.jsx(K,{type:"submit",children:"Save Settings"})})]})]})}const ih=[{value:"UK",label:"United Kingdom"},{value:"US",label:"United States"},{value:"EU",label:"Europe"},{value:"Asia",label:"Asia Pacific"},{value:"Other",label:"Other"}],gp=[{value:"excellent",label:"Excellent",description:"Like new, minimal wear"},{value:"good",label:"Good",description:"Normal wear, well maintained"},{value:"fair",label:"Fair",description:"Above average wear, functional"},{value:"project",label:"Project",description:"Needs significant work"}],Iv=[{value:"internal",label:"Internal Sale",description:"Sold through HQ Aviation"},{value:"market_data",label:"Market Data",description:"External market intelligence"},{value:"manual_entry",label:"Manual Entry",description:"Manually entered record"}],vP=[{value:"GBP",label:"GBP ()",symbol:""},{value:"USD",label:"USD ($)",symbol:"$"},{value:"EUR",label:"EUR ()",symbol:""}],Cbe=[{value:"pending",label:"Pending Review"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"}],Zx={"Garmin G500H TXi":35e3,"Garmin G1000H NXi":55e3,"Garmin GTN 750Xi":18e3,"Garmin GTN 650Xi":12e3,"Garmin GFC 600H":25e3,"Garmin GTS 800":15e3,"TCAS II":2e4,"Radar Altimeter":8e3,"Weather Radar":25e3,HTAWS:12e3,"ADS-B Out":5e3,"ADS-B In":3e3,"Satellite Phone":8e3,"Moving Map":5e3,"Air Conditioning":15e3,Floats:35e3,"Emergency Floats":25e3,"Cargo Hook":12e3,Hoist:45e3,"Wire Strike Kit":18e3,"FLIR Camera":55e3,Searchlight:8e3,"Leather Interior":15e3,"Custom Paint":1e4,"Sound Proofing":8e3,"Auxiliary Fuel Tank":12e3,"External Basket":6e3,"Bear Paws":4e3,"Snow Skis":8e3,"High Skids":5e3,"Low Skids":3e3,"Ground Handling Wheels":4e3,"Blade Tie Downs":1500,"Pitot Cover":500,"Rotor Brake":8e3,"IFR Equipped":25e3,"Single Owner":5e3,"Low Hours":1e4,"Fresh Annual":3e3,"Fresh Overhaul":0,Hangared:5e3},fd={regions:{UK:"#3b82f6",US:"#ef4444",EU:"#22c55e",Asia:"#f97316",Other:"#8b5cf6"},conditions:{excellent:"#22c55e",good:"#3b82f6",fair:"#f59e0b",project:"#ef4444"},sources:{internal:"#8b5cf6",market_data:"#6b7280",manual_entry:"#f59e0b"}};function yp(t){var e;return((e=ih.find(n=>n.value===t))==null?void 0:e.label)||t}function vp(t){var e;return((e=gp.find(n=>n.value===t))==null?void 0:e.label)||t}function Tbe(t){var e;return((e=Iv.find(n=>n.value===t))==null?void 0:e.label)||t}function Abe(t){var e;return((e=vP.find(n=>n.value===t))==null?void 0:e.symbol)||t}function kbe(t){var e;return((e=Cbe.find(n=>n.value===t))==null?void 0:e.label)||t}function Ibe(t,e){const n=["excellent","good","fair","project"],r=n.indexOf(t),s=n.indexOf(e);if(r===-1||s===-1)return .5;switch(Math.abs(r-s)){case 0:return 1;case 1:return .7;case 2:return .4;case 3:return .2;default:return .2}}function Pbe(t,e,n,r){const s=new Set([...t||[],...n||[]]),i=new Set([...e||[],...r||[]]);if(s.size===0&&i.size===0)return 1;if(s.size===0||i.size===0)return .5;const a=new Set([...s].filter(c=>i.has(c))),l=new Set([...s,...i]);return a.size/l.size}function Obe(t,e){const n=new Set([...t||[]]),r=new Set([...e||[]]);let s=0;return n.forEach(i=>{!r.has(i)&&Zx[i]&&(s+=Zx[i]*.5)}),r.forEach(i=>{!n.has(i)&&Zx[i]&&(s-=Zx[i]*.5)}),s}function On(t,e="USD"){return t==null?"-":`${Abe(e)}${Math.round(t).toLocaleString()}`}function ky(t){return t?(t.toDate?t.toDate():new Date(t)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"-"}function Dbe({filters:t,onFilterChange:e,salesData:n=[],showCompact:r=!1}){var g,y,x,w,N,S;const{manufacturers:s,getModelsForManufacturer:i}=Pu(),[a,l]=b.useState(!r),c=b.useMemo(()=>t.manufacturer?i(t.manufacturer):[],[t.manufacturer,i]),u=b.useMemo(()=>{if(!n.length)return{min:1990,max:new Date().getFullYear()};const C=n.map(A=>A.year).filter(Boolean);return{min:Math.min(...C),max:Math.max(...C)}},[n]);b.useMemo(()=>{if(!n.length)return{min:0,max:1e7};const C=n.map(A=>A.priceUSD).filter(Boolean);return{min:Math.min(...C),max:Math.max(...C)}},[n]);const d=(C,A)=>{C==="manufacturer"&&A!==t.manufacturer?e({...t,[C]:A,model:""}):e({...t,[C]:A})},h=(C,A,j)=>{e({...t,[C]:{...t[C],[A]:j}})},f=()=>{e({manufacturer:"",model:"",yearRange:{min:"",max:""},priceRange:{min:"",max:""},regions:[],conditions:[],sources:[],hoursRange:{min:"",max:""}})},p=()=>{var C,A,j,_,E,I,T,P,O;return t.manufacturer||t.model||((C=t.yearRange)==null?void 0:C.min)||((A=t.yearRange)==null?void 0:A.max)||((j=t.priceRange)==null?void 0:j.min)||((_=t.priceRange)==null?void 0:_.max)||((E=t.regions)==null?void 0:E.length)>0||((I=t.conditions)==null?void 0:I.length)>0||((T=t.sources)==null?void 0:T.length)>0||((P=t.hoursRange)==null?void 0:P.min)||((O=t.hoursRange)==null?void 0:O.max)},m=(C,A)=>{const j=t[C]||[],_=j.includes(A)?j.filter(E=>E!==A):[...j,A];e({...t,[C]:_})};return o.jsxs("div",{className:`pricing-filters-panel ${a?"expanded":"collapsed"}`,children:[o.jsxs("div",{className:"filters-header",onClick:()=>l(!a),children:[o.jsxs("div",{className:"filters-title",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),o.jsx("span",{children:"Filters"}),p()&&o.jsx("span",{className:"filter-count",children:"Active"})]}),o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:`chevron ${a?"up":"down"}`,children:o.jsx("polyline",{points:a?"18 15 12 9 6 15":"6 9 12 15 18 9"})})]}),a&&o.jsxs("div",{className:"filters-content",children:[o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Aircraft"}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Manufacturer"}),o.jsxs("select",{value:t.manufacturer||"",onChange:C=>d("manufacturer",C.target.value),children:[o.jsx("option",{value:"",children:"All Manufacturers"}),s.map(C=>o.jsx("option",{value:C,children:C},C))]})]}),o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Model"}),o.jsxs("select",{value:t.model||"",onChange:C=>d("model",C.target.value),disabled:!t.manufacturer,children:[o.jsx("option",{value:"",children:"All Models"}),c.map(C=>o.jsx("option",{value:C,children:C},C))]})]})]})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Year Range"}),o.jsxs("div",{className:"filter-row range-row",children:[o.jsx("input",{type:"number",placeholder:`Min (${u.min})`,value:((g=t.yearRange)==null?void 0:g.min)||"",onChange:C=>h("yearRange","min",C.target.value),min:u.min,max:u.max}),o.jsx("span",{className:"range-separator",children:"to"}),o.jsx("input",{type:"number",placeholder:`Max (${u.max})`,value:((y=t.yearRange)==null?void 0:y.max)||"",onChange:C=>h("yearRange","max",C.target.value),min:u.min,max:u.max})]})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Price Range (USD)"}),o.jsxs("div",{className:"filter-row range-row",children:[o.jsx("input",{type:"number",placeholder:"Min",value:((x=t.priceRange)==null?void 0:x.min)||"",onChange:C=>h("priceRange","min",C.target.value),min:0,step:1e4}),o.jsx("span",{className:"range-separator",children:"to"}),o.jsx("input",{type:"number",placeholder:"Max",value:((w=t.priceRange)==null?void 0:w.max)||"",onChange:C=>h("priceRange","max",C.target.value),min:0,step:1e4})]})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Total Hours"}),o.jsxs("div",{className:"filter-row range-row",children:[o.jsx("input",{type:"number",placeholder:"Min",value:((N=t.hoursRange)==null?void 0:N.min)||"",onChange:C=>h("hoursRange","min",C.target.value),min:0}),o.jsx("span",{className:"range-separator",children:"to"}),o.jsx("input",{type:"number",placeholder:"Max",value:((S=t.hoursRange)==null?void 0:S.max)||"",onChange:C=>h("hoursRange","max",C.target.value),min:0})]})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Region"}),o.jsx("div",{className:"filter-chips",children:ih.map(C=>o.jsx("button",{className:`filter-chip ${(t.regions||[]).includes(C.value)?"active":""}`,onClick:()=>m("regions",C.value),children:C.label},C.value))})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Condition"}),o.jsx("div",{className:"filter-chips",children:gp.map(C=>o.jsx("button",{className:`filter-chip ${(t.conditions||[]).includes(C.value)?"active":""}`,onClick:()=>m("conditions",C.value),children:C.label},C.value))})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h4",{children:"Data Source"}),o.jsx("div",{className:"filter-chips",children:Iv.map(C=>o.jsx("button",{className:`filter-chip ${(t.sources||[]).includes(C.value)?"active":""}`,onClick:()=>m("sources",C.value),children:C.label},C.value))})]}),p()&&o.jsx("button",{className:"clear-filters-btn",onClick:f,children:"Clear All Filters"})]})]})}function q9(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=q9(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function gn(){for(var t,e,n=0,r="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=q9(t))&&(r&&(r+=" "),r+=e);return r}var Rbe=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function xP(t){if(typeof t!="string")return!1;var e=Rbe;return e.includes(t)}var Mbe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Lbe=new Set(Mbe);function G9(t){return typeof t!="string"?!1:Lbe.has(t)}function K9(t){return typeof t=="string"&&t.startsWith("data-")}function Mo(t){if(typeof t!="object"||t===null)return{};var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(G9(n)||K9(n))&&(e[n]=t[n]);return e}function bP(t){if(t==null)return null;if(b.isValidElement(t)&&typeof t.props=="object"&&t.props!==null){var e=t.props;return Mo(e)}return typeof t=="object"&&!Array.isArray(t)?Mo(t):null}function Gi(t){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(G9(n)||K9(n)||xP(n))&&(e[n]=t[n]);return e}var Fbe=["children","width","height","viewBox","className","style","title","desc"];function uT(){return uT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},uT.apply(null,arguments)}function Bbe(t,e){if(t==null)return{};var n,r,s=Vbe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Vbe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var Y9=b.forwardRef((t,e)=>{var{children:n,width:r,height:s,viewBox:i,className:a,style:l,title:c,desc:u}=t,d=Bbe(t,Fbe),h=i||{width:r,height:s,x:0,y:0},f=gn("recharts-surface",a);return b.createElement("svg",uT({},Gi(d),{className:f,width:r,height:s,style:l,viewBox:"".concat(h.x," ").concat(h.y," ").concat(h.width," ").concat(h.height),ref:e}),b.createElement("title",null,c),b.createElement("desc",null,u),n)}),$be=["children","className"];function dT(){return dT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},dT.apply(null,arguments)}function Ube(t,e){if(t==null)return{};var n,r,s=zbe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function zbe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var Xa=b.forwardRef((t,e)=>{var{children:n,className:r}=t,s=Ube(t,$be),i=gn("recharts-layer",r);return b.createElement("g",dT({className:i},Gi(s),{ref:e}),n)}),Hbe=b.createContext(null);function hn(t){return function(){return t}}const Q9=Math.cos,Uw=Math.sin,Za=Math.sqrt,zw=Math.PI,XN=2*zw,hT=Math.PI,fT=2*hT,Ju=1e-6,Wbe=fT-Ju;function X9(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function qbe(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return X9;const n=10**e;return function(r){this._+=r[0];for(let s=1,i=r.length;s<i;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}class Gbe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?X9:qbe(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,s){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+s}`}bezierCurveTo(e,n,r,s,i,a){this._append`C${+e},${+n},${+r},${+s},${this._x1=+i},${this._y1=+a}`}arcTo(e,n,r,s,i){if(e=+e,n=+n,r=+r,s=+s,i=+i,i<0)throw new Error(`negative radius: ${i}`);let a=this._x1,l=this._y1,c=r-e,u=s-n,d=a-e,h=l-n,f=d*d+h*h;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(f>Ju)if(!(Math.abs(h*c-u*d)>Ju)||!i)this._append`L${this._x1=e},${this._y1=n}`;else{let p=r-a,m=s-l,g=c*c+u*u,y=p*p+m*m,x=Math.sqrt(g),w=Math.sqrt(f),N=i*Math.tan((hT-Math.acos((g+f-y)/(2*x*w)))/2),S=N/w,C=N/x;Math.abs(S-1)>Ju&&this._append`L${e+S*d},${n+S*h}`,this._append`A${i},${i},0,0,${+(h*p>d*m)},${this._x1=e+C*c},${this._y1=n+C*u}`}}arc(e,n,r,s,i,a){if(e=+e,n=+n,r=+r,a=!!a,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(s),c=r*Math.sin(s),u=e+l,d=n+c,h=1^a,f=a?s-i:i-s;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>Ju||Math.abs(this._y1-d)>Ju)&&this._append`L${u},${d}`,r&&(f<0&&(f=f%fT+fT),f>Wbe?this._append`A${r},${r},0,1,${h},${e-l},${n-c}A${r},${r},0,1,${h},${this._x1=u},${this._y1=d}`:f>Ju&&this._append`A${r},${r},0,${+(f>=hT)},${h},${this._x1=e+r*Math.cos(i)},${this._y1=n+r*Math.sin(i)}`)}rect(e,n,r,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+s}h${-r}Z`}toString(){return this._}}function wP(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Gbe(e)}function NP(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function J9(t){this._context=t}J9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function JN(t){return new J9(t)}function Z9(t){return t[0]}function e8(t){return t[1]}function t8(t,e){var n=hn(!0),r=null,s=JN,i=null,a=wP(l);t=typeof t=="function"?t:t===void 0?Z9:hn(t),e=typeof e=="function"?e:e===void 0?e8:hn(e);function l(c){var u,d=(c=NP(c)).length,h,f=!1,p;for(r==null&&(i=s(p=a())),u=0;u<=d;++u)!(u<d&&n(h=c[u],u,c))===f&&((f=!f)?i.lineStart():i.lineEnd()),f&&i.point(+t(h,u,c),+e(h,u,c));if(p)return i=null,p+""||null}return l.x=function(c){return arguments.length?(t=typeof c=="function"?c:hn(+c),l):t},l.y=function(c){return arguments.length?(e=typeof c=="function"?c:hn(+c),l):e},l.defined=function(c){return arguments.length?(n=typeof c=="function"?c:hn(!!c),l):n},l.curve=function(c){return arguments.length?(s=c,r!=null&&(i=s(r)),l):s},l.context=function(c){return arguments.length?(c==null?r=i=null:i=s(r=c),l):r},l}function e0(t,e,n){var r=null,s=hn(!0),i=null,a=JN,l=null,c=wP(u);t=typeof t=="function"?t:t===void 0?Z9:hn(+t),e=typeof e=="function"?e:hn(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?e8:hn(+n);function u(h){var f,p,m,g=(h=NP(h)).length,y,x=!1,w,N=new Array(g),S=new Array(g);for(i==null&&(l=a(w=c())),f=0;f<=g;++f){if(!(f<g&&s(y=h[f],f,h))===x)if(x=!x)p=f,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),m=f-1;m>=p;--m)l.point(N[m],S[m]);l.lineEnd(),l.areaEnd()}x&&(N[f]=+t(y,f,h),S[f]=+e(y,f,h),l.point(r?+r(y,f,h):N[f],n?+n(y,f,h):S[f]))}if(w)return l=null,w+""||null}function d(){return t8().defined(s).curve(a).context(i)}return u.x=function(h){return arguments.length?(t=typeof h=="function"?h:hn(+h),r=null,u):t},u.x0=function(h){return arguments.length?(t=typeof h=="function"?h:hn(+h),u):t},u.x1=function(h){return arguments.length?(r=h==null?null:typeof h=="function"?h:hn(+h),u):r},u.y=function(h){return arguments.length?(e=typeof h=="function"?h:hn(+h),n=null,u):e},u.y0=function(h){return arguments.length?(e=typeof h=="function"?h:hn(+h),u):e},u.y1=function(h){return arguments.length?(n=h==null?null:typeof h=="function"?h:hn(+h),u):n},u.lineX0=u.lineY0=function(){return d().x(t).y(e)},u.lineY1=function(){return d().x(t).y(n)},u.lineX1=function(){return d().x(r).y(e)},u.defined=function(h){return arguments.length?(s=typeof h=="function"?h:hn(!!h),u):s},u.curve=function(h){return arguments.length?(a=h,i!=null&&(l=a(i)),u):a},u.context=function(h){return arguments.length?(h==null?i=l=null:l=a(i=h),u):i},u}class n8{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}function Kbe(t){return new n8(t,!0)}function Ybe(t){return new n8(t,!1)}const SP={draw(t,e){const n=Za(e/zw);t.moveTo(n,0),t.arc(0,0,n,0,XN)}},Qbe={draw(t,e){const n=Za(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},r8=Za(1/3),Xbe=r8*2,Jbe={draw(t,e){const n=Za(e/Xbe),r=n*r8;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},Zbe={draw(t,e){const n=Za(e),r=-n/2;t.rect(r,r,n,n)}},ewe=.8908130915292852,s8=Uw(zw/10)/Uw(7*zw/10),twe=Uw(XN/10)*s8,nwe=-Q9(XN/10)*s8,rwe={draw(t,e){const n=Za(e*ewe),r=twe*n,s=nwe*n;t.moveTo(0,-n),t.lineTo(r,s);for(let i=1;i<5;++i){const a=XN*i/5,l=Q9(a),c=Uw(a);t.lineTo(c*n,-l*n),t.lineTo(l*r-c*s,c*r+l*s)}t.closePath()}},Ij=Za(3),swe={draw(t,e){const n=-Za(e/(Ij*3));t.moveTo(0,n*2),t.lineTo(-Ij*n,-n),t.lineTo(Ij*n,-n),t.closePath()}},oa=-.5,la=Za(3)/2,pT=1/Za(12),iwe=(pT/2+1)*3,awe={draw(t,e){const n=Za(e/iwe),r=n/2,s=n*pT,i=r,a=n*pT+n,l=-i,c=a;t.moveTo(r,s),t.lineTo(i,a),t.lineTo(l,c),t.lineTo(oa*r-la*s,la*r+oa*s),t.lineTo(oa*i-la*a,la*i+oa*a),t.lineTo(oa*l-la*c,la*l+oa*c),t.lineTo(oa*r+la*s,oa*s-la*r),t.lineTo(oa*i+la*a,oa*a-la*i),t.lineTo(oa*l+la*c,oa*c-la*l),t.closePath()}};function owe(t,e){let n=null,r=wP(s);t=typeof t=="function"?t:hn(t||SP),e=typeof e=="function"?e:hn(e===void 0?64:+e);function s(){let i;if(n||(n=i=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return s.type=function(i){return arguments.length?(t=typeof i=="function"?i:hn(i),s):t},s.size=function(i){return arguments.length?(e=typeof i=="function"?i:hn(+i),s):e},s.context=function(i){return arguments.length?(n=i??null,s):n},s}function Hw(){}function Ww(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function i8(t){this._context=t}i8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ww(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ww(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function lwe(t){return new i8(t)}function a8(t){this._context=t}a8.prototype={areaStart:Hw,areaEnd:Hw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Ww(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function cwe(t){return new a8(t)}function o8(t){this._context=t}o8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Ww(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function uwe(t){return new o8(t)}function l8(t){this._context=t}l8.prototype={areaStart:Hw,areaEnd:Hw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function dwe(t){return new l8(t)}function UF(t){return t<0?-1:1}function zF(t,e,n){var r=t._x1-t._x0,s=e-t._x1,i=(t._y1-t._y0)/(r||s<0&&-0),a=(n-t._y1)/(s||r<0&&-0),l=(i*s+a*r)/(r+s);return(UF(i)+UF(a))*Math.min(Math.abs(i),Math.abs(a),.5*Math.abs(l))||0}function HF(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Pj(t,e,n){var r=t._x0,s=t._y0,i=t._x1,a=t._y1,l=(i-r)/3;t._context.bezierCurveTo(r+l,s+l*e,i-l,a-l*n,i,a)}function qw(t){this._context=t}qw.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Pj(this,this._t0,HF(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Pj(this,HF(this,n=zF(this,t,e)),n);break;default:Pj(this,this._t0,n=zF(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function c8(t){this._context=new u8(t)}(c8.prototype=Object.create(qw.prototype)).point=function(t,e){qw.prototype.point.call(this,e,t)};function u8(t){this._context=t}u8.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,s,i){this._context.bezierCurveTo(e,t,r,n,i,s)}};function hwe(t){return new qw(t)}function fwe(t){return new c8(t)}function d8(t){this._context=t}d8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var r=WF(t),s=WF(e),i=0,a=1;a<n;++i,++a)this._context.bezierCurveTo(r[0][i],s[0][i],r[1][i],s[1][i],t[a],e[a]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function WF(t){var e,n=t.length-1,r,s=new Array(n),i=new Array(n),a=new Array(n);for(s[0]=0,i[0]=2,a[0]=t[0]+2*t[1],e=1;e<n-1;++e)s[e]=1,i[e]=4,a[e]=4*t[e]+2*t[e+1];for(s[n-1]=2,i[n-1]=7,a[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)r=s[e]/i[e-1],i[e]-=r,a[e]-=r*a[e-1];for(s[n-1]=a[n-1]/i[n-1],e=n-2;e>=0;--e)s[e]=(a[e]-s[e+1])/i[e];for(i[n-1]=(t[n]+s[n-1])/2,e=0;e<n-1;++e)i[e]=2*t[e+1]-s[e+1];return[s,i]}function pwe(t){return new d8(t)}function ZN(t,e){this._context=t,this._t=e}ZN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function mwe(t){return new ZN(t,.5)}function gwe(t){return new ZN(t,0)}function ywe(t){return new ZN(t,1)}function ah(t,e){if((a=t.length)>1)for(var n=1,r,s,i=t[e[0]],a,l=i.length;n<a;++n)for(s=i,i=t[e[n]],r=0;r<l;++r)i[r][1]+=i[r][0]=isNaN(s[r][1])?s[r][0]:s[r][1]}function mT(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function vwe(t,e){return t[e]}function xwe(t){const e=[];return e.key=t,e}function bwe(){var t=hn([]),e=mT,n=ah,r=vwe;function s(i){var a=Array.from(t.apply(this,arguments),xwe),l,c=a.length,u=-1,d;for(const h of i)for(l=0,++u;l<c;++l)(a[l][u]=[0,+r(h,a[l].key,u,i)]).data=h;for(l=0,d=NP(e(a));l<c;++l)a[d[l]].index=l;return n(a,d),a}return s.keys=function(i){return arguments.length?(t=typeof i=="function"?i:hn(Array.from(i)),s):t},s.value=function(i){return arguments.length?(r=typeof i=="function"?i:hn(+i),s):r},s.order=function(i){return arguments.length?(e=i==null?mT:typeof i=="function"?i:hn(Array.from(i)),s):e},s.offset=function(i){return arguments.length?(n=i??ah,s):n},s}function wwe(t,e){if((r=t.length)>0){for(var n,r,s=0,i=t[0].length,a;s<i;++s){for(a=n=0;n<r;++n)a+=t[n][s][1]||0;if(a)for(n=0;n<r;++n)t[n][s][1]/=a}ah(t,e)}}function Nwe(t,e){if((s=t.length)>0){for(var n=0,r=t[e[0]],s,i=r.length;n<i;++n){for(var a=0,l=0;a<s;++a)l+=t[a][n][1]||0;r[n][1]+=r[n][0]=-l/2}ah(t,e)}}function Swe(t,e){if(!(!((a=t.length)>0)||!((i=(s=t[e[0]]).length)>0))){for(var n=0,r=1,s,i,a;r<i;++r){for(var l=0,c=0,u=0;l<a;++l){for(var d=t[e[l]],h=d[r][1]||0,f=d[r-1][1]||0,p=(h-f)/2,m=0;m<l;++m){var g=t[e[m]],y=g[r][1]||0,x=g[r-1][1]||0;p+=y-x}c+=h,u+=p*h}s[r-1][1]+=s[r-1][0]=n,c&&(n-=u/c)}s[r-1][1]+=s[r-1][0]=n,ah(t,e)}}var eS={},h8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==="__proto__"}t.isUnsafeProperty=e})(h8);var _P={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){switch(typeof n){case"number":case"symbol":return!1;case"string":return n.includes(".")||n.includes("[")||n.includes("]")}}t.isDeepKey=e})(_P);var tS={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){var r;return typeof n=="string"||typeof n=="symbol"?n:Object.is((r=n==null?void 0:n.valueOf)==null?void 0:r.call(n),-0)?"-0":String(n)}t.toKey=e})(tS);var nS={},f8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){if(n==null)return"";if(typeof n=="string")return n;if(Array.isArray(n))return n.map(e).join(",");const r=String(n);return r==="0"&&Object.is(Number(n),-0)?"-0":r}t.toString=e})(f8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=f8,n=tS;function r(s){if(Array.isArray(s))return s.map(n.toKey);if(typeof s=="symbol")return[s];s=e.toString(s);const i=[],a=s.length;if(a===0)return i;let l=0,c="",u="",d=!1;for(s.charCodeAt(0)===46&&(i.push(""),l++);l<a;){const h=s[l];u?h==="\\"&&l+1<a?(l++,c+=s[l]):h===u?u="":c+=h:d?h==='"'||h==="'"?u=h:h==="]"?(d=!1,i.push(c),c=""):c+=h:h==="["?(d=!0,c&&(i.push(c),c="")):h==="."?c&&(i.push(c),c=""):c+=h,l++}return c&&i.push(c),i}t.toPath=r})(nS);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=h8,n=_P,r=tS,s=nS;function i(l,c,u){if(l==null)return u;switch(typeof c){case"string":{if(e.isUnsafeProperty(c))return u;const d=l[c];return d===void 0?n.isDeepKey(c)?i(l,s.toPath(c),u):u:d}case"number":case"symbol":{typeof c=="number"&&(c=r.toKey(c));const d=l[c];return d===void 0?u:d}default:{if(Array.isArray(c))return a(l,c,u);if(Object.is(c==null?void 0:c.valueOf(),-0)?c="-0":c=String(c),e.isUnsafeProperty(c))return u;const d=l[c];return d===void 0?u:d}}}function a(l,c,u){if(c.length===0)return u;let d=l;for(let h=0;h<c.length;h++){if(d==null||e.isUnsafeProperty(c[h]))return u;d=d[c[h]]}return d===void 0?u:d}t.get=i})(eS);var _we=eS.get;const xp=Bo(_we);var jwe=4;function Lc(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jwe,n=10**e,r=Math.round(t*n)/n;return Object.is(r,-0)?0:r}function Wn(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.reduce((s,i,a)=>{var l=n[a-1];return typeof l=="string"?s+l+i:l!==void 0?s+Lc(l)+i:s+i},"")}var ga=t=>t===0?0:t>0?1:-1,Ol=t=>typeof t=="number"&&t!=+t,oh=t=>typeof t=="string"&&t.indexOf("%")===t.length-1,tt=t=>(typeof t=="number"||t instanceof Number)&&!Ol(t),Ta=t=>tt(t)||typeof t=="string",Ewe=0,Iy=t=>{var e=++Ewe;return"".concat(t||"").concat(e)},vu=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!tt(e)&&typeof e!="string")return r;var i;if(oh(e)){if(n==null)return r;var a=e.indexOf("%");i=n*parseFloat(e.slice(0,a))/100}else i=+e;return Ol(i)&&(i=r),s&&n!=null&&i>n&&(i=n),i},p8=t=>{if(!Array.isArray(t))return!1;for(var e=t.length,n={},r=0;r<e;r++)if(!n[String(t[r])])n[String(t[r])]=!0;else return!0;return!1};function Oi(t,e,n){return tt(t)&&tt(e)?Lc(t+n*(e-t)):e}function m8(t,e,n){if(!(!t||!t.length))return t.find(r=>r&&(typeof e=="function"?e(r):xp(r,e))===n)}var Cwe=t=>{for(var e=t.length,n=0,r=0,s=0,i=0,a=1/0,l=-1/0,c=0,u=0,d=0;d<e;d++){var h,f;c=((h=t[d])===null||h===void 0?void 0:h.cx)||0,u=((f=t[d])===null||f===void 0?void 0:f.cy)||0,n+=c,r+=u,s+=c*u,i+=c*c,a=Math.min(a,c),l=Math.max(l,c)}var p=e*i!==n*n?(e*s-n*r)/(e*i-n*n):0;return{xmin:a,xmax:l,a:p,b:(r-p*n)/e}},dr=t=>t===null||typeof t>"u",Pv=t=>dr(t)?t:"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));function mi(t){return t!=null}function Ov(){}var Twe=["type","size","sizeType"];function gT(){return gT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},gT.apply(null,arguments)}function qF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function GF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qF(Object(n),!0).forEach(function(r){Awe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Awe(t,e,n){return(e=kwe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kwe(t){var e=Iwe(t,"string");return typeof e=="symbol"?e:e+""}function Iwe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pwe(t,e){if(t==null)return{};var n,r,s=Owe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Owe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var g8={symbolCircle:SP,symbolCross:Qbe,symbolDiamond:Jbe,symbolSquare:Zbe,symbolStar:rwe,symbolTriangle:swe,symbolWye:awe},Dwe=Math.PI/180,Rwe=t=>{var e="symbol".concat(Pv(t));return g8[e]||SP},Mwe=(t,e,n)=>{if(e==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var r=18*Dwe;return 1.25*t*t*(Math.tan(r)-Math.tan(r*2)*Math.tan(r)**2)}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},Lwe=(t,e)=>{g8["symbol".concat(Pv(t))]=e},jP=t=>{var{type:e="circle",size:n=64,sizeType:r="area"}=t,s=Pwe(t,Twe),i=GF(GF({},s),{},{type:e,size:n,sizeType:r}),a="circle";typeof e=="string"&&(a=e);var l=()=>{var f=Rwe(a),p=owe().type(f).size(Mwe(n,r,a)),m=p();if(m!==null)return m},{className:c,cx:u,cy:d}=i,h=Gi(i);return tt(u)&&tt(d)&&tt(n)?b.createElement("path",gT({},h,{className:gn("recharts-symbols",c),transform:"translate(".concat(u,", ").concat(d,")"),d:l()})):null};jP.registerSymbol=Lwe;var y8=t=>"radius"in t&&"startAngle"in t&&"endAngle"in t,Fwe=(t,e)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(b.isValidElement(t)&&(n=t.props),typeof n!="object"&&typeof n!="function")return null;var r={};return Object.keys(n).forEach(s=>{xP(s)&&(r[s]=i=>n[s](n,i))}),r},Bwe=(t,e,n)=>r=>(t(e,n,r),null),v8=(t,e,n)=>{if(t===null||typeof t!="object"&&typeof t!="function")return null;var r=null;return Object.keys(t).forEach(s=>{var i=t[s];xP(s)&&typeof i=="function"&&(r||(r={}),r[s]=Bwe(i,e,n))}),r},Vwe=t=>Array.isArray(t)&&t.length>0;function KF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function $we(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KF(Object(n),!0).forEach(function(r){Uwe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Uwe(t,e,n){return(e=zwe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zwe(t){var e=Hwe(t,"string");return typeof e=="symbol"?e:e+""}function Hwe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ei(t,e){var n=$we({},t),r=e,s=Object.keys(e),i=s.reduce((a,l)=>(a[l]===void 0&&r[l]!==void 0&&(a[l]=r[l]),a),n);return i}var x8={},b8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r){const s=new Map;for(let i=0;i<n.length;i++){const a=n[i],l=r(a,i,n);s.has(l)||s.set(l,a)}return Array.from(s.values())}t.uniqBy=e})(b8);var w8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r){return function(...s){return n.apply(this,s.slice(0,r))}}t.ary=e})(w8);var EP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n}t.identity=e})(EP);var N8={},rS={},S8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return Number.isSafeInteger(n)&&n>=0}t.isLength=e})(S8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=S8;function n(r){return r!=null&&typeof r!="function"&&e.isLength(r.length)}t.isArrayLike=n})(rS);var _8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="object"&&n!==null}t.isObjectLike=e})(_8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=rS,n=_8;function r(s){return n.isObjectLike(s)&&e.isArrayLike(s)}t.isArrayLikeObject=r})(N8);var j8={},E8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=eS;function n(r){return function(s){return e.get(s,r)}}t.property=n})(E8);var C8={},CP={},T8={},TP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n!==null&&(typeof n=="object"||typeof n=="function")}t.isObject=e})(TP);var AP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==null||typeof n!="object"&&typeof n!="function"}t.isPrimitive=e})(AP);var kP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r){return n===r||Number.isNaN(n)&&Number.isNaN(r)}t.isEqualsSameValueZero=e})(kP);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=TP,n=AP,r=kP;function s(d,h,f){return typeof f!="function"?s(d,h,()=>{}):i(d,h,function p(m,g,y,x,w,N){const S=f(m,g,y,x,w,N);return S!==void 0?!!S:i(m,g,p,N)},new Map)}function i(d,h,f,p){if(h===d)return!0;switch(typeof h){case"object":return a(d,h,f,p);case"function":return Object.keys(h).length>0?i(d,{...h},f,p):r.isEqualsSameValueZero(d,h);default:return e.isObject(d)?typeof h=="string"?h==="":!0:r.isEqualsSameValueZero(d,h)}}function a(d,h,f,p){if(h==null)return!0;if(Array.isArray(h))return c(d,h,f,p);if(h instanceof Map)return l(d,h,f,p);if(h instanceof Set)return u(d,h,f,p);const m=Object.keys(h);if(d==null||n.isPrimitive(d))return m.length===0;if(m.length===0)return!0;if(p!=null&&p.has(h))return p.get(h)===d;p==null||p.set(h,d);try{for(let g=0;g<m.length;g++){const y=m[g];if(!n.isPrimitive(d)&&!(y in d)||h[y]===void 0&&d[y]!==void 0||h[y]===null&&d[y]!==null||!f(d[y],h[y],y,d,h,p))return!1}return!0}finally{p==null||p.delete(h)}}function l(d,h,f,p){if(h.size===0)return!0;if(!(d instanceof Map))return!1;for(const[m,g]of h.entries()){const y=d.get(m);if(f(y,g,m,d,h,p)===!1)return!1}return!0}function c(d,h,f,p){if(h.length===0)return!0;if(!Array.isArray(d))return!1;const m=new Set;for(let g=0;g<h.length;g++){const y=h[g];let x=!1;for(let w=0;w<d.length;w++){if(m.has(w))continue;const N=d[w];let S=!1;if(f(N,y,g,d,h,p)&&(S=!0),S){m.add(w),x=!0;break}}if(!x)return!1}return!0}function u(d,h,f,p){return h.size===0?!0:d instanceof Set?c([...d],[...h],f,p):!1}t.isMatchWith=s,t.isSetMatch=u})(T8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=T8;function n(r,s){return e.isMatchWith(r,s,()=>{})}t.isMatch=n})(CP);var A8={},IP={},k8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return Object.getOwnPropertySymbols(n).filter(r=>Object.prototype.propertyIsEnumerable.call(n,r))}t.getSymbols=e})(k8);var sS={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}t.getTag=e})(sS);var PP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e="[object RegExp]",n="[object String]",r="[object Number]",s="[object Boolean]",i="[object Arguments]",a="[object Symbol]",l="[object Date]",c="[object Map]",u="[object Set]",d="[object Array]",h="[object Function]",f="[object ArrayBuffer]",p="[object Object]",m="[object Error]",g="[object DataView]",y="[object Uint8Array]",x="[object Uint8ClampedArray]",w="[object Uint16Array]",N="[object Uint32Array]",S="[object BigUint64Array]",C="[object Int8Array]",A="[object Int16Array]",j="[object Int32Array]",_="[object BigInt64Array]",E="[object Float32Array]",I="[object Float64Array]";t.argumentsTag=i,t.arrayBufferTag=f,t.arrayTag=d,t.bigInt64ArrayTag=_,t.bigUint64ArrayTag=S,t.booleanTag=s,t.dataViewTag=g,t.dateTag=l,t.errorTag=m,t.float32ArrayTag=E,t.float64ArrayTag=I,t.functionTag=h,t.int16ArrayTag=A,t.int32ArrayTag=j,t.int8ArrayTag=C,t.mapTag=c,t.numberTag=r,t.objectTag=p,t.regexpTag=e,t.setTag=u,t.stringTag=n,t.symbolTag=a,t.uint16ArrayTag=w,t.uint32ArrayTag=N,t.uint8ArrayTag=y,t.uint8ClampedArrayTag=x})(PP);var I8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}t.isTypedArray=e})(I8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=k8,n=sS,r=PP,s=AP,i=I8;function a(d,h){return l(d,void 0,d,new Map,h)}function l(d,h,f,p=new Map,m=void 0){const g=m==null?void 0:m(d,h,f,p);if(g!==void 0)return g;if(s.isPrimitive(d))return d;if(p.has(d))return p.get(d);if(Array.isArray(d)){const y=new Array(d.length);p.set(d,y);for(let x=0;x<d.length;x++)y[x]=l(d[x],x,f,p,m);return Object.hasOwn(d,"index")&&(y.index=d.index),Object.hasOwn(d,"input")&&(y.input=d.input),y}if(d instanceof Date)return new Date(d.getTime());if(d instanceof RegExp){const y=new RegExp(d.source,d.flags);return y.lastIndex=d.lastIndex,y}if(d instanceof Map){const y=new Map;p.set(d,y);for(const[x,w]of d)y.set(x,l(w,x,f,p,m));return y}if(d instanceof Set){const y=new Set;p.set(d,y);for(const x of d)y.add(l(x,void 0,f,p,m));return y}if(typeof Buffer<"u"&&Buffer.isBuffer(d))return d.subarray();if(i.isTypedArray(d)){const y=new(Object.getPrototypeOf(d)).constructor(d.length);p.set(d,y);for(let x=0;x<d.length;x++)y[x]=l(d[x],x,f,p,m);return y}if(d instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&d instanceof SharedArrayBuffer)return d.slice(0);if(d instanceof DataView){const y=new DataView(d.buffer.slice(0),d.byteOffset,d.byteLength);return p.set(d,y),c(y,d,f,p,m),y}if(typeof File<"u"&&d instanceof File){const y=new File([d],d.name,{type:d.type});return p.set(d,y),c(y,d,f,p,m),y}if(typeof Blob<"u"&&d instanceof Blob){const y=new Blob([d],{type:d.type});return p.set(d,y),c(y,d,f,p,m),y}if(d instanceof Error){const y=new d.constructor;return p.set(d,y),y.message=d.message,y.name=d.name,y.stack=d.stack,y.cause=d.cause,c(y,d,f,p,m),y}if(d instanceof Boolean){const y=new Boolean(d.valueOf());return p.set(d,y),c(y,d,f,p,m),y}if(d instanceof Number){const y=new Number(d.valueOf());return p.set(d,y),c(y,d,f,p,m),y}if(d instanceof String){const y=new String(d.valueOf());return p.set(d,y),c(y,d,f,p,m),y}if(typeof d=="object"&&u(d)){const y=Object.create(Object.getPrototypeOf(d));return p.set(d,y),c(y,d,f,p,m),y}return d}function c(d,h,f=d,p,m){const g=[...Object.keys(h),...e.getSymbols(h)];for(let y=0;y<g.length;y++){const x=g[y],w=Object.getOwnPropertyDescriptor(d,x);(w==null||w.writable)&&(d[x]=l(h[x],x,f,p,m))}}function u(d){switch(n.getTag(d)){case r.argumentsTag:case r.arrayTag:case r.arrayBufferTag:case r.dataViewTag:case r.booleanTag:case r.dateTag:case r.float32ArrayTag:case r.float64ArrayTag:case r.int8ArrayTag:case r.int16ArrayTag:case r.int32ArrayTag:case r.mapTag:case r.numberTag:case r.objectTag:case r.regexpTag:case r.setTag:case r.stringTag:case r.symbolTag:case r.uint8ArrayTag:case r.uint8ClampedArrayTag:case r.uint16ArrayTag:case r.uint32ArrayTag:return!0;default:return!1}}t.cloneDeepWith=a,t.cloneDeepWithImpl=l,t.copyProperties=c})(IP);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=IP;function n(r){return e.cloneDeepWithImpl(r,void 0,r,new Map,void 0)}t.cloneDeep=n})(A8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=CP,n=A8;function r(s){return s=n.cloneDeep(s),i=>e.isMatch(i,s)}t.matches=r})(C8);var P8={},O8={},D8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=IP,n=sS,r=PP;function s(i,a){return e.cloneDeepWith(i,(l,c,u,d)=>{const h=a==null?void 0:a(l,c,u,d);if(h!==void 0)return h;if(typeof i=="object"){if(n.getTag(i)===r.objectTag&&typeof i.constructor!="function"){const f={};return d.set(i,f),e.copyProperties(f,i,u,d),f}switch(Object.prototype.toString.call(i)){case r.numberTag:case r.stringTag:case r.booleanTag:{const f=new i.constructor(i==null?void 0:i.valueOf());return e.copyProperties(f,i),f}case r.argumentsTag:{const f={};return e.copyProperties(f,i),f.length=i.length,f[Symbol.iterator]=i[Symbol.iterator],f}default:return}}})}t.cloneDeepWith=s})(D8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=D8;function n(r){return e.cloneDeepWith(r)}t.cloneDeep=n})(O8);var R8={},OP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=/^(?:0|[1-9]\d*)$/;function n(r,s=Number.MAX_SAFE_INTEGER){switch(typeof r){case"number":return Number.isInteger(r)&&r>=0&&r<s;case"symbol":return!1;case"string":return e.test(r)}}t.isIndex=n})(OP);var M8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=sS;function n(r){return r!==null&&typeof r=="object"&&e.getTag(r)==="[object Arguments]"}t.isArguments=n})(M8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=_P,n=OP,r=M8,s=nS;function i(a,l){let c;if(Array.isArray(l)?c=l:typeof l=="string"&&e.isDeepKey(l)&&(a==null?void 0:a[l])==null?c=s.toPath(l):c=[l],c.length===0)return!1;let u=a;for(let d=0;d<c.length;d++){const h=c[d];if((u==null||!Object.hasOwn(u,h))&&!((Array.isArray(u)||r.isArguments(u))&&n.isIndex(h)&&h<u.length))return!1;u=u[h]}return!0}t.has=i})(R8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=CP,n=tS,r=O8,s=eS,i=R8;function a(l,c){switch(typeof l){case"object":{Object.is(l==null?void 0:l.valueOf(),-0)&&(l="-0");break}case"number":{l=n.toKey(l);break}}return c=r.cloneDeep(c),function(u){const d=s.get(u,l);return d===void 0?i.has(u,l):c===void 0?d===void 0:e.isMatch(d,c)}}t.matchesProperty=a})(P8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=EP,n=E8,r=C8,s=P8;function i(a){if(a==null)return e.identity;switch(typeof a){case"function":return a;case"object":return Array.isArray(a)&&a.length===2?s.matchesProperty(a[0],a[1]):r.matches(a);case"string":case"symbol":case"number":return n.property(a)}}t.iteratee=i})(j8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=b8,n=w8,r=EP,s=N8,i=j8;function a(l,c=r.identity){return s.isArrayLikeObject(l)?e.uniqBy(Array.from(l),n.ary(i.iteratee(c),1)):[]}t.uniqBy=a})(x8);var Wwe=x8.uniqBy;const YF=Bo(Wwe);function qwe(t,e,n){return e===!0?YF(t,n):typeof e=="function"?YF(t,e):t}var L8={exports:{}},F8={},B8={exports:{}},V8={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bp=b;function Gwe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Kwe=typeof Object.is=="function"?Object.is:Gwe,Ywe=bp.useState,Qwe=bp.useEffect,Xwe=bp.useLayoutEffect,Jwe=bp.useDebugValue;function Zwe(t,e){var n=e(),r=Ywe({inst:{value:n,getSnapshot:e}}),s=r[0].inst,i=r[1];return Xwe(function(){s.value=n,s.getSnapshot=e,Oj(s)&&i({inst:s})},[t,n,e]),Qwe(function(){return Oj(s)&&i({inst:s}),t(function(){Oj(s)&&i({inst:s})})},[t]),Jwe(n),n}function Oj(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kwe(t,n)}catch{return!0}}function e1e(t,e){return e()}var t1e=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?e1e:Zwe;V8.useSyncExternalStore=bp.useSyncExternalStore!==void 0?bp.useSyncExternalStore:t1e;B8.exports=V8;var n1e=B8.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iS=b,r1e=n1e;function s1e(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var i1e=typeof Object.is=="function"?Object.is:s1e,a1e=r1e.useSyncExternalStore,o1e=iS.useRef,l1e=iS.useEffect,c1e=iS.useMemo,u1e=iS.useDebugValue;F8.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var i=o1e(null);if(i.current===null){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=c1e(function(){function c(p){if(!u){if(u=!0,d=p,p=r(p),s!==void 0&&a.hasValue){var m=a.value;if(s(m,p))return h=m}return h=p}if(m=h,i1e(d,p))return m;var g=r(p);return s!==void 0&&s(m,g)?(d=p,m):(d=p,h=g)}var u=!1,d,h,f=n===void 0?null:n;return[function(){return c(e())},f===null?void 0:function(){return c(f())}]},[e,n,r,s]);var l=a1e(t,i[0],i[1]);return l1e(function(){a.hasValue=!0,a.value=l},[l]),u1e(l),l};L8.exports=F8;var d1e=L8.exports,DP=b.createContext(null),h1e=t=>t,Xn=()=>{var t=b.useContext(DP);return t?t.store.dispatch:h1e},q0=()=>{},f1e=()=>q0,p1e=(t,e)=>t===e;function Ze(t){var e=b.useContext(DP),n=b.useMemo(()=>e?r=>{if(r!=null)return t(r)}:q0,[e,t]);return d1e.useSyncExternalStoreWithSelector(e?e.subscription.addNestedSub:f1e,e?e.store.getState:q0,e?e.store.getState:q0,n,p1e)}function m1e(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function g1e(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function y1e(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var QF=t=>Array.isArray(t)?t:[t];function v1e(t){const e=Array.isArray(t[0])?t[0]:t;return y1e(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function x1e(t,e){const n=[],{length:r}=t;for(let s=0;s<r;s++)n.push(t[s].apply(null,e));return n}var b1e=class{constructor(t){this.value=t}deref(){return this.value}},w1e=typeof WeakRef<"u"?WeakRef:b1e,N1e=0,XF=1;function t0(){return{s:N1e,v:void 0,o:null,p:null}}function $8(t,e={}){let n=t0();const{resultEqualityCheck:r}=e;let s,i=0;function a(){var h;let l=n;const{length:c}=arguments;for(let f=0,p=c;f<p;f++){const m=arguments[f];if(typeof m=="function"||typeof m=="object"&&m!==null){let g=l.o;g===null&&(l.o=g=new WeakMap);const y=g.get(m);y===void 0?(l=t0(),g.set(m,l)):l=y}else{let g=l.p;g===null&&(l.p=g=new Map);const y=g.get(m);y===void 0?(l=t0(),g.set(m,l)):l=y}}const u=l;let d;if(l.s===XF)d=l.v;else if(d=t.apply(null,arguments),i++,r){const f=((h=s==null?void 0:s.deref)==null?void 0:h.call(s))??s;f!=null&&r(f,d)&&(d=f,i!==0&&i--),s=typeof d=="object"&&d!==null||typeof d=="function"?new w1e(d):d}return u.s=XF,u.v=d,d}return a.clearCache=()=>{n=t0(),a.resetResultsCount()},a.resultsCount=()=>i,a.resetResultsCount=()=>{i=0},a}function S1e(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...s)=>{let i=0,a=0,l,c={},u=s.pop();typeof u=="object"&&(c=u,u=s.pop()),m1e(u,`createSelector expects an output function after the inputs, but received: [${typeof u}]`);const d={...n,...c},{memoize:h,memoizeOptions:f=[],argsMemoize:p=$8,argsMemoizeOptions:m=[]}=d,g=QF(f),y=QF(m),x=v1e(s),w=h(function(){return i++,u.apply(null,arguments)},...g),N=p(function(){a++;const C=x1e(x,arguments);return l=w.apply(null,C),l},...y);return Object.assign(N,{resultFunc:u,memoizedResultFunc:w,dependencies:x,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>l,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:h,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var ce=S1e($8),_1e=Object.assign((t,e=ce)=>{g1e(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(i=>t[i]);return e(r,(...i)=>i.reduce((a,l,c)=>(a[n[c]]=l,a),{}))},{withTypes:()=>_1e}),U8={},z8={},H8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="symbol"?1:r===null?2:r===void 0?3:r!==r?4:0}const n=(r,s,i)=>{if(r!==s){const a=e(r),l=e(s);if(a===l&&a===0){if(r<s)return i==="desc"?1:-1;if(r>s)return i==="desc"?-1:1}return i==="desc"?l-a:a-l}return 0};t.compareValues=n})(H8);var W8={},RP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="symbol"||n instanceof Symbol}t.isSymbol=e})(RP);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=RP,n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function s(i,a){return Array.isArray(i)?!1:typeof i=="number"||typeof i=="boolean"||i==null||e.isSymbol(i)?!0:typeof i=="string"&&(r.test(i)||!n.test(i))||a!=null&&Object.hasOwn(a,i)}t.isKey=s})(W8);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=H8,n=W8,r=nS;function s(i,a,l,c){if(i==null)return[];l=c?void 0:l,Array.isArray(i)||(i=Object.values(i)),Array.isArray(a)||(a=a==null?[null]:[a]),a.length===0&&(a=[null]),Array.isArray(l)||(l=l==null?[]:[l]),l=l.map(p=>String(p));const u=(p,m)=>{let g=p;for(let y=0;y<m.length&&g!=null;++y)g=g[m[y]];return g},d=(p,m)=>m==null||p==null?m:typeof p=="object"&&"key"in p?Object.hasOwn(m,p.key)?m[p.key]:u(m,p.path):typeof p=="function"?p(m):Array.isArray(p)?u(m,p):typeof m=="object"?m[p]:m,h=a.map(p=>(Array.isArray(p)&&p.length===1&&(p=p[0]),p==null||typeof p=="function"||Array.isArray(p)||n.isKey(p)?p:{key:p,path:r.toPath(p)}));return i.map(p=>({original:p,criteria:h.map(m=>d(m,p))})).slice().sort((p,m)=>{for(let g=0;g<h.length;g++){const y=e.compareValues(p.criteria[g],m.criteria[g],l[g]);if(y!==0)return y}return 0}).map(p=>p.original)}t.orderBy=s})(z8);var q8={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r=1){const s=[],i=Math.floor(r),a=(l,c)=>{for(let u=0;u<l.length;u++){const d=l[u];Array.isArray(d)&&c<i?a(d,c+1):s.push(d)}};return a(n,0),s}t.flatten=e})(q8);var MP={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=OP,n=rS,r=TP,s=kP;function i(a,l,c){return r.isObject(c)&&(typeof l=="number"&&n.isArrayLike(c)&&e.isIndex(l)&&l<c.length||typeof l=="string"&&l in c)?s.isEqualsSameValueZero(c[l],a):!1}t.isIterateeCall=i})(MP);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=z8,n=q8,r=MP;function s(i,...a){const l=a.length;return l>1&&r.isIterateeCall(i,a[0],a[1])?a=[]:l>2&&r.isIterateeCall(a[0],a[1],a[2])&&(a=[a[0]]),e.orderBy(i,n.flatten(a),["asc"])}t.sortBy=s})(U8);var j1e=U8.sortBy;const aS=Bo(j1e);var G8=t=>t.legend.settings,E1e=t=>t.legend.size,C1e=t=>t.legend.payload;ce([C1e,G8],(t,e)=>{var{itemSorter:n}=e,r=t.flat(1);return n?aS(r,n):r});var n0=1;function T1e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[e,n]=b.useState({height:0,left:0,top:0,width:0}),r=b.useCallback(s=>{if(s!=null){var i=s.getBoundingClientRect(),a={height:i.height,left:i.left,top:i.top,width:i.width};(Math.abs(a.height-e.height)>n0||Math.abs(a.left-e.left)>n0||Math.abs(a.top-e.top)>n0||Math.abs(a.width-e.width)>n0)&&n({height:a.height,left:a.left,top:a.top,width:a.width})}},[e.width,e.height,e.top,e.left,...t]);return[e,r]}function rs(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var A1e=typeof Symbol=="function"&&Symbol.observable||"@@observable",JF=A1e,Dj=()=>Math.random().toString(36).substring(7).split("").join("."),k1e={INIT:`@@redux/INIT${Dj()}`,REPLACE:`@@redux/REPLACE${Dj()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Dj()}`},Gw=k1e;function LP(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function K8(t,e,n){if(typeof t!="function")throw new Error(rs(2));if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(rs(0));if(typeof e=="function"&&typeof n>"u"&&(n=e,e=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(rs(1));return n(K8)(t,e)}let r=t,s=e,i=new Map,a=i,l=0,c=!1;function u(){a===i&&(a=new Map,i.forEach((y,x)=>{a.set(x,y)}))}function d(){if(c)throw new Error(rs(3));return s}function h(y){if(typeof y!="function")throw new Error(rs(4));if(c)throw new Error(rs(5));let x=!0;u();const w=l++;return a.set(w,y),function(){if(x){if(c)throw new Error(rs(6));x=!1,u(),a.delete(w),i=null}}}function f(y){if(!LP(y))throw new Error(rs(7));if(typeof y.type>"u")throw new Error(rs(8));if(typeof y.type!="string")throw new Error(rs(17));if(c)throw new Error(rs(9));try{c=!0,s=r(s,y)}finally{c=!1}return(i=a).forEach(w=>{w()}),y}function p(y){if(typeof y!="function")throw new Error(rs(10));r=y,f({type:Gw.REPLACE})}function m(){const y=h;return{subscribe(x){if(typeof x!="object"||x===null)throw new Error(rs(11));function w(){const S=x;S.next&&S.next(d())}return w(),{unsubscribe:y(w)}},[JF](){return this}}}return f({type:Gw.INIT}),{dispatch:f,subscribe:h,getState:d,replaceReducer:p,[JF]:m}}function I1e(t){Object.keys(t).forEach(e=>{const n=t[e];if(typeof n(void 0,{type:Gw.INIT})>"u")throw new Error(rs(12));if(typeof n(void 0,{type:Gw.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(rs(13))})}function Y8(t){const e=Object.keys(t),n={};for(let i=0;i<e.length;i++){const a=e[i];typeof t[a]=="function"&&(n[a]=t[a])}const r=Object.keys(n);let s;try{I1e(n)}catch(i){s=i}return function(a={},l){if(s)throw s;let c=!1;const u={};for(let d=0;d<r.length;d++){const h=r[d],f=n[h],p=a[h],m=f(p,l);if(typeof m>"u")throw l&&l.type,new Error(rs(14));u[h]=m,c=c||m!==p}return c=c||r.length!==Object.keys(a).length,c?u:a}}function Kw(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,n)=>(...r)=>e(n(...r)))}function P1e(...t){return e=>(n,r)=>{const s=e(n,r);let i=()=>{throw new Error(rs(15))};const a={getState:s.getState,dispatch:(c,...u)=>i(c,...u)},l=t.map(c=>c(a));return i=Kw(...l)(s.dispatch),{...s,dispatch:i}}}function Q8(t){return LP(t)&&"type"in t&&typeof t.type=="string"}var X8=Symbol.for("immer-nothing"),ZF=Symbol.for("immer-draftable"),Ys=Symbol.for("immer-state");function Va(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Fi=Object,wp=Fi.getPrototypeOf,Yw="constructor",oS="prototype",yT="configurable",Qw="enumerable",G0="writable",Py="value",Dl=t=>!!t&&!!t[Ys];function Ja(t){var e;return t?J8(t)||cS(t)||!!t[ZF]||!!((e=t[Yw])!=null&&e[ZF])||uS(t)||dS(t):!1}var O1e=Fi[oS][Yw].toString(),eB=new WeakMap;function J8(t){if(!t||!FP(t))return!1;const e=wp(t);if(e===null||e===Fi[oS])return!0;const n=Fi.hasOwnProperty.call(e,Yw)&&e[Yw];if(n===Object)return!0;if(!Zh(n))return!1;let r=eB.get(n);return r===void 0&&(r=Function.toString.call(n),eB.set(n,r)),r===O1e}function lS(t,e,n=!0){Dv(t)===0?(n?Reflect.ownKeys(t):Fi.keys(t)).forEach(s=>{e(s,t[s],t)}):t.forEach((r,s)=>e(s,r,t))}function Dv(t){const e=t[Ys];return e?e.type_:cS(t)?1:uS(t)?2:dS(t)?3:0}var tB=(t,e,n=Dv(t))=>n===2?t.has(e):Fi[oS].hasOwnProperty.call(t,e),vT=(t,e,n=Dv(t))=>n===2?t.get(e):t[e],Xw=(t,e,n,r=Dv(t))=>{r===2?t.set(e,n):r===3?t.add(n):t[e]=n};function D1e(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}var cS=Array.isArray,uS=t=>t instanceof Map,dS=t=>t instanceof Set,FP=t=>typeof t=="object",Zh=t=>typeof t=="function",Rj=t=>typeof t=="boolean";function R1e(t){const e=+t;return Number.isInteger(e)&&String(e)===t}var nl=t=>t.copy_||t.base_,BP=t=>t.modified_?t.copy_:t.base_;function xT(t,e){if(uS(t))return new Map(t);if(dS(t))return new Set(t);if(cS(t))return Array[oS].slice.call(t);const n=J8(t);if(e===!0||e==="class_only"&&!n){const r=Fi.getOwnPropertyDescriptors(t);delete r[Ys];let s=Reflect.ownKeys(r);for(let i=0;i<s.length;i++){const a=s[i],l=r[a];l[G0]===!1&&(l[G0]=!0,l[yT]=!0),(l.get||l.set)&&(r[a]={[yT]:!0,[G0]:!0,[Qw]:l[Qw],[Py]:t[a]})}return Fi.create(wp(t),r)}else{const r=wp(t);if(r!==null&&n)return{...t};const s=Fi.create(r);return Fi.assign(s,t)}}function VP(t,e=!1){return hS(t)||Dl(t)||!Ja(t)||(Dv(t)>1&&Fi.defineProperties(t,{set:r0,add:r0,clear:r0,delete:r0}),Fi.freeze(t),e&&lS(t,(n,r)=>{VP(r,!0)},!1)),t}function M1e(){Va(2)}var r0={[Py]:M1e};function hS(t){return t===null||!FP(t)?!0:Fi.isFrozen(t)}var Jw="MapSet",bT="Patches",nB="ArrayMethods",Z8={};function lh(t){const e=Z8[t];return e||Va(0,t),e}var rB=t=>!!Z8[t],Oy,eG=()=>Oy,L1e=(t,e)=>({drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:rB(Jw)?lh(Jw):void 0,arrayMethodsPlugin_:rB(nB)?lh(nB):void 0});function sB(t,e){e&&(t.patchPlugin_=lh(bT),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function wT(t){NT(t),t.drafts_.forEach(F1e),t.drafts_=null}function NT(t){t===Oy&&(Oy=t.parent_)}var iB=t=>Oy=L1e(Oy,t);function F1e(t){const e=t[Ys];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function aB(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];if(t!==void 0&&t!==n){n[Ys].modified_&&(wT(e),Va(4)),Ja(t)&&(t=oB(e,t));const{patchPlugin_:s}=e;s&&s.generateReplacementPatches_(n[Ys].base_,t,e)}else t=oB(e,n);return B1e(e,t,!0),wT(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==X8?t:void 0}function oB(t,e){if(hS(e))return e;const n=e[Ys];if(!n)return Zw(e,t.handledSet_,t);if(!fS(n,t))return e;if(!n.modified_)return n.base_;if(!n.finalized_){const{callbacks_:r}=n;if(r)for(;r.length>0;)r.pop()(t);rG(n,t)}return n.copy_}function B1e(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&VP(e,n)}function tG(t){t.finalized_=!0,t.scope_.unfinalizedDrafts_--}var fS=(t,e)=>t.scope_===e,V1e=[];function nG(t,e,n,r){const s=nl(t),i=t.type_;if(r!==void 0&&vT(s,r,i)===e){Xw(s,r,n,i);return}if(!t.draftLocations_){const l=t.draftLocations_=new Map;lS(s,(c,u)=>{if(Dl(u)){const d=l.get(u)||[];d.push(c),l.set(u,d)}})}const a=t.draftLocations_.get(e)??V1e;for(const l of a)Xw(s,l,n,i)}function $1e(t,e,n){t.callbacks_.push(function(s){var l;const i=e;if(!i||!fS(i,s))return;(l=s.mapSetPlugin_)==null||l.fixSetContents(i);const a=BP(i);nG(t,i.draft_??i,a,n),rG(i,s)})}function rG(t,e){var r;if(t.modified_&&!t.finalized_&&(t.type_===3||t.type_===1&&t.allIndicesReassigned_||(((r=t.assigned_)==null?void 0:r.size)??0)>0)){const{patchPlugin_:s}=e;if(s){const i=s.getPath(t);i&&s.generatePatches_(t,i,e)}tG(t)}}function U1e(t,e,n){const{scope_:r}=t;if(Dl(n)){const s=n[Ys];fS(s,r)&&s.callbacks_.push(function(){K0(t);const a=BP(s);nG(t,n,a,e)})}else Ja(n)&&t.callbacks_.push(function(){const i=nl(t);t.type_===3?i.has(n)&&Zw(n,r.handledSet_,r):vT(i,e,t.type_)===n&&r.drafts_.length>1&&(t.assigned_.get(e)??!1)===!0&&t.copy_&&Zw(vT(t.copy_,e,t.type_),r.handledSet_,r)})}function Zw(t,e,n){return!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||Dl(t)||e.has(t)||!Ja(t)||hS(t)||(e.add(t),lS(t,(r,s)=>{if(Dl(s)){const i=s[Ys];if(fS(i,n)){const a=BP(i);Xw(t,r,a,t.type_),tG(i)}}else Ja(s)&&Zw(s,e,n)})),t}function z1e(t,e){const n=cS(t),r={type_:n?1:0,scope_:e?e.scope_:eG(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let s=r,i=e1;n&&(s=[r],i=Dy);const{revoke:a,proxy:l}=Proxy.revocable(s,i);return r.draft_=l,r.revoke_=a,[l,r]}var e1={get(t,e){if(e===Ys)return t;let n=t.scope_.arrayMethodsPlugin_;const r=t.type_===1&&typeof e=="string";if(r&&n!=null&&n.isArrayOperationMethod(e))return n.createMethodInterceptor(t,e);const s=nl(t);if(!tB(s,e,t.type_))return H1e(t,s,e);const i=s[e];if(t.finalized_||!Ja(i)||r&&t.operationMethod&&(n!=null&&n.isMutatingArrayMethod(t.operationMethod))&&R1e(e))return i;if(i===Mj(t.base_,e)){K0(t);const a=t.type_===1?+e:e,l=_T(t.scope_,i,t,a);return t.copy_[a]=l}return i},has(t,e){return e in nl(t)},ownKeys(t){return Reflect.ownKeys(nl(t))},set(t,e,n){const r=sG(nl(t),e);if(r!=null&&r.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const s=Mj(nl(t),e),i=s==null?void 0:s[Ys];if(i&&i.base_===n)return t.copy_[e]=n,t.assigned_.set(e,!1),!0;if(D1e(n,s)&&(n!==void 0||tB(t.base_,e,t.type_)))return!0;K0(t),ST(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_.set(e,!0),U1e(t,e,n)),!0},deleteProperty(t,e){return K0(t),Mj(t.base_,e)!==void 0||e in t.base_?(t.assigned_.set(e,!1),ST(t)):t.assigned_.delete(e),t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=nl(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{[G0]:!0,[yT]:t.type_!==1||e!=="length",[Qw]:r[Qw],[Py]:n[e]}},defineProperty(){Va(11)},getPrototypeOf(t){return wp(t.base_)},setPrototypeOf(){Va(12)}},Dy={};for(let t in e1){let e=e1[t];Dy[t]=function(){const n=arguments;return n[0]=n[0][0],e.apply(this,n)}}Dy.deleteProperty=function(t,e){return Dy.set.call(this,t,e,void 0)};Dy.set=function(t,e,n){return e1.set.call(this,t[0],e,n,t[0])};function Mj(t,e){const n=t[Ys];return(n?nl(n):t)[e]}function H1e(t,e,n){var s;const r=sG(e,n);return r?Py in r?r[Py]:(s=r.get)==null?void 0:s.call(t.draft_):void 0}function sG(t,e){if(!(e in t))return;let n=wp(t);for(;n;){const r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=wp(n)}}function ST(t){t.modified_||(t.modified_=!0,t.parent_&&ST(t.parent_))}function K0(t){t.copy_||(t.assigned_=new Map,t.copy_=xT(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var W1e=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(n,r,s)=>{if(Zh(n)&&!Zh(r)){const a=r;r=n;const l=this;return function(u=a,...d){return l.produce(u,h=>r.call(this,h,...d))}}Zh(r)||Va(6),s!==void 0&&!Zh(s)&&Va(7);let i;if(Ja(n)){const a=iB(this),l=_T(a,n,void 0);let c=!0;try{i=r(l),c=!1}finally{c?wT(a):NT(a)}return sB(a,s),aB(i,a)}else if(!n||!FP(n)){if(i=r(n),i===void 0&&(i=n),i===X8&&(i=void 0),this.autoFreeze_&&VP(i,!0),s){const a=[],l=[];lh(bT).generateReplacementPatches_(n,i,{patches_:a,inversePatches_:l}),s(a,l)}return i}else Va(1,n)},this.produceWithPatches=(n,r)=>{if(Zh(n))return(l,...c)=>this.produceWithPatches(l,u=>n(u,...c));let s,i;return[this.produce(n,r,(l,c)=>{s=l,i=c}),s,i]},Rj(e==null?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),Rj(e==null?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),Rj(e==null?void 0:e.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){Ja(e)||Va(8),Dl(e)&&(e=Ga(e));const n=iB(this),r=_T(n,e,void 0);return r[Ys].isManual_=!0,NT(n),r}finishDraft(e,n){const r=e&&e[Ys];(!r||!r.isManual_)&&Va(9);const{scope_:s}=r;return sB(s,n),aB(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,n){let r;for(r=n.length-1;r>=0;r--){const i=n[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(n=n.slice(r+1));const s=lh(bT).applyPatches_;return Dl(e)?s(e,n):this.produce(e,i=>s(i,n))}};function _T(t,e,n,r){const[s,i]=uS(e)?lh(Jw).proxyMap_(e,n):dS(e)?lh(Jw).proxySet_(e,n):z1e(e,n);return((n==null?void 0:n.scope_)??eG()).drafts_.push(s),i.callbacks_=(n==null?void 0:n.callbacks_)??[],i.key_=r,n&&r!==void 0?$1e(n,i,r):i.callbacks_.push(function(c){var d;(d=c.mapSetPlugin_)==null||d.fixSetContents(i);const{patchPlugin_:u}=c;i.modified_&&u&&u.generatePatches_(i,[],c)}),s}function Ga(t){return Dl(t)||Va(10,t),iG(t)}function iG(t){if(!Ja(t)||hS(t))return t;const e=t[Ys];let n,r=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=xT(t,e.scope_.immer_.useStrictShallowCopy_),r=e.scope_.immer_.shouldUseStrictIteration()}else n=xT(t,!0);return lS(n,(s,i)=>{Xw(n,s,iG(i))},r),e&&(e.finalized_=!1),n}var q1e=new W1e,aG=q1e.produce;function oG(t){return({dispatch:n,getState:r})=>s=>i=>typeof i=="function"?i(n,r,t):s(i)}var G1e=oG(),K1e=oG,Y1e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Kw:Kw.apply(null,arguments)};function Aa(t,e){function n(...r){if(e){let s=e(...r);if(!s)throw new Error($i(0));return{type:t,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:t,payload:r[0]}}return n.toString=()=>`${t}`,n.type=t,n.match=r=>Q8(r)&&r.type===t,n}var lG=class ng extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ng.prototype)}static get[Symbol.species](){return ng}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new ng(...e[0].concat(this)):new ng(...e.concat(this))}};function lB(t){return Ja(t)?aG(t,()=>{}):t}function s0(t,e,n){return t.has(e)?t.get(e):t.set(e,n(e)).get(e)}function Q1e(t){return typeof t=="boolean"}var X1e=()=>function(e){const{thunk:n=!0,immutableCheck:r=!0,serializableCheck:s=!0,actionCreatorCheck:i=!0}=e??{};let a=new lG;return n&&(Q1e(n)?a.push(G1e):a.push(K1e(n.extraArgument))),a},cG="RTK_autoBatch",En=()=>t=>({payload:t,meta:{[cG]:!0}}),cB=t=>e=>{setTimeout(e,t)},uG=(t={type:"raf"})=>e=>(...n)=>{const r=e(...n);let s=!0,i=!1,a=!1;const l=new Set,c=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:cB(10):t.type==="callback"?t.queueNotification:cB(t.timeout),u=()=>{a=!1,i&&(i=!1,l.forEach(d=>d()))};return Object.assign({},r,{subscribe(d){const h=()=>s&&d(),f=r.subscribe(h);return l.add(d),()=>{f(),l.delete(d)}},dispatch(d){var h;try{return s=!((h=d==null?void 0:d.meta)!=null&&h[cG]),i=!s,i&&(a||(a=!0,c(u))),r.dispatch(d)}finally{s=!0}}})},J1e=t=>function(n){const{autoBatch:r=!0}=n??{};let s=new lG(t);return r&&s.push(uG(typeof r=="object"?r:void 0)),s};function Z1e(t){const e=X1e(),{reducer:n=void 0,middleware:r,devTools:s=!0,preloadedState:i=void 0,enhancers:a=void 0}=t||{};let l;if(typeof n=="function")l=n;else if(LP(n))l=Y8(n);else throw new Error($i(1));let c;typeof r=="function"?c=r(e):c=e();let u=Kw;s&&(u=Y1e({trace:!1,...typeof s=="object"&&s}));const d=P1e(...c),h=J1e(d);let f=typeof a=="function"?a(h):h();const p=u(...f);return K8(l,i,p)}function dG(t){const e={},n=[];let r;const s={addCase(i,a){const l=typeof i=="string"?i:i.type;if(!l)throw new Error($i(28));if(l in e)throw new Error($i(29));return e[l]=a,s},addAsyncThunk(i,a){return a.pending&&(e[i.pending.type]=a.pending),a.rejected&&(e[i.rejected.type]=a.rejected),a.fulfilled&&(e[i.fulfilled.type]=a.fulfilled),a.settled&&n.push({matcher:i.settled,reducer:a.settled}),s},addMatcher(i,a){return n.push({matcher:i,reducer:a}),s},addDefaultCase(i){return r=i,s}};return t(s),[e,n,r]}function eNe(t){return typeof t=="function"}function tNe(t,e){let[n,r,s]=dG(e),i;if(eNe(t))i=()=>lB(t());else{const l=lB(t);i=()=>l}function a(l=i(),c){let u=[n[c.type],...r.filter(({matcher:d})=>d(c)).map(({reducer:d})=>d)];return u.filter(d=>!!d).length===0&&(u=[s]),u.reduce((d,h)=>{if(h)if(Dl(d)){const p=h(d,c);return p===void 0?d:p}else{if(Ja(d))return aG(d,f=>h(f,c));{const f=h(d,c);if(f===void 0){if(d===null)return d;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return d},l)}return a.getInitialState=i,a}var nNe="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",rNe=(t=21)=>{let e="",n=t;for(;n--;)e+=nNe[Math.random()*64|0];return e},sNe=Symbol.for("rtk-slice-createasyncthunk");function iNe(t,e){return`${t}/${e}`}function aNe({creators:t}={}){var n;const e=(n=t==null?void 0:t.asyncThunk)==null?void 0:n[sNe];return function(s){const{name:i,reducerPath:a=i}=s;if(!i)throw new Error($i(11));const l=(typeof s.reducers=="function"?s.reducers(lNe()):s.reducers)||{},c=Object.keys(l),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},d={addCase(S,C){const A=typeof S=="string"?S:S.type;if(!A)throw new Error($i(12));if(A in u.sliceCaseReducersByType)throw new Error($i(13));return u.sliceCaseReducersByType[A]=C,d},addMatcher(S,C){return u.sliceMatchers.push({matcher:S,reducer:C}),d},exposeAction(S,C){return u.actionCreators[S]=C,d},exposeCaseReducer(S,C){return u.sliceCaseReducersByName[S]=C,d}};c.forEach(S=>{const C=l[S],A={reducerName:S,type:iNe(i,S),createNotation:typeof s.reducers=="function"};uNe(C)?hNe(A,C,d,e):cNe(A,C,d)});function h(){const[S={},C=[],A=void 0]=typeof s.extraReducers=="function"?dG(s.extraReducers):[s.extraReducers],j={...S,...u.sliceCaseReducersByType};return tNe(s.initialState,_=>{for(let E in j)_.addCase(E,j[E]);for(let E of u.sliceMatchers)_.addMatcher(E.matcher,E.reducer);for(let E of C)_.addMatcher(E.matcher,E.reducer);A&&_.addDefaultCase(A)})}const f=S=>S,p=new Map,m=new WeakMap;let g;function y(S,C){return g||(g=h()),g(S,C)}function x(){return g||(g=h()),g.getInitialState()}function w(S,C=!1){function A(_){let E=_[S];return typeof E>"u"&&C&&(E=s0(m,A,x)),E}function j(_=f){const E=s0(p,C,()=>new WeakMap);return s0(E,_,()=>{const I={};for(const[T,P]of Object.entries(s.selectors??{}))I[T]=oNe(P,_,()=>s0(m,_,x),C);return I})}return{reducerPath:S,getSelectors:j,get selectors(){return j(A)},selectSlice:A}}const N={name:i,reducer:y,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:x,...w(a),injectInto(S,{reducerPath:C,...A}={}){const j=C??a;return S.inject({reducerPath:j,reducer:y},A),{...N,...w(j,!0)}}};return N}}function oNe(t,e,n,r){function s(i,...a){let l=e(i);return typeof l>"u"&&r&&(l=n()),t(l,...a)}return s.unwrapped=t,s}var _i=aNe();function lNe(){function t(e,n){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...n}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...n){return e(...n)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,n){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:n}},asyncThunk:t}}function cNe({type:t,reducerName:e,createNotation:n},r,s){let i,a;if("reducer"in r){if(n&&!dNe(r))throw new Error($i(17));i=r.reducer,a=r.prepare}else i=r;s.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,a?Aa(t,a):Aa(t))}function uNe(t){return t._reducerDefinitionType==="asyncThunk"}function dNe(t){return t._reducerDefinitionType==="reducerWithPrepare"}function hNe({type:t,reducerName:e},n,r,s){if(!s)throw new Error($i(18));const{payloadCreator:i,fulfilled:a,pending:l,rejected:c,settled:u,options:d}=n,h=s(t,i,d);r.exposeAction(e,h),a&&r.addCase(h.fulfilled,a),l&&r.addCase(h.pending,l),c&&r.addCase(h.rejected,c),u&&r.addMatcher(h.settled,u),r.exposeCaseReducer(e,{fulfilled:a||i0,pending:l||i0,rejected:c||i0,settled:u||i0})}function i0(){}var fNe="task",hG="listener",fG="completed",$P="cancelled",pNe=`task-${$P}`,mNe=`task-${fG}`,jT=`${hG}-${$P}`,gNe=`${hG}-${fG}`,pS=class{constructor(t){n_(this,"name","TaskAbortError");n_(this,"message");this.code=t,this.message=`${fNe} ${$P} (reason: ${t})`}},UP=(t,e)=>{if(typeof t!="function")throw new TypeError($i(32))},t1=()=>{},pG=(t,e=t1)=>(t.catch(e),t),mG=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),Ad=t=>{if(t.aborted)throw new pS(t.reason)};function gG(t,e){let n=t1;return new Promise((r,s)=>{const i=()=>s(new pS(t.reason));if(t.aborted){i();return}n=mG(t,i),e.finally(()=>n()).then(r,s)}).finally(()=>{n=t1})}var yNe=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(n){return{status:n instanceof pS?"cancelled":"rejected",error:n}}finally{e==null||e()}},n1=t=>e=>pG(gG(t,e).then(n=>(Ad(t),n))),yG=t=>{const e=n1(t);return n=>e(new Promise(r=>setTimeout(r,n)))},{assign:Rf}=Object,uB={},mS="listenerMiddleware",vNe=(t,e)=>{const n=r=>mG(t,()=>r.abort(t.reason));return(r,s)=>{UP(r);const i=new AbortController;n(i);const a=yNe(async()=>{Ad(t),Ad(i.signal);const l=await r({pause:n1(i.signal),delay:yG(i.signal),signal:i.signal});return Ad(i.signal),l},()=>i.abort(mNe));return s!=null&&s.autoJoin&&e.push(a.catch(t1)),{result:n1(t)(a),cancel(){i.abort(pNe)}}}},xNe=(t,e)=>{const n=async(r,s)=>{Ad(e);let i=()=>{};const l=[new Promise((c,u)=>{let d=t({predicate:r,effect:(h,f)=>{f.unsubscribe(),c([h,f.getState(),f.getOriginalState()])}});i=()=>{d(),u()}})];s!=null&&l.push(new Promise(c=>setTimeout(c,s,null)));try{const c=await gG(e,Promise.race(l));return Ad(e),c}finally{i()}};return(r,s)=>pG(n(r,s))},vG=t=>{let{type:e,actionCreator:n,matcher:r,predicate:s,effect:i}=t;if(e)s=Aa(e).match;else if(n)e=n.type,s=n.match;else if(r)s=r;else if(!s)throw new Error($i(21));return UP(i),{predicate:s,type:e,effect:i}},xG=Rf(t=>{const{type:e,predicate:n,effect:r}=vG(t);return{id:rNe(),effect:r,type:e,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error($i(22))}}},{withTypes:()=>xG}),dB=(t,e)=>{const{type:n,effect:r,predicate:s}=vG(e);return Array.from(t.values()).find(i=>(typeof n=="string"?i.type===n:i.predicate===s)&&i.effect===r)},ET=t=>{t.pending.forEach(e=>{e.abort(jT)})},bNe=(t,e)=>()=>{for(const n of e.keys())ET(n);t.clear()},hB=(t,e,n)=>{try{t(e,n)}catch(r){setTimeout(()=>{throw r},0)}},bG=Rf(Aa(`${mS}/add`),{withTypes:()=>bG}),wNe=Aa(`${mS}/removeAll`),wG=Rf(Aa(`${mS}/remove`),{withTypes:()=>wG}),NNe=(...t)=>{console.error(`${mS}/error`,...t)},Rv=(t={})=>{const e=new Map,n=new Map,r=p=>{const m=n.get(p)??0;n.set(p,m+1)},s=p=>{const m=n.get(p)??1;m===1?n.delete(p):n.set(p,m-1)},{extra:i,onError:a=NNe}=t;UP(a);const l=p=>(p.unsubscribe=()=>e.delete(p.id),e.set(p.id,p),m=>{p.unsubscribe(),m!=null&&m.cancelActive&&ET(p)}),c=p=>{const m=dB(e,p)??xG(p);return l(m)};Rf(c,{withTypes:()=>c});const u=p=>{const m=dB(e,p);return m&&(m.unsubscribe(),p.cancelActive&&ET(m)),!!m};Rf(u,{withTypes:()=>u});const d=async(p,m,g,y)=>{const x=new AbortController,w=xNe(c,x.signal),N=[];try{p.pending.add(x),r(p),await Promise.resolve(p.effect(m,Rf({},g,{getOriginalState:y,condition:(S,C)=>w(S,C).then(Boolean),take:w,delay:yG(x.signal),pause:n1(x.signal),extra:i,signal:x.signal,fork:vNe(x.signal,N),unsubscribe:p.unsubscribe,subscribe:()=>{e.set(p.id,p)},cancelActiveListeners:()=>{p.pending.forEach((S,C,A)=>{S!==x&&(S.abort(jT),A.delete(S))})},cancel:()=>{x.abort(jT),p.pending.delete(x)},throwIfCancelled:()=>{Ad(x.signal)}})))}catch(S){S instanceof pS||hB(a,S,{raisedBy:"effect"})}finally{await Promise.all(N),x.abort(gNe),s(p),p.pending.delete(x)}},h=bNe(e,n);return{middleware:p=>m=>g=>{if(!Q8(g))return m(g);if(bG.match(g))return c(g.payload);if(wNe.match(g)){h();return}if(wG.match(g))return u(g.payload);let y=p.getState();const x=()=>{if(y===uB)throw new Error($i(23));return y};let w;try{if(w=m(g),e.size>0){const N=p.getState(),S=Array.from(e.values());for(const C of S){let A=!1;try{A=C.predicate(g,N,y)}catch(j){A=!1,hB(a,j,{raisedBy:"predicate"})}A&&d(C,g,p,x)}}}finally{y=uB}return w},startListening:c,stopListening:u,clearListeners:h}};function $i(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var SNe={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},NG=_i({name:"chartLayout",initialState:SNe,reducers:{setLayout(t,e){t.layoutType=e.payload},setChartSize(t,e){t.width=e.payload.width,t.height=e.payload.height},setMargin(t,e){var n,r,s,i;t.margin.top=(n=e.payload.top)!==null&&n!==void 0?n:0,t.margin.right=(r=e.payload.right)!==null&&r!==void 0?r:0,t.margin.bottom=(s=e.payload.bottom)!==null&&s!==void 0?s:0,t.margin.left=(i=e.payload.left)!==null&&i!==void 0?i:0},setScale(t,e){t.scale=e.payload}}}),{setMargin:_Ne,setLayout:jNe,setChartSize:ENe,setScale:CNe}=NG.actions,TNe=NG.reducer;function SG(t,e,n){return Array.isArray(t)&&t&&e+n!==0?t.slice(e,n+1):t}function Ct(t){return Number.isFinite(t)}function Lo(t){return typeof t=="number"&&t>0&&Number.isFinite(t)}function fB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function yf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fB(Object(n),!0).forEach(function(r){ANe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ANe(t,e,n){return(e=kNe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kNe(t){var e=INe(t,"string");return typeof e=="symbol"?e:e+""}function INe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Er(t,e,n){return dr(t)||dr(e)?n:Ta(e)?xp(t,e,n):typeof e=="function"?e(t):n}var PNe=(t,e,n)=>{if(e&&n){var{width:r,height:s}=n,{align:i,verticalAlign:a,layout:l}=e;if((l==="vertical"||l==="horizontal"&&a==="middle")&&i!=="center"&&tt(t[i]))return yf(yf({},t),{},{[i]:t[i]+(r||0)});if((l==="horizontal"||l==="vertical"&&i==="center")&&a!=="middle"&&tt(t[a]))return yf(yf({},t),{},{[a]:t[a]+(s||0)})}return t},Lu=(t,e)=>t==="horizontal"&&e==="xAxis"||t==="vertical"&&e==="yAxis"||t==="centric"&&e==="angleAxis"||t==="radial"&&e==="radiusAxis",_G=(t,e,n,r)=>{if(r)return t.map(l=>l.coordinate);var s,i,a=t.map(l=>(l.coordinate===e&&(s=!0),l.coordinate===n&&(i=!0),l.coordinate));return s||a.push(e),i||a.push(n),a},jG=(t,e,n)=>{if(!t)return null;var{duplicateDomain:r,type:s,range:i,scale:a,realScaleType:l,isCategorical:c,categoricalDomain:u,tickCount:d,ticks:h,niceTicks:f,axisType:p}=t;if(!a)return null;var m=l==="scaleBand"&&a.bandwidth?a.bandwidth()/2:2,g=s==="category"&&a.bandwidth?a.bandwidth()/m:0;if(g=p==="angleAxis"&&i&&i.length>=2?ga(i[0]-i[1])*2*g:g,h||f){var y=(h||f||[]).map((x,w)=>{var N=r?r.indexOf(x):x,S=a.map(N);return Ct(S)?{coordinate:S+g,value:x,offset:g,index:w}:null}).filter(mi);return y}return c&&u?u.map((x,w)=>{var N=a.map(x);return Ct(N)?{coordinate:N+g,value:x,index:w,offset:g}:null}).filter(mi):a.ticks&&d!=null?a.ticks(d).map((x,w)=>{var N=a.map(x);return Ct(N)?{coordinate:N+g,value:x,index:w,offset:g}:null}).filter(mi):a.domain().map((x,w)=>{var N=a.map(x);return Ct(N)?{coordinate:N+g,value:r?r[x]:x,index:w,offset:g}:null}).filter(mi)},ONe=t=>{var e,n=t.length;if(!(n<=0)){var r=(e=t[0])===null||e===void 0?void 0:e.length;if(!(r==null||r<=0))for(var s=0;s<r;++s)for(var i=0,a=0,l=0;l<n;++l){var c=t[l],u=c==null?void 0:c[s];if(u!=null){var d=u[1],h=u[0],f=Ol(d)?h:d;f>=0?(u[0]=i,i+=f,u[1]=i):(u[0]=a,a+=f,u[1]=a)}}}},DNe=t=>{var e,n=t.length;if(!(n<=0)){var r=(e=t[0])===null||e===void 0?void 0:e.length;if(!(r==null||r<=0))for(var s=0;s<r;++s)for(var i=0,a=0;a<n;++a){var l=t[a],c=l==null?void 0:l[s];if(c!=null){var u=Ol(c[1])?c[0]:c[1];u>=0?(c[0]=i,i+=u,c[1]=i):(c[0]=0,c[1]=0)}}}},RNe={sign:ONe,expand:wwe,none:ah,silhouette:Nwe,wiggle:Swe,positive:DNe},MNe=(t,e,n)=>{var r,s=(r=RNe[n])!==null&&r!==void 0?r:ah,i=bwe().keys(e).value((l,c)=>Number(Er(l,c,0))).order(mT).offset(s),a=i(t);return a.forEach((l,c)=>{l.forEach((u,d)=>{var h=Er(t[d],e[c],0);Array.isArray(h)&&h.length===2&&tt(h[0])&&tt(h[1])&&(u[0]=h[0],u[1]=h[1])})}),a};function pB(t){var{axis:e,ticks:n,bandSize:r,entry:s,index:i,dataKey:a}=t;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!dr(s[e.dataKey])){var l=m8(n,"value",s[e.dataKey]);if(l)return l.coordinate+r/2}return n!=null&&n[i]?n[i].coordinate+r/2:null}var c=Er(s,dr(a)?e.dataKey:a),u=e.scale.map(c);return tt(u)?u:null}var LNe=t=>{var e=t.flat(2).filter(tt);return[Math.min(...e),Math.max(...e)]},FNe=t=>[t[0]===1/0?0:t[0],t[1]===-1/0?0:t[1]],BNe=(t,e,n)=>{if(t!=null)return FNe(Object.keys(t).reduce((r,s)=>{var i=t[s];if(!i)return r;var{stackedData:a}=i,l=a.reduce((c,u)=>{var d=SG(u,e,n),h=LNe(d);return!Ct(h[0])||!Ct(h[1])?c:[Math.min(c[0],h[0]),Math.max(c[1],h[1])]},[1/0,-1/0]);return[Math.min(l[0],r[0]),Math.max(l[1],r[1])]},[1/0,-1/0]))},mB=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,gB=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,yB=(t,e,n)=>{if(t&&t.scale&&t.scale.bandwidth){var r=t.scale.bandwidth();return r}if(t&&e&&e.length>=2){for(var s=aS(e,d=>d.coordinate),i=1/0,a=1,l=s.length;a<l;a++){var c=s[a],u=s[a-1];i=Math.min(((c==null?void 0:c.coordinate)||0)-((u==null?void 0:u.coordinate)||0),i)}return i===1/0?0:i}return n?void 0:0};function vB(t){var{tooltipEntrySettings:e,dataKey:n,payload:r,value:s,name:i}=t;return yf(yf({},e),{},{dataKey:n,payload:r,value:s,name:i})}function EG(t,e){if(t)return String(t);if(typeof e=="string")return e}var VNe=(t,e)=>{if(e==="horizontal")return t.chartX;if(e==="vertical")return t.chartY},$Ne=(t,e)=>e==="centric"?t.angle:t.radius,Yl=t=>t.layout.width,Ql=t=>t.layout.height,UNe=t=>t.layout.scale,CG=t=>t.layout.margin,gS=ce(t=>t.cartesianAxis.xAxis,t=>Object.values(t)),yS=ce(t=>t.cartesianAxis.yAxis,t=>Object.values(t)),zNe="data-recharts-item-index",TG="data-recharts-item-id",Mv=60;function xB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function a0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xB(Object(n),!0).forEach(function(r){HNe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function HNe(t,e,n){return(e=WNe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WNe(t){var e=qNe(t,"string");return typeof e=="symbol"?e:e+""}function qNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var GNe=t=>t.brush.height;function KNe(t){var e=yS(t);return e.reduce((n,r)=>{if(r.orientation==="left"&&!r.mirror&&!r.hide){var s=typeof r.width=="number"?r.width:Mv;return n+s}return n},0)}function YNe(t){var e=yS(t);return e.reduce((n,r)=>{if(r.orientation==="right"&&!r.mirror&&!r.hide){var s=typeof r.width=="number"?r.width:Mv;return n+s}return n},0)}function QNe(t){var e=gS(t);return e.reduce((n,r)=>r.orientation==="top"&&!r.mirror&&!r.hide?n+r.height:n,0)}function XNe(t){var e=gS(t);return e.reduce((n,r)=>r.orientation==="bottom"&&!r.mirror&&!r.hide?n+r.height:n,0)}var xs=ce([Yl,Ql,CG,GNe,KNe,YNe,QNe,XNe,G8,E1e],(t,e,n,r,s,i,a,l,c,u)=>{var d={left:(n.left||0)+s,right:(n.right||0)+i},h={top:(n.top||0)+a,bottom:(n.bottom||0)+l},f=a0(a0({},h),d),p=f.bottom;f.bottom+=r,f=PNe(f,c,u);var m=t-f.left-f.right,g=e-f.top-f.bottom;return a0(a0({brushBottom:p},f),{},{width:Math.max(m,0),height:Math.max(g,0)})}),JNe=ce(xs,t=>({x:t.left,y:t.top,width:t.width,height:t.height})),AG=ce(Yl,Ql,(t,e)=>({x:0,y:0,width:t,height:e})),ZNe=b.createContext(null),ti=()=>b.useContext(ZNe)!=null,vS=t=>t.brush,xS=ce([vS,xs,CG],(t,e,n)=>({height:t.height,x:tt(t.x)?t.x:e.left,y:tt(t.y)?t.y:e.top+e.height+e.brushBottom-((n==null?void 0:n.bottom)||0),width:tt(t.width)?t.width:e.width})),kG={},IG={},PG={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n,r,{signal:s,edges:i}={}){let a,l=null;const c=i!=null&&i.includes("leading"),u=i==null||i.includes("trailing"),d=()=>{l!==null&&(n.apply(a,l),a=void 0,l=null)},h=()=>{u&&d(),g()};let f=null;const p=()=>{f!=null&&clearTimeout(f),f=setTimeout(()=>{f=null,h()},r)},m=()=>{f!==null&&(clearTimeout(f),f=null)},g=()=>{m(),a=void 0,l=null},y=()=>{d()},x=function(...w){if(s!=null&&s.aborted)return;a=this,l=w;const N=f==null;p(),c&&N&&d()};return x.schedule=p,x.cancel=g,x.flush=y,s==null||s.addEventListener("abort",g,{once:!0}),x}t.debounce=e})(PG);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=PG;function n(r,s=0,i={}){typeof i!="object"&&(i={});const{leading:a=!1,trailing:l=!0,maxWait:c}=i,u=Array(2);a&&(u[0]="leading"),l&&(u[1]="trailing");let d,h=null;const f=e.debounce(function(...g){d=r.apply(this,g),h=null},s,{edges:u}),p=function(...g){return c!=null&&(h===null&&(h=Date.now()),Date.now()-h>=c)?(d=r.apply(this,g),h=Date.now(),f.cancel(),f.schedule(),d):(f.apply(this,g),d)},m=()=>(f.flush(),d);return p.cancel=f.cancel,p.flush=m,p}t.debounce=n})(IG);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=IG;function n(r,s=0,i={}){const{leading:a=!0,trailing:l=!0}=i;return e.debounce(r,s,{leading:a,maxWait:s,trailing:l})}t.throttle=n})(kG);var eSe=kG.throttle;const tSe=Bo(eSe);var r1=function(e,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];if(typeof console<"u"&&console.warn&&(n===void 0&&console.warn("LogUtils requires an error message argument"),!e))if(n===void 0)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=0;console.warn(n.replace(/%s/g,()=>s[a++]))}},xo={width:"100%",height:"100%",debounce:0,minWidth:0,initialDimension:{width:-1,height:-1}},OG=(t,e,n)=>{var{width:r=xo.width,height:s=xo.height,aspect:i,maxHeight:a}=n,l=oh(r)?t:Number(r),c=oh(s)?e:Number(s);return i&&i>0&&(l?c=l/i:c&&(l=c*i),a&&c!=null&&c>a&&(c=a)),{calculatedWidth:l,calculatedHeight:c}},nSe={width:0,height:0,overflow:"visible"},rSe={width:0,overflowX:"visible"},sSe={height:0,overflowY:"visible"},iSe={},aSe=t=>{var{width:e,height:n}=t,r=oh(e),s=oh(n);return r&&s?nSe:r?rSe:s?sSe:iSe};function oSe(t){var{width:e,height:n,aspect:r}=t,s=e,i=n;return s===void 0&&i===void 0?(s=xo.width,i=xo.height):s===void 0?s=r&&r>0?void 0:xo.width:i===void 0&&(i=r&&r>0?void 0:xo.height),{width:s,height:i}}function CT(){return CT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},CT.apply(null,arguments)}function bB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function wB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bB(Object(n),!0).forEach(function(r){lSe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function lSe(t,e,n){return(e=cSe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function cSe(t){var e=uSe(t,"string");return typeof e=="symbol"?e:e+""}function uSe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var DG=b.createContext(xo.initialDimension);function dSe(t){return Lo(t.width)&&Lo(t.height)}function RG(t){var{children:e,width:n,height:r}=t,s=b.useMemo(()=>({width:n,height:r}),[n,r]);return dSe(s)?b.createElement(DG.Provider,{value:s},e):null}var zP=()=>b.useContext(DG),hSe=b.forwardRef((t,e)=>{var{aspect:n,initialDimension:r=xo.initialDimension,width:s,height:i,minWidth:a=xo.minWidth,minHeight:l,maxHeight:c,children:u,debounce:d=xo.debounce,id:h,className:f,onResize:p,style:m={}}=t,g=b.useRef(null),y=b.useRef();y.current=p,b.useImperativeHandle(e,()=>g.current);var[x,w]=b.useState({containerWidth:r.width,containerHeight:r.height}),N=b.useCallback((_,E)=>{w(I=>{var T=Math.round(_),P=Math.round(E);return I.containerWidth===T&&I.containerHeight===P?I:{containerWidth:T,containerHeight:P}})},[]);b.useEffect(()=>{if(g.current==null||typeof ResizeObserver>"u")return Ov;var _=P=>{var O,H=P[0];if(H!=null){var{width:X,height:se}=H.contentRect;N(X,se),(O=y.current)===null||O===void 0||O.call(y,X,se)}};d>0&&(_=tSe(_,d,{trailing:!0,leading:!1}));var E=new ResizeObserver(_),{width:I,height:T}=g.current.getBoundingClientRect();return N(I,T),E.observe(g.current),()=>{E.disconnect()}},[N,d]);var{containerWidth:S,containerHeight:C}=x;r1(!n||n>0,"The aspect(%s) must be greater than zero.",n);var{calculatedWidth:A,calculatedHeight:j}=OG(S,C,{width:s,height:i,aspect:n,maxHeight:c});return r1(A!=null&&A>0||j!=null&&j>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,A,j,s,i,a,l,n),b.createElement("div",{id:h?"".concat(h):void 0,className:gn("recharts-responsive-container",f),style:wB(wB({},m),{},{width:s,height:i,minWidth:a,minHeight:l,maxHeight:c}),ref:g},b.createElement("div",{style:aSe({width:s,height:i})},b.createElement(RG,{width:A,height:j},u)))}),fSe=b.forwardRef((t,e)=>{var n=zP();if(Lo(n.width)&&Lo(n.height))return t.children;var{width:r,height:s}=oSe({width:t.width,height:t.height,aspect:t.aspect}),{calculatedWidth:i,calculatedHeight:a}=OG(void 0,void 0,{width:r,height:s,aspect:t.aspect,maxHeight:t.maxHeight});return tt(i)&&tt(a)?b.createElement(RG,{width:i,height:a},t.children):b.createElement(hSe,CT({},t,{width:r,height:s,ref:e}))});function HP(t){if(t)return{x:t.x,y:t.y,upperWidth:"upperWidth"in t?t.upperWidth:t.width,lowerWidth:"lowerWidth"in t?t.lowerWidth:t.width,width:t.width,height:t.height}}var Yp=()=>{var t,e=ti(),n=Ze(JNe),r=Ze(xS),s=(t=Ze(vS))===null||t===void 0?void 0:t.padding;return!e||!r||!s?n:{width:r.width-s.left-s.right,height:r.height-s.top-s.bottom,x:s.left,y:s.top}},pSe={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},MG=()=>{var t;return(t=Ze(xs))!==null&&t!==void 0?t:pSe},LG=()=>Ze(Yl),FG=()=>Ze(Ql),sr=t=>t.layout.layoutType,Lv=()=>Ze(sr),BG=()=>{var t=Lv();if(t==="horizontal"||t==="vertical")return t},VG=t=>{var e=t.layout.layoutType;if(e==="centric"||e==="radial")return e},mSe=()=>{var t=Lv();return t!==void 0},Fv=t=>{var e=Xn(),n=ti(),{width:r,height:s}=t,i=zP(),a=r,l=s;return i&&(a=i.width>0?i.width:r,l=i.height>0?i.height:s),b.useEffect(()=>{!n&&Lo(a)&&Lo(l)&&e(ENe({width:a,height:l}))},[e,n,a,l]),null},$G=Symbol.for("immer-nothing"),NB=Symbol.for("immer-draftable"),Ki=Symbol.for("immer-state");function $a(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Ry=Object.getPrototypeOf;function Np(t){return!!t&&!!t[Ki]}function ch(t){var e;return t?UG(t)||Array.isArray(t)||!!t[NB]||!!((e=t.constructor)!=null&&e[NB])||Bv(t)||wS(t):!1}var gSe=Object.prototype.constructor.toString(),SB=new WeakMap;function UG(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);if(e===null||e===Object.prototype)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(n===Object)return!0;if(typeof n!="function")return!1;let r=SB.get(n);return r===void 0&&(r=Function.toString.call(n),SB.set(n,r)),r===gSe}function s1(t,e,n=!0){bS(t)===0?(n?Reflect.ownKeys(t):Object.keys(t)).forEach(s=>{e(s,t[s],t)}):t.forEach((r,s)=>e(s,r,t))}function bS(t){const e=t[Ki];return e?e.type_:Array.isArray(t)?1:Bv(t)?2:wS(t)?3:0}function TT(t,e){return bS(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function zG(t,e,n){const r=bS(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function ySe(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function Bv(t){return t instanceof Map}function wS(t){return t instanceof Set}function Zu(t){return t.copy_||t.base_}function AT(t,e){if(Bv(t))return new Map(t);if(wS(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=UG(t);if(e===!0||e==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(t);delete r[Ki];let s=Reflect.ownKeys(r);for(let i=0;i<s.length;i++){const a=s[i],l=r[a];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[a]={configurable:!0,writable:!0,enumerable:l.enumerable,value:t[a]})}return Object.create(Ry(t),r)}else{const r=Ry(t);if(r!==null&&n)return{...t};const s=Object.create(r);return Object.assign(s,t)}}function WP(t,e=!1){return NS(t)||Np(t)||!ch(t)||(bS(t)>1&&Object.defineProperties(t,{set:o0,add:o0,clear:o0,delete:o0}),Object.freeze(t),e&&Object.values(t).forEach(n=>WP(n,!0))),t}function vSe(){$a(2)}var o0={value:vSe};function NS(t){return t===null||typeof t!="object"?!0:Object.isFrozen(t)}var xSe={};function uh(t){const e=xSe[t];return e||$a(0,t),e}var My;function HG(){return My}function bSe(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function _B(t,e){e&&(uh("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function kT(t){IT(t),t.drafts_.forEach(wSe),t.drafts_=null}function IT(t){t===My&&(My=t.parent_)}function jB(t){return My=bSe(My,t)}function wSe(t){const e=t[Ki];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function EB(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return t!==void 0&&t!==n?(n[Ki].modified_&&(kT(e),$a(4)),ch(t)&&(t=i1(e,t),e.parent_||a1(e,t)),e.patches_&&uh("Patches").generateReplacementPatches_(n[Ki].base_,t,e.patches_,e.inversePatches_)):t=i1(e,n,[]),kT(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==$G?t:void 0}function i1(t,e,n){if(NS(e))return e;const r=t.immer_.shouldUseStrictIteration(),s=e[Ki];if(!s)return s1(e,(i,a)=>CB(t,s,e,i,a,n),r),e;if(s.scope_!==t)return e;if(!s.modified_)return a1(t,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const i=s.copy_;let a=i,l=!1;s.type_===3&&(a=new Set(i),i.clear(),l=!0),s1(a,(c,u)=>CB(t,s,i,c,u,n,l),r),a1(t,i,!1),n&&t.patches_&&uh("Patches").generatePatches_(s,n,t.patches_,t.inversePatches_)}return s.copy_}function CB(t,e,n,r,s,i,a){if(s==null||typeof s!="object"&&!a)return;const l=NS(s);if(!(l&&!a)){if(Np(s)){const c=i&&e&&e.type_!==3&&!TT(e.assigned_,r)?i.concat(r):void 0,u=i1(t,s,c);if(zG(n,r,u),Np(u))t.canAutoFreeze_=!1;else return}else a&&n.add(s);if(ch(s)&&!l){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1||e&&e.base_&&e.base_[r]===s&&l)return;i1(t,s),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&(Bv(n)?n.has(r):Object.prototype.propertyIsEnumerable.call(n,r))&&a1(t,s)}}}function a1(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&WP(e,n)}function NSe(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:HG(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,i=qP;n&&(s=[r],i=Ly);const{revoke:a,proxy:l}=Proxy.revocable(s,i);return r.draft_=l,r.revoke_=a,l}var qP={get(t,e){if(e===Ki)return t;const n=Zu(t);if(!TT(n,e))return SSe(t,n,e);const r=n[e];return t.finalized_||!ch(r)?r:r===Lj(t.base_,e)?(Fj(t),t.copy_[e]=OT(r,t)):r},has(t,e){return e in Zu(t)},ownKeys(t){return Reflect.ownKeys(Zu(t))},set(t,e,n){const r=WG(Zu(t),e);if(r!=null&&r.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const s=Lj(Zu(t),e),i=s==null?void 0:s[Ki];if(i&&i.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(ySe(n,s)&&(n!==void 0||TT(t.base_,e)))return!0;Fj(t),PT(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return Lj(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,Fj(t),PT(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=Zu(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty(){$a(11)},getPrototypeOf(t){return Ry(t.base_)},setPrototypeOf(){$a(12)}},Ly={};s1(qP,(t,e)=>{Ly[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Ly.deleteProperty=function(t,e){return Ly.set.call(this,t,e,void 0)};Ly.set=function(t,e,n){return qP.set.call(this,t[0],e,n,t[0])};function Lj(t,e){const n=t[Ki];return(n?Zu(n):t)[e]}function SSe(t,e,n){var s;const r=WG(e,n);return r?"value"in r?r.value:(s=r.get)==null?void 0:s.call(t.draft_):void 0}function WG(t,e){if(!(e in t))return;let n=Ry(t);for(;n;){const r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Ry(n)}}function PT(t){t.modified_||(t.modified_=!0,t.parent_&&PT(t.parent_))}function Fj(t){t.copy_||(t.copy_=AT(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var _Se=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,n,r)=>{if(typeof e=="function"&&typeof n!="function"){const i=n;n=e;const a=this;return function(c=i,...u){return a.produce(c,d=>n.call(this,d,...u))}}typeof n!="function"&&$a(6),r!==void 0&&typeof r!="function"&&$a(7);let s;if(ch(e)){const i=jB(this),a=OT(e,void 0);let l=!0;try{s=n(a),l=!1}finally{l?kT(i):IT(i)}return _B(i,r),EB(s,i)}else if(!e||typeof e!="object"){if(s=n(e),s===void 0&&(s=e),s===$G&&(s=void 0),this.autoFreeze_&&WP(s,!0),r){const i=[],a=[];uh("Patches").generateReplacementPatches_(e,s,i,a),r(i,a)}return s}else $a(1,e)},this.produceWithPatches=(e,n)=>{if(typeof e=="function")return(a,...l)=>this.produceWithPatches(a,c=>e(c,...l));let r,s;return[this.produce(e,n,(a,l)=>{r=a,s=l}),r,s]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),typeof(t==null?void 0:t.useStrictIteration)=="boolean"&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){ch(t)||$a(8),Np(t)&&(t=jSe(t));const e=jB(this),n=OT(t,void 0);return n[Ki].isManual_=!0,IT(e),n}finishDraft(t,e){const n=t&&t[Ki];(!n||!n.isManual_)&&$a(9);const{scope_:r}=n;return _B(r,e),EB(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const s=e[n];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}n>-1&&(e=e.slice(n+1));const r=uh("Patches").applyPatches_;return Np(t)?r(t,e):this.produce(t,s=>r(s,e))}};function OT(t,e){const n=Bv(t)?uh("MapSet").proxyMap_(t,e):wS(t)?uh("MapSet").proxySet_(t,e):NSe(t,e);return(e?e.scope_:HG()).drafts_.push(n),n}function jSe(t){return Np(t)||$a(10,t),qG(t)}function qG(t){if(!ch(t)||NS(t))return t;const e=t[Ki];let n,r=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=AT(t,e.scope_.immer_.useStrictShallowCopy_),r=e.scope_.immer_.shouldUseStrictIteration()}else n=AT(t,!0);return s1(n,(s,i)=>{zG(n,s,qG(i))},r),e&&(e.finalized_=!1),n}var ESe=new _Se;ESe.produce;var CSe={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},GG=_i({name:"legend",initialState:CSe,reducers:{setLegendSize(t,e){t.size.width=e.payload.width,t.size.height=e.payload.height},setLegendSettings(t,e){t.settings.align=e.payload.align,t.settings.layout=e.payload.layout,t.settings.verticalAlign=e.payload.verticalAlign,t.settings.itemSorter=e.payload.itemSorter},addLegendPayload:{reducer(t,e){t.payload.push(e.payload)},prepare:En()},replaceLegendPayload:{reducer(t,e){var{prev:n,next:r}=e.payload,s=Ga(t).payload.indexOf(n);s>-1&&(t.payload[s]=r)},prepare:En()},removeLegendPayload:{reducer(t,e){var n=Ga(t).payload.indexOf(e.payload);n>-1&&t.payload.splice(n,1)},prepare:En()}}}),{setLegendSize:bMe,setLegendSettings:wMe,addLegendPayload:TSe,replaceLegendPayload:ASe,removeLegendPayload:kSe}=GG.actions,ISe=GG.reducer;function DT(){return DT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},DT.apply(null,arguments)}function TB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Om(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TB(Object(n),!0).forEach(function(r){PSe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function PSe(t,e,n){return(e=OSe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function OSe(t){var e=DSe(t,"string");return typeof e=="symbol"?e:e+""}function DSe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function RSe(t){return Array.isArray(t)&&Ta(t[0])&&Ta(t[1])?t.join(" ~ "):t}var Bh={separator:" : ",contentStyle:{margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},itemStyle:{display:"block",paddingTop:4,paddingBottom:4,color:"#000"},labelStyle:{},accessibilityLayer:!1},MSe=t=>{var{separator:e=Bh.separator,contentStyle:n,itemStyle:r,labelStyle:s=Bh.labelStyle,payload:i,formatter:a,itemSorter:l,wrapperClassName:c,labelClassName:u,label:d,labelFormatter:h,accessibilityLayer:f=Bh.accessibilityLayer}=t,p=()=>{if(i&&i.length){var C={padding:0,margin:0},A=(l?aS(i,l):i).map((j,_)=>{if(j.type==="none")return null;var E=j.formatter||a||RSe,{value:I,name:T}=j,P=I,O=T;if(E){var H=E(I,T,j,_,i);if(Array.isArray(H))[P,O]=H;else if(H!=null)P=H;else return null}var X=Om(Om({},Bh.itemStyle),{},{color:j.color||Bh.itemStyle.color},r);return b.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(_),style:X},Ta(O)?b.createElement("span",{className:"recharts-tooltip-item-name"},O):null,Ta(O)?b.createElement("span",{className:"recharts-tooltip-item-separator"},e):null,b.createElement("span",{className:"recharts-tooltip-item-value"},P),b.createElement("span",{className:"recharts-tooltip-item-unit"},j.unit||""))});return b.createElement("ul",{className:"recharts-tooltip-item-list",style:C},A)}return null},m=Om(Om({},Bh.contentStyle),n),g=Om({margin:0},s),y=!dr(d),x=y?d:"",w=gn("recharts-default-tooltip",c),N=gn("recharts-tooltip-label",u);y&&h&&i!==void 0&&i!==null&&(x=h(d,i));var S=f?{role:"status","aria-live":"assertive"}:{};return b.createElement("div",DT({className:w,style:m},S),b.createElement("p",{className:N,style:g},b.isValidElement(x)?x:"".concat(x)),p())},Dm="recharts-tooltip-wrapper",LSe={visibility:"hidden"};function FSe(t){var{coordinate:e,translateX:n,translateY:r}=t;return gn(Dm,{["".concat(Dm,"-right")]:tt(n)&&e&&tt(e.x)&&n>=e.x,["".concat(Dm,"-left")]:tt(n)&&e&&tt(e.x)&&n<e.x,["".concat(Dm,"-bottom")]:tt(r)&&e&&tt(e.y)&&r>=e.y,["".concat(Dm,"-top")]:tt(r)&&e&&tt(e.y)&&r<e.y})}function AB(t){var{allowEscapeViewBox:e,coordinate:n,key:r,offset:s,position:i,reverseDirection:a,tooltipDimension:l,viewBox:c,viewBoxDimension:u}=t;if(i&&tt(i[r]))return i[r];var d=n[r]-l-(s>0?s:0),h=n[r]+s;if(e[r])return a[r]?d:h;var f=c[r];if(f==null)return 0;if(a[r]){var p=d,m=f;return p<m?Math.max(h,f):Math.max(d,f)}if(u==null)return 0;var g=h+l,y=f+u;return g>y?Math.max(d,f):Math.max(h,f)}function BSe(t){var{translateX:e,translateY:n,useTranslate3d:r}=t;return{transform:r?"translate3d(".concat(e,"px, ").concat(n,"px, 0)"):"translate(".concat(e,"px, ").concat(n,"px)")}}function VSe(t){var{allowEscapeViewBox:e,coordinate:n,offsetTop:r,offsetLeft:s,position:i,reverseDirection:a,tooltipBox:l,useTranslate3d:c,viewBox:u}=t,d,h,f;return l.height>0&&l.width>0&&n?(h=AB({allowEscapeViewBox:e,coordinate:n,key:"x",offset:s,position:i,reverseDirection:a,tooltipDimension:l.width,viewBox:u,viewBoxDimension:u.width}),f=AB({allowEscapeViewBox:e,coordinate:n,key:"y",offset:r,position:i,reverseDirection:a,tooltipDimension:l.height,viewBox:u,viewBoxDimension:u.height}),d=BSe({translateX:h,translateY:f,useTranslate3d:c})):d=LSe,{cssProperties:d,cssClasses:FSe({translateX:h,translateY:f,coordinate:n})}}function kB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function l0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kB(Object(n),!0).forEach(function(r){RT(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function RT(t,e,n){return(e=$Se(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $Se(t){var e=USe(t,"string");return typeof e=="symbol"?e:e+""}function USe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class zSe extends b.PureComponent{constructor(){super(...arguments),RT(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),RT(this,"handleKeyDown",e=>{if(e.key==="Escape"){var n,r,s,i;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(n=(r=this.props.coordinate)===null||r===void 0?void 0:r.x)!==null&&n!==void 0?n:0,y:(s=(i=this.props.coordinate)===null||i===void 0?void 0:i.y)!==null&&s!==void 0?s:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,n;this.state.dismissed&&(((e=this.props.coordinate)===null||e===void 0?void 0:e.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:n,animationDuration:r,animationEasing:s,children:i,coordinate:a,hasPayload:l,isAnimationActive:c,offset:u,position:d,reverseDirection:h,useTranslate3d:f,viewBox:p,wrapperStyle:m,lastBoundingBox:g,innerRef:y,hasPortalFromProps:x}=this.props,w=typeof u=="number"?u:u.x,N=typeof u=="number"?u:u.y,{cssClasses:S,cssProperties:C}=VSe({allowEscapeViewBox:n,coordinate:a,offsetLeft:w,offsetTop:N,position:d,reverseDirection:h,tooltipBox:{height:g.height,width:g.width},useTranslate3d:f,viewBox:p}),A=x?{}:l0(l0({transition:c&&e?"transform ".concat(r,"ms ").concat(s):void 0},C),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&l?"visible":"hidden",position:"absolute",top:0,left:0}),j=l0(l0({},A),{},{visibility:!this.state.dismissed&&e&&l?"visible":"hidden"},m);return b.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:S,style:j,ref:y},i)}}var KG=()=>{var t;return(t=Ze(e=>e.rootProps.accessibilityLayer))!==null&&t!==void 0?t:!0};function MT(){return MT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},MT.apply(null,arguments)}function IB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function PB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IB(Object(n),!0).forEach(function(r){HSe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function HSe(t,e,n){return(e=WSe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WSe(t){var e=qSe(t,"string");return typeof e=="symbol"?e:e+""}function qSe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var OB={curveBasisClosed:cwe,curveBasisOpen:uwe,curveBasis:lwe,curveBumpX:Kbe,curveBumpY:Ybe,curveLinearClosed:dwe,curveLinear:JN,curveMonotoneX:hwe,curveMonotoneY:fwe,curveNatural:pwe,curveStep:mwe,curveStepAfter:ywe,curveStepBefore:gwe},o1=t=>Ct(t.x)&&Ct(t.y),DB=t=>t.base!=null&&o1(t.base)&&o1(t),Rm=t=>t.x,Mm=t=>t.y,GSe=(t,e)=>{if(typeof t=="function")return t;var n="curve".concat(Pv(t));if((n==="curveMonotone"||n==="curveBump")&&e){var r=OB["".concat(n).concat(e==="vertical"?"Y":"X")];if(r)return r}return OB[n]||JN},RB={connectNulls:!1,type:"linear"},KSe=t=>{var{type:e=RB.type,points:n=[],baseLine:r,layout:s,connectNulls:i=RB.connectNulls}=t,a=GSe(e,s),l=i?n.filter(o1):n;if(Array.isArray(r)){var c,u=n.map((m,g)=>PB(PB({},m),{},{base:r[g]}));s==="vertical"?c=e0().y(Mm).x1(Rm).x0(m=>m.base.x):c=e0().x(Rm).y1(Mm).y0(m=>m.base.y);var d=c.defined(DB).curve(a),h=i?u.filter(DB):u;return d(h)}var f;s==="vertical"&&tt(r)?f=e0().y(Mm).x1(Rm).x0(r):tt(r)?f=e0().x(Rm).y1(Mm).y0(r):f=t8().x(Rm).y(Mm);var p=f.defined(o1).curve(a);return p(l)},GP=t=>{var{className:e,points:n,path:r,pathRef:s}=t,i=Lv();if((!n||!n.length)&&!r)return null;var a={type:t.type,points:t.points,baseLine:t.baseLine,layout:t.layout||i,connectNulls:t.connectNulls},l=n&&n.length?KSe(a):r;return b.createElement("path",MT({},Mo(t),Fwe(t),{className:gn("recharts-curve",e),d:l===null?void 0:l,ref:s}))},YSe=["x","y","top","left","width","height","className"];function LT(){return LT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},LT.apply(null,arguments)}function MB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function QSe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?MB(Object(n),!0).forEach(function(r){XSe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):MB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function XSe(t,e,n){return(e=JSe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function JSe(t){var e=ZSe(t,"string");return typeof e=="symbol"?e:e+""}function ZSe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function e_e(t,e){if(t==null)return{};var n,r,s=t_e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function t_e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var n_e=(t,e,n,r,s,i)=>"M".concat(t,",").concat(s,"v").concat(r,"M").concat(i,",").concat(e,"h").concat(n),r_e=t=>{var{x:e=0,y:n=0,top:r=0,left:s=0,width:i=0,height:a=0,className:l}=t,c=e_e(t,YSe),u=QSe({x:e,y:n,top:r,left:s,width:i,height:a},c);return!tt(e)||!tt(n)||!tt(i)||!tt(a)||!tt(r)||!tt(s)?null:b.createElement("path",LT({},Gi(u),{className:gn("recharts-cross",l),d:n_e(e,n,i,a,r,s)}))};function s_e(t,e,n,r){var s=r/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-s:n.left+.5,y:t==="horizontal"?n.top+.5:e.y-s,width:t==="horizontal"?r:n.width-1,height:t==="horizontal"?n.height-1:r}}function LB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function FB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?LB(Object(n),!0).forEach(function(r){i_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function i_e(t,e,n){return(e=a_e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a_e(t){var e=o_e(t,"string");return typeof e=="symbol"?e:e+""}function o_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var l_e=t=>t.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())),YG=(t,e,n)=>t.map(r=>"".concat(l_e(r)," ").concat(e,"ms ").concat(n)).join(","),c_e=(t,e)=>[Object.keys(t),Object.keys(e)].reduce((n,r)=>n.filter(s=>r.includes(s))),Fy=(t,e)=>Object.keys(e).reduce((n,r)=>FB(FB({},n),{},{[r]:t(r,e[r])}),{});function BB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function _r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BB(Object(n),!0).forEach(function(r){u_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function u_e(t,e,n){return(e=d_e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d_e(t){var e=h_e(t,"string");return typeof e=="symbol"?e:e+""}function h_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var l1=(t,e,n)=>t+(e-t)*n,FT=t=>{var{from:e,to:n}=t;return e!==n},QG=(t,e,n)=>{var r=Fy((s,i)=>{if(FT(i)){var[a,l]=t(i.from,i.to,i.velocity);return _r(_r({},i),{},{from:a,velocity:l})}return i},e);return n<1?Fy((s,i)=>FT(i)&&r[s]!=null?_r(_r({},i),{},{velocity:l1(i.velocity,r[s].velocity,n),from:l1(i.from,r[s].from,n)}):i,e):QG(t,r,n-1)};function f_e(t,e,n,r,s,i){var a,l=r.reduce((f,p)=>_r(_r({},f),{},{[p]:{from:t[p],velocity:0,to:e[p]}}),{}),c=()=>Fy((f,p)=>p.from,l),u=()=>!Object.values(l).filter(FT).length,d=null,h=f=>{a||(a=f);var p=f-a,m=p/n.dt;l=QG(n,l,m),s(_r(_r(_r({},t),e),c())),a=f,u()||(d=i.setTimeout(h))};return()=>(d=i.setTimeout(h),()=>{var f;(f=d)===null||f===void 0||f()})}function p_e(t,e,n,r,s,i,a){var l=null,c=s.reduce((h,f)=>{var p=t[f],m=e[f];return p==null||m==null?h:_r(_r({},h),{},{[f]:[p,m]})},{}),u,d=h=>{u||(u=h);var f=(h-u)/r,p=Fy((g,y)=>l1(...y,n(f)),c);if(i(_r(_r(_r({},t),e),p)),f<1)l=a.setTimeout(d);else{var m=Fy((g,y)=>l1(...y,n(1)),c);i(_r(_r(_r({},t),e),m))}};return()=>(l=a.setTimeout(d),()=>{var h;(h=l)===null||h===void 0||h()})}const m_e=(t,e,n,r,s,i)=>{var a=c_e(t,e);return n==null?()=>(s(_r(_r({},t),e)),()=>{}):n.isStepper===!0?f_e(t,e,n,a,s,i):p_e(t,e,n,r,a,s,i)};var c1=1e-4,XG=(t,e)=>[0,3*t,3*e-6*t,3*t-3*e+1],JG=(t,e)=>t.map((n,r)=>n*e**r).reduce((n,r)=>n+r),VB=(t,e)=>n=>{var r=XG(t,e);return JG(r,n)},g_e=(t,e)=>n=>{var r=XG(t,e),s=[...r.map((i,a)=>i*a).slice(1),0];return JG(s,n)},y_e=t=>{var e,n=t.split("(");if(n.length!==2||n[0]!=="cubic-bezier")return null;var r=(e=n[1])===null||e===void 0||(e=e.split(")")[0])===null||e===void 0?void 0:e.split(",");if(r==null||r.length!==4)return null;var s=r.map(i=>parseFloat(i));return[s[0],s[1],s[2],s[3]]},v_e=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(n.length===1)switch(n[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:{var s=y_e(n[0]);if(s)return s}}return n.length===4?n:[0,0,1,1]},x_e=(t,e,n,r)=>{var s=VB(t,n),i=VB(e,r),a=g_e(t,n),l=u=>u>1?1:u<0?0:u,c=u=>{for(var d=u>1?1:u,h=d,f=0;f<8;++f){var p=s(h)-d,m=a(h);if(Math.abs(p-d)<c1||m<c1)return i(h);h=l(h-p/m)}return i(h)};return c.isStepper=!1,c},$B=function(){return x_e(...v_e(...arguments))},b_e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:n=100,damping:r=8,dt:s=17}=e,i=(a,l,c)=>{var u=-(a-l)*n,d=c*r,h=c+(u-d)*s/1e3,f=c*s/1e3+a;return Math.abs(f-l)<c1&&Math.abs(h)<c1?[l,0]:[f,h]};return i.isStepper=!0,i.dt=s,i},w_e=t=>{if(typeof t=="string")switch(t){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return $B(t);case"spring":return b_e();default:if(t.split("(")[0]==="cubic-bezier")return $B(t)}return typeof t=="function"?t:null};function N_e(t){var e,n=()=>null,r=!1,s=null,i=a=>{if(!r){if(Array.isArray(a)){if(!a.length)return;var l=a,[c,...u]=l;if(typeof c=="number"){s=t.setTimeout(i.bind(null,u),c);return}i(c),s=t.setTimeout(i.bind(null,u));return}typeof a=="string"&&(e=a,n(e)),typeof a=="object"&&(e=a,n(e)),typeof a=="function"&&a()}};return{stop:()=>{r=!0},start:a=>{r=!1,s&&(s(),s=null),i(a)},subscribe:a=>(n=a,()=>{n=()=>null}),getTimeoutController:()=>t}}class S_e{setTimeout(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=performance.now(),s=null,i=a=>{a-r>=n?e(a):typeof requestAnimationFrame=="function"&&(s=requestAnimationFrame(i))};return s=requestAnimationFrame(i),()=>{s!=null&&cancelAnimationFrame(s)}}}function __e(){return N_e(new S_e)}var j_e=b.createContext(__e);function E_e(t,e){var n=b.useContext(j_e);return b.useMemo(()=>e??n(t),[t,e,n])}var C_e=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),SS={isSsr:C_e()},T_e={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},UB={t:0},Bj={t:1};function KP(t){var e=ei(t,T_e),{isActive:n,canBegin:r,duration:s,easing:i,begin:a,onAnimationEnd:l,onAnimationStart:c,children:u}=e,d=n==="auto"?!SS.isSsr:n,h=E_e(e.animationId,e.animationManager),[f,p]=b.useState(d?UB:Bj),m=b.useRef(null);return b.useEffect(()=>{d||p(Bj)},[d]),b.useEffect(()=>{if(!d||!r)return Ov;var g=m_e(UB,Bj,w_e(i),s,p,h.getTimeoutController()),y=()=>{m.current=g()};return h.start([c,a,y,s,l]),()=>{h.stop(),m.current&&m.current(),l()}},[d,r,s,i,a,c,l,h]),u(f.t)}function YP(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",n=b.useRef(Iy(e)),r=b.useRef(t);return r.current!==t&&(n.current=Iy(e),r.current=t),n.current}var A_e=["radius"],k_e=["radius"],zB,HB,WB,qB,GB,KB,YB,QB,XB,JB;function ZB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function eV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZB(Object(n),!0).forEach(function(r){I_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function I_e(t,e,n){return(e=P_e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P_e(t){var e=O_e(t,"string");return typeof e=="symbol"?e:e+""}function O_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function u1(){return u1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u1.apply(null,arguments)}function tV(t,e){if(t==null)return{};var n,r,s=D_e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function D_e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function ro(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var nV=(t,e,n,r,s)=>{var i=Lc(n),a=Lc(r),l=Math.min(Math.abs(i)/2,Math.abs(a)/2),c=a>=0?1:-1,u=i>=0?1:-1,d=a>=0&&i>=0||a<0&&i<0?1:0,h;if(l>0&&Array.isArray(s)){for(var f=[0,0,0,0],p=0,m=4;p<m;p++){var g,y=(g=s[p])!==null&&g!==void 0?g:0;f[p]=y>l?l:y}h=Wn(zB||(zB=ro(["M",",",""])),t,e+c*f[0]),f[0]>0&&(h+=Wn(HB||(HB=ro(["A ",",",",0,0,",",",",",""])),f[0],f[0],d,t+u*f[0],e)),h+=Wn(WB||(WB=ro(["L ",",",""])),t+n-u*f[1],e),f[1]>0&&(h+=Wn(qB||(qB=ro(["A ",",",",0,0,",`,
        `,",",""])),f[1],f[1],d,t+n,e+c*f[1])),h+=Wn(GB||(GB=ro(["L ",",",""])),t+n,e+r-c*f[2]),f[2]>0&&(h+=Wn(KB||(KB=ro(["A ",",",",0,0,",`,
        `,",",""])),f[2],f[2],d,t+n-u*f[2],e+r)),h+=Wn(YB||(YB=ro(["L ",",",""])),t+u*f[3],e+r),f[3]>0&&(h+=Wn(QB||(QB=ro(["A ",",",",0,0,",`,
        `,",",""])),f[3],f[3],d,t,e+r-c*f[3])),h+="Z"}else if(l>0&&s===+s&&s>0){var x=Math.min(l,s);h=Wn(XB||(XB=ro(["M ",",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",","," Z"])),t,e+c*x,x,x,d,t+u*x,e,t+n-u*x,e,x,x,d,t+n,e+c*x,t+n,e+r-c*x,x,x,d,t+n-u*x,e+r,t+u*x,e+r,x,x,d,t,e+r-c*x)}else h=Wn(JB||(JB=ro(["M ",","," h "," v "," h "," Z"])),t,e,n,r,-n);return h},rV={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},ZG=t=>{var e=ei(t,rV),n=b.useRef(null),[r,s]=b.useState(-1);b.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var L=n.current.getTotalLength();L&&s(L)}catch{}},[]);var{x:i,y:a,width:l,height:c,radius:u,className:d}=e,{animationEasing:h,animationDuration:f,animationBegin:p,isAnimationActive:m,isUpdateAnimationActive:g}=e,y=b.useRef(l),x=b.useRef(c),w=b.useRef(i),N=b.useRef(a),S=b.useMemo(()=>({x:i,y:a,width:l,height:c,radius:u}),[i,a,l,c,u]),C=YP(S,"rectangle-");if(i!==+i||a!==+a||l!==+l||c!==+c||l===0||c===0)return null;var A=gn("recharts-rectangle",d);if(!g){var j=Gi(e),{radius:_}=j,E=tV(j,A_e);return b.createElement("path",u1({},E,{x:Lc(i),y:Lc(a),width:Lc(l),height:Lc(c),radius:typeof u=="number"?u:void 0,className:A,d:nV(i,a,l,c,u)}))}var I=y.current,T=x.current,P=w.current,O=N.current,H="0px ".concat(r===-1?1:r,"px"),X="".concat(r,"px 0px"),se=YG(["strokeDasharray"],f,typeof h=="string"?h:rV.animationEasing);return b.createElement(KP,{animationId:C,key:C,canBegin:r>0,duration:f,easing:h,isActive:g,begin:p},L=>{var B=Oi(I,l,L),$=Oi(T,c,L),q=Oi(P,i,L),Y=Oi(O,a,L);n.current&&(y.current=B,x.current=$,w.current=q,N.current=Y);var R;m?L>0?R={transition:se,strokeDasharray:X}:R={strokeDasharray:H}:R={strokeDasharray:X};var G=Gi(e),{radius:Z}=G,W=tV(G,k_e);return b.createElement("path",u1({},W,{radius:typeof u=="number"?u:void 0,className:A,d:nV(q,Y,B,$,u),ref:n,style:eV(eV({},R),e.style)}))})};function sV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function iV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sV(Object(n),!0).forEach(function(r){R_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function R_e(t,e,n){return(e=M_e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function M_e(t){var e=L_e(t,"string");return typeof e=="symbol"?e:e+""}function L_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var d1=Math.PI/180,F_e=t=>t*180/Math.PI,ms=(t,e,n,r)=>({x:t+Math.cos(-d1*r)*n,y:e+Math.sin(-d1*r)*n}),B_e=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(n-(r.top||0)-(r.bottom||0)))/2},V_e=(t,e)=>{var{x:n,y:r}=t,{x:s,y:i}=e;return Math.sqrt((n-s)**2+(r-i)**2)},$_e=(t,e)=>{var{x:n,y:r}=t,{cx:s,cy:i}=e,a=V_e({x:n,y:r},{x:s,y:i});if(a<=0)return{radius:a,angle:0};var l=(n-s)/a,c=Math.acos(l);return r>i&&(c=2*Math.PI-c),{radius:a,angle:F_e(c),angleInRadian:c}},U_e=t=>{var{startAngle:e,endAngle:n}=t,r=Math.floor(e/360),s=Math.floor(n/360),i=Math.min(r,s);return{startAngle:e-i*360,endAngle:n-i*360}},z_e=(t,e)=>{var{startAngle:n,endAngle:r}=e,s=Math.floor(n/360),i=Math.floor(r/360),a=Math.min(s,i);return t+a*360},H_e=(t,e)=>{var{chartX:n,chartY:r}=t,{radius:s,angle:i}=$_e({x:n,y:r},e),{innerRadius:a,outerRadius:l}=e;if(s<a||s>l||s===0)return null;var{startAngle:c,endAngle:u}=U_e(e),d=i,h;if(c<=u){for(;d>u;)d-=360;for(;d<c;)d+=360;h=d>=c&&d<=u}else{for(;d>c;)d-=360;for(;d<u;)d+=360;h=d>=u&&d<=c}return h?iV(iV({},e),{},{radius:s,angle:z_e(d,e)}):null};function eK(t){var{cx:e,cy:n,radius:r,startAngle:s,endAngle:i}=t,a=ms(e,n,r,s),l=ms(e,n,r,i);return{points:[a,l],cx:e,cy:n,radius:r,startAngle:s,endAngle:i}}var aV,oV,lV,cV,uV,dV,hV;function BT(){return BT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},BT.apply(null,arguments)}function pd(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var W_e=(t,e)=>{var n=ga(e-t),r=Math.min(Math.abs(e-t),359.999);return n*r},c0=t=>{var{cx:e,cy:n,radius:r,angle:s,sign:i,isExternal:a,cornerRadius:l,cornerIsExternal:c}=t,u=l*(a?1:-1)+r,d=Math.asin(l/u)/d1,h=c?s:s+i*d,f=ms(e,n,u,h),p=ms(e,n,r,h),m=c?s-i*d:s,g=ms(e,n,u*Math.cos(d*d1),m);return{center:f,circleTangency:p,lineTangency:g,theta:d}},tK=t=>{var{cx:e,cy:n,innerRadius:r,outerRadius:s,startAngle:i,endAngle:a}=t,l=W_e(i,a),c=i+l,u=ms(e,n,s,i),d=ms(e,n,s,c),h=Wn(aV||(aV=pd(["M ",",",`
    A `,",",`,0,
    `,",",`,
    `,",",`
  `])),u.x,u.y,s,s,+(Math.abs(l)>180),+(i>c),d.x,d.y);if(r>0){var f=ms(e,n,r,i),p=ms(e,n,r,c);h+=Wn(oV||(oV=pd(["L ",",",`
            A `,",",`,0,
            `,",",`,
            `,","," Z"])),p.x,p.y,r,r,+(Math.abs(l)>180),+(i<=c),f.x,f.y)}else h+=Wn(lV||(lV=pd(["L ",","," Z"])),e,n);return h},q_e=t=>{var{cx:e,cy:n,innerRadius:r,outerRadius:s,cornerRadius:i,forceCornerRadius:a,cornerIsExternal:l,startAngle:c,endAngle:u}=t,d=ga(u-c),{circleTangency:h,lineTangency:f,theta:p}=c0({cx:e,cy:n,radius:s,angle:c,sign:d,cornerRadius:i,cornerIsExternal:l}),{circleTangency:m,lineTangency:g,theta:y}=c0({cx:e,cy:n,radius:s,angle:u,sign:-d,cornerRadius:i,cornerIsExternal:l}),x=l?Math.abs(c-u):Math.abs(c-u)-p-y;if(x<0)return a?Wn(cV||(cV=pd(["M ",",",`
        a`,",",",0,0,1,",`,0
        a`,",",",0,0,1,",`,0
      `])),f.x,f.y,i,i,i*2,i,i,-i*2):tK({cx:e,cy:n,innerRadius:r,outerRadius:s,startAngle:c,endAngle:u});var w=Wn(uV||(uV=pd(["M ",",",`
    A`,",",",0,0,",",",",",`
    A`,",",",0,",",",",",",",`
    A`,",",",0,0,",",",",",`
  `])),f.x,f.y,i,i,+(d<0),h.x,h.y,s,s,+(x>180),+(d<0),m.x,m.y,i,i,+(d<0),g.x,g.y);if(r>0){var{circleTangency:N,lineTangency:S,theta:C}=c0({cx:e,cy:n,radius:r,angle:c,sign:d,isExternal:!0,cornerRadius:i,cornerIsExternal:l}),{circleTangency:A,lineTangency:j,theta:_}=c0({cx:e,cy:n,radius:r,angle:u,sign:-d,isExternal:!0,cornerRadius:i,cornerIsExternal:l}),E=l?Math.abs(c-u):Math.abs(c-u)-C-_;if(E<0&&i===0)return"".concat(w,"L").concat(e,",").concat(n,"Z");w+=Wn(dV||(dV=pd(["L",",",`
      A`,",",",0,0,",",",",",`
      A`,",",",0,",",",",",",",`
      A`,",",",0,0,",",",",","Z"])),j.x,j.y,i,i,+(d<0),A.x,A.y,r,r,+(E>180),+(d>0),N.x,N.y,i,i,+(d<0),S.x,S.y)}else w+=Wn(hV||(hV=pd(["L",",","Z"])),e,n);return w},G_e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},nK=t=>{var e=ei(t,G_e),{cx:n,cy:r,innerRadius:s,outerRadius:i,cornerRadius:a,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d,className:h}=e;if(i<s||u===d)return null;var f=gn("recharts-sector",h),p=i-s,m=vu(a,p,0,!0),g;return m>0&&Math.abs(u-d)<360?g=q_e({cx:n,cy:r,innerRadius:s,outerRadius:i,cornerRadius:Math.min(m,p/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d}):g=tK({cx:n,cy:r,innerRadius:s,outerRadius:i,startAngle:u,endAngle:d}),b.createElement("path",BT({},Gi(e),{className:f,d:g}))};function K_e(t,e,n){if(t==="horizontal")return[{x:e.x,y:n.top},{x:e.x,y:n.top+n.height}];if(t==="vertical")return[{x:n.left,y:e.y},{x:n.left+n.width,y:e.y}];if(y8(e)){if(t==="centric"){var{cx:r,cy:s,innerRadius:i,outerRadius:a,angle:l}=e,c=ms(r,s,i,l),u=ms(r,s,a,l);return[{x:c.x,y:c.y},{x:u.x,y:u.y}]}return eK(e)}}var rK={},sK={},iK={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=RP;function n(r){return e.isSymbol(r)?NaN:Number(r)}t.toNumber=n})(iK);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=iK;function n(r){return r?(r=e.toNumber(r),r===1/0||r===-1/0?(r<0?-1:1)*Number.MAX_VALUE:r===r?r:0):r===0?r:0}t.toFinite=n})(sK);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=MP,n=sK;function r(s,i,a){a&&typeof a!="number"&&e.isIterateeCall(s,i,a)&&(i=a=void 0),s=n.toFinite(s),i===void 0?(i=s,s=0):i=n.toFinite(i),a=a===void 0?s<i?1:-1:n.toFinite(a);const l=Math.max(Math.ceil((i-s)/(a||1)),0),c=new Array(l);for(let u=0;u<l;u++)c[u]=s,s+=a;return c}t.range=r})(rK);var Y_e=rK.range;const aK=Bo(Y_e);function eu(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Q_e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function QP(t){let e,n,r;t.length!==2?(e=eu,n=(l,c)=>eu(t(l),c),r=(l,c)=>t(l)-c):(e=t===eu||t===Q_e?t:X_e,n=t,r=t);function s(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const h=u+d>>>1;n(l[h],c)<0?u=h+1:d=h}while(u<d)}return u}function i(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const h=u+d>>>1;n(l[h],c)<=0?u=h+1:d=h}while(u<d)}return u}function a(l,c,u=0,d=l.length){const h=s(l,c,u,d-1);return h>u&&r(l[h-1],c)>-r(l[h],c)?h-1:h}return{left:s,center:a,right:i}}function X_e(){return 0}function oK(t){return t===null?NaN:+t}function*J_e(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}const Z_e=QP(eu),Vv=Z_e.right;QP(oK).center;class fV extends Map{constructor(e,n=nje){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,s]of e)this.set(r,s)}get(e){return super.get(pV(this,e))}has(e){return super.has(pV(this,e))}set(e,n){return super.set(eje(this,e),n)}delete(e){return super.delete(tje(this,e))}}function pV({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function eje({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function tje({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function nje(t){return t!==null&&typeof t=="object"?t.valueOf():t}function rje(t=eu){if(t===eu)return lK;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||r===0?r:(t(n,n)===0)-(t(e,e)===0)}}function lK(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const sje=Math.sqrt(50),ije=Math.sqrt(10),aje=Math.sqrt(2);function h1(t,e,n){const r=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(r)),i=r/Math.pow(10,s),a=i>=sje?10:i>=ije?5:i>=aje?2:1;let l,c,u;return s<0?(u=Math.pow(10,-s)/a,l=Math.round(t*u),c=Math.round(e*u),l/u<t&&++l,c/u>e&&--c,u=-u):(u=Math.pow(10,s)*a,l=Math.round(t/u),c=Math.round(e/u),l*u<t&&++l,c*u>e&&--c),c<l&&.5<=n&&n<2?h1(t,e,n*2):[l,c,u]}function VT(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[s,i,a]=r?h1(e,t,n):h1(t,e,n);if(!(i>=s))return[];const l=i-s+1,c=new Array(l);if(r)if(a<0)for(let u=0;u<l;++u)c[u]=(i-u)/-a;else for(let u=0;u<l;++u)c[u]=(i-u)*a;else if(a<0)for(let u=0;u<l;++u)c[u]=(s+u)/-a;else for(let u=0;u<l;++u)c[u]=(s+u)*a;return c}function $T(t,e,n){return e=+e,t=+t,n=+n,h1(t,e,n)[2]}function UT(t,e,n){e=+e,t=+t,n=+n;const r=e<t,s=r?$T(e,t,n):$T(t,e,n);return(r?-1:1)*(s<0?1/-s:s)}function mV(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function gV(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function cK(t,e,n=0,r=1/0,s){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(s=s===void 0?lK:rje(s);r>n;){if(r-n>600){const c=r-n+1,u=e-n+1,d=Math.log(c),h=.5*Math.exp(2*d/3),f=.5*Math.sqrt(d*h*(c-h)/c)*(u-c/2<0?-1:1),p=Math.max(n,Math.floor(e-u*h/c+f)),m=Math.min(r,Math.floor(e+(c-u)*h/c+f));cK(t,e,p,m,s)}const i=t[e];let a=n,l=r;for(Lm(t,n,e),s(t[r],i)>0&&Lm(t,n,r);a<l;){for(Lm(t,a,l),++a,--l;s(t[a],i)<0;)++a;for(;s(t[l],i)>0;)--l}s(t[n],i)===0?Lm(t,n,l):(++l,Lm(t,l,r)),l<=e&&(n=l+1),e<=l&&(r=l-1)}return t}function Lm(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function oje(t,e,n){if(t=Float64Array.from(J_e(t)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return gV(t);if(e>=1)return mV(t);var r,s=(r-1)*e,i=Math.floor(s),a=mV(cK(t,i).subarray(0,i+1)),l=gV(t.subarray(i+1));return a+(l-a)*(s-i)}}function lje(t,e,n=oK){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,s=(r-1)*e,i=Math.floor(s),a=+n(t[i],i,t),l=+n(t[i+1],i+1,t);return a+(l-a)*(s-i)}}function cje(t,e,n){t=+t,e=+e,n=(s=arguments.length)<2?(e=t,t=0,1):s<3?1:+n;for(var r=-1,s=Math.max(0,Math.ceil((e-t)/n))|0,i=new Array(s);++r<s;)i[r]=t+r*n;return i}function Pa(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Xl(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const zT=Symbol("implicit");function XP(){var t=new fV,e=[],n=[],r=zT;function s(i){let a=t.get(i);if(a===void 0){if(r!==zT)return r;t.set(i,a=e.push(i)-1)}return n[a%n.length]}return s.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new fV;for(const a of i)t.has(a)||t.set(a,e.push(a)-1);return s},s.range=function(i){return arguments.length?(n=Array.from(i),s):n.slice()},s.unknown=function(i){return arguments.length?(r=i,s):r},s.copy=function(){return XP(e,n).unknown(r)},Pa.apply(s,arguments),s}function JP(){var t=XP().unknown(void 0),e=t.domain,n=t.range,r=0,s=1,i,a,l=!1,c=0,u=0,d=.5;delete t.unknown;function h(){var f=e().length,p=s<r,m=p?s:r,g=p?r:s;i=(g-m)/Math.max(1,f-c+u*2),l&&(i=Math.floor(i)),m+=(g-m-i*(f-c))*d,a=i*(1-c),l&&(m=Math.round(m),a=Math.round(a));var y=cje(f).map(function(x){return m+i*x});return n(p?y.reverse():y)}return t.domain=function(f){return arguments.length?(e(f),h()):e()},t.range=function(f){return arguments.length?([r,s]=f,r=+r,s=+s,h()):[r,s]},t.rangeRound=function(f){return[r,s]=f,r=+r,s=+s,l=!0,h()},t.bandwidth=function(){return a},t.step=function(){return i},t.round=function(f){return arguments.length?(l=!!f,h()):l},t.padding=function(f){return arguments.length?(c=Math.min(1,u=+f),h()):c},t.paddingInner=function(f){return arguments.length?(c=Math.min(1,f),h()):c},t.paddingOuter=function(f){return arguments.length?(u=+f,h()):u},t.align=function(f){return arguments.length?(d=Math.max(0,Math.min(1,f)),h()):d},t.copy=function(){return JP(e(),[r,s]).round(l).paddingInner(c).paddingOuter(u).align(d)},Pa.apply(h(),arguments)}function uK(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return uK(e())},t}function uje(){return uK(JP.apply(null,arguments).paddingInner(1))}function ZP(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function dK(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function $v(){}var By=.7,f1=1/By,Mf="\\s*([+-]?\\d+)\\s*",Vy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ao="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dje=/^#([0-9a-f]{3,8})$/,hje=new RegExp(`^rgb\\(${Mf},${Mf},${Mf}\\)$`),fje=new RegExp(`^rgb\\(${Ao},${Ao},${Ao}\\)$`),pje=new RegExp(`^rgba\\(${Mf},${Mf},${Mf},${Vy}\\)$`),mje=new RegExp(`^rgba\\(${Ao},${Ao},${Ao},${Vy}\\)$`),gje=new RegExp(`^hsl\\(${Vy},${Ao},${Ao}\\)$`),yje=new RegExp(`^hsla\\(${Vy},${Ao},${Ao},${Vy}\\)$`),yV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ZP($v,$y,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:vV,formatHex:vV,formatHex8:vje,formatHsl:xje,formatRgb:xV,toString:xV});function vV(){return this.rgb().formatHex()}function vje(){return this.rgb().formatHex8()}function xje(){return hK(this).formatHsl()}function xV(){return this.rgb().formatRgb()}function $y(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=dje.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?bV(e):n===3?new gi(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?u0(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?u0(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=hje.exec(t))?new gi(e[1],e[2],e[3],1):(e=fje.exec(t))?new gi(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=pje.exec(t))?u0(e[1],e[2],e[3],e[4]):(e=mje.exec(t))?u0(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=gje.exec(t))?SV(e[1],e[2]/100,e[3]/100,1):(e=yje.exec(t))?SV(e[1],e[2]/100,e[3]/100,e[4]):yV.hasOwnProperty(t)?bV(yV[t]):t==="transparent"?new gi(NaN,NaN,NaN,0):null}function bV(t){return new gi(t>>16&255,t>>8&255,t&255,1)}function u0(t,e,n,r){return r<=0&&(t=e=n=NaN),new gi(t,e,n,r)}function bje(t){return t instanceof $v||(t=$y(t)),t?(t=t.rgb(),new gi(t.r,t.g,t.b,t.opacity)):new gi}function HT(t,e,n,r){return arguments.length===1?bje(t):new gi(t,e,n,r??1)}function gi(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}ZP(gi,HT,dK($v,{brighter(t){return t=t==null?f1:Math.pow(f1,t),new gi(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?By:Math.pow(By,t),new gi(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new gi(kd(this.r),kd(this.g),kd(this.b),p1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wV,formatHex:wV,formatHex8:wje,formatRgb:NV,toString:NV}));function wV(){return`#${md(this.r)}${md(this.g)}${md(this.b)}`}function wje(){return`#${md(this.r)}${md(this.g)}${md(this.b)}${md((isNaN(this.opacity)?1:this.opacity)*255)}`}function NV(){const t=p1(this.opacity);return`${t===1?"rgb(":"rgba("}${kd(this.r)}, ${kd(this.g)}, ${kd(this.b)}${t===1?")":`, ${t})`}`}function p1(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function kd(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function md(t){return t=kd(t),(t<16?"0":"")+t.toString(16)}function SV(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ua(t,e,n,r)}function hK(t){if(t instanceof Ua)return new Ua(t.h,t.s,t.l,t.opacity);if(t instanceof $v||(t=$y(t)),!t)return new Ua;if(t instanceof Ua)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),i=Math.max(e,n,r),a=NaN,l=i-s,c=(i+s)/2;return l?(e===i?a=(n-r)/l+(n<r)*6:n===i?a=(r-e)/l+2:a=(e-n)/l+4,l/=c<.5?i+s:2-i-s,a*=60):l=c>0&&c<1?0:a,new Ua(a,l,c,t.opacity)}function Nje(t,e,n,r){return arguments.length===1?hK(t):new Ua(t,e,n,r??1)}function Ua(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}ZP(Ua,Nje,dK($v,{brighter(t){return t=t==null?f1:Math.pow(f1,t),new Ua(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?By:Math.pow(By,t),new Ua(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,s=2*n-r;return new gi(Vj(t>=240?t-240:t+120,s,r),Vj(t,s,r),Vj(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Ua(_V(this.h),d0(this.s),d0(this.l),p1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=p1(this.opacity);return`${t===1?"hsl(":"hsla("}${_V(this.h)}, ${d0(this.s)*100}%, ${d0(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _V(t){return t=(t||0)%360,t<0?t+360:t}function d0(t){return Math.max(0,Math.min(1,t||0))}function Vj(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const eO=t=>()=>t;function Sje(t,e){return function(n){return t+n*e}}function _je(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function jje(t){return(t=+t)==1?fK:function(e,n){return n-e?_je(e,n,t):eO(isNaN(e)?n:e)}}function fK(t,e){var n=e-t;return n?Sje(t,n):eO(isNaN(t)?e:t)}const jV=function t(e){var n=jje(e);function r(s,i){var a=n((s=HT(s)).r,(i=HT(i)).r),l=n(s.g,i.g),c=n(s.b,i.b),u=fK(s.opacity,i.opacity);return function(d){return s.r=a(d),s.g=l(d),s.b=c(d),s.opacity=u(d),s+""}}return r.gamma=t,r}(1);function Eje(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(i){for(s=0;s<n;++s)r[s]=t[s]*(1-i)+e[s]*i;return r}}function Cje(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Tje(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),i=new Array(n),a;for(a=0;a<r;++a)s[a]=Qp(t[a],e[a]);for(;a<n;++a)i[a]=e[a];return function(l){for(a=0;a<r;++a)i[a]=s[a](l);return i}}function Aje(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function m1(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function kje(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=Qp(t[s],e[s]):r[s]=e[s];return function(i){for(s in n)r[s]=n[s](i);return r}}var WT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$j=new RegExp(WT.source,"g");function Ije(t){return function(){return t}}function Pje(t){return function(e){return t(e)+""}}function Oje(t,e){var n=WT.lastIndex=$j.lastIndex=0,r,s,i,a=-1,l=[],c=[];for(t=t+"",e=e+"";(r=WT.exec(t))&&(s=$j.exec(e));)(i=s.index)>n&&(i=e.slice(n,i),l[a]?l[a]+=i:l[++a]=i),(r=r[0])===(s=s[0])?l[a]?l[a]+=s:l[++a]=s:(l[++a]=null,c.push({i:a,x:m1(r,s)})),n=$j.lastIndex;return n<e.length&&(i=e.slice(n),l[a]?l[a]+=i:l[++a]=i),l.length<2?c[0]?Pje(c[0].x):Ije(e):(e=c.length,function(u){for(var d=0,h;d<e;++d)l[(h=c[d]).i]=h.x(u);return l.join("")})}function Qp(t,e){var n=typeof e,r;return e==null||n==="boolean"?eO(e):(n==="number"?m1:n==="string"?(r=$y(e))?(e=r,jV):Oje:e instanceof $y?jV:e instanceof Date?Aje:Cje(e)?Eje:Array.isArray(e)?Tje:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?kje:m1)(t,e)}function tO(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Dje(t,e){e===void 0&&(e=t,t=Qp);for(var n=0,r=e.length-1,s=e[0],i=new Array(r<0?0:r);n<r;)i[n]=t(s,s=e[++n]);return function(a){var l=Math.max(0,Math.min(r-1,Math.floor(a*=r)));return i[l](a-l)}}function Rje(t){return function(){return t}}function g1(t){return+t}var EV=[0,1];function Hs(t){return t}function qT(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Rje(isNaN(e)?NaN:.5)}function Mje(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Lje(t,e,n){var r=t[0],s=t[1],i=e[0],a=e[1];return s<r?(r=qT(s,r),i=n(a,i)):(r=qT(r,s),i=n(i,a)),function(l){return i(r(l))}}function Fje(t,e,n){var r=Math.min(t.length,e.length)-1,s=new Array(r),i=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)s[a]=qT(t[a],t[a+1]),i[a]=n(e[a],e[a+1]);return function(l){var c=Vv(t,l,1,r)-1;return i[c](s[c](l))}}function Uv(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function _S(){var t=EV,e=EV,n=Qp,r,s,i,a=Hs,l,c,u;function d(){var f=Math.min(t.length,e.length);return a!==Hs&&(a=Mje(t[0],t[f-1])),l=f>2?Fje:Lje,c=u=null,h}function h(f){return f==null||isNaN(f=+f)?i:(c||(c=l(t.map(r),e,n)))(r(a(f)))}return h.invert=function(f){return a(s((u||(u=l(e,t.map(r),m1)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,g1),d()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),d()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),n=tO,d()},h.clamp=function(f){return arguments.length?(a=f?!0:Hs,d()):a!==Hs},h.interpolate=function(f){return arguments.length?(n=f,d()):n},h.unknown=function(f){return arguments.length?(i=f,h):i},function(f,p){return r=f,s=p,d()}}function nO(){return _S()(Hs,Hs)}function Bje(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function y1(t,e){if(!isFinite(t)||t===0)return null;var n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"),r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Sp(t){return t=y1(Math.abs(t)),t?t[1]:NaN}function Vje(t,e){return function(n,r){for(var s=n.length,i=[],a=0,l=t[0],c=0;s>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),i.push(n.substring(s-=l,s+l)),!((c+=l+1)>r));)l=t[a=(a+1)%t.length];return i.reverse().join(e)}}function $je(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Uje=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Uy(t){if(!(e=Uje.exec(t)))throw new Error("invalid format: "+t);var e;return new rO({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Uy.prototype=rO.prototype;function rO(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}rO.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zje(t){e:for(var e=t.length,n=1,r=-1,s;n<e;++n)switch(t[n]){case".":r=s=n;break;case"0":r===0&&(r=n),s=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(s+1):t}var v1;function Hje(t,e){var n=y1(t,e);if(!n)return v1=void 0,t.toPrecision(e);var r=n[0],s=n[1],i=s-(v1=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=r.length;return i===a?r:i>a?r+new Array(i-a+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+y1(t,Math.max(0,e+i-1))[0]}function CV(t,e){var n=y1(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const TV={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Bje,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>CV(t*100,e),r:CV,s:Hje,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function AV(t){return t}var kV=Array.prototype.map,IV=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Wje(t){var e=t.grouping===void 0||t.thousands===void 0?AV:Vje(kV.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?AV:$je(kV.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(h,f){h=Uy(h);var p=h.fill,m=h.align,g=h.sign,y=h.symbol,x=h.zero,w=h.width,N=h.comma,S=h.precision,C=h.trim,A=h.type;A==="n"?(N=!0,A="g"):TV[A]||(S===void 0&&(S=12),C=!0,A="g"),(x||p==="0"&&m==="=")&&(x=!0,p="0",m="=");var j=(f&&f.prefix!==void 0?f.prefix:"")+(y==="$"?n:y==="#"&&/[boxX]/.test(A)?"0"+A.toLowerCase():""),_=(y==="$"?r:/[%p]/.test(A)?a:"")+(f&&f.suffix!==void 0?f.suffix:""),E=TV[A],I=/[defgprs%]/.test(A);S=S===void 0?6:/[gprs]/.test(A)?Math.max(1,Math.min(21,S)):Math.max(0,Math.min(20,S));function T(P){var O=j,H=_,X,se,L;if(A==="c")H=E(P)+H,P="";else{P=+P;var B=P<0||1/P<0;if(P=isNaN(P)?c:E(Math.abs(P),S),C&&(P=zje(P)),B&&+P==0&&g!=="+"&&(B=!1),O=(B?g==="("?g:l:g==="-"||g==="("?"":g)+O,H=(A==="s"&&!isNaN(P)&&v1!==void 0?IV[8+v1/3]:"")+H+(B&&g==="("?")":""),I){for(X=-1,se=P.length;++X<se;)if(L=P.charCodeAt(X),48>L||L>57){H=(L===46?s+P.slice(X+1):P.slice(X))+H,P=P.slice(0,X);break}}}N&&!x&&(P=e(P,1/0));var $=O.length+P.length+H.length,q=$<w?new Array(w-$+1).join(p):"";switch(N&&x&&(P=e(q+P,q.length?w-H.length:1/0),q=""),m){case"<":P=O+P+H+q;break;case"=":P=O+q+P+H;break;case"^":P=q.slice(0,$=q.length>>1)+O+P+H+q.slice($);break;default:P=q+O+P+H;break}return i(P)}return T.toString=function(){return h+""},T}function d(h,f){var p=Math.max(-8,Math.min(8,Math.floor(Sp(f)/3)))*3,m=Math.pow(10,-p),g=u((h=Uy(h),h.type="f",h),{suffix:IV[8+p/3]});return function(y){return g(m*y)}}return{format:u,formatPrefix:d}}var h0,sO,pK;qje({thousands:",",grouping:[3],currency:["$",""]});function qje(t){return h0=Wje(t),sO=h0.format,pK=h0.formatPrefix,h0}function Gje(t){return Math.max(0,-Sp(Math.abs(t)))}function Kje(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Sp(e)/3)))*3-Sp(Math.abs(t)))}function Yje(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Sp(e)-Sp(t))+1}function mK(t,e,n,r){var s=UT(t,e,n),i;switch(r=Uy(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=Kje(s,a))&&(r.precision=i),pK(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=Yje(s,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=Gje(s))&&(r.precision=i-(r.type==="%")*2);break}}return sO(r)}function Fu(t){var e=t.domain;return t.ticks=function(n){var r=e();return VT(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var s=e();return mK(s[0],s[s.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),s=0,i=r.length-1,a=r[s],l=r[i],c,u,d=10;for(l<a&&(u=a,a=l,l=u,u=s,s=i,i=u);d-- >0;){if(u=$T(a,l,n),u===c)return r[s]=a,r[i]=l,e(r);if(u>0)a=Math.floor(a/u)*u,l=Math.ceil(l/u)*u;else if(u<0)a=Math.ceil(a*u)/u,l=Math.floor(l*u)/u;else break;c=u}return t},t}function gK(){var t=nO();return t.copy=function(){return Uv(t,gK())},Pa.apply(t,arguments),Fu(t)}function yK(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,g1),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return yK(t).unknown(e)},t=arguments.length?Array.from(t,g1):[0,1],Fu(n)}function vK(t,e){t=t.slice();var n=0,r=t.length-1,s=t[n],i=t[r],a;return i<s&&(a=n,n=r,r=a,a=s,s=i,i=a),t[n]=e.floor(s),t[r]=e.ceil(i),t}function PV(t){return Math.log(t)}function OV(t){return Math.exp(t)}function Qje(t){return-Math.log(-t)}function Xje(t){return-Math.exp(-t)}function Jje(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Zje(t){return t===10?Jje:t===Math.E?Math.exp:e=>Math.pow(t,e)}function eEe(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function DV(t){return(e,n)=>-t(-e,n)}function iO(t){const e=t(PV,OV),n=e.domain;let r=10,s,i;function a(){return s=eEe(r),i=Zje(r),n()[0]<0?(s=DV(s),i=DV(i),t(Qje,Xje)):t(PV,OV),e}return e.base=function(l){return arguments.length?(r=+l,a()):r},e.domain=function(l){return arguments.length?(n(l),a()):n()},e.ticks=l=>{const c=n();let u=c[0],d=c[c.length-1];const h=d<u;h&&([u,d]=[d,u]);let f=s(u),p=s(d),m,g;const y=l==null?10:+l;let x=[];if(!(r%1)&&p-f<y){if(f=Math.floor(f),p=Math.ceil(p),u>0){for(;f<=p;++f)for(m=1;m<r;++m)if(g=f<0?m/i(-f):m*i(f),!(g<u)){if(g>d)break;x.push(g)}}else for(;f<=p;++f)for(m=r-1;m>=1;--m)if(g=f>0?m/i(-f):m*i(f),!(g<u)){if(g>d)break;x.push(g)}x.length*2<y&&(x=VT(u,d,y))}else x=VT(f,p,Math.min(p-f,y)).map(i);return h?x.reverse():x},e.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=r===10?"s":","),typeof c!="function"&&(!(r%1)&&(c=Uy(c)).precision==null&&(c.trim=!0),c=sO(c)),l===1/0)return c;const u=Math.max(1,r*l/e.ticks().length);return d=>{let h=d/i(Math.round(s(d)));return h*r<r-.5&&(h*=r),h<=u?c(d):""}},e.nice=()=>n(vK(n(),{floor:l=>i(Math.floor(s(l))),ceil:l=>i(Math.ceil(s(l)))})),e}function xK(){const t=iO(_S()).domain([1,10]);return t.copy=()=>Uv(t,xK()).base(t.base()),Pa.apply(t,arguments),t}function RV(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function MV(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function aO(t){var e=1,n=t(RV(e),MV(e));return n.constant=function(r){return arguments.length?t(RV(e=+r),MV(e)):e},Fu(n)}function bK(){var t=aO(_S());return t.copy=function(){return Uv(t,bK()).constant(t.constant())},Pa.apply(t,arguments)}function LV(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function tEe(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function nEe(t){return t<0?-t*t:t*t}function oO(t){var e=t(Hs,Hs),n=1;function r(){return n===1?t(Hs,Hs):n===.5?t(tEe,nEe):t(LV(n),LV(1/n))}return e.exponent=function(s){return arguments.length?(n=+s,r()):n},Fu(e)}function lO(){var t=oO(_S());return t.copy=function(){return Uv(t,lO()).exponent(t.exponent())},Pa.apply(t,arguments),t}function rEe(){return lO.apply(null,arguments).exponent(.5)}function FV(t){return Math.sign(t)*t*t}function sEe(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function wK(){var t=nO(),e=[0,1],n=!1,r;function s(i){var a=sEe(t(i));return isNaN(a)?r:n?Math.round(a):a}return s.invert=function(i){return t.invert(FV(i))},s.domain=function(i){return arguments.length?(t.domain(i),s):t.domain()},s.range=function(i){return arguments.length?(t.range((e=Array.from(i,g1)).map(FV)),s):e.slice()},s.rangeRound=function(i){return s.range(i).round(!0)},s.round=function(i){return arguments.length?(n=!!i,s):n},s.clamp=function(i){return arguments.length?(t.clamp(i),s):t.clamp()},s.unknown=function(i){return arguments.length?(r=i,s):r},s.copy=function(){return wK(t.domain(),e).round(n).clamp(t.clamp()).unknown(r)},Pa.apply(s,arguments),Fu(s)}function NK(){var t=[],e=[],n=[],r;function s(){var a=0,l=Math.max(1,e.length);for(n=new Array(l-1);++a<l;)n[a-1]=lje(t,a/l);return i}function i(a){return a==null||isNaN(a=+a)?r:e[Vv(n,a)]}return i.invertExtent=function(a){var l=e.indexOf(a);return l<0?[NaN,NaN]:[l>0?n[l-1]:t[0],l<n.length?n[l]:t[t.length-1]]},i.domain=function(a){if(!arguments.length)return t.slice();t=[];for(let l of a)l!=null&&!isNaN(l=+l)&&t.push(l);return t.sort(eu),s()},i.range=function(a){return arguments.length?(e=Array.from(a),s()):e.slice()},i.unknown=function(a){return arguments.length?(r=a,i):r},i.quantiles=function(){return n.slice()},i.copy=function(){return NK().domain(t).range(e).unknown(r)},Pa.apply(i,arguments)}function SK(){var t=0,e=1,n=1,r=[.5],s=[0,1],i;function a(c){return c!=null&&c<=c?s[Vv(r,c,0,n)]:i}function l(){var c=-1;for(r=new Array(n);++c<n;)r[c]=((c+1)*e-(c-n)*t)/(n+1);return a}return a.domain=function(c){return arguments.length?([t,e]=c,t=+t,e=+e,l()):[t,e]},a.range=function(c){return arguments.length?(n=(s=Array.from(c)).length-1,l()):s.slice()},a.invertExtent=function(c){var u=s.indexOf(c);return u<0?[NaN,NaN]:u<1?[t,r[0]]:u>=n?[r[n-1],e]:[r[u-1],r[u]]},a.unknown=function(c){return arguments.length&&(i=c),a},a.thresholds=function(){return r.slice()},a.copy=function(){return SK().domain([t,e]).range(s).unknown(i)},Pa.apply(Fu(a),arguments)}function _K(){var t=[.5],e=[0,1],n,r=1;function s(i){return i!=null&&i<=i?e[Vv(t,i,0,r)]:n}return s.domain=function(i){return arguments.length?(t=Array.from(i),r=Math.min(t.length,e.length-1),s):t.slice()},s.range=function(i){return arguments.length?(e=Array.from(i),r=Math.min(t.length,e.length-1),s):e.slice()},s.invertExtent=function(i){var a=e.indexOf(i);return[t[a-1],t[a]]},s.unknown=function(i){return arguments.length?(n=i,s):n},s.copy=function(){return _K().domain(t).range(e).unknown(n)},Pa.apply(s,arguments)}const Uj=new Date,zj=new Date;function kr(t,e,n,r){function s(i){return t(i=arguments.length===0?new Date:new Date(+i)),i}return s.floor=i=>(t(i=new Date(+i)),i),s.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),s.round=i=>{const a=s(i),l=s.ceil(i);return i-a<l-i?a:l},s.offset=(i,a)=>(e(i=new Date(+i),a==null?1:Math.floor(a)),i),s.range=(i,a,l)=>{const c=[];if(i=s.ceil(i),l=l==null?1:Math.floor(l),!(i<a)||!(l>0))return c;let u;do c.push(u=new Date(+i)),e(i,l),t(i);while(u<i&&i<a);return c},s.filter=i=>kr(a=>{if(a>=a)for(;t(a),!i(a);)a.setTime(a-1)},(a,l)=>{if(a>=a)if(l<0)for(;++l<=0;)for(;e(a,-1),!i(a););else for(;--l>=0;)for(;e(a,1),!i(a););}),n&&(s.count=(i,a)=>(Uj.setTime(+i),zj.setTime(+a),t(Uj),t(zj),Math.floor(n(Uj,zj))),s.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?s.filter(r?a=>r(a)%i===0:a=>s.count(0,a)%i===0):s)),s}const x1=kr(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);x1.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?kr(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):x1);x1.range;const pl=1e3,ya=pl*60,ml=ya*60,Rl=ml*24,cO=Rl*7,BV=Rl*30,Hj=Rl*365,gd=kr(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*pl)},(t,e)=>(e-t)/pl,t=>t.getUTCSeconds());gd.range;const uO=kr(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*pl)},(t,e)=>{t.setTime(+t+e*ya)},(t,e)=>(e-t)/ya,t=>t.getMinutes());uO.range;const dO=kr(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*ya)},(t,e)=>(e-t)/ya,t=>t.getUTCMinutes());dO.range;const hO=kr(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*pl-t.getMinutes()*ya)},(t,e)=>{t.setTime(+t+e*ml)},(t,e)=>(e-t)/ml,t=>t.getHours());hO.range;const fO=kr(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*ml)},(t,e)=>(e-t)/ml,t=>t.getUTCHours());fO.range;const zv=kr(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ya)/Rl,t=>t.getDate()-1);zv.range;const jS=kr(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Rl,t=>t.getUTCDate()-1);jS.range;const jK=kr(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Rl,t=>Math.floor(t/Rl));jK.range;function jh(t){return kr(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*ya)/cO)}const ES=jh(0),b1=jh(1),iEe=jh(2),aEe=jh(3),_p=jh(4),oEe=jh(5),lEe=jh(6);ES.range;b1.range;iEe.range;aEe.range;_p.range;oEe.range;lEe.range;function Eh(t){return kr(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/cO)}const CS=Eh(0),w1=Eh(1),cEe=Eh(2),uEe=Eh(3),jp=Eh(4),dEe=Eh(5),hEe=Eh(6);CS.range;w1.range;cEe.range;uEe.range;jp.range;dEe.range;hEe.range;const pO=kr(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());pO.range;const mO=kr(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());mO.range;const Ml=kr(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Ml.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:kr(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});Ml.range;const Ll=kr(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());Ll.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:kr(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});Ll.range;function EK(t,e,n,r,s,i){const a=[[gd,1,pl],[gd,5,5*pl],[gd,15,15*pl],[gd,30,30*pl],[i,1,ya],[i,5,5*ya],[i,15,15*ya],[i,30,30*ya],[s,1,ml],[s,3,3*ml],[s,6,6*ml],[s,12,12*ml],[r,1,Rl],[r,2,2*Rl],[n,1,cO],[e,1,BV],[e,3,3*BV],[t,1,Hj]];function l(u,d,h){const f=d<u;f&&([u,d]=[d,u]);const p=h&&typeof h.range=="function"?h:c(u,d,h),m=p?p.range(u,+d+1):[];return f?m.reverse():m}function c(u,d,h){const f=Math.abs(d-u)/h,p=QP(([,,y])=>y).right(a,f);if(p===a.length)return t.every(UT(u/Hj,d/Hj,h));if(p===0)return x1.every(Math.max(UT(u,d,h),1));const[m,g]=a[f/a[p-1][2]<a[p][2]/f?p-1:p];return m.every(g)}return[l,c]}const[fEe,pEe]=EK(Ll,mO,CS,jK,fO,dO),[mEe,gEe]=EK(Ml,pO,ES,zv,hO,uO);function Wj(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function qj(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Fm(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function yEe(t){var e=t.dateTime,n=t.date,r=t.time,s=t.periods,i=t.days,a=t.shortDays,l=t.months,c=t.shortMonths,u=Bm(s),d=Vm(s),h=Bm(i),f=Vm(i),p=Bm(a),m=Vm(a),g=Bm(l),y=Vm(l),x=Bm(c),w=Vm(c),N={a:L,A:B,b:$,B:q,c:null,d:WV,e:WV,f:VEe,g:QEe,G:JEe,H:LEe,I:FEe,j:BEe,L:CK,m:$Ee,M:UEe,p:Y,q:R,Q:KV,s:YV,S:zEe,u:HEe,U:WEe,V:qEe,w:GEe,W:KEe,x:null,X:null,y:YEe,Y:XEe,Z:ZEe,"%":GV},S={a:G,A:Z,b:W,B:Q,c:null,d:qV,e:qV,f:rCe,g:fCe,G:mCe,H:eCe,I:tCe,j:nCe,L:AK,m:sCe,M:iCe,p:U,q:pe,Q:KV,s:YV,S:aCe,u:oCe,U:lCe,V:cCe,w:uCe,W:dCe,x:null,X:null,y:hCe,Y:pCe,Z:gCe,"%":GV},C={a:I,A:T,b:P,B:O,c:H,d:zV,e:zV,f:OEe,g:UV,G:$V,H:HV,I:HV,j:AEe,L:PEe,m:TEe,M:kEe,p:E,q:CEe,Q:REe,s:MEe,S:IEe,u:NEe,U:SEe,V:_Ee,w:wEe,W:jEe,x:X,X:se,y:UV,Y:$V,Z:EEe,"%":DEe};N.x=A(n,N),N.X=A(r,N),N.c=A(e,N),S.x=A(n,S),S.X=A(r,S),S.c=A(e,S);function A(J,ge){return function(me){var ue=[],st=-1,Ke=0,ot=J.length,lt,bt,mt;for(me instanceof Date||(me=new Date(+me));++st<ot;)J.charCodeAt(st)===37&&(ue.push(J.slice(Ke,st)),(bt=VV[lt=J.charAt(++st)])!=null?lt=J.charAt(++st):bt=lt==="e"?" ":"0",(mt=ge[lt])&&(lt=mt(me,bt)),ue.push(lt),Ke=st+1);return ue.push(J.slice(Ke,st)),ue.join("")}}function j(J,ge){return function(me){var ue=Fm(1900,void 0,1),st=_(ue,J,me+="",0),Ke,ot;if(st!=me.length)return null;if("Q"in ue)return new Date(ue.Q);if("s"in ue)return new Date(ue.s*1e3+("L"in ue?ue.L:0));if(ge&&!("Z"in ue)&&(ue.Z=0),"p"in ue&&(ue.H=ue.H%12+ue.p*12),ue.m===void 0&&(ue.m="q"in ue?ue.q:0),"V"in ue){if(ue.V<1||ue.V>53)return null;"w"in ue||(ue.w=1),"Z"in ue?(Ke=qj(Fm(ue.y,0,1)),ot=Ke.getUTCDay(),Ke=ot>4||ot===0?w1.ceil(Ke):w1(Ke),Ke=jS.offset(Ke,(ue.V-1)*7),ue.y=Ke.getUTCFullYear(),ue.m=Ke.getUTCMonth(),ue.d=Ke.getUTCDate()+(ue.w+6)%7):(Ke=Wj(Fm(ue.y,0,1)),ot=Ke.getDay(),Ke=ot>4||ot===0?b1.ceil(Ke):b1(Ke),Ke=zv.offset(Ke,(ue.V-1)*7),ue.y=Ke.getFullYear(),ue.m=Ke.getMonth(),ue.d=Ke.getDate()+(ue.w+6)%7)}else("W"in ue||"U"in ue)&&("w"in ue||(ue.w="u"in ue?ue.u%7:"W"in ue?1:0),ot="Z"in ue?qj(Fm(ue.y,0,1)).getUTCDay():Wj(Fm(ue.y,0,1)).getDay(),ue.m=0,ue.d="W"in ue?(ue.w+6)%7+ue.W*7-(ot+5)%7:ue.w+ue.U*7-(ot+6)%7);return"Z"in ue?(ue.H+=ue.Z/100|0,ue.M+=ue.Z%100,qj(ue)):Wj(ue)}}function _(J,ge,me,ue){for(var st=0,Ke=ge.length,ot=me.length,lt,bt;st<Ke;){if(ue>=ot)return-1;if(lt=ge.charCodeAt(st++),lt===37){if(lt=ge.charAt(st++),bt=C[lt in VV?ge.charAt(st++):lt],!bt||(ue=bt(J,me,ue))<0)return-1}else if(lt!=me.charCodeAt(ue++))return-1}return ue}function E(J,ge,me){var ue=u.exec(ge.slice(me));return ue?(J.p=d.get(ue[0].toLowerCase()),me+ue[0].length):-1}function I(J,ge,me){var ue=p.exec(ge.slice(me));return ue?(J.w=m.get(ue[0].toLowerCase()),me+ue[0].length):-1}function T(J,ge,me){var ue=h.exec(ge.slice(me));return ue?(J.w=f.get(ue[0].toLowerCase()),me+ue[0].length):-1}function P(J,ge,me){var ue=x.exec(ge.slice(me));return ue?(J.m=w.get(ue[0].toLowerCase()),me+ue[0].length):-1}function O(J,ge,me){var ue=g.exec(ge.slice(me));return ue?(J.m=y.get(ue[0].toLowerCase()),me+ue[0].length):-1}function H(J,ge,me){return _(J,e,ge,me)}function X(J,ge,me){return _(J,n,ge,me)}function se(J,ge,me){return _(J,r,ge,me)}function L(J){return a[J.getDay()]}function B(J){return i[J.getDay()]}function $(J){return c[J.getMonth()]}function q(J){return l[J.getMonth()]}function Y(J){return s[+(J.getHours()>=12)]}function R(J){return 1+~~(J.getMonth()/3)}function G(J){return a[J.getUTCDay()]}function Z(J){return i[J.getUTCDay()]}function W(J){return c[J.getUTCMonth()]}function Q(J){return l[J.getUTCMonth()]}function U(J){return s[+(J.getUTCHours()>=12)]}function pe(J){return 1+~~(J.getUTCMonth()/3)}return{format:function(J){var ge=A(J+="",N);return ge.toString=function(){return J},ge},parse:function(J){var ge=j(J+="",!1);return ge.toString=function(){return J},ge},utcFormat:function(J){var ge=A(J+="",S);return ge.toString=function(){return J},ge},utcParse:function(J){var ge=j(J+="",!0);return ge.toString=function(){return J},ge}}}var VV={"-":"",_:" ",0:"0"},Yr=/^\s*\d+/,vEe=/^%/,xEe=/[\\^$*+?|[\]().{}]/g;function Wt(t,e,n){var r=t<0?"-":"",s=(r?-t:t)+"",i=s.length;return r+(i<n?new Array(n-i+1).join(e)+s:s)}function bEe(t){return t.replace(xEe,"\\$&")}function Bm(t){return new RegExp("^(?:"+t.map(bEe).join("|")+")","i")}function Vm(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function wEe(t,e,n){var r=Yr.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function NEe(t,e,n){var r=Yr.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function SEe(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function _Ee(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function jEe(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function $V(t,e,n){var r=Yr.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function UV(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function EEe(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function CEe(t,e,n){var r=Yr.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function TEe(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function zV(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function AEe(t,e,n){var r=Yr.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function HV(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function kEe(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function IEe(t,e,n){var r=Yr.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function PEe(t,e,n){var r=Yr.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function OEe(t,e,n){var r=Yr.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function DEe(t,e,n){var r=vEe.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function REe(t,e,n){var r=Yr.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function MEe(t,e,n){var r=Yr.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function WV(t,e){return Wt(t.getDate(),e,2)}function LEe(t,e){return Wt(t.getHours(),e,2)}function FEe(t,e){return Wt(t.getHours()%12||12,e,2)}function BEe(t,e){return Wt(1+zv.count(Ml(t),t),e,3)}function CK(t,e){return Wt(t.getMilliseconds(),e,3)}function VEe(t,e){return CK(t,e)+"000"}function $Ee(t,e){return Wt(t.getMonth()+1,e,2)}function UEe(t,e){return Wt(t.getMinutes(),e,2)}function zEe(t,e){return Wt(t.getSeconds(),e,2)}function HEe(t){var e=t.getDay();return e===0?7:e}function WEe(t,e){return Wt(ES.count(Ml(t)-1,t),e,2)}function TK(t){var e=t.getDay();return e>=4||e===0?_p(t):_p.ceil(t)}function qEe(t,e){return t=TK(t),Wt(_p.count(Ml(t),t)+(Ml(t).getDay()===4),e,2)}function GEe(t){return t.getDay()}function KEe(t,e){return Wt(b1.count(Ml(t)-1,t),e,2)}function YEe(t,e){return Wt(t.getFullYear()%100,e,2)}function QEe(t,e){return t=TK(t),Wt(t.getFullYear()%100,e,2)}function XEe(t,e){return Wt(t.getFullYear()%1e4,e,4)}function JEe(t,e){var n=t.getDay();return t=n>=4||n===0?_p(t):_p.ceil(t),Wt(t.getFullYear()%1e4,e,4)}function ZEe(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Wt(e/60|0,"0",2)+Wt(e%60,"0",2)}function qV(t,e){return Wt(t.getUTCDate(),e,2)}function eCe(t,e){return Wt(t.getUTCHours(),e,2)}function tCe(t,e){return Wt(t.getUTCHours()%12||12,e,2)}function nCe(t,e){return Wt(1+jS.count(Ll(t),t),e,3)}function AK(t,e){return Wt(t.getUTCMilliseconds(),e,3)}function rCe(t,e){return AK(t,e)+"000"}function sCe(t,e){return Wt(t.getUTCMonth()+1,e,2)}function iCe(t,e){return Wt(t.getUTCMinutes(),e,2)}function aCe(t,e){return Wt(t.getUTCSeconds(),e,2)}function oCe(t){var e=t.getUTCDay();return e===0?7:e}function lCe(t,e){return Wt(CS.count(Ll(t)-1,t),e,2)}function kK(t){var e=t.getUTCDay();return e>=4||e===0?jp(t):jp.ceil(t)}function cCe(t,e){return t=kK(t),Wt(jp.count(Ll(t),t)+(Ll(t).getUTCDay()===4),e,2)}function uCe(t){return t.getUTCDay()}function dCe(t,e){return Wt(w1.count(Ll(t)-1,t),e,2)}function hCe(t,e){return Wt(t.getUTCFullYear()%100,e,2)}function fCe(t,e){return t=kK(t),Wt(t.getUTCFullYear()%100,e,2)}function pCe(t,e){return Wt(t.getUTCFullYear()%1e4,e,4)}function mCe(t,e){var n=t.getUTCDay();return t=n>=4||n===0?jp(t):jp.ceil(t),Wt(t.getUTCFullYear()%1e4,e,4)}function gCe(){return"+0000"}function GV(){return"%"}function KV(t){return+t}function YV(t){return Math.floor(+t/1e3)}var Vh,IK,PK;yCe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function yCe(t){return Vh=yEe(t),IK=Vh.format,Vh.parse,PK=Vh.utcFormat,Vh.utcParse,Vh}function vCe(t){return new Date(t)}function xCe(t){return t instanceof Date?+t:+new Date(+t)}function gO(t,e,n,r,s,i,a,l,c,u){var d=nO(),h=d.invert,f=d.domain,p=u(".%L"),m=u(":%S"),g=u("%I:%M"),y=u("%I %p"),x=u("%a %d"),w=u("%b %d"),N=u("%B"),S=u("%Y");function C(A){return(c(A)<A?p:l(A)<A?m:a(A)<A?g:i(A)<A?y:r(A)<A?s(A)<A?x:w:n(A)<A?N:S)(A)}return d.invert=function(A){return new Date(h(A))},d.domain=function(A){return arguments.length?f(Array.from(A,xCe)):f().map(vCe)},d.ticks=function(A){var j=f();return t(j[0],j[j.length-1],A??10)},d.tickFormat=function(A,j){return j==null?C:u(j)},d.nice=function(A){var j=f();return(!A||typeof A.range!="function")&&(A=e(j[0],j[j.length-1],A??10)),A?f(vK(j,A)):d},d.copy=function(){return Uv(d,gO(t,e,n,r,s,i,a,l,c,u))},d}function bCe(){return Pa.apply(gO(mEe,gEe,Ml,pO,ES,zv,hO,uO,gd,IK).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function wCe(){return Pa.apply(gO(fEe,pEe,Ll,mO,CS,jS,fO,dO,gd,PK).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function TS(){var t=0,e=1,n,r,s,i,a=Hs,l=!1,c;function u(h){return h==null||isNaN(h=+h)?c:a(s===0?.5:(h=(i(h)-n)*s,l?Math.max(0,Math.min(1,h)):h))}u.domain=function(h){return arguments.length?([t,e]=h,n=i(t=+t),r=i(e=+e),s=n===r?0:1/(r-n),u):[t,e]},u.clamp=function(h){return arguments.length?(l=!!h,u):l},u.interpolator=function(h){return arguments.length?(a=h,u):a};function d(h){return function(f){var p,m;return arguments.length?([p,m]=f,a=h(p,m),u):[a(0),a(1)]}}return u.range=d(Qp),u.rangeRound=d(tO),u.unknown=function(h){return arguments.length?(c=h,u):c},function(h){return i=h,n=h(t),r=h(e),s=n===r?0:1/(r-n),u}}function Bu(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function OK(){var t=Fu(TS()(Hs));return t.copy=function(){return Bu(t,OK())},Xl.apply(t,arguments)}function DK(){var t=iO(TS()).domain([1,10]);return t.copy=function(){return Bu(t,DK()).base(t.base())},Xl.apply(t,arguments)}function RK(){var t=aO(TS());return t.copy=function(){return Bu(t,RK()).constant(t.constant())},Xl.apply(t,arguments)}function yO(){var t=oO(TS());return t.copy=function(){return Bu(t,yO()).exponent(t.exponent())},Xl.apply(t,arguments)}function NCe(){return yO.apply(null,arguments).exponent(.5)}function MK(){var t=[],e=Hs;function n(r){if(r!=null&&!isNaN(r=+r))return e((Vv(t,r,1)-1)/(t.length-1))}return n.domain=function(r){if(!arguments.length)return t.slice();t=[];for(let s of r)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(eu),n},n.interpolator=function(r){return arguments.length?(e=r,n):e},n.range=function(){return t.map((r,s)=>e(s/(t.length-1)))},n.quantiles=function(r){return Array.from({length:r+1},(s,i)=>oje(t,i/r))},n.copy=function(){return MK(e).domain(t)},Xl.apply(n,arguments)}function AS(){var t=0,e=.5,n=1,r=1,s,i,a,l,c,u=Hs,d,h=!1,f;function p(g){return isNaN(g=+g)?f:(g=.5+((g=+d(g))-i)*(r*g<r*i?l:c),u(h?Math.max(0,Math.min(1,g)):g))}p.domain=function(g){return arguments.length?([t,e,n]=g,s=d(t=+t),i=d(e=+e),a=d(n=+n),l=s===i?0:.5/(i-s),c=i===a?0:.5/(a-i),r=i<s?-1:1,p):[t,e,n]},p.clamp=function(g){return arguments.length?(h=!!g,p):h},p.interpolator=function(g){return arguments.length?(u=g,p):u};function m(g){return function(y){var x,w,N;return arguments.length?([x,w,N]=y,u=Dje(g,[x,w,N]),p):[u(0),u(.5),u(1)]}}return p.range=m(Qp),p.rangeRound=m(tO),p.unknown=function(g){return arguments.length?(f=g,p):f},function(g){return d=g,s=g(t),i=g(e),a=g(n),l=s===i?0:.5/(i-s),c=i===a?0:.5/(a-i),r=i<s?-1:1,p}}function LK(){var t=Fu(AS()(Hs));return t.copy=function(){return Bu(t,LK())},Xl.apply(t,arguments)}function FK(){var t=iO(AS()).domain([.1,1,10]);return t.copy=function(){return Bu(t,FK()).base(t.base())},Xl.apply(t,arguments)}function BK(){var t=aO(AS());return t.copy=function(){return Bu(t,BK()).constant(t.constant())},Xl.apply(t,arguments)}function vO(){var t=oO(AS());return t.copy=function(){return Bu(t,vO()).exponent(t.exponent())},Xl.apply(t,arguments)}function SCe(){return vO.apply(null,arguments).exponent(.5)}const rg=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:JP,scaleDiverging:LK,scaleDivergingLog:FK,scaleDivergingPow:vO,scaleDivergingSqrt:SCe,scaleDivergingSymlog:BK,scaleIdentity:yK,scaleImplicit:zT,scaleLinear:gK,scaleLog:xK,scaleOrdinal:XP,scalePoint:uje,scalePow:lO,scaleQuantile:NK,scaleQuantize:SK,scaleRadial:wK,scaleSequential:OK,scaleSequentialLog:DK,scaleSequentialPow:yO,scaleSequentialQuantile:MK,scaleSequentialSqrt:NCe,scaleSequentialSymlog:RK,scaleSqrt:rEe,scaleSymlog:bK,scaleThreshold:_K,scaleTime:bCe,scaleUtc:wCe,tickFormat:mK},Symbol.toStringTag,{value:"Module"}));var Vu=t=>t.chartData,_Ce=ce([Vu],t=>{var e=t.chartData!=null?t.chartData.length-1:0;return{chartData:t.chartData,computedData:t.computedData,dataEndIndex:e,dataStartIndex:0}}),xO=(t,e,n,r)=>r?_Ce(t):Vu(t);function Fl(t){if(Array.isArray(t)&&t.length===2){var[e,n]=t;if(Ct(e)&&Ct(n))return!0}return!1}function QV(t,e,n){return n?t:[Math.min(t[0],e[0]),Math.max(t[1],e[1])]}function VK(t,e){if(e&&typeof t!="function"&&Array.isArray(t)&&t.length===2){var[n,r]=t,s,i;if(Ct(n))s=n;else if(typeof n=="function")return;if(Ct(r))i=r;else if(typeof r=="function")return;var a=[s,i];if(Fl(a))return a}}function jCe(t,e,n){if(!(!n&&e==null)){if(typeof t=="function"&&e!=null)try{var r=t(e,n);if(Fl(r))return QV(r,e,n)}catch{}if(Array.isArray(t)&&t.length===2){var[s,i]=t,a,l;if(s==="auto")e!=null&&(a=Math.min(...e));else if(tt(s))a=s;else if(typeof s=="function")try{e!=null&&(a=s(e==null?void 0:e[0]))}catch{}else if(typeof s=="string"&&mB.test(s)){var c=mB.exec(s);if(c==null||c[1]==null||e==null)a=void 0;else{var u=+c[1];a=e[0]-u}}else a=e==null?void 0:e[0];if(i==="auto")e!=null&&(l=Math.max(...e));else if(tt(i))l=i;else if(typeof i=="function")try{e!=null&&(l=i(e==null?void 0:e[1]))}catch{}else if(typeof i=="string"&&gB.test(i)){var d=gB.exec(i);if(d==null||d[1]==null||e==null)l=void 0;else{var h=+d[1];l=e[1]+h}}else l=e==null?void 0:e[1];var f=[a,l];if(Fl(f))return e==null?f:QV(f,e,n)}}}var Xp=1e9,ECe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},wO,kn=!0,ka="[DecimalError] ",Id=ka+"Invalid argument: ",bO=ka+"Exponent out of range: ",Jp=Math.floor,ed=Math.pow,CCe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Di,Rr=1e7,bn=7,$K=9007199254740991,N1=Jp($K/bn),He={};He.absoluteValue=He.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};He.comparedTo=He.cmp=function(t){var e,n,r,s,i=this;if(t=new i.constructor(t),i.s!==t.s)return i.s||-t.s;if(i.e!==t.e)return i.e>t.e^i.s<0?1:-1;for(r=i.d.length,s=t.d.length,e=0,n=r<s?r:s;e<n;++e)if(i.d[e]!==t.d[e])return i.d[e]>t.d[e]^i.s<0?1:-1;return r===s?0:r>s^i.s<0?1:-1};He.decimalPlaces=He.dp=function(){var t=this,e=t.d.length-1,n=(e-t.e)*bn;if(e=t.d[e],e)for(;e%10==0;e/=10)n--;return n<0?0:n};He.dividedBy=He.div=function(t){return wl(this,new this.constructor(t))};He.dividedToIntegerBy=He.idiv=function(t){var e=this,n=e.constructor;return cn(wl(e,new n(t),0,1),n.precision)};He.equals=He.eq=function(t){return!this.cmp(t)};He.exponent=function(){return pr(this)};He.greaterThan=He.gt=function(t){return this.cmp(t)>0};He.greaterThanOrEqualTo=He.gte=function(t){return this.cmp(t)>=0};He.isInteger=He.isint=function(){return this.e>this.d.length-2};He.isNegative=He.isneg=function(){return this.s<0};He.isPositive=He.ispos=function(){return this.s>0};He.isZero=function(){return this.s===0};He.lessThan=He.lt=function(t){return this.cmp(t)<0};He.lessThanOrEqualTo=He.lte=function(t){return this.cmp(t)<1};He.logarithm=He.log=function(t){var e,n=this,r=n.constructor,s=r.precision,i=s+5;if(t===void 0)t=new r(10);else if(t=new r(t),t.s<1||t.eq(Di))throw Error(ka+"NaN");if(n.s<1)throw Error(ka+(n.s?"NaN":"-Infinity"));return n.eq(Di)?new r(0):(kn=!1,e=wl(zy(n,i),zy(t,i),i),kn=!0,cn(e,s))};He.minus=He.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?HK(e,t):UK(e,(t.s=-t.s,t))};He.modulo=He.mod=function(t){var e,n=this,r=n.constructor,s=r.precision;if(t=new r(t),!t.s)throw Error(ka+"NaN");return n.s?(kn=!1,e=wl(n,t,0,1).times(t),kn=!0,n.minus(e)):cn(new r(n),s)};He.naturalExponential=He.exp=function(){return zK(this)};He.naturalLogarithm=He.ln=function(){return zy(this)};He.negated=He.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};He.plus=He.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?UK(e,t):HK(e,(t.s=-t.s,t))};He.precision=He.sd=function(t){var e,n,r,s=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Id+t);if(e=pr(s)+1,r=s.d.length-1,n=r*bn+1,r=s.d[r],r){for(;r%10==0;r/=10)n--;for(r=s.d[0];r>=10;r/=10)n++}return t&&e>n?e:n};He.squareRoot=He.sqrt=function(){var t,e,n,r,s,i,a,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(ka+"NaN")}for(t=pr(l),kn=!1,s=Math.sqrt(+l),s==0||s==1/0?(e=bo(l.d),(e.length+t)%2==0&&(e+="0"),s=Math.sqrt(e),t=Jp((t+1)/2)-(t<0||t%2),s==1/0?e="5e"+t:(e=s.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),r=new c(e)):r=new c(s.toString()),n=c.precision,s=a=n+3;;)if(i=r,r=i.plus(wl(l,i,a+2)).times(.5),bo(i.d).slice(0,a)===(e=bo(r.d)).slice(0,a)){if(e=e.slice(a-3,a+1),s==a&&e=="4999"){if(cn(i,n+1,0),i.times(i).eq(l)){r=i;break}}else if(e!="9999")break;a+=4}return kn=!0,cn(r,n)};He.times=He.mul=function(t){var e,n,r,s,i,a,l,c,u,d=this,h=d.constructor,f=d.d,p=(t=new h(t)).d;if(!d.s||!t.s)return new h(0);for(t.s*=d.s,n=d.e+t.e,c=f.length,u=p.length,c<u&&(i=f,f=p,p=i,a=c,c=u,u=a),i=[],a=c+u,r=a;r--;)i.push(0);for(r=u;--r>=0;){for(e=0,s=c+r;s>r;)l=i[s]+p[r]*f[s-r-1]+e,i[s--]=l%Rr|0,e=l/Rr|0;i[s]=(i[s]+e)%Rr|0}for(;!i[--a];)i.pop();return e?++n:i.shift(),t.d=i,t.e=n,kn?cn(t,h.precision):t};He.toDecimalPlaces=He.todp=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(Fo(t,0,Xp),e===void 0?e=r.rounding:Fo(e,0,8),cn(n,t+pr(n)+1,e))};He.toExponential=function(t,e){var n,r=this,s=r.constructor;return t===void 0?n=dh(r,!0):(Fo(t,0,Xp),e===void 0?e=s.rounding:Fo(e,0,8),r=cn(new s(r),t+1,e),n=dh(r,!0,t+1)),n};He.toFixed=function(t,e){var n,r,s=this,i=s.constructor;return t===void 0?dh(s):(Fo(t,0,Xp),e===void 0?e=i.rounding:Fo(e,0,8),r=cn(new i(s),t+pr(s)+1,e),n=dh(r.abs(),!1,t+pr(r)+1),s.isneg()&&!s.isZero()?"-"+n:n)};He.toInteger=He.toint=function(){var t=this,e=t.constructor;return cn(new e(t),pr(t)+1,e.rounding)};He.toNumber=function(){return+this};He.toPower=He.pow=function(t){var e,n,r,s,i,a,l=this,c=l.constructor,u=12,d=+(t=new c(t));if(!t.s)return new c(Di);if(l=new c(l),!l.s){if(t.s<1)throw Error(ka+"Infinity");return l}if(l.eq(Di))return l;if(r=c.precision,t.eq(Di))return cn(l,r);if(e=t.e,n=t.d.length-1,a=e>=n,i=l.s,a){if((n=d<0?-d:d)<=$K){for(s=new c(Di),e=Math.ceil(r/bn+4),kn=!1;n%2&&(s=s.times(l),JV(s.d,e)),n=Jp(n/2),n!==0;)l=l.times(l),JV(l.d,e);return kn=!0,t.s<0?new c(Di).div(s):cn(s,r)}}else if(i<0)throw Error(ka+"NaN");return i=i<0&&t.d[Math.max(e,n)]&1?-1:1,l.s=1,kn=!1,s=t.times(zy(l,r+u)),kn=!0,s=zK(s),s.s=i,s};He.toPrecision=function(t,e){var n,r,s=this,i=s.constructor;return t===void 0?(n=pr(s),r=dh(s,n<=i.toExpNeg||n>=i.toExpPos)):(Fo(t,1,Xp),e===void 0?e=i.rounding:Fo(e,0,8),s=cn(new i(s),t,e),n=pr(s),r=dh(s,t<=n||n<=i.toExpNeg,t)),r};He.toSignificantDigits=He.tosd=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(Fo(t,1,Xp),e===void 0?e=r.rounding:Fo(e,0,8)),cn(new r(n),t,e)};He.toString=He.valueOf=He.val=He.toJSON=He[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=pr(t),n=t.constructor;return dh(t,e<=n.toExpNeg||e>=n.toExpPos)};function UK(t,e){var n,r,s,i,a,l,c,u,d=t.constructor,h=d.precision;if(!t.s||!e.s)return e.s||(e=new d(t)),kn?cn(e,h):e;if(c=t.d,u=e.d,a=t.e,s=e.e,c=c.slice(),i=a-s,i){for(i<0?(r=c,i=-i,l=u.length):(r=u,s=a,l=c.length),a=Math.ceil(h/bn),l=a>l?a+1:l+1,i>l&&(i=l,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for(l=c.length,i=u.length,l-i<0&&(i=l,r=u,u=c,c=r),n=0;i;)n=(c[--i]=c[i]+u[i]+n)/Rr|0,c[i]%=Rr;for(n&&(c.unshift(n),++s),l=c.length;c[--l]==0;)c.pop();return e.d=c,e.e=s,kn?cn(e,h):e}function Fo(t,e,n){if(t!==~~t||t<e||t>n)throw Error(Id+t)}function bo(t){var e,n,r,s=t.length-1,i="",a=t[0];if(s>0){for(i+=a,e=1;e<s;e++)r=t[e]+"",n=bn-r.length,n&&(i+=pc(n)),i+=r;a=t[e],r=a+"",n=bn-r.length,n&&(i+=pc(n))}else if(a===0)return"0";for(;a%10===0;)a/=10;return i+a}var wl=function(){function t(r,s){var i,a=0,l=r.length;for(r=r.slice();l--;)i=r[l]*s+a,r[l]=i%Rr|0,a=i/Rr|0;return a&&r.unshift(a),r}function e(r,s,i,a){var l,c;if(i!=a)c=i>a?1:-1;else for(l=c=0;l<i;l++)if(r[l]!=s[l]){c=r[l]>s[l]?1:-1;break}return c}function n(r,s,i){for(var a=0;i--;)r[i]-=a,a=r[i]<s[i]?1:0,r[i]=a*Rr+r[i]-s[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,s,i,a){var l,c,u,d,h,f,p,m,g,y,x,w,N,S,C,A,j,_,E=r.constructor,I=r.s==s.s?1:-1,T=r.d,P=s.d;if(!r.s)return new E(r);if(!s.s)throw Error(ka+"Division by zero");for(c=r.e-s.e,j=P.length,C=T.length,p=new E(I),m=p.d=[],u=0;P[u]==(T[u]||0);)++u;if(P[u]>(T[u]||0)&&--c,i==null?w=i=E.precision:a?w=i+(pr(r)-pr(s))+1:w=i,w<0)return new E(0);if(w=w/bn+2|0,u=0,j==1)for(d=0,P=P[0],w++;(u<C||d)&&w--;u++)N=d*Rr+(T[u]||0),m[u]=N/P|0,d=N%P|0;else{for(d=Rr/(P[0]+1)|0,d>1&&(P=t(P,d),T=t(T,d),j=P.length,C=T.length),S=j,g=T.slice(0,j),y=g.length;y<j;)g[y++]=0;_=P.slice(),_.unshift(0),A=P[0],P[1]>=Rr/2&&++A;do d=0,l=e(P,g,j,y),l<0?(x=g[0],j!=y&&(x=x*Rr+(g[1]||0)),d=x/A|0,d>1?(d>=Rr&&(d=Rr-1),h=t(P,d),f=h.length,y=g.length,l=e(h,g,f,y),l==1&&(d--,n(h,j<f?_:P,f))):(d==0&&(l=d=1),h=P.slice()),f=h.length,f<y&&h.unshift(0),n(g,h,y),l==-1&&(y=g.length,l=e(P,g,j,y),l<1&&(d++,n(g,j<y?_:P,y))),y=g.length):l===0&&(d++,g=[0]),m[u++]=d,l&&g[0]?g[y++]=T[S]||0:(g=[T[S]],y=1);while((S++<C||g[0]!==void 0)&&w--)}return m[0]||m.shift(),p.e=c,cn(p,a?i+pr(p)+1:i)}}();function zK(t,e){var n,r,s,i,a,l,c=0,u=0,d=t.constructor,h=d.precision;if(pr(t)>16)throw Error(bO+pr(t));if(!t.s)return new d(Di);for(kn=!1,l=h,a=new d(.03125);t.abs().gte(.1);)t=t.times(a),u+=5;for(r=Math.log(ed(2,u))/Math.LN10*2+5|0,l+=r,n=s=i=new d(Di),d.precision=l;;){if(s=cn(s.times(t),l),n=n.times(++c),a=i.plus(wl(s,n,l)),bo(a.d).slice(0,l)===bo(i.d).slice(0,l)){for(;u--;)i=cn(i.times(i),l);return d.precision=h,e==null?(kn=!0,cn(i,h)):i}i=a}}function pr(t){for(var e=t.e*bn,n=t.d[0];n>=10;n/=10)e++;return e}function Gj(t,e,n){if(e>t.LN10.sd())throw kn=!0,n&&(t.precision=n),Error(ka+"LN10 precision limit exceeded");return cn(new t(t.LN10),e)}function pc(t){for(var e="";t--;)e+="0";return e}function zy(t,e){var n,r,s,i,a,l,c,u,d,h=1,f=10,p=t,m=p.d,g=p.constructor,y=g.precision;if(p.s<1)throw Error(ka+(p.s?"NaN":"-Infinity"));if(p.eq(Di))return new g(0);if(e==null?(kn=!1,u=y):u=e,p.eq(10))return e==null&&(kn=!0),Gj(g,u);if(u+=f,g.precision=u,n=bo(m),r=n.charAt(0),i=pr(p),Math.abs(i)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)p=p.times(t),n=bo(p.d),r=n.charAt(0),h++;i=pr(p),r>1?(p=new g("0."+n),i++):p=new g(r+"."+n.slice(1))}else return c=Gj(g,u+2,y).times(i+""),p=zy(new g(r+"."+n.slice(1)),u-f).plus(c),g.precision=y,e==null?(kn=!0,cn(p,y)):p;for(l=a=p=wl(p.minus(Di),p.plus(Di),u),d=cn(p.times(p),u),s=3;;){if(a=cn(a.times(d),u),c=l.plus(wl(a,new g(s),u)),bo(c.d).slice(0,u)===bo(l.d).slice(0,u))return l=l.times(2),i!==0&&(l=l.plus(Gj(g,u+2,y).times(i+""))),l=wl(l,new g(h),u),g.precision=y,e==null?(kn=!0,cn(l,y)):l;l=c,s+=2}}function XV(t,e){var n,r,s;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;)++r;for(s=e.length;e.charCodeAt(s-1)===48;)--s;if(e=e.slice(r,s),e){if(s-=r,n=n-r-1,t.e=Jp(n/bn),t.d=[],r=(n+1)%bn,n<0&&(r+=bn),r<s){for(r&&t.d.push(+e.slice(0,r)),s-=bn;r<s;)t.d.push(+e.slice(r,r+=bn));e=e.slice(r),r=bn-e.length}else r-=s;for(;r--;)e+="0";if(t.d.push(+e),kn&&(t.e>N1||t.e<-N1))throw Error(bO+n)}else t.s=0,t.e=0,t.d=[0];return t}function cn(t,e,n){var r,s,i,a,l,c,u,d,h=t.d;for(a=1,i=h[0];i>=10;i/=10)a++;if(r=e-a,r<0)r+=bn,s=e,u=h[d=0];else{if(d=Math.ceil((r+1)/bn),i=h.length,d>=i)return t;for(u=i=h[d],a=1;i>=10;i/=10)a++;r%=bn,s=r-bn+a}if(n!==void 0&&(i=ed(10,a-s-1),l=u/i%10|0,c=e<0||h[d+1]!==void 0||u%i,c=n<4?(l||c)&&(n==0||n==(t.s<0?3:2)):l>5||l==5&&(n==4||c||n==6&&(r>0?s>0?u/ed(10,a-s):0:h[d-1])%10&1||n==(t.s<0?8:7))),e<1||!h[0])return c?(i=pr(t),h.length=1,e=e-i-1,h[0]=ed(10,(bn-e%bn)%bn),t.e=Jp(-e/bn)||0):(h.length=1,h[0]=t.e=t.s=0),t;if(r==0?(h.length=d,i=1,d--):(h.length=d+1,i=ed(10,bn-r),h[d]=s>0?(u/ed(10,a-s)%ed(10,s)|0)*i:0),c)for(;;)if(d==0){(h[0]+=i)==Rr&&(h[0]=1,++t.e);break}else{if(h[d]+=i,h[d]!=Rr)break;h[d--]=0,i=1}for(r=h.length;h[--r]===0;)h.pop();if(kn&&(t.e>N1||t.e<-N1))throw Error(bO+pr(t));return t}function HK(t,e){var n,r,s,i,a,l,c,u,d,h,f=t.constructor,p=f.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new f(t),kn?cn(e,p):e;if(c=t.d,h=e.d,r=e.e,u=t.e,c=c.slice(),a=u-r,a){for(d=a<0,d?(n=c,a=-a,l=h.length):(n=h,r=u,l=c.length),s=Math.max(Math.ceil(p/bn),l)+2,a>s&&(a=s,n.length=1),n.reverse(),s=a;s--;)n.push(0);n.reverse()}else{for(s=c.length,l=h.length,d=s<l,d&&(l=s),s=0;s<l;s++)if(c[s]!=h[s]){d=c[s]<h[s];break}a=0}for(d&&(n=c,c=h,h=n,e.s=-e.s),l=c.length,s=h.length-l;s>0;--s)c[l++]=0;for(s=h.length;s>a;){if(c[--s]<h[s]){for(i=s;i&&c[--i]===0;)c[i]=Rr-1;--c[i],c[s]+=Rr}c[s]-=h[s]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--r;return c[0]?(e.d=c,e.e=r,kn?cn(e,p):e):new f(0)}function dh(t,e,n){var r,s=pr(t),i=bo(t.d),a=i.length;return e?(n&&(r=n-a)>0?i=i.charAt(0)+"."+i.slice(1)+pc(r):a>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(s<0?"e":"e+")+s):s<0?(i="0."+pc(-s-1)+i,n&&(r=n-a)>0&&(i+=pc(r))):s>=a?(i+=pc(s+1-a),n&&(r=n-s-1)>0&&(i=i+"."+pc(r))):((r=s+1)<a&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-a)>0&&(s+1===a&&(i+="."),i+=pc(r))),t.s<0?"-"+i:i}function JV(t,e){if(t.length>e)return t.length=e,!0}function WK(t){var e,n,r;function s(i){var a=this;if(!(a instanceof s))return new s(i);if(a.constructor=s,i instanceof s){a.s=i.s,a.e=i.e,a.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(Id+i);if(i>0)a.s=1;else if(i<0)i=-i,a.s=-1;else{a.s=0,a.e=0,a.d=[0];return}if(i===~~i&&i<1e7){a.e=0,a.d=[i];return}return XV(a,i.toString())}else if(typeof i!="string")throw Error(Id+i);if(i.charCodeAt(0)===45?(i=i.slice(1),a.s=-1):a.s=1,CCe.test(i))XV(a,i);else throw Error(Id+i)}if(s.prototype=He,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=WK,s.config=s.set=TCe,t===void 0&&(t={}),t)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return s.config(t),s}function TCe(t){if(!t||typeof t!="object")throw Error(ka+"Object expected");var e,n,r,s=["precision",1,Xp,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<s.length;e+=3)if((r=t[n=s[e]])!==void 0)if(Jp(r)===r&&r>=s[e+1]&&r<=s[e+2])this[n]=r;else throw Error(Id+n+": "+r);if((r=t[n="LN10"])!==void 0)if(r==Math.LN10)this[n]=new this(r);else throw Error(Id+n+": "+r);return this}var wO=WK(ECe);Di=new wO(1);const Xt=wO;function qK(t){var e;return t===0?e=1:e=Math.floor(new Xt(t).abs().log(10).toNumber())+1,e}function GK(t,e,n){for(var r=new Xt(t),s=0,i=[];r.lt(e)&&s<1e5;)i.push(r.toNumber()),r=r.add(n),s++;return i}var KK=t=>{var[e,n]=t,[r,s]=[e,n];return e>n&&([r,s]=[n,e]),[r,s]},YK=(t,e,n)=>{if(t.lte(0))return new Xt(0);var r=qK(t.toNumber()),s=new Xt(10).pow(r),i=t.div(s),a=r!==1?.05:.1,l=new Xt(Math.ceil(i.div(a).toNumber())).add(n).mul(a),c=l.mul(s);return e?new Xt(c.toNumber()):new Xt(Math.ceil(c.toNumber()))},ACe=(t,e,n)=>{var r=new Xt(1),s=new Xt(t);if(!s.isint()&&n){var i=Math.abs(t);i<1?(r=new Xt(10).pow(qK(t)-1),s=new Xt(Math.floor(s.div(r).toNumber())).mul(r)):i>1&&(s=new Xt(Math.floor(t)))}else t===0?s=new Xt(Math.floor((e-1)/2)):n||(s=new Xt(Math.floor(t)));for(var a=Math.floor((e-1)/2),l=[],c=0;c<e;c++)l.push(s.add(new Xt(c-a).mul(r)).toNumber());return l},QK=function(e,n,r,s){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(r-1)))return{step:new Xt(0),tickMin:new Xt(0),tickMax:new Xt(0)};var a=YK(new Xt(n).sub(e).div(r-1),s,i),l;e<=0&&n>=0?l=new Xt(0):(l=new Xt(e).add(n).div(2),l=l.sub(new Xt(l).mod(a)));var c=Math.ceil(l.sub(e).div(a).toNumber()),u=Math.ceil(new Xt(n).sub(l).div(a).toNumber()),d=c+u+1;return d>r?QK(e,n,r,s,i+1):(d<r&&(u=n>0?u+(r-d):u,c=n>0?c:c+(r-d)),{step:a,tickMin:l.sub(new Xt(c).mul(a)),tickMax:l.add(new Xt(u).mul(a))})},kCe=function(e){var[n,r]=e,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=Math.max(s,2),[l,c]=KK([n,r]);if(l===-1/0||c===1/0){var u=c===1/0?[l,...Array(s-1).fill(1/0)]:[...Array(s-1).fill(-1/0),c];return n>r?u.reverse():u}if(l===c)return ACe(l,s,i);var{step:d,tickMin:h,tickMax:f}=QK(l,c,a,i,0),p=GK(h,f.add(new Xt(.1).mul(d)),d);return n>r?p.reverse():p},ICe=function(e,n){var[r,s]=e,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[a,l]=KK([r,s]);if(a===-1/0||l===1/0)return[r,s];if(a===l)return[a];var c=Math.max(n,2),u=YK(new Xt(l).sub(a).div(c-1),i,0),d=[...GK(new Xt(a),new Xt(l),u),l];return i===!1&&(d=d.map(h=>Math.round(h))),r>s?d.reverse():d},PCe=t=>t.rootProps.barCategoryGap,kS=t=>t.rootProps.stackOffset,XK=t=>t.rootProps.reverseStackOrder,NO=t=>t.options.chartName,SO=t=>t.rootProps.syncId,JK=t=>t.rootProps.syncMethod,_O=t=>t.options.eventEmitter,Ws={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},Wu={allowDecimals:!1,allowDataOverflow:!1,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"auto"},so={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,includeHidden:!1,radiusAxisId:0,reversed:!1,scale:"auto",tick:!0,tickCount:5,type:"auto"},IS=(t,e)=>{if(!(!t||!e))return t!=null&&t.reversed?[e[1],e[0]]:e};function PS(t,e,n){if(n!=="auto")return n;if(t!=null)return Lu(t,e)?"category":"number"}function ZV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function S1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZV(Object(n),!0).forEach(function(r){OCe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function OCe(t,e,n){return(e=DCe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function DCe(t){var e=RCe(t,"string");return typeof e=="symbol"?e:e+""}function RCe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var e4={allowDataOverflow:Wu.allowDataOverflow,allowDecimals:Wu.allowDecimals,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:Wu.angleAxisId,includeHidden:!1,name:void 0,reversed:Wu.reversed,scale:Wu.scale,tick:Wu.tick,tickCount:void 0,ticks:void 0,type:Wu.type,unit:void 0},t4={allowDataOverflow:so.allowDataOverflow,allowDecimals:so.allowDecimals,allowDuplicatedCategory:so.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:so.radiusAxisId,includeHidden:so.includeHidden,name:void 0,reversed:so.reversed,scale:so.scale,tick:so.tick,tickCount:so.tickCount,ticks:void 0,type:so.type,unit:void 0},MCe=(t,e)=>{if(e!=null)return t.polarAxis.angleAxis[e]},jO=ce([MCe,VG],(t,e)=>{var n;if(t!=null)return t;var r=(n=PS(e,"angleAxis",e4.type))!==null&&n!==void 0?n:"category";return S1(S1({},e4),{},{type:r})}),LCe=(t,e)=>t.polarAxis.radiusAxis[e],EO=ce([LCe,VG],(t,e)=>{var n;if(t!=null)return t;var r=(n=PS(e,"radiusAxis",t4.type))!==null&&n!==void 0?n:"category";return S1(S1({},t4),{},{type:r})}),OS=t=>t.polarOptions,CO=ce([Yl,Ql,xs],B_e),ZK=ce([OS,CO],(t,e)=>{if(t!=null)return vu(t.innerRadius,e,0)}),e7=ce([OS,CO],(t,e)=>{if(t!=null)return vu(t.outerRadius,e,e*.8)}),FCe=t=>{if(t==null)return[0,0];var{startAngle:e,endAngle:n}=t;return[e,n]},t7=ce([OS],FCe);ce([jO,t7],IS);var n7=ce([CO,ZK,e7],(t,e,n)=>{if(!(t==null||e==null||n==null))return[e,n]});ce([EO,n7],IS);var r7=ce([sr,OS,ZK,e7,Yl,Ql],(t,e,n,r,s,i)=>{if(!(t!=="centric"&&t!=="radial"||e==null||n==null||r==null)){var{cx:a,cy:l,startAngle:c,endAngle:u}=e;return{cx:vu(a,s,s/2),cy:vu(l,i,i/2),innerRadius:n,outerRadius:r,startAngle:c,endAngle:u,clockWise:!1}}}),Qr=(t,e)=>e,DS=(t,e,n)=>n;function s7(t){return t==null?void 0:t.id}function i7(t,e,n){var{chartData:r=[]}=e,{allowDuplicatedCategory:s,dataKey:i}=n,a=new Map;return t.forEach(l=>{var c,u=(c=l.data)!==null&&c!==void 0?c:r;if(!(u==null||u.length===0)){var d=s7(l);u.forEach((h,f)=>{var p=i==null||s?f:String(Er(h,i,null)),m=Er(h,l.dataKey,0),g;a.has(p)?g=a.get(p):g={},Object.assign(g,{[d]:m}),a.set(p,g)})}}),Array.from(a.values())}function TO(t){return"stackId"in t&&t.stackId!=null&&t.dataKey!=null}var RS=(t,e)=>t===e?!0:t==null||e==null?!1:t[0]===e[0]&&t[1]===e[1];function MS(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===0&&e.length===0?!0:t===e}function BCe(t,e){if(t.length===e.length){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}var Xr=t=>{var e=sr(t);return e==="horizontal"?"xAxis":e==="vertical"?"yAxis":e==="centric"?"angleAxis":"radiusAxis"},Zp=t=>t.tooltip.settings.axisId;function VCe(t){if(t in rg)return rg[t]();var e="scale".concat(Pv(t));if(e in rg)return rg[e]()}function n4(t){var e=t.ticks,n=t.bandwidth,r=t.range(),s=[Math.min(...r),Math.max(...r)];return{domain:()=>t.domain(),range:function(i){function a(){return i.apply(this,arguments)}return a.toString=function(){return i.toString()},a}(()=>s),rangeMin:()=>s[0],rangeMax:()=>s[1],isInRange(i){var a=s[0],l=s[1];return a<=l?i>=a&&i<=l:i>=l&&i<=a},bandwidth:n?()=>n.call(t):void 0,ticks:e?i=>e.call(t,i):void 0,map:(i,a)=>{var l=t(i);if(l!=null){if(t.bandwidth&&a!==null&&a!==void 0&&a.position){var c=t.bandwidth();switch(a.position){case"middle":l+=c/2;break;case"end":l+=c;break}}return l}}}}function r4(t,e,n){if(typeof t=="function")return n4(t.copy().domain(e).range(n));if(t!=null){var r=VCe(t);if(r!=null)return r.domain(e).range(n),n4(r)}}var $Ce=(t,e)=>{if(e!=null)switch(t){case"linear":{if(!Fl(e)){for(var n,r,s=0;s<e.length;s++){var i=e[s];Ct(i)&&((n===void 0||i<n)&&(n=i),(r===void 0||i>r)&&(r=i))}return n!==void 0&&r!==void 0?[n,r]:void 0}return e}default:return e}};function s4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function _1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?s4(Object(n),!0).forEach(function(r){UCe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function UCe(t,e,n){return(e=zCe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zCe(t){var e=HCe(t,"string");return typeof e=="symbol"?e:e+""}function HCe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var GT=[0,"auto"],Pr={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},a7=(t,e)=>t.cartesianAxis.xAxis[e],Uo=(t,e)=>{var n=a7(t,e);return n??Pr},Or={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:GT,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Mv},o7=(t,e)=>t.cartesianAxis.yAxis[e],zo=(t,e)=>{var n=o7(t,e);return n??Or},l7={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},AO=(t,e)=>{var n=t.cartesianAxis.zAxis[e];return n??l7},ni=(t,e,n)=>{switch(e){case"xAxis":return Uo(t,n);case"yAxis":return zo(t,n);case"zAxis":return AO(t,n);case"angleAxis":return jO(t,n);case"radiusAxis":return EO(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},WCe=(t,e,n)=>{switch(e){case"xAxis":return Uo(t,n);case"yAxis":return zo(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},Hv=(t,e,n)=>{switch(e){case"xAxis":return Uo(t,n);case"yAxis":return zo(t,n);case"angleAxis":return jO(t,n);case"radiusAxis":return EO(t,n);default:throw new Error("Unexpected axis type: ".concat(e))}},c7=t=>t.graphicalItems.cartesianItems.some(e=>e.type==="bar")||t.graphicalItems.polarItems.some(e=>e.type==="radialBar");function u7(t,e){return n=>{switch(t){case"xAxis":return"xAxisId"in n&&n.xAxisId===e;case"yAxis":return"yAxisId"in n&&n.yAxisId===e;case"zAxis":return"zAxisId"in n&&n.zAxisId===e;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===e;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===e;default:return!1}}}var d7=t=>t.graphicalItems.cartesianItems,qCe=ce([Qr,DS],u7),h7=(t,e,n)=>t.filter(n).filter(r=>(e==null?void 0:e.includeHidden)===!0?!0:!r.hide),Wv=ce([d7,ni,qCe],h7,{memoizeOptions:{resultEqualityCheck:MS}}),f7=ce([Wv],t=>t.filter(e=>e.type==="area"||e.type==="bar").filter(TO)),p7=t=>t.filter(e=>!("stackId"in e)||e.stackId===void 0),GCe=ce([Wv],p7),m7=t=>t.map(e=>e.data).filter(Boolean).flat(1),KCe=ce([Wv],m7,{memoizeOptions:{resultEqualityCheck:MS}}),g7=(t,e)=>{var{chartData:n=[],dataStartIndex:r,dataEndIndex:s}=e;return t.length>0?t:n.slice(r,s+1)},kO=ce([KCe,xO],g7),y7=(t,e,n)=>(e==null?void 0:e.dataKey)!=null?t.map(r=>({value:Er(r,e.dataKey)})):n.length>0?n.map(r=>r.dataKey).flatMap(r=>t.map(s=>({value:Er(s,r)}))):t.map(r=>({value:r})),LS=ce([kO,ni,Wv],y7);function v7(t,e){switch(t){case"xAxis":return e.direction==="x";case"yAxis":return e.direction==="y";default:return!1}}function Y0(t){if(Ta(t)||t instanceof Date){var e=Number(t);if(Ct(e))return e}}function i4(t){if(Array.isArray(t)){var e=[Y0(t[0]),Y0(t[1])];return Fl(e)?e:void 0}var n=Y0(t);if(n!=null)return[n,n]}function Bl(t){return t.map(Y0).filter(mi)}function YCe(t,e,n){return!n||typeof e!="number"||Ol(e)?[]:n.length?Bl(n.flatMap(r=>{var s=Er(t,r.dataKey),i,a;if(Array.isArray(s)?[i,a]=s:i=a=s,!(!Ct(i)||!Ct(a)))return[e-i,e+a]})):[]}var Ir=t=>{var e=Xr(t),n=Zp(t);return Hv(t,e,n)},qv=ce([Ir],t=>t==null?void 0:t.dataKey),QCe=ce([f7,xO,Ir],i7),x7=(t,e,n,r)=>{var s={},i=e.reduce((a,l)=>{if(l.stackId==null)return a;var c=a[l.stackId];return c==null&&(c=[]),c.push(l),a[l.stackId]=c,a},s);return Object.fromEntries(Object.entries(i).map(a=>{var[l,c]=a,u=r?[...c].reverse():c,d=u.map(s7);return[l,{stackedData:MNe(t,d,n),graphicalItems:u}]}))},XCe=ce([QCe,f7,kS,XK],x7),b7=(t,e,n,r)=>{var{dataStartIndex:s,dataEndIndex:i}=e;if(r==null&&n!=="zAxis"){var a=BNe(t,s,i);if(!(a!=null&&a[0]===0&&a[1]===0))return a}},JCe=ce([ni],t=>t.allowDataOverflow),IO=t=>{var e;if(t==null||!("domain"in t))return GT;if(t.domain!=null)return t.domain;if("ticks"in t&&t.ticks!=null){if(t.type==="number"){var n=Bl(t.ticks);return[Math.min(...n),Math.max(...n)]}if(t.type==="category")return t.ticks.map(String)}return(e=t==null?void 0:t.domain)!==null&&e!==void 0?e:GT},w7=ce([ni],IO),N7=ce([w7,JCe],VK),ZCe=ce([XCe,Vu,Qr,N7],b7,{memoizeOptions:{resultEqualityCheck:RS}}),PO=t=>t.errorBars,eTe=(t,e,n)=>t.flatMap(r=>e[r.id]).filter(Boolean).filter(r=>v7(n,r)),j1=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var s=n.filter(Boolean);if(s.length!==0){var i=s.flat(),a=Math.min(...i),l=Math.max(...i);return[a,l]}},S7=(t,e,n,r,s)=>{var i,a;if(n.length>0&&t.forEach(l=>{n.forEach(c=>{var u,d,h=(u=r[c.id])===null||u===void 0?void 0:u.filter(x=>v7(s,x)),f=Er(l,(d=e.dataKey)!==null&&d!==void 0?d:c.dataKey),p=YCe(l,f,h);if(p.length>=2){var m=Math.min(...p),g=Math.max(...p);(i==null||m<i)&&(i=m),(a==null||g>a)&&(a=g)}var y=i4(f);y!=null&&(i=i==null?y[0]:Math.min(i,y[0]),a=a==null?y[1]:Math.max(a,y[1]))})}),(e==null?void 0:e.dataKey)!=null&&t.forEach(l=>{var c=i4(Er(l,e.dataKey));c!=null&&(i=i==null?c[0]:Math.min(i,c[0]),a=a==null?c[1]:Math.max(a,c[1]))}),Ct(i)&&Ct(a))return[i,a]},tTe=ce([kO,ni,GCe,PO,Qr],S7,{memoizeOptions:{resultEqualityCheck:RS}});function nTe(t){var{value:e}=t;if(Ta(e)||e instanceof Date)return e}var rTe=(t,e,n)=>{var r=t.map(nTe).filter(s=>s!=null);return n&&(e.dataKey==null||e.allowDuplicatedCategory&&p8(r))?aK(0,t.length):e.allowDuplicatedCategory?r:Array.from(new Set(r))},_7=t=>t.referenceElements.dots,em=(t,e,n)=>t.filter(r=>r.ifOverflow==="extendDomain").filter(r=>e==="xAxis"?r.xAxisId===n:r.yAxisId===n),sTe=ce([_7,Qr,DS],em),j7=t=>t.referenceElements.areas,iTe=ce([j7,Qr,DS],em),E7=t=>t.referenceElements.lines,aTe=ce([E7,Qr,DS],em),C7=(t,e)=>{if(t!=null){var n=Bl(t.map(r=>e==="xAxis"?r.x:r.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},oTe=ce(sTe,Qr,C7),T7=(t,e)=>{if(t!=null){var n=Bl(t.flatMap(r=>[e==="xAxis"?r.x1:r.y1,e==="xAxis"?r.x2:r.y2]));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},lTe=ce([iTe,Qr],T7);function cTe(t){var e;if(t.x!=null)return Bl([t.x]);var n=(e=t.segment)===null||e===void 0?void 0:e.map(r=>r.x);return n==null||n.length===0?[]:Bl(n)}function uTe(t){var e;if(t.y!=null)return Bl([t.y]);var n=(e=t.segment)===null||e===void 0?void 0:e.map(r=>r.y);return n==null||n.length===0?[]:Bl(n)}var A7=(t,e)=>{if(t!=null){var n=t.flatMap(r=>e==="xAxis"?cTe(r):uTe(r));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},dTe=ce([aTe,Qr],A7),hTe=ce(oTe,dTe,lTe,(t,e,n)=>j1(t,n,e)),k7=(t,e,n,r,s,i,a,l)=>{if(n!=null)return n;var c=a==="vertical"&&l==="xAxis"||a==="horizontal"&&l==="yAxis",u=c?j1(r,i,s):j1(i,s);return jCe(e,u,t.allowDataOverflow)},fTe=ce([ni,w7,N7,ZCe,tTe,hTe,sr,Qr],k7,{memoizeOptions:{resultEqualityCheck:RS}}),pTe=[0,1],I7=(t,e,n,r,s,i,a)=>{if(!((t==null||n==null||n.length===0)&&a===void 0)){var{dataKey:l,type:c}=t,u=Lu(e,i);if(u&&l==null){var d;return aK(0,(d=n==null?void 0:n.length)!==null&&d!==void 0?d:0)}return c==="category"?rTe(r,t,u):s==="expand"?pTe:a}},OO=ce([ni,sr,kO,LS,kS,Qr,fTe],I7);function mTe(t){return t in rg}var P7=(t,e,n)=>{if(t!=null){var{scale:r,type:s}=t;if(r==="auto")return s==="category"&&n&&(n.indexOf("LineChart")>=0||n.indexOf("AreaChart")>=0||n.indexOf("ComposedChart")>=0&&!e)?"point":s==="category"?"band":"linear";if(typeof r=="string"){var i="scale".concat(Pv(r));return mTe(i)?i:"point"}}},tm=ce([ni,c7,NO],P7);function DO(t,e,n,r){if(!(n==null||r==null))return typeof t.scale=="function"?r4(t.scale,n,r):r4(e,n,r)}var O7=(t,e,n)=>{var r=IO(e);if(!(n!=="auto"&&n!=="linear")){if(e!=null&&e.tickCount&&Array.isArray(r)&&(r[0]==="auto"||r[1]==="auto")&&Fl(t))return kCe(t,e.tickCount,e.allowDecimals);if(e!=null&&e.tickCount&&e.type==="number"&&Fl(t))return ICe(t,e.tickCount,e.allowDecimals)}},RO=ce([OO,Hv,tm],O7),D7=(t,e,n,r)=>{if(r!=="angleAxis"&&(t==null?void 0:t.type)==="number"&&Fl(e)&&Array.isArray(n)&&n.length>0){var s,i,a=e[0],l=(s=n[0])!==null&&s!==void 0?s:0,c=e[1],u=(i=n[n.length-1])!==null&&i!==void 0?i:0;return[Math.min(a,l),Math.max(c,u)]}return e},gTe=ce([ni,OO,RO,Qr],D7),yTe=ce(LS,ni,(t,e)=>{if(!(!e||e.type!=="number")){var n=1/0,r=Array.from(Bl(t.map(h=>h.value))).sort((h,f)=>h-f),s=r[0],i=r[r.length-1];if(s==null||i==null)return 1/0;var a=i-s;if(a===0)return 1/0;for(var l=0;l<r.length-1;l++){var c=r[l],u=r[l+1];if(!(c==null||u==null)){var d=u-c;n=Math.min(n,d)}}return n/a}}),R7=ce(yTe,sr,PCe,xs,(t,e,n,r,s)=>s,(t,e,n,r,s)=>{if(!Ct(t))return 0;var i=e==="vertical"?r.height:r.width;if(s==="gap")return t*i/2;if(s==="no-gap"){var a=vu(n,t*i),l=t*i/2;return l-a-(l-a)/i*a}return 0}),vTe=(t,e,n)=>{var r=Uo(t,e);return r==null||typeof r.padding!="string"?0:R7(t,"xAxis",e,n,r.padding)},xTe=(t,e,n)=>{var r=zo(t,e);return r==null||typeof r.padding!="string"?0:R7(t,"yAxis",e,n,r.padding)},bTe=ce(Uo,vTe,(t,e)=>{var n,r;if(t==null)return{left:0,right:0};var{padding:s}=t;return typeof s=="string"?{left:e,right:e}:{left:((n=s.left)!==null&&n!==void 0?n:0)+e,right:((r=s.right)!==null&&r!==void 0?r:0)+e}}),wTe=ce(zo,xTe,(t,e)=>{var n,r;if(t==null)return{top:0,bottom:0};var{padding:s}=t;return typeof s=="string"?{top:e,bottom:e}:{top:((n=s.top)!==null&&n!==void 0?n:0)+e,bottom:((r=s.bottom)!==null&&r!==void 0?r:0)+e}}),NTe=ce([xs,bTe,xS,vS,(t,e,n)=>n],(t,e,n,r,s)=>{var{padding:i}=r;return s?[i.left,n.width-i.right]:[t.left+e.left,t.left+t.width-e.right]}),STe=ce([xs,sr,wTe,xS,vS,(t,e,n)=>n],(t,e,n,r,s,i)=>{var{padding:a}=s;return i?[r.height-a.bottom,a.top]:e==="horizontal"?[t.top+t.height-n.bottom,t.top+n.top]:[t.top+n.top,t.top+t.height-n.bottom]}),Gv=(t,e,n,r)=>{var s;switch(e){case"xAxis":return NTe(t,n,r);case"yAxis":return STe(t,n,r);case"zAxis":return(s=AO(t,n))===null||s===void 0?void 0:s.range;case"angleAxis":return t7(t);case"radiusAxis":return n7(t,n);default:return}},M7=ce([ni,Gv],IS),_Te=ce([tm,gTe],$Ce),Ep=ce([ni,tm,_Te,M7],DO);ce([Wv,PO,Qr],eTe);function L7(t,e){return t.id<e.id?-1:t.id>e.id?1:0}var FS=(t,e)=>e,BS=(t,e,n)=>n,jTe=ce(gS,FS,BS,(t,e,n)=>t.filter(r=>r.orientation===e).filter(r=>r.mirror===n).sort(L7)),ETe=ce(yS,FS,BS,(t,e,n)=>t.filter(r=>r.orientation===e).filter(r=>r.mirror===n).sort(L7)),F7=(t,e)=>({width:t.width,height:e.height}),CTe=(t,e)=>{var n=typeof e.width=="number"?e.width:Mv;return{width:n,height:t.height}},TTe=ce(xs,Uo,F7),ATe=(t,e,n)=>{switch(e){case"top":return t.top;case"bottom":return n-t.bottom;default:return 0}},kTe=(t,e,n)=>{switch(e){case"left":return t.left;case"right":return n-t.right;default:return 0}},ITe=ce(Ql,xs,jTe,FS,BS,(t,e,n,r,s)=>{var i={},a;return n.forEach(l=>{var c=F7(e,l);a==null&&(a=ATe(e,r,t));var u=r==="top"&&!s||r==="bottom"&&s;i[l.id]=a-Number(u)*c.height,a+=(u?-1:1)*c.height}),i}),PTe=ce(Yl,xs,ETe,FS,BS,(t,e,n,r,s)=>{var i={},a;return n.forEach(l=>{var c=CTe(e,l);a==null&&(a=kTe(e,r,t));var u=r==="left"&&!s||r==="right"&&s;i[l.id]=a-Number(u)*c.width,a+=(u?-1:1)*c.width}),i}),OTe=(t,e)=>{var n=Uo(t,e);if(n!=null)return ITe(t,n.orientation,n.mirror)},DTe=ce([xs,Uo,OTe,(t,e)=>e],(t,e,n,r)=>{if(e!=null){var s=n==null?void 0:n[r];return s==null?{x:t.left,y:0}:{x:t.left,y:s}}}),RTe=(t,e)=>{var n=zo(t,e);if(n!=null)return PTe(t,n.orientation,n.mirror)},MTe=ce([xs,zo,RTe,(t,e)=>e],(t,e,n,r)=>{if(e!=null){var s=n==null?void 0:n[r];return s==null?{x:0,y:t.top}:{x:s,y:t.top}}}),LTe=ce(xs,zo,(t,e)=>{var n=typeof e.width=="number"?e.width:Mv;return{width:n,height:t.height}}),B7=(t,e,n,r)=>{if(n!=null){var{allowDuplicatedCategory:s,type:i,dataKey:a}=n,l=Lu(t,r),c=e.map(u=>u.value);if(a&&l&&i==="category"&&s&&p8(c))return c}},MO=ce([sr,LS,ni,Qr],B7),V7=(t,e,n,r)=>{if(!(n==null||n.dataKey==null)){var{type:s,scale:i}=n,a=Lu(t,r);if(a&&(s==="number"||i!=="auto"))return e.map(l=>l.value)}},LO=ce([sr,LS,Hv,Qr],V7),a4=ce([sr,WCe,tm,Ep,MO,LO,Gv,RO,Qr],(t,e,n,r,s,i,a,l,c)=>{if(e!=null){var u=Lu(t,c);return{angle:e.angle,interval:e.interval,minTickGap:e.minTickGap,orientation:e.orientation,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit,axisType:c,categoricalDomain:i,duplicateDomain:s,isCategorical:u,niceTicks:l,range:a,realScaleType:n,scale:r}}}),FTe=(t,e,n,r,s,i,a,l,c)=>{if(!(e==null||r==null)){var u=Lu(t,c),{type:d,ticks:h,tickCount:f}=e,p=n==="scaleBand"&&typeof r.bandwidth=="function"?r.bandwidth()/2:2,m=d==="category"&&r.bandwidth?r.bandwidth()/p:0;m=c==="angleAxis"&&i!=null&&i.length>=2?ga(i[0]-i[1])*2*m:m;var g=h||s;return g?g.map((y,x)=>{var w=a?a.indexOf(y):y,N=r.map(w);return Ct(N)?{index:x,coordinate:N+m,value:y,offset:m}:null}).filter(mi):u&&l?l.map((y,x)=>{var w=r.map(y);return Ct(w)?{coordinate:w+m,value:y,index:x,offset:m}:null}).filter(mi):r.ticks?r.ticks(f).map((y,x)=>{var w=r.map(y);return Ct(w)?{coordinate:w+m,value:y,index:x,offset:m}:null}).filter(mi):r.domain().map((y,x)=>{var w=r.map(y);return Ct(w)?{coordinate:w+m,value:a?a[y]:y,index:x,offset:m}:null}).filter(mi)}},$7=ce([sr,Hv,tm,Ep,RO,Gv,MO,LO,Qr],FTe),BTe=(t,e,n,r,s,i,a)=>{if(!(e==null||n==null||r==null||r[0]===r[1])){var l=Lu(t,a),{tickCount:c}=e,u=0;return u=a==="angleAxis"&&(r==null?void 0:r.length)>=2?ga(r[0]-r[1])*2*u:u,l&&i?i.map((d,h)=>{var f=n.map(d);return Ct(f)?{coordinate:f+u,value:d,index:h,offset:u}:null}).filter(mi):n.ticks?n.ticks(c).map((d,h)=>{var f=n.map(d);return Ct(f)?{coordinate:f+u,value:d,index:h,offset:u}:null}).filter(mi):n.domain().map((d,h)=>{var f=n.map(d);return Ct(f)?{coordinate:f+u,value:s?s[d]:d,index:h,offset:u}:null}).filter(mi)}},U7=ce([sr,Hv,Ep,Gv,MO,LO,Qr],BTe),z7=ce(ni,Ep,(t,e)=>{if(!(t==null||e==null))return _1(_1({},t),{},{scale:e})}),VTe=ce([ni,tm,OO,M7],DO),$Te=ce((t,e,n)=>AO(t,n),VTe,(t,e)=>{if(!(t==null||e==null))return _1(_1({},t),{},{scale:e})}),UTe=ce([sr,gS,yS],(t,e,n)=>{switch(t){case"horizontal":return e.some(r=>r.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(r=>r.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),H7=t=>t.options.defaultTooltipEventType,W7=t=>t.options.validateTooltipEventTypes;function q7(t,e,n){if(t==null)return e;var r=t?"axis":"item";return n==null?e:n.includes(r)?r:e}function FO(t,e){var n=H7(t),r=W7(t);return q7(e,n,r)}function zTe(t){return Ze(e=>FO(e,t))}var G7=(t,e)=>{var n,r=Number(e);if(!(Ol(r)||e==null))return r>=0?t==null||(n=t[r])===null||n===void 0?void 0:n.value:void 0},HTe=t=>t.tooltip.settings,Tc={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},WTe={itemInteraction:{click:Tc,hover:Tc},axisInteraction:{click:Tc,hover:Tc},keyboardInteraction:Tc,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},K7=_i({name:"tooltip",initialState:WTe,reducers:{addTooltipEntrySettings:{reducer(t,e){t.tooltipItemPayloads.push(e.payload)},prepare:En()},replaceTooltipEntrySettings:{reducer(t,e){var{prev:n,next:r}=e.payload,s=Ga(t).tooltipItemPayloads.indexOf(n);s>-1&&(t.tooltipItemPayloads[s]=r)},prepare:En()},removeTooltipEntrySettings:{reducer(t,e){var n=Ga(t).tooltipItemPayloads.indexOf(e.payload);n>-1&&t.tooltipItemPayloads.splice(n,1)},prepare:En()},setTooltipSettingsState(t,e){t.settings=e.payload},setActiveMouseOverItemIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.itemInteraction.hover.active=!0,t.itemInteraction.hover.index=e.payload.activeIndex,t.itemInteraction.hover.dataKey=e.payload.activeDataKey,t.itemInteraction.hover.graphicalItemId=e.payload.activeGraphicalItemId,t.itemInteraction.hover.coordinate=e.payload.activeCoordinate},mouseLeaveChart(t){t.itemInteraction.hover.active=!1,t.axisInteraction.hover.active=!1},mouseLeaveItem(t){t.itemInteraction.hover.active=!1},setActiveClickItemIndex(t,e){t.syncInteraction.active=!1,t.itemInteraction.click.active=!0,t.keyboardInteraction.active=!1,t.itemInteraction.click.index=e.payload.activeIndex,t.itemInteraction.click.dataKey=e.payload.activeDataKey,t.itemInteraction.click.graphicalItemId=e.payload.activeGraphicalItemId,t.itemInteraction.click.coordinate=e.payload.activeCoordinate},setMouseOverAxisIndex(t,e){t.syncInteraction.active=!1,t.axisInteraction.hover.active=!0,t.keyboardInteraction.active=!1,t.axisInteraction.hover.index=e.payload.activeIndex,t.axisInteraction.hover.dataKey=e.payload.activeDataKey,t.axisInteraction.hover.coordinate=e.payload.activeCoordinate},setMouseClickAxisIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.axisInteraction.click.active=!0,t.axisInteraction.click.index=e.payload.activeIndex,t.axisInteraction.click.dataKey=e.payload.activeDataKey,t.axisInteraction.click.coordinate=e.payload.activeCoordinate},setSyncInteraction(t,e){t.syncInteraction=e.payload},setKeyboardInteraction(t,e){t.keyboardInteraction.active=e.payload.active,t.keyboardInteraction.index=e.payload.activeIndex,t.keyboardInteraction.coordinate=e.payload.activeCoordinate}}}),{addTooltipEntrySettings:qTe,replaceTooltipEntrySettings:GTe,removeTooltipEntrySettings:KTe,setTooltipSettingsState:YTe,setActiveMouseOverItemIndex:Y7,mouseLeaveItem:QTe,mouseLeaveChart:Q7,setActiveClickItemIndex:XTe,setMouseOverAxisIndex:X7,setMouseClickAxisIndex:JTe,setSyncInteraction:KT,setKeyboardInteraction:YT}=K7.actions,ZTe=K7.reducer;function o4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function f0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?o4(Object(n),!0).forEach(function(r){eAe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function eAe(t,e,n){return(e=tAe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tAe(t){var e=nAe(t,"string");return typeof e=="symbol"?e:e+""}function nAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function rAe(t,e,n){return e==="axis"?n==="click"?t.axisInteraction.click:t.axisInteraction.hover:n==="click"?t.itemInteraction.click:t.itemInteraction.hover}function sAe(t){return t.index!=null}var J7=(t,e,n,r)=>{if(e==null)return Tc;var s=rAe(t,e,n);if(s==null)return Tc;if(s.active)return s;if(t.keyboardInteraction.active)return t.keyboardInteraction;if(t.syncInteraction.active&&t.syncInteraction.index!=null)return t.syncInteraction;var i=t.settings.active===!0;if(sAe(s)){if(i)return f0(f0({},s),{},{active:!0})}else if(r!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:r,graphicalItemId:void 0};return f0(f0({},Tc),{},{coordinate:s.coordinate})};function iAe(t){if(typeof t=="number")return Number.isFinite(t)?t:void 0;if(t instanceof Date){var e=t.valueOf();return Number.isFinite(e)?e:void 0}var n=Number(t);return Number.isFinite(n)?n:void 0}function aAe(t,e){var n=iAe(t),r=e[0],s=e[1];if(n===void 0)return!1;var i=Math.min(r,s),a=Math.max(r,s);return n>=i&&n<=a}function oAe(t,e,n){if(n==null||e==null)return!0;var r=Er(t,e);return r==null||!Fl(n)?!0:aAe(r,n)}var BO=(t,e,n,r)=>{var s=t==null?void 0:t.index;if(s==null)return null;var i=Number(s);if(!Ct(i))return s;var a=0,l=1/0;e.length>0&&(l=e.length-1);var c=Math.max(a,Math.min(i,l)),u=e[c];return u==null||oAe(u,n,r)?String(c):null},Z7=(t,e,n,r,s,i,a)=>{if(i!=null){var l=a[0],c=l==null?void 0:l.getPosition(i);if(c!=null)return c;var u=s==null?void 0:s[Number(i)];if(u)switch(n){case"horizontal":return{x:u.coordinate,y:(r.top+e)/2};default:return{x:(r.left+t)/2,y:u.coordinate}}}},eY=(t,e,n,r)=>{if(e==="axis")return t.tooltipItemPayloads;if(t.tooltipItemPayloads.length===0)return[];var s;if(n==="hover"?s=t.itemInteraction.hover.graphicalItemId:s=t.itemInteraction.click.graphicalItemId,s==null&&r!=null){var i=t.tooltipItemPayloads[0];return i!=null?[i]:[]}return t.tooltipItemPayloads.filter(a=>{var l;return((l=a.settings)===null||l===void 0?void 0:l.graphicalItemId)===s})},tY=t=>t.options.tooltipPayloadSearcher,nm=t=>t.tooltip;function l4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function c4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l4(Object(n),!0).forEach(function(r){lAe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function lAe(t,e,n){return(e=cAe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function cAe(t){var e=uAe(t,"string");return typeof e=="symbol"?e:e+""}function uAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function dAe(t,e){return t??e}var nY=(t,e,n,r,s,i,a)=>{if(!(e==null||i==null)){var{chartData:l,computedData:c,dataStartIndex:u,dataEndIndex:d}=n,h=[];return t.reduce((f,p)=>{var m,{dataDefinedOnItem:g,settings:y}=p,x=dAe(g,l),w=Array.isArray(x)?SG(x,u,d):x,N=(m=y==null?void 0:y.dataKey)!==null&&m!==void 0?m:r,S=y==null?void 0:y.nameKey,C;if(r&&Array.isArray(w)&&!Array.isArray(w[0])&&a==="axis"?C=m8(w,r,s):C=i(w,e,c,S),Array.isArray(C))C.forEach(j=>{var _=c4(c4({},y),{},{name:j.name,unit:j.unit,color:void 0,fill:void 0});f.push(vB({tooltipEntrySettings:_,dataKey:j.dataKey,payload:j.payload,value:Er(j.payload,j.dataKey),name:j.name}))});else{var A;f.push(vB({tooltipEntrySettings:y,dataKey:N,payload:C,value:Er(C,N),name:(A=Er(C,S))!==null&&A!==void 0?A:y==null?void 0:y.name}))}return f},h)}},VO=ce([Ir,c7,NO],P7),hAe=ce([t=>t.graphicalItems.cartesianItems,t=>t.graphicalItems.polarItems],(t,e)=>[...t,...e]),fAe=ce([Xr,Zp],u7),rm=ce([hAe,Ir,fAe],h7,{memoizeOptions:{resultEqualityCheck:MS}}),pAe=ce([rm],t=>t.filter(TO)),mAe=ce([rm],m7,{memoizeOptions:{resultEqualityCheck:MS}}),sm=ce([mAe,Vu],g7),gAe=ce([pAe,Vu,Ir],i7),$O=ce([sm,Ir,rm],y7),rY=ce([Ir],IO),yAe=ce([Ir],t=>t.allowDataOverflow),sY=ce([rY,yAe],VK),vAe=ce([rm],t=>t.filter(TO)),xAe=ce([gAe,vAe,kS,XK],x7),bAe=ce([xAe,Vu,Xr,sY],b7),wAe=ce([rm],p7),NAe=ce([sm,Ir,wAe,PO,Xr],S7,{memoizeOptions:{resultEqualityCheck:RS}}),SAe=ce([_7,Xr,Zp],em),_Ae=ce([SAe,Xr],C7),jAe=ce([j7,Xr,Zp],em),EAe=ce([jAe,Xr],T7),CAe=ce([E7,Xr,Zp],em),TAe=ce([CAe,Xr],A7),AAe=ce([_Ae,TAe,EAe],j1),kAe=ce([Ir,rY,sY,bAe,NAe,AAe,sr,Xr],k7),Kv=ce([Ir,sr,sm,$O,kS,Xr,kAe],I7),IAe=ce([Kv,Ir,VO],O7),PAe=ce([Ir,Kv,IAe,Xr],D7),iY=t=>{var e=Xr(t),n=Zp(t),r=!1;return Gv(t,e,n,r)},aY=ce([Ir,iY],IS),oY=ce([Ir,VO,PAe,aY],DO),OAe=ce([sr,$O,Ir,Xr],B7),DAe=ce([sr,$O,Ir,Xr],V7),RAe=(t,e,n,r,s,i,a,l)=>{if(e){var{type:c}=e,u=Lu(t,l);if(r){var d=n==="scaleBand"&&r.bandwidth?r.bandwidth()/2:2,h=c==="category"&&r.bandwidth?r.bandwidth()/d:0;return h=l==="angleAxis"&&s!=null&&(s==null?void 0:s.length)>=2?ga(s[0]-s[1])*2*h:h,u&&a?a.map((f,p)=>{var m=r.map(f);return Ct(m)?{coordinate:m+h,value:f,index:p,offset:h}:null}).filter(mi):r.domain().map((f,p)=>{var m=r.map(f);return Ct(m)?{coordinate:m+h,value:i?i[f]:f,index:p,offset:h}:null}).filter(mi)}}},Jl=ce([sr,Ir,VO,oY,iY,OAe,DAe,Xr],RAe),UO=ce([H7,W7,HTe],(t,e,n)=>q7(n.shared,t,e)),lY=t=>t.tooltip.settings.trigger,zO=t=>t.tooltip.settings.defaultIndex,Yv=ce([nm,UO,lY,zO],J7),Hy=ce([Yv,sm,qv,Kv],BO),cY=ce([Jl,Hy],G7),MAe=ce([Yv],t=>{if(t)return t.dataKey});ce([Yv],t=>{if(t)return t.graphicalItemId});var uY=ce([nm,UO,lY,zO],eY),LAe=ce([Yl,Ql,sr,xs,Jl,zO,uY],Z7),FAe=ce([Yv,LAe],(t,e)=>t!=null&&t.coordinate?t.coordinate:e),BAe=ce([Yv],t=>{var e;return(e=t==null?void 0:t.active)!==null&&e!==void 0?e:!1}),VAe=ce([uY,Hy,Vu,qv,cY,tY,UO],nY);ce([VAe],t=>{if(t!=null){var e=t.map(n=>n.payload).filter(n=>n!=null);return Array.from(new Set(e))}});function u4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function d4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?u4(Object(n),!0).forEach(function(r){$Ae(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function $Ae(t,e,n){return(e=UAe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function UAe(t){var e=zAe(t,"string");return typeof e=="symbol"?e:e+""}function zAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var HAe=()=>Ze(Ir),WAe=()=>{var t=HAe(),e=Ze(Jl),n=Ze(oY);return yB(!t||!n?void 0:d4(d4({},t),{},{scale:n}),e)};function h4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function $h(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h4(Object(n),!0).forEach(function(r){qAe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function qAe(t,e,n){return(e=GAe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function GAe(t){var e=KAe(t,"string");return typeof e=="symbol"?e:e+""}function KAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var YAe=(t,e,n,r)=>{var s=e.find(i=>i&&i.index===n);if(s){if(t==="horizontal")return{x:s.coordinate,y:r.chartY};if(t==="vertical")return{x:r.chartX,y:s.coordinate}}return{x:0,y:0}},QAe=(t,e,n,r)=>{var s=e.find(u=>u&&u.index===n);if(s){if(t==="centric"){var i=s.coordinate,{radius:a}=r;return $h($h($h({},r),ms(r.cx,r.cy,a,i)),{},{angle:i,radius:a})}var l=s.coordinate,{angle:c}=r;return $h($h($h({},r),ms(r.cx,r.cy,l,c)),{},{angle:c,radius:l})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}};function XAe(t,e){var{chartX:n,chartY:r}=t;return n>=e.left&&n<=e.left+e.width&&r>=e.top&&r<=e.top+e.height}var dY=(t,e,n,r,s)=>{var i,a=(i=e==null?void 0:e.length)!==null&&i!==void 0?i:0;if(a<=1||t==null)return 0;if(r==="angleAxis"&&s!=null&&Math.abs(Math.abs(s[1]-s[0])-360)<=1e-6)for(var l=0;l<a;l++){var c,u,d,h,f,p=l>0?(c=n[l-1])===null||c===void 0?void 0:c.coordinate:(u=n[a-1])===null||u===void 0?void 0:u.coordinate,m=(d=n[l])===null||d===void 0?void 0:d.coordinate,g=l>=a-1?(h=n[0])===null||h===void 0?void 0:h.coordinate:(f=n[l+1])===null||f===void 0?void 0:f.coordinate,y=void 0;if(!(p==null||m==null||g==null))if(ga(m-p)!==ga(g-m)){var x=[];if(ga(g-m)===ga(s[1]-s[0])){y=g;var w=m+s[1]-s[0];x[0]=Math.min(w,(w+p)/2),x[1]=Math.max(w,(w+p)/2)}else{y=p;var N=g+s[1]-s[0];x[0]=Math.min(m,(N+m)/2),x[1]=Math.max(m,(N+m)/2)}var S=[Math.min(m,(y+m)/2),Math.max(m,(y+m)/2)];if(t>S[0]&&t<=S[1]||t>=x[0]&&t<=x[1]){var C;return(C=n[l])===null||C===void 0?void 0:C.index}}else{var A=Math.min(p,g),j=Math.max(p,g);if(t>(A+m)/2&&t<=(j+m)/2){var _;return(_=n[l])===null||_===void 0?void 0:_.index}}}else if(e)for(var E=0;E<a;E++){var I=e[E];if(I!=null){var T=e[E+1],P=e[E-1];if(E===0&&T!=null&&t<=(I.coordinate+T.coordinate)/2||E===a-1&&P!=null&&t>(I.coordinate+P.coordinate)/2||E>0&&E<a-1&&P!=null&&T!=null&&t>(I.coordinate+P.coordinate)/2&&t<=(I.coordinate+T.coordinate)/2)return I.index}}return-1},JAe=()=>Ze(NO),HO=(t,e)=>e,hY=(t,e,n)=>n,WO=(t,e,n,r)=>r,ZAe=ce(Jl,t=>aS(t,e=>e.coordinate)),qO=ce([nm,HO,hY,WO],J7),GO=ce([qO,sm,qv,Kv],BO),eke=(t,e,n)=>{if(e!=null){var r=nm(t);return e==="axis"?n==="hover"?r.axisInteraction.hover.dataKey:r.axisInteraction.click.dataKey:n==="hover"?r.itemInteraction.hover.dataKey:r.itemInteraction.click.dataKey}},fY=ce([nm,HO,hY,WO],eY),E1=ce([Yl,Ql,sr,xs,Jl,WO,fY],Z7),tke=ce([qO,E1],(t,e)=>{var n;return(n=t.coordinate)!==null&&n!==void 0?n:e}),pY=ce([Jl,GO],G7),nke=ce([fY,GO,Vu,qv,pY,tY,HO],nY),rke=ce([qO,GO],(t,e)=>({isActive:t.active&&e!=null,activeIndex:e})),ske=(t,e,n,r,s,i,a)=>{if(!(!t||!n||!r||!s)&&XAe(t,a)){var l=VNe(t,e),c=dY(l,i,s,n,r),u=YAe(e,s,c,t);return{activeIndex:String(c),activeCoordinate:u}}},ike=(t,e,n,r,s,i,a)=>{if(!(!t||!r||!s||!i||!n)){var l=H_e(t,n);if(l){var c=$Ne(l,e),u=dY(c,a,i,r,s),d=QAe(e,i,u,l);return{activeIndex:String(u),activeCoordinate:d}}}},ake=(t,e,n,r,s,i,a,l)=>{if(!(!t||!e||!r||!s||!i))return e==="horizontal"||e==="vertical"?ske(t,e,r,s,i,a,l):ike(t,e,n,r,s,i,a)},oke=ce(t=>t.zIndex.zIndexMap,(t,e)=>e,(t,e,n)=>n,(t,e,n)=>{if(e!=null){var r=t[e];if(r!=null)return n?r.panoramaElement:r.element}}),lke=ce(t=>t.zIndex.zIndexMap,t=>{var e=Object.keys(t).map(r=>parseInt(r,10)).concat(Object.values(Ws)),n=Array.from(new Set(e));return n.sort((r,s)=>r-s)},{memoizeOptions:{resultEqualityCheck:BCe}});function f4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function p4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?f4(Object(n),!0).forEach(function(r){cke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function cke(t,e,n){return(e=uke(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function uke(t){var e=dke(t,"string");return typeof e=="symbol"?e:e+""}function dke(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var hke={},fke={zIndexMap:Object.values(Ws).reduce((t,e)=>p4(p4({},t),{},{[e]:{element:void 0,panoramaElement:void 0,consumers:0}}),hke)},pke=new Set(Object.values(Ws));function mke(t){return pke.has(t)}var mY=_i({name:"zIndex",initialState:fke,reducers:{registerZIndexPortal:{reducer:(t,e)=>{var{zIndex:n}=e.payload;t.zIndexMap[n]?t.zIndexMap[n].consumers+=1:t.zIndexMap[n]={consumers:1,element:void 0,panoramaElement:void 0}},prepare:En()},unregisterZIndexPortal:{reducer:(t,e)=>{var{zIndex:n}=e.payload;t.zIndexMap[n]&&(t.zIndexMap[n].consumers-=1,t.zIndexMap[n].consumers<=0&&!mke(n)&&delete t.zIndexMap[n])},prepare:En()},registerZIndexPortalElement:{reducer:(t,e)=>{var{zIndex:n,element:r,isPanorama:s}=e.payload;t.zIndexMap[n]?s?t.zIndexMap[n].panoramaElement=r:t.zIndexMap[n].element=r:t.zIndexMap[n]={consumers:0,element:s?void 0:r,panoramaElement:s?r:void 0}},prepare:En()},unregisterZIndexPortalElement:{reducer:(t,e)=>{var{zIndex:n}=e.payload;t.zIndexMap[n]&&(e.payload.isPanorama?t.zIndexMap[n].panoramaElement=void 0:t.zIndexMap[n].element=void 0)},prepare:En()}}}),{registerZIndexPortal:gke,unregisterZIndexPortal:yke,registerZIndexPortalElement:vke,unregisterZIndexPortalElement:xke}=mY.actions,bke=mY.reducer;function Zl(t){var{zIndex:e,children:n}=t,r=mSe(),s=r&&e!==void 0&&e!==0,i=ti(),a=Xn();b.useLayoutEffect(()=>s?(a(gke({zIndex:e})),()=>{a(yke({zIndex:e}))}):Ov,[a,e,s]);var l=Ze(c=>oke(c,e,i));return s?l?Q1.createPortal(n,l):null:n}function QT(){return QT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},QT.apply(null,arguments)}function m4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function p0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?m4(Object(n),!0).forEach(function(r){wke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function wke(t,e,n){return(e=Nke(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nke(t){var e=Ske(t,"string");return typeof e=="symbol"?e:e+""}function Ske(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _ke(t){var{cursor:e,cursorComp:n,cursorProps:r}=t;return b.isValidElement(e)?b.cloneElement(e,r):b.createElement(n,r)}function jke(t){var e,{coordinate:n,payload:r,index:s,offset:i,tooltipAxisBandSize:a,layout:l,cursor:c,tooltipEventType:u,chartName:d}=t,h=n,f=r,p=s;if(!c||!h||d!=="ScatterChart"&&u!=="axis")return null;var m,g,y;if(d==="ScatterChart")m=h,g=r_e,y=Ws.cursorLine;else if(d==="BarChart")m=s_e(l,h,i,a),g=ZG,y=Ws.cursorRectangle;else if(l==="radial"&&y8(h)){var{cx:x,cy:w,radius:N,startAngle:S,endAngle:C}=eK(h);m={cx:x,cy:w,startAngle:S,endAngle:C,innerRadius:N,outerRadius:N},g=nK,y=Ws.cursorLine}else m={points:K_e(l,h,i)},g=GP,y=Ws.cursorLine;var A=typeof c=="object"&&"className"in c?c.className:void 0,j=p0(p0(p0(p0({stroke:"#ccc",pointerEvents:"none"},i),m),bP(c)),{},{payload:f,payloadIndex:p,className:gn("recharts-tooltip-cursor",A)});return b.createElement(Zl,{zIndex:(e=t.zIndex)!==null&&e!==void 0?e:y},b.createElement(_ke,{cursor:c,cursorComp:g,cursorProps:j}))}function Eke(t){var e=WAe(),n=MG(),r=Lv(),s=JAe();return e==null||n==null||r==null||s==null?null:b.createElement(jke,QT({},t,{offset:n,layout:r,tooltipAxisBandSize:e,chartName:s}))}var gY=b.createContext(null),Cke=()=>b.useContext(gY),yY={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function i(c,u,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new s(d,h||c,f),m=n?n+u:u;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],p]:c._events[m].push(p):(c._events[m]=p,c._eventsCount++),c}function a(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],d,h;if(this._eventsCount===0)return u;for(h in d=this._events)e.call(d,h)&&u.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var d=n?n+u:u,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,m=new Array(p);f<p;f++)m[f]=h[f].fn;return m},l.prototype.listenerCount=function(u){var d=n?n+u:u,h=this._events[d];return h?h.fn?1:h.length:0},l.prototype.emit=function(u,d,h,f,p,m){var g=n?n+u:u;if(!this._events[g])return!1;var y=this._events[g],x=arguments.length,w,N;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),x){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,h),!0;case 4:return y.fn.call(y.context,d,h,f),!0;case 5:return y.fn.call(y.context,d,h,f,p),!0;case 6:return y.fn.call(y.context,d,h,f,p,m),!0}for(N=1,w=new Array(x-1);N<x;N++)w[N-1]=arguments[N];y.fn.apply(y.context,w)}else{var S=y.length,C;for(N=0;N<S;N++)switch(y[N].once&&this.removeListener(u,y[N].fn,void 0,!0),x){case 1:y[N].fn.call(y[N].context);break;case 2:y[N].fn.call(y[N].context,d);break;case 3:y[N].fn.call(y[N].context,d,h);break;case 4:y[N].fn.call(y[N].context,d,h,f);break;default:if(!w)for(C=1,w=new Array(x-1);C<x;C++)w[C-1]=arguments[C];y[N].fn.apply(y[N].context,w)}}return!0},l.prototype.on=function(u,d,h){return i(this,u,d,h,!1)},l.prototype.once=function(u,d,h){return i(this,u,d,h,!0)},l.prototype.removeListener=function(u,d,h,f){var p=n?n+u:u;if(!this._events[p])return this;if(!d)return a(this,p),this;var m=this._events[p];if(m.fn)m.fn===d&&(!f||m.once)&&(!h||m.context===h)&&a(this,p);else{for(var g=0,y=[],x=m.length;g<x;g++)(m[g].fn!==d||f&&!m[g].once||h&&m[g].context!==h)&&y.push(m[g]);y.length?this._events[p]=y.length===1?y[0]:y:a(this,p)}return this},l.prototype.removeAllListeners=function(u){var d;return u?(d=n?n+u:u,this._events[d]&&a(this,d)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,t.exports=l})(yY);var Tke=yY.exports;const Ake=Bo(Tke);var Wy=new Ake,XT="recharts.syncEvent.tooltip",g4="recharts.syncEvent.brush",kke=(t,e)=>{if(e&&Array.isArray(t)){var n=Number.parseInt(e,10);if(!Ol(n))return t[n]}},Ike={chartName:"",tooltipPayloadSearcher:()=>{},eventEmitter:void 0,defaultTooltipEventType:"axis"},vY=_i({name:"options",initialState:Ike,reducers:{createEventEmitter:t=>{t.eventEmitter==null&&(t.eventEmitter=Symbol("rechartsEventEmitter"))}}}),Pke=vY.reducer,{createEventEmitter:Oke}=vY.actions;function Dke(t){return t.tooltip.syncInteraction}var Rke={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},xY=_i({name:"chartData",initialState:Rke,reducers:{setChartData(t,e){if(t.chartData=e.payload,e.payload==null){t.dataStartIndex=0,t.dataEndIndex=0;return}e.payload.length>0&&t.dataEndIndex!==e.payload.length-1&&(t.dataEndIndex=e.payload.length-1)},setComputedData(t,e){t.computedData=e.payload},setDataStartEndIndexes(t,e){var{startIndex:n,endIndex:r}=e.payload;n!=null&&(t.dataStartIndex=n),r!=null&&(t.dataEndIndex=r)}}}),{setChartData:y4,setDataStartEndIndexes:Mke,setComputedData:NMe}=xY.actions,Lke=xY.reducer,Fke=["x","y"];function v4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Uh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?v4(Object(n),!0).forEach(function(r){Bke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Bke(t,e,n){return(e=Vke(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Vke(t){var e=$ke(t,"string");return typeof e=="symbol"?e:e+""}function $ke(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Uke(t,e){if(t==null)return{};var n,r,s=zke(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function zke(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function Hke(){var t=Ze(SO),e=Ze(_O),n=Xn(),r=Ze(JK),s=Ze(Jl),i=Lv(),a=Yp(),l=Ze(c=>c.rootProps.className);b.useEffect(()=>{if(t==null)return Ov;var c=(u,d,h)=>{if(e!==h&&t===u){if(r==="index"){var f;if(a&&d!==null&&d!==void 0&&(f=d.payload)!==null&&f!==void 0&&f.coordinate&&d.payload.sourceViewBox){var p=d.payload.coordinate,{x:m,y:g}=p,y=Uke(p,Fke),{x,y:w,width:N,height:S}=d.payload.sourceViewBox,C=Uh(Uh({},y),{},{x:a.x+(N?(m-x)/N:0)*a.width,y:a.y+(S?(g-w)/S:0)*a.height});n(Uh(Uh({},d),{},{payload:Uh(Uh({},d.payload),{},{coordinate:C})}))}else n(d);return}if(s!=null){var A;if(typeof r=="function"){var j={activeTooltipIndex:d.payload.index==null?void 0:Number(d.payload.index),isTooltipActive:d.payload.active,activeIndex:d.payload.index==null?void 0:Number(d.payload.index),activeLabel:d.payload.label,activeDataKey:d.payload.dataKey,activeCoordinate:d.payload.coordinate},_=r(s,j);A=s[_]}else r==="value"&&(A=s.find(se=>String(se.value)===d.payload.label));var{coordinate:E}=d.payload;if(A==null||d.payload.active===!1||E==null||a==null){n(KT({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}));return}var{x:I,y:T}=E,P=Math.min(I,a.x+a.width),O=Math.min(T,a.y+a.height),H={x:i==="horizontal"?A.coordinate:P,y:i==="horizontal"?O:A.coordinate},X=KT({active:d.payload.active,coordinate:H,dataKey:d.payload.dataKey,index:String(A.index),label:d.payload.label,sourceViewBox:d.payload.sourceViewBox,graphicalItemId:d.payload.graphicalItemId});n(X)}}};return Wy.on(XT,c),()=>{Wy.off(XT,c)}},[l,n,e,t,r,s,i,a])}function Wke(){var t=Ze(SO),e=Ze(_O),n=Xn();b.useEffect(()=>{if(t==null)return Ov;var r=(s,i,a)=>{e!==a&&t===s&&n(Mke(i))};return Wy.on(g4,r),()=>{Wy.off(g4,r)}},[n,e,t])}function qke(){var t=Xn();b.useEffect(()=>{t(Oke())},[t]),Hke(),Wke()}function Gke(t,e,n,r,s,i){var a=Ze(p=>eke(p,t,e)),l=Ze(_O),c=Ze(SO),u=Ze(JK),d=Ze(Dke),h=d==null?void 0:d.active,f=Yp();b.useEffect(()=>{if(!h&&c!=null&&l!=null){var p=KT({active:i,coordinate:n,dataKey:a,index:s,label:typeof r=="number"?String(r):r,sourceViewBox:f,graphicalItemId:void 0});Wy.emit(XT,c,p,l)}},[h,n,a,s,r,l,c,u,i,f])}function x4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function b4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?x4(Object(n),!0).forEach(function(r){Kke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Kke(t,e,n){return(e=Yke(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yke(t){var e=Qke(t,"string");return typeof e=="symbol"?e:e+""}function Qke(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Xke(t){return t.dataKey}function Jke(t,e){return b.isValidElement(t)?b.cloneElement(t,e):typeof t=="function"?b.createElement(t,e):b.createElement(MSe,e)}var w4=[],Zke={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,includeHidden:!1,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function eIe(t){var e,n,r=ei(t,Zke),{active:s,allowEscapeViewBox:i,animationDuration:a,animationEasing:l,content:c,filterNull:u,isAnimationActive:d,offset:h,payloadUniqBy:f,position:p,reverseDirection:m,useTranslate3d:g,wrapperStyle:y,cursor:x,shared:w,trigger:N,defaultIndex:S,portal:C,axisId:A}=r,j=Xn(),_=typeof S=="number"?String(S):S;b.useEffect(()=>{j(YTe({shared:w,trigger:N,axisId:A,active:s,defaultIndex:_}))},[j,w,N,A,s,_]);var E=Yp(),I=KG(),T=zTe(w),{activeIndex:P,isActive:O}=(e=Ze(U=>rke(U,T,N,_)))!==null&&e!==void 0?e:{},H=Ze(U=>nke(U,T,N,_)),X=Ze(U=>pY(U,T,N,_)),se=Ze(U=>tke(U,T,N,_)),L=H,B=Cke(),$=(n=s??O)!==null&&n!==void 0?n:!1,[q,Y]=T1e([L,$]),R=T==="axis"?X:void 0;Gke(T,N,se,R,P,$);var G=C??B;if(G==null||E==null||T==null)return null;var Z=L??w4;$||(Z=w4),u&&Z.length&&(Z=qwe(Z.filter(U=>U.value!=null&&(U.hide!==!0||r.includeHidden)),f,Xke));var W=Z.length>0,Q=b.createElement(zSe,{allowEscapeViewBox:i,animationDuration:a,animationEasing:l,isAnimationActive:d,active:$,coordinate:se,hasPayload:W,offset:h,position:p,reverseDirection:m,useTranslate3d:g,viewBox:E,wrapperStyle:y,lastBoundingBox:q,innerRef:Y,hasPortalFromProps:!!C},Jke(c,b4(b4({},r),{},{payload:Z,label:R,active:$,activeIndex:P,coordinate:se,accessibilityLayer:I})));return b.createElement(b.Fragment,null,Q1.createPortal(Q,G),$&&b.createElement(Eke,{cursor:x,tooltipEventType:T,coordinate:se,payload:Z,index:P}))}var bY=t=>null;bY.displayName="Cell";function tIe(t,e,n){return(e=nIe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nIe(t){var e=rIe(t,"string");return typeof e=="symbol"?e:e+""}function rIe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class sIe{constructor(e){tIe(this,"cache",new Map),this.maxSize=e}get(e){var n=this.cache.get(e);return n!==void 0&&(this.cache.delete(e),this.cache.set(e,n)),n}set(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;r!=null&&this.cache.delete(r)}this.cache.set(e,n)}clear(){this.cache.clear()}size(){return this.cache.size}}function N4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function iIe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?N4(Object(n),!0).forEach(function(r){aIe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function aIe(t,e,n){return(e=oIe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function oIe(t){var e=lIe(t,"string");return typeof e=="symbol"?e:e+""}function lIe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var cIe={cacheSize:2e3,enableCache:!0},wY=iIe({},cIe),S4=new sIe(wY.cacheSize),uIe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},_4="recharts_measurement_span";function dIe(t,e){var n=e.fontSize||"",r=e.fontFamily||"",s=e.fontWeight||"",i=e.fontStyle||"",a=e.letterSpacing||"",l=e.textTransform||"";return"".concat(t,"|").concat(n,"|").concat(r,"|").concat(s,"|").concat(i,"|").concat(a,"|").concat(l)}var j4=(t,e)=>{try{var n=document.getElementById(_4);n||(n=document.createElement("span"),n.setAttribute("id",_4),n.setAttribute("aria-hidden","true"),document.body.appendChild(n)),Object.assign(n.style,uIe,e),n.textContent="".concat(t);var r=n.getBoundingClientRect();return{width:r.width,height:r.height}}catch{return{width:0,height:0}}},Rg=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||SS.isSsr)return{width:0,height:0};if(!wY.enableCache)return j4(e,n);var r=dIe(e,n),s=S4.get(r);if(s)return s;var i=j4(e,n);return S4.set(r,i),i},NY;function hIe(t,e,n){return(e=fIe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fIe(t){var e=pIe(t,"string");return typeof e=="symbol"?e:e+""}function pIe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var E4=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,C4=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,mIe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,gIe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,yIe={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},vIe=["cm","mm","pt","pc","in","Q","px"];function xIe(t){return vIe.includes(t)}var vf="NaN";function bIe(t,e){return t*yIe[e]}class as{static parse(e){var n,[,r,s]=(n=gIe.exec(e))!==null&&n!==void 0?n:[];return r==null?as.NaN:new as(parseFloat(r),s??"")}constructor(e,n){this.num=e,this.unit=n,this.num=e,this.unit=n,Ol(e)&&(this.unit=""),n!==""&&!mIe.test(n)&&(this.num=NaN,this.unit=""),xIe(n)&&(this.num=bIe(e,n),this.unit="px")}add(e){return this.unit!==e.unit?new as(NaN,""):new as(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new as(NaN,""):new as(this.num-e.num,this.unit)}multiply(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new as(NaN,""):new as(this.num*e.num,this.unit||e.unit)}divide(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new as(NaN,""):new as(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return Ol(this.num)}}NY=as;hIe(as,"NaN",new NY(NaN,""));function SY(t){if(t==null||t.includes(vf))return vf;for(var e=t;e.includes("*")||e.includes("/");){var n,[,r,s,i]=(n=E4.exec(e))!==null&&n!==void 0?n:[],a=as.parse(r??""),l=as.parse(i??""),c=s==="*"?a.multiply(l):a.divide(l);if(c.isNaN())return vf;e=e.replace(E4,c.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var u,[,d,h,f]=(u=C4.exec(e))!==null&&u!==void 0?u:[],p=as.parse(d??""),m=as.parse(f??""),g=h==="+"?p.add(m):p.subtract(m);if(g.isNaN())return vf;e=e.replace(C4,g.toString())}return e}var T4=/\(([^()]*)\)/;function wIe(t){for(var e=t,n;(n=T4.exec(e))!=null;){var[,r]=n;e=e.replace(T4,SY(r))}return e}function NIe(t){var e=t.replace(/\s+/g,"");return e=wIe(e),e=SY(e),e}function SIe(t){try{return NIe(t)}catch{return vf}}function Kj(t){var e=SIe(t.slice(5,-1));return e===vf?"":e}var _Ie=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],jIe=["dx","dy","angle","className","breakAll"];function JT(){return JT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},JT.apply(null,arguments)}function A4(t,e){if(t==null)return{};var n,r,s=EIe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function EIe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var _Y=/[ \f\n\r\t\v\u2028\u2029]+/,jY=t=>{var{children:e,breakAll:n,style:r}=t;try{var s=[];dr(e)||(n?s=e.toString().split(""):s=e.toString().split(_Y));var i=s.map(l=>({word:l,width:Rg(l,r).width})),a=n?0:Rg("",r).width;return{wordsWithComputedWidth:i,spaceWidth:a}}catch{return null}};function CIe(t){return t==="start"||t==="middle"||t==="end"||t==="inherit"}var EY=(t,e,n,r)=>t.reduce((s,i)=>{var{word:a,width:l}=i,c=s[s.length-1];if(c&&l!=null&&(e==null||r||c.width+l+n<Number(e)))c.words.push(a),c.width+=l+n;else{var u={words:[a],width:l};s.push(u)}return s},[]),CY=t=>t.reduce((e,n)=>e.width>n.width?e:n),TIe="",k4=(t,e,n,r,s,i,a,l)=>{var c=t.slice(0,e),u=jY({breakAll:n,style:r,children:c+TIe});if(!u)return[!1,[]];var d=EY(u.wordsWithComputedWidth,i,a,l),h=d.length>s||CY(d).width>Number(i);return[h,d]},AIe=(t,e,n,r,s)=>{var{maxLines:i,children:a,style:l,breakAll:c}=t,u=tt(i),d=String(a),h=EY(e,r,n,s);if(!u||s)return h;var f=h.length>i||CY(h).width>Number(r);if(!f)return h;for(var p=0,m=d.length-1,g=0,y;p<=m&&g<=d.length-1;){var x=Math.floor((p+m)/2),w=x-1,[N,S]=k4(d,w,c,l,i,r,n,s),[C]=k4(d,x,c,l,i,r,n,s);if(!N&&!C&&(p=x+1),N&&C&&(m=x-1),!N&&C){y=S;break}g++}return y||h},I4=t=>{var e=dr(t)?[]:t.toString().split(_Y);return[{words:e,width:void 0}]},kIe=t=>{var{width:e,scaleToFit:n,children:r,style:s,breakAll:i,maxLines:a}=t;if((e||n)&&!SS.isSsr){var l,c,u=jY({breakAll:i,children:r,style:s});if(u){var{wordsWithComputedWidth:d,spaceWidth:h}=u;l=d,c=h}else return I4(r);return AIe({breakAll:i,children:r,maxLines:a,style:s},l,c,e,!!n)}return I4(r)},TY="#808080",IIe={angle:0,breakAll:!1,capHeight:"0.71em",fill:TY,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},KO=b.forwardRef((t,e)=>{var n=ei(t,IIe),{x:r,y:s,lineHeight:i,capHeight:a,fill:l,scaleToFit:c,textAnchor:u,verticalAnchor:d}=n,h=A4(n,_Ie),f=b.useMemo(()=>kIe({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:c,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,c,h.style,h.width]),{dx:p,dy:m,angle:g,className:y,breakAll:x}=h,w=A4(h,jIe);if(!Ta(r)||!Ta(s)||f.length===0)return null;var N=Number(r)+(tt(p)?p:0),S=Number(s)+(tt(m)?m:0);if(!Ct(N)||!Ct(S))return null;var C;switch(d){case"start":C=Kj("calc(".concat(a,")"));break;case"middle":C=Kj("calc(".concat((f.length-1)/2," * -").concat(i," + (").concat(a," / 2))"));break;default:C=Kj("calc(".concat(f.length-1," * -").concat(i,")"));break}var A=[],j=f[0];if(c&&j!=null){var _=j.width,{width:E}=h;A.push("scale(".concat(tt(E)&&tt(_)?E/_:1,")"))}return g&&A.push("rotate(".concat(g,", ").concat(N,", ").concat(S,")")),A.length&&(w.transform=A.join(" ")),b.createElement("text",JT({},Gi(w),{ref:e,x:N,y:S,className:gn("recharts-text",y),textAnchor:u,fill:l.includes("url")?TY:l}),f.map((I,T)=>{var P=I.words.join(x?"":" ");return b.createElement("tspan",{x:N,dy:T===0?C:i,key:"".concat(P,"-").concat(T)},P)}))});KO.displayName="Text";function P4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function io(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?P4(Object(n),!0).forEach(function(r){PIe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function PIe(t,e,n){return(e=OIe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function OIe(t){var e=DIe(t,"string");return typeof e=="symbol"?e:e+""}function DIe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var RIe=t=>{var{viewBox:e,position:n,offset:r=0,parentViewBox:s}=t,{x:i,y:a,height:l,upperWidth:c,lowerWidth:u}=HP(e),d=i,h=i+(c-u)/2,f=(d+h)/2,p=(c+u)/2,m=d+c/2,g=l>=0?1:-1,y=g*r,x=g>0?"end":"start",w=g>0?"start":"end",N=c>=0?1:-1,S=N*r,C=N>0?"end":"start",A=N>0?"start":"end",j=s;if(n==="top"){var _={x:d+c/2,y:a-y,horizontalAnchor:"middle",verticalAnchor:x};return j&&(_.height=Math.max(a-j.y,0),_.width=c),_}if(n==="bottom"){var E={x:h+u/2,y:a+l+y,horizontalAnchor:"middle",verticalAnchor:w};return j&&(E.height=Math.max(j.y+j.height-(a+l),0),E.width=u),E}if(n==="left"){var I={x:f-S,y:a+l/2,horizontalAnchor:C,verticalAnchor:"middle"};return j&&(I.width=Math.max(I.x-j.x,0),I.height=l),I}if(n==="right"){var T={x:f+p+S,y:a+l/2,horizontalAnchor:A,verticalAnchor:"middle"};return j&&(T.width=Math.max(j.x+j.width-T.x,0),T.height=l),T}var P=j?{width:p,height:l}:{};return n==="insideLeft"?io({x:f+S,y:a+l/2,horizontalAnchor:A,verticalAnchor:"middle"},P):n==="insideRight"?io({x:f+p-S,y:a+l/2,horizontalAnchor:C,verticalAnchor:"middle"},P):n==="insideTop"?io({x:d+c/2,y:a+y,horizontalAnchor:"middle",verticalAnchor:w},P):n==="insideBottom"?io({x:h+u/2,y:a+l-y,horizontalAnchor:"middle",verticalAnchor:x},P):n==="insideTopLeft"?io({x:d+S,y:a+y,horizontalAnchor:A,verticalAnchor:w},P):n==="insideTopRight"?io({x:d+c-S,y:a+y,horizontalAnchor:C,verticalAnchor:w},P):n==="insideBottomLeft"?io({x:h+S,y:a+l-y,horizontalAnchor:A,verticalAnchor:x},P):n==="insideBottomRight"?io({x:h+u-S,y:a+l-y,horizontalAnchor:C,verticalAnchor:x},P):n&&typeof n=="object"&&(tt(n.x)||oh(n.x))&&(tt(n.y)||oh(n.y))?io({x:i+vu(n.x,p),y:a+vu(n.y,l),horizontalAnchor:"end",verticalAnchor:"end"},P):io({x:m,y:a+l/2,horizontalAnchor:"middle",verticalAnchor:"middle"},P)},MIe=["labelRef"],LIe=["content"];function O4(t,e){if(t==null)return{};var n,r,s=FIe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function FIe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function D4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function sg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?D4(Object(n),!0).forEach(function(r){BIe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function BIe(t,e,n){return(e=VIe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function VIe(t){var e=$Ie(t,"string");return typeof e=="symbol"?e:e+""}function $Ie(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sl(){return sl=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},sl.apply(null,arguments)}var AY=b.createContext(null),kY=t=>{var{x:e,y:n,upperWidth:r,lowerWidth:s,width:i,height:a,children:l}=t,c=b.useMemo(()=>({x:e,y:n,upperWidth:r,lowerWidth:s,width:i,height:a}),[e,n,r,s,i,a]);return b.createElement(AY.Provider,{value:c},l)},IY=()=>{var t=b.useContext(AY),e=Yp();return t||(e?HP(e):void 0)},UIe=b.createContext(null),zIe=()=>{var t=b.useContext(UIe),e=Ze(r7);return t||e},HIe=t=>{var{value:e,formatter:n}=t,r=dr(t.children)?e:t.children;return typeof n=="function"?n(r):r},YO=t=>t!=null&&typeof t=="function",WIe=(t,e)=>{var n=ga(e-t),r=Math.min(Math.abs(e-t),360);return n*r},qIe=(t,e,n,r,s)=>{var{offset:i,className:a}=t,{cx:l,cy:c,innerRadius:u,outerRadius:d,startAngle:h,endAngle:f,clockWise:p}=s,m=(u+d)/2,g=WIe(h,f),y=g>=0?1:-1,x,w;switch(e){case"insideStart":x=h+y*i,w=p;break;case"insideEnd":x=f-y*i,w=!p;break;case"end":x=f+y*i,w=p;break;default:throw new Error("Unsupported position ".concat(e))}w=g<=0?w:!w;var N=ms(l,c,m,x),S=ms(l,c,m,x+(w?1:-1)*359),C="M".concat(N.x,",").concat(N.y,`
    A`).concat(m,",").concat(m,",0,1,").concat(w?0:1,`,
    `).concat(S.x,",").concat(S.y),A=dr(t.id)?Iy("recharts-radial-line-"):t.id;return b.createElement("text",sl({},r,{dominantBaseline:"central",className:gn("recharts-radial-bar-label",a)}),b.createElement("defs",null,b.createElement("path",{id:A,d:C})),b.createElement("textPath",{xlinkHref:"#".concat(A)},n))},GIe=(t,e,n)=>{var{cx:r,cy:s,innerRadius:i,outerRadius:a,startAngle:l,endAngle:c}=t,u=(l+c)/2;if(n==="outside"){var{x:d,y:h}=ms(r,s,a+e,u);return{x:d,y:h,textAnchor:d>=r?"start":"end",verticalAnchor:"middle"}}if(n==="center")return{x:r,y:s,textAnchor:"middle",verticalAnchor:"middle"};if(n==="centerTop")return{x:r,y:s,textAnchor:"middle",verticalAnchor:"start"};if(n==="centerBottom")return{x:r,y:s,textAnchor:"middle",verticalAnchor:"end"};var f=(i+a)/2,{x:p,y:m}=ms(r,s,f,u);return{x:p,y:m,textAnchor:"middle",verticalAnchor:"middle"}},Q0=t=>t!=null&&"cx"in t&&tt(t.cx),KIe={angle:0,offset:5,zIndex:Ws.label,position:"middle",textBreakAll:!1};function YIe(t){if(!Q0(t))return t;var{cx:e,cy:n,outerRadius:r}=t,s=r*2;return{x:e-r,y:n-r,width:s,upperWidth:s,lowerWidth:s,height:s}}function mc(t){var e=ei(t,KIe),{viewBox:n,parentViewBox:r,position:s,value:i,children:a,content:l,className:c="",textBreakAll:u,labelRef:d}=e,h=zIe(),f=IY(),p=s==="center"?f:h??f,m,g,y;n==null?m=p:Q0(n)?m=n:m=HP(n);var x=YIe(m);if(!m||dr(i)&&dr(a)&&!b.isValidElement(l)&&typeof l!="function")return null;var w=sg(sg({},e),{},{viewBox:m});if(b.isValidElement(l)){var{labelRef:N}=w,S=O4(w,MIe);return b.cloneElement(l,S)}if(typeof l=="function"){var{content:C}=w,A=O4(w,LIe);if(g=b.createElement(l,A),b.isValidElement(g))return g}else g=HIe(e);var j=Gi(e);if(Q0(m)){if(s==="insideStart"||s==="insideEnd"||s==="end")return qIe(e,s,g,j,m);y=GIe(m,e.offset,e.position)}else{if(!x)return null;var _=RIe({viewBox:x,position:s,offset:e.offset,parentViewBox:Q0(r)?void 0:r});y=sg(sg({x:_.x,y:_.y,textAnchor:_.horizontalAnchor,verticalAnchor:_.verticalAnchor},_.width!==void 0?{width:_.width}:{}),_.height!==void 0?{height:_.height}:{})}return b.createElement(Zl,{zIndex:e.zIndex},b.createElement(KO,sl({ref:d,className:gn("recharts-label",c)},j,y,{textAnchor:CIe(j.textAnchor)?j.textAnchor:y.textAnchor,breakAll:u}),g))}mc.displayName="Label";var QIe=(t,e,n)=>{if(!t)return null;var r={viewBox:e,labelRef:n};return t===!0?b.createElement(mc,sl({key:"label-implicit"},r)):Ta(t)?b.createElement(mc,sl({key:"label-implicit",value:t},r)):b.isValidElement(t)?t.type===mc?b.cloneElement(t,sg({key:"label-implicit"},r)):b.createElement(mc,sl({key:"label-implicit",content:t},r)):YO(t)?b.createElement(mc,sl({key:"label-implicit",content:t},r)):t&&typeof t=="object"?b.createElement(mc,sl({},t,{key:"label-implicit"},r)):null};function PY(t){var{label:e,labelRef:n}=t,r=IY();return QIe(e,r,n)||null}var OY={},DY={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return n[n.length-1]}t.last=e})(DY);var RY={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return Array.isArray(n)?n:Array.from(n)}t.toArray=e})(RY);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=DY,n=RY,r=rS;function s(i){if(r.isArrayLike(i))return e.last(n.toArray(i))}t.last=s})(OY);var XIe=OY.last;const JIe=Bo(XIe);var ZIe=["valueAccessor"],ePe=["dataKey","clockWise","id","textBreakAll","zIndex"];function C1(){return C1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},C1.apply(null,arguments)}function R4(t,e){if(t==null)return{};var n,r,s=tPe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function tPe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var nPe=t=>Array.isArray(t.value)?JIe(t.value):t.value,MY=b.createContext(void 0),rPe=MY.Provider,LY=b.createContext(void 0);LY.Provider;function sPe(){return b.useContext(MY)}function iPe(){return b.useContext(LY)}function X0(t){var{valueAccessor:e=nPe}=t,n=R4(t,ZIe),{dataKey:r,clockWise:s,id:i,textBreakAll:a,zIndex:l}=n,c=R4(n,ePe),u=sPe(),d=iPe(),h=u||d;return!h||!h.length?null:b.createElement(Zl,{zIndex:l??Ws.label},b.createElement(Xa,{className:"recharts-label-list"},h.map((f,p)=>{var m,g=dr(r)?e(f,p):Er(f.payload,r),y=dr(i)?{}:{id:"".concat(i,"-").concat(p)};return b.createElement(mc,C1({key:"label-".concat(p)},Gi(f),c,y,{fill:(m=n.fill)!==null&&m!==void 0?m:f.fill,parentViewBox:f.parentViewBox,value:g,textBreakAll:a,viewBox:f.viewBox,index:p,zIndex:0}))})))}X0.displayName="LabelList";function aPe(t){var{label:e}=t;return e?e===!0?b.createElement(X0,{key:"labelList-implicit"}):b.isValidElement(e)||YO(e)?b.createElement(X0,{key:"labelList-implicit",content:e}):typeof e=="object"?b.createElement(X0,C1({key:"labelList-implicit"},e,{type:String(e.type)})):null:null}var oPe={radiusAxis:{},angleAxis:{}},FY=_i({name:"polarAxis",initialState:oPe,reducers:{addRadiusAxis(t,e){t.radiusAxis[e.payload.id]=e.payload},removeRadiusAxis(t,e){delete t.radiusAxis[e.payload.id]},addAngleAxis(t,e){t.angleAxis[e.payload.id]=e.payload},removeAngleAxis(t,e){delete t.angleAxis[e.payload.id]}}}),{addRadiusAxis:SMe,removeRadiusAxis:_Me,addAngleAxis:jMe,removeAngleAxis:EMe}=FY.actions,lPe=FY.reducer;function cPe(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var BY={exports:{}},en={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jr=typeof Symbol=="function"&&Symbol.for,QO=Jr?Symbol.for("react.element"):60103,XO=Jr?Symbol.for("react.portal"):60106,VS=Jr?Symbol.for("react.fragment"):60107,$S=Jr?Symbol.for("react.strict_mode"):60108,US=Jr?Symbol.for("react.profiler"):60114,zS=Jr?Symbol.for("react.provider"):60109,HS=Jr?Symbol.for("react.context"):60110,JO=Jr?Symbol.for("react.async_mode"):60111,WS=Jr?Symbol.for("react.concurrent_mode"):60111,qS=Jr?Symbol.for("react.forward_ref"):60112,GS=Jr?Symbol.for("react.suspense"):60113,uPe=Jr?Symbol.for("react.suspense_list"):60120,KS=Jr?Symbol.for("react.memo"):60115,YS=Jr?Symbol.for("react.lazy"):60116,dPe=Jr?Symbol.for("react.block"):60121,hPe=Jr?Symbol.for("react.fundamental"):60117,fPe=Jr?Symbol.for("react.responder"):60118,pPe=Jr?Symbol.for("react.scope"):60119;function Ji(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case QO:switch(t=t.type,t){case JO:case WS:case VS:case US:case $S:case GS:return t;default:switch(t=t&&t.$$typeof,t){case HS:case qS:case YS:case KS:case zS:return t;default:return e}}case XO:return e}}}function VY(t){return Ji(t)===WS}en.AsyncMode=JO;en.ConcurrentMode=WS;en.ContextConsumer=HS;en.ContextProvider=zS;en.Element=QO;en.ForwardRef=qS;en.Fragment=VS;en.Lazy=YS;en.Memo=KS;en.Portal=XO;en.Profiler=US;en.StrictMode=$S;en.Suspense=GS;en.isAsyncMode=function(t){return VY(t)||Ji(t)===JO};en.isConcurrentMode=VY;en.isContextConsumer=function(t){return Ji(t)===HS};en.isContextProvider=function(t){return Ji(t)===zS};en.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===QO};en.isForwardRef=function(t){return Ji(t)===qS};en.isFragment=function(t){return Ji(t)===VS};en.isLazy=function(t){return Ji(t)===YS};en.isMemo=function(t){return Ji(t)===KS};en.isPortal=function(t){return Ji(t)===XO};en.isProfiler=function(t){return Ji(t)===US};en.isStrictMode=function(t){return Ji(t)===$S};en.isSuspense=function(t){return Ji(t)===GS};en.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===VS||t===WS||t===US||t===$S||t===GS||t===uPe||typeof t=="object"&&t!==null&&(t.$$typeof===YS||t.$$typeof===KS||t.$$typeof===zS||t.$$typeof===HS||t.$$typeof===qS||t.$$typeof===hPe||t.$$typeof===fPe||t.$$typeof===pPe||t.$$typeof===dPe)};en.typeOf=Ji;BY.exports=en;var mPe=BY.exports,M4=t=>typeof t=="string"?t:t?t.displayName||t.name||"Component":"",L4=null,Yj=null,$Y=t=>{if(t===L4&&Array.isArray(Yj))return Yj;var e=[];return b.Children.forEach(t,n=>{dr(n)||(mPe.isFragment(n)?e=e.concat($Y(n.props.children)):e.push(n))}),Yj=e,L4=t,e};function gPe(t,e){var n=[],r=[];return Array.isArray(e)?r=e.map(s=>M4(s)):r=[M4(e)],$Y(t).forEach(s=>{var i=xp(s,"type.displayName")||xp(s,"type.name");i&&r.indexOf(i)!==-1&&n.push(s)}),n}var UY={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){var s;if(typeof n!="object"||n==null)return!1;if(Object.getPrototypeOf(n)===null)return!0;if(Object.prototype.toString.call(n)!=="[object Object]"){const i=n[Symbol.toStringTag];return i==null||!((s=Object.getOwnPropertyDescriptor(n,Symbol.toStringTag))!=null&&s.writable)?!1:n.toString()===`[object ${i}]`}let r=n;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(n)===r}t.isPlainObject=e})(UY);var yPe=UY.isPlainObject;const vPe=Bo(yPe);var F4,B4,V4,$4,U4;function z4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function H4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?z4(Object(n),!0).forEach(function(r){xPe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function xPe(t,e,n){return(e=bPe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bPe(t){var e=wPe(t,"string");return typeof e=="symbol"?e:e+""}function wPe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function T1(){return T1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},T1.apply(null,arguments)}function $m(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var W4=(t,e,n,r,s)=>{var i=n-r,a;return a=Wn(F4||(F4=$m(["M ",",",""])),t,e),a+=Wn(B4||(B4=$m(["L ",",",""])),t+n,e),a+=Wn(V4||(V4=$m(["L ",",",""])),t+n-i/2,e+s),a+=Wn($4||($4=$m(["L ",",",""])),t+n-i/2-r,e+s),a+=Wn(U4||(U4=$m(["L ",","," Z"])),t,e),a},NPe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},SPe=t=>{var e=ei(t,NPe),{x:n,y:r,upperWidth:s,lowerWidth:i,height:a,className:l}=e,{animationEasing:c,animationDuration:u,animationBegin:d,isUpdateAnimationActive:h}=e,f=b.useRef(null),[p,m]=b.useState(-1),g=b.useRef(s),y=b.useRef(i),x=b.useRef(a),w=b.useRef(n),N=b.useRef(r),S=YP(t,"trapezoid-");if(b.useEffect(()=>{if(f.current&&f.current.getTotalLength)try{var H=f.current.getTotalLength();H&&m(H)}catch{}},[]),n!==+n||r!==+r||s!==+s||i!==+i||a!==+a||s===0&&i===0||a===0)return null;var C=gn("recharts-trapezoid",l);if(!h)return b.createElement("g",null,b.createElement("path",T1({},Gi(e),{className:C,d:W4(n,r,s,i,a)})));var A=g.current,j=y.current,_=x.current,E=w.current,I=N.current,T="0px ".concat(p===-1?1:p,"px"),P="".concat(p,"px 0px"),O=YG(["strokeDasharray"],u,c);return b.createElement(KP,{animationId:S,key:S,canBegin:p>0,duration:u,easing:c,isActive:h,begin:d},H=>{var X=Oi(A,s,H),se=Oi(j,i,H),L=Oi(_,a,H),B=Oi(E,n,H),$=Oi(I,r,H);f.current&&(g.current=X,y.current=se,x.current=L,w.current=B,N.current=$);var q=H>0?{transition:O,strokeDasharray:P}:{strokeDasharray:T};return b.createElement("path",T1({},Gi(e),{className:C,d:W4(B,$,X,se,L),ref:f,style:H4(H4({},q),e.style)}))})},_Pe=["option","shapeType","activeClassName"];function jPe(t,e){if(t==null)return{};var n,r,s=EPe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function EPe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function q4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function A1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q4(Object(n),!0).forEach(function(r){CPe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function CPe(t,e,n){return(e=TPe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function TPe(t){var e=APe(t,"string");return typeof e=="symbol"?e:e+""}function APe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kPe(t,e){return A1(A1({},e),t)}function IPe(t,e){return t==="symbols"}function G4(t){var{shapeType:e,elementProps:n}=t;switch(e){case"rectangle":return b.createElement(ZG,n);case"trapezoid":return b.createElement(SPe,n);case"sector":return b.createElement(nK,n);case"symbols":if(IPe(e))return b.createElement(jP,n);break;case"curve":return b.createElement(GP,n);default:return null}}function PPe(t){return b.isValidElement(t)?t.props:t}function K4(t){var{option:e,shapeType:n,activeClassName:r="recharts-active-shape"}=t,s=jPe(t,_Pe),i;if(b.isValidElement(e))i=b.cloneElement(e,A1(A1({},s),PPe(e)));else if(typeof e=="function")i=e(s,s.index);else if(vPe(e)&&typeof e!="boolean"){var a=kPe(e,s);i=b.createElement(G4,{shapeType:n,elementProps:a})}else{var l=s;i=b.createElement(G4,{shapeType:n,elementProps:l})}return s.isActive?b.createElement(Xa,{className:r},i):i}var OPe=(t,e,n)=>{var r=Xn();return(s,i)=>a=>{t==null||t(s,i,a),r(Y7({activeIndex:String(i),activeDataKey:e,activeCoordinate:s.tooltipPosition,activeGraphicalItemId:n}))}},DPe=t=>{var e=Xn();return(n,r)=>s=>{t==null||t(n,r,s),e(QTe())}},RPe=(t,e,n)=>{var r=Xn();return(s,i)=>a=>{t==null||t(s,i,a),r(XTe({activeIndex:String(i),activeDataKey:e,activeCoordinate:s.tooltipPosition,activeGraphicalItemId:n}))}};function MPe(t){var{tooltipEntrySettings:e}=t,n=Xn(),r=ti(),s=b.useRef(null);return b.useLayoutEffect(()=>{r||(s.current===null?n(qTe(e)):s.current!==e&&n(GTe({prev:s.current,next:e})),s.current=e)},[e,n,r]),b.useLayoutEffect(()=>()=>{s.current&&(n(KTe(s.current)),s.current=null)},[n]),null}function LPe(t){var{legendPayload:e}=t,n=Xn(),r=ti(),s=b.useRef(null);return b.useLayoutEffect(()=>{r||(s.current===null?n(TSe(e)):s.current!==e&&n(ASe({prev:s.current,next:e})),s.current=e)},[n,r,e]),b.useLayoutEffect(()=>()=>{s.current&&(n(kSe(s.current)),s.current=null)},[n]),null}var Qj,FPe=()=>{var[t]=b.useState(()=>Iy("uid-"));return t},BPe=(Qj=P$.useId)!==null&&Qj!==void 0?Qj:FPe;function VPe(t,e){var n=BPe();return e||(t?"".concat(t,"-").concat(n):n)}var $Pe=b.createContext(void 0),UPe=t=>{var{id:e,type:n,children:r}=t,s=VPe("recharts-".concat(n),e);return b.createElement($Pe.Provider,{value:s},r(s))},zPe={cartesianItems:[],polarItems:[]},zY=_i({name:"graphicalItems",initialState:zPe,reducers:{addCartesianGraphicalItem:{reducer(t,e){t.cartesianItems.push(e.payload)},prepare:En()},replaceCartesianGraphicalItem:{reducer(t,e){var{prev:n,next:r}=e.payload,s=Ga(t).cartesianItems.indexOf(n);s>-1&&(t.cartesianItems[s]=r)},prepare:En()},removeCartesianGraphicalItem:{reducer(t,e){var n=Ga(t).cartesianItems.indexOf(e.payload);n>-1&&t.cartesianItems.splice(n,1)},prepare:En()},addPolarGraphicalItem:{reducer(t,e){t.polarItems.push(e.payload)},prepare:En()},removePolarGraphicalItem:{reducer(t,e){var n=Ga(t).polarItems.indexOf(e.payload);n>-1&&t.polarItems.splice(n,1)},prepare:En()}}}),{addCartesianGraphicalItem:HPe,replaceCartesianGraphicalItem:WPe,removeCartesianGraphicalItem:qPe,addPolarGraphicalItem:CMe,removePolarGraphicalItem:TMe}=zY.actions,GPe=zY.reducer,KPe=t=>{var e=Xn(),n=b.useRef(null);return b.useLayoutEffect(()=>{n.current===null?e(HPe(t)):n.current!==t&&e(WPe({prev:n.current,next:t})),n.current=t},[e,t]),b.useLayoutEffect(()=>()=>{n.current&&(e(qPe(n.current)),n.current=null)},[e]),null},YPe=b.memo(KPe);function Y4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Q4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Y4(Object(n),!0).forEach(function(r){QPe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function QPe(t,e,n){return(e=XPe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function XPe(t){var e=JPe(t,"string");return typeof e=="symbol"?e:e+""}function JPe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var ZPe={xAxis:{},yAxis:{},zAxis:{}},HY=_i({name:"cartesianAxis",initialState:ZPe,reducers:{addXAxis:{reducer(t,e){t.xAxis[e.payload.id]=e.payload},prepare:En()},replaceXAxis:{reducer(t,e){var{prev:n,next:r}=e.payload;t.xAxis[n.id]!==void 0&&(n.id!==r.id&&delete t.xAxis[n.id],t.xAxis[r.id]=r)},prepare:En()},removeXAxis:{reducer(t,e){delete t.xAxis[e.payload.id]},prepare:En()},addYAxis:{reducer(t,e){t.yAxis[e.payload.id]=e.payload},prepare:En()},replaceYAxis:{reducer(t,e){var{prev:n,next:r}=e.payload;t.yAxis[n.id]!==void 0&&(n.id!==r.id&&delete t.yAxis[n.id],t.yAxis[r.id]=r)},prepare:En()},removeYAxis:{reducer(t,e){delete t.yAxis[e.payload.id]},prepare:En()},addZAxis:{reducer(t,e){t.zAxis[e.payload.id]=e.payload},prepare:En()},replaceZAxis:{reducer(t,e){var{prev:n,next:r}=e.payload;t.zAxis[n.id]!==void 0&&(n.id!==r.id&&delete t.zAxis[n.id],t.zAxis[r.id]=r)},prepare:En()},removeZAxis:{reducer(t,e){delete t.zAxis[e.payload.id]},prepare:En()},updateYAxisWidth(t,e){var{id:n,width:r}=e.payload,s=t.yAxis[n];if(s){var i,a=s.widthHistory||[];if(a.length===3&&a[0]===a[2]&&r===a[1]&&r!==s.width&&Math.abs(r-((i=a[0])!==null&&i!==void 0?i:0))<=1)return;var l=[...a,r].slice(-3);t.yAxis[n]=Q4(Q4({},s),{},{width:r,widthHistory:l})}}}}),{addXAxis:eOe,replaceXAxis:tOe,removeXAxis:nOe,addYAxis:rOe,replaceYAxis:sOe,removeYAxis:iOe,addZAxis:AMe,replaceZAxis:kMe,removeZAxis:IMe,updateYAxisWidth:aOe}=HY.actions,oOe=HY.reducer,lOe=ce([xs],t=>({top:t.top,bottom:t.bottom,left:t.left,right:t.right})),cOe=ce([lOe,Yl,Ql],(t,e,n)=>{if(!(!t||e==null||n==null))return{x:t.left,y:t.top,width:Math.max(0,e-t.left-t.right),height:Math.max(0,n-t.top-t.bottom)}}),WY=()=>Ze(cOe),uOe=t=>{var{chartData:e}=t,n=Xn(),r=ti();return b.useEffect(()=>r?()=>{}:(n(y4(e)),()=>{n(y4(void 0))}),[e,n,r]),null},X4={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},qY=_i({name:"brush",initialState:X4,reducers:{setBrushSettings(t,e){return e.payload==null?X4:e.payload}}}),{setBrushSettings:PMe}=qY.actions,dOe=qY.reducer,hOe=(t,e)=>{var{x:n,y:r}=t,{x:s,y:i}=e;return{x:Math.min(n,s),y:Math.min(r,i),width:Math.abs(s-n),height:Math.abs(i-r)}},fOe=t=>{var{x1:e,y1:n,x2:r,y2:s}=t;return hOe({x:e,y:n},{x:r,y:s})};function pOe(t){return(t%180+180)%180}var mOe=function(e){var{width:n,height:r}=e,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=pOe(s),a=i*Math.PI/180,l=Math.atan(r/n),c=a>l&&a<Math.PI-l?r/Math.sin(a):n/Math.cos(a);return Math.abs(c)},gOe={dots:[],areas:[],lines:[]},GY=_i({name:"referenceElements",initialState:gOe,reducers:{addDot:(t,e)=>{t.dots.push(e.payload)},removeDot:(t,e)=>{var n=Ga(t).dots.findIndex(r=>r===e.payload);n!==-1&&t.dots.splice(n,1)},addArea:(t,e)=>{t.areas.push(e.payload)},removeArea:(t,e)=>{var n=Ga(t).areas.findIndex(r=>r===e.payload);n!==-1&&t.areas.splice(n,1)},addLine:(t,e)=>{t.lines.push(e.payload)},removeLine:(t,e)=>{var n=Ga(t).lines.findIndex(r=>r===e.payload);n!==-1&&t.lines.splice(n,1)}}}),{addDot:OMe,removeDot:DMe,addArea:RMe,removeArea:MMe,addLine:yOe,removeLine:vOe}=GY.actions,xOe=GY.reducer,KY=b.createContext(void 0),bOe=t=>{var{children:e}=t,[n]=b.useState("".concat(Iy("recharts"),"-clip")),r=WY();if(r==null)return null;var{x:s,y:i,width:a,height:l}=r;return b.createElement(KY.Provider,{value:n},b.createElement("defs",null,b.createElement("clipPath",{id:n},b.createElement("rect",{x:s,y:i,height:l,width:a}))),e)},wOe=()=>b.useContext(KY);class NOe{constructor(e){var{x:n,y:r}=e;this.xAxisScale=n,this.yAxisScale=r}map(e,n){var r,s,{position:i}=n;return{x:(r=this.xAxisScale.map(e.x,{position:i}))!==null&&r!==void 0?r:0,y:(s=this.yAxisScale.map(e.y,{position:i}))!==null&&s!==void 0?s:0}}mapWithFallback(e,n){var r,s,{position:i,fallback:a}=n,l,c;return a==="rangeMin"?l=this.yAxisScale.rangeMin():a==="rangeMax"?l=this.yAxisScale.rangeMax():l=0,a==="rangeMin"?c=this.xAxisScale.rangeMin():a==="rangeMax"?c=this.xAxisScale.rangeMax():c=0,{x:(r=this.xAxisScale.map(e.x,{position:i}))!==null&&r!==void 0?r:c,y:(s=this.yAxisScale.map(e.y,{position:i}))!==null&&s!==void 0?s:l}}isInRange(e){var{x:n,y:r}=e,s=n==null||this.xAxisScale.isInRange(n),i=r==null||this.yAxisScale.isInRange(r);return s&&i}}function J4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Z4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J4(Object(n),!0).forEach(function(r){SOe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function SOe(t,e,n){return(e=_Oe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _Oe(t){var e=jOe(t,"string");return typeof e=="symbol"?e:e+""}function jOe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function k1(){return k1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},k1.apply(null,arguments)}var EOe=(t,e)=>{var n;if(b.isValidElement(t))n=b.cloneElement(t,e);else if(typeof t=="function")n=t(e);else{if(!Ct(e.x1)||!Ct(e.y1)||!Ct(e.x2)||!Ct(e.y2))return null;n=b.createElement("line",k1({},e,{className:"recharts-reference-line-line"}))}return n},COe=(t,e,n,r,s,i)=>{var{x:a,width:l}=i,c=s.map(t,{position:n});if(!Ct(c)||e==="discard"&&!s.isInRange(c))return null;var u=[{x:a+l,y:c},{x:a,y:c}];return r==="left"?u.reverse():u},TOe=(t,e,n,r,s,i)=>{var{y:a,height:l}=i,c=s.map(t,{position:n});if(!Ct(c)||e==="discard"&&!s.isInRange(c))return null;var u=[{x:c,y:a+l},{x:c,y:a}];return r==="top"?u.reverse():u},AOe=(t,e,n,r)=>{var s=[r.mapWithFallback(t[0],{position:n,fallback:"rangeMin"}),r.mapWithFallback(t[1],{position:n,fallback:"rangeMax"})];return e==="discard"&&s.some(i=>!r.isInRange(i))?null:s},kOe=(t,e,n,r,s,i,a)=>{var{x:l,y:c,segment:u,ifOverflow:d}=a,h=Ta(l),f=Ta(c);return f?COe(c,d,r,i,e,n):h?TOe(l,d,r,s,t,n):u!=null&&u.length===2?AOe(u,d,r,new NOe({x:t,y:e})):null};function IOe(t){var e=Xn();return b.useEffect(()=>(e(yOe(t)),()=>{e(vOe(t))})),null}function POe(t){var{xAxisId:e,yAxisId:n,shape:r,className:s,ifOverflow:i}=t,a=ti(),l=wOe(),c=Ze(j=>Uo(j,e)),u=Ze(j=>zo(j,n)),d=Ze(j=>Ep(j,"xAxis",e,a)),h=Ze(j=>Ep(j,"yAxis",n,a)),f=Yp();if(!l||!f||c==null||u==null||d==null||h==null)return null;var p=kOe(d,h,f,t.position,c.orientation,u.orientation,t);if(!p)return null;var m=p[0],g=p[1];if(m==null||g==null)return null;var{x:y,y:x}=m,{x:w,y:N}=g,S=i==="hidden"?"url(#".concat(l,")"):void 0,C=Z4(Z4({clipPath:S},Gi(t)),{},{x1:y,y1:x,x2:w,y2:N}),A=fOe({x1:y,y1:x,x2:w,y2:N});return b.createElement(Zl,{zIndex:t.zIndex},b.createElement(Xa,{className:gn("recharts-reference-line",s)},EOe(r,C),b.createElement(kY,k1({},A,{lowerWidth:A.width,upperWidth:A.width}),b.createElement(PY,{label:t.label}),t.children)))}var OOe={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",label:!1,stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ws.line};function YY(t){var e=ei(t,OOe);return b.createElement(b.Fragment,null,b.createElement(IOe,{yAxisId:e.yAxisId,xAxisId:e.xAxisId,ifOverflow:e.ifOverflow,x:e.x,y:e.y,segment:e.segment}),b.createElement(POe,e))}YY.displayName="ReferenceLine";function QY(t,e){if(e<1)return[];if(e===1)return t;for(var n=[],r=0;r<t.length;r+=e){var s=t[r];s!==void 0&&n.push(s)}return n}function DOe(t,e,n){var r={width:t.width+e.width,height:t.height+e.height};return mOe(r,n)}function ROe(t,e,n){var r=n==="width",{x:s,y:i,width:a,height:l}=t;return e===1?{start:r?s:i,end:r?s+a:i+l}:{start:r?s+a:i+l,end:r?s:i}}function qy(t,e,n,r,s){if(t*e<t*r||t*e>t*s)return!1;var i=n();return t*(e-t*i/2-r)>=0&&t*(e+t*i/2-s)<=0}function MOe(t,e){return QY(t,e+1)}function LOe(t,e,n,r,s){for(var i=(r||[]).slice(),{start:a,end:l}=e,c=0,u=1,d=a,h=function(){var m=r==null?void 0:r[c];if(m===void 0)return{v:QY(r,u)};var g=c,y,x=()=>(y===void 0&&(y=n(m,g)),y),w=m.coordinate,N=c===0||qy(t,w,x,d,l);N||(c=0,d=a,u+=1),N&&(d=w+t*(x()/2+s),c+=u)},f;u<=i.length;)if(f=h(),f)return f.v;return[]}function FOe(t,e,n,r,s){var i=(r||[]).slice(),a=i.length;if(a===0)return[];for(var{start:l,end:c}=e,u=1;u<=a;u++){for(var d=(a-1)%u,h=l,f=!0,p=function(){var S=r[g];if(S==null)return 0;var C=g,A,j=()=>(A===void 0&&(A=n(S,C)),A),_=S.coordinate,E=g===d||qy(t,_,j,h,c);if(!E)return f=!1,1;E&&(h=_+t*(j()/2+s))},m,g=d;g<a&&(m=p(),!(m!==0&&m===1));g+=u);if(f){for(var y=[],x=d;x<a;x+=u){var w=r[x];w!=null&&y.push(w)}return y}}return[]}function e$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function As(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?e$(Object(n),!0).forEach(function(r){BOe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function BOe(t,e,n){return(e=VOe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function VOe(t){var e=$Oe(t,"string");return typeof e=="symbol"?e:e+""}function $Oe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UOe(t,e,n,r,s){for(var i=(r||[]).slice(),a=i.length,{start:l}=e,{end:c}=e,u=function(f){var p=i[f];if(p==null)return 1;var m=p,g,y=()=>(g===void 0&&(g=n(p,f)),g);if(f===a-1){var x=t*(m.coordinate+t*y()/2-c);i[f]=m=As(As({},m),{},{tickCoord:x>0?m.coordinate-x*t:m.coordinate})}else i[f]=m=As(As({},m),{},{tickCoord:m.coordinate});if(m.tickCoord!=null){var w=qy(t,m.tickCoord,y,l,c);w&&(c=m.tickCoord-t*(y()/2+s),i[f]=As(As({},m),{},{isShow:!0}))}},d=a-1;d>=0;d--)u(d);return i}function zOe(t,e,n,r,s,i){var a=(r||[]).slice(),l=a.length,{start:c,end:u}=e;if(i){var d=r[l-1];if(d!=null){var h=n(d,l-1),f=t*(d.coordinate+t*h/2-u);if(a[l-1]=d=As(As({},d),{},{tickCoord:f>0?d.coordinate-f*t:d.coordinate}),d.tickCoord!=null){var p=qy(t,d.tickCoord,()=>h,c,u);p&&(u=d.tickCoord-t*(h/2+s),a[l-1]=As(As({},d),{},{isShow:!0}))}}}for(var m=i?l-1:l,g=function(w){var N=a[w];if(N==null)return 1;var S=N,C,A=()=>(C===void 0&&(C=n(N,w)),C);if(w===0){var j=t*(S.coordinate-t*A()/2-c);a[w]=S=As(As({},S),{},{tickCoord:j<0?S.coordinate-j*t:S.coordinate})}else a[w]=S=As(As({},S),{},{tickCoord:S.coordinate});if(S.tickCoord!=null){var _=qy(t,S.tickCoord,A,c,u);_&&(c=S.tickCoord+t*(A()/2+s),a[w]=As(As({},S),{},{isShow:!0}))}},y=0;y<m;y++)g(y);return a}function ZO(t,e,n){var{tick:r,ticks:s,viewBox:i,minTickGap:a,orientation:l,interval:c,tickFormatter:u,unit:d,angle:h}=t;if(!s||!s.length||!r)return[];if(tt(c)||SS.isSsr){var f;return(f=MOe(s,tt(c)?c:0))!==null&&f!==void 0?f:[]}var p=[],m=l==="top"||l==="bottom"?"width":"height",g=d&&m==="width"?Rg(d,{fontSize:e,letterSpacing:n}):{width:0,height:0},y=(C,A)=>{var j=typeof u=="function"?u(C.value,A):C.value;return m==="width"?DOe(Rg(j,{fontSize:e,letterSpacing:n}),g,h):Rg(j,{fontSize:e,letterSpacing:n})[m]},x=s[0],w=s[1],N=s.length>=2&&x!=null&&w!=null?ga(w.coordinate-x.coordinate):1,S=ROe(i,N,m);return c==="equidistantPreserveStart"?LOe(N,S,y,s,a):c==="equidistantPreserveEnd"?FOe(N,S,y,s,a):(c==="preserveStart"||c==="preserveStartEnd"?p=zOe(N,S,y,s,a,c==="preserveStartEnd"):p=UOe(N,S,y,s,a),p.filter(C=>C.isShow))}var HOe=t=>{var{ticks:e,label:n,labelGapWithTick:r=5,tickSize:s=0,tickMargin:i=0}=t,a=0;if(e){Array.from(e).forEach(d=>{if(d){var h=d.getBoundingClientRect();h.width>a&&(a=h.width)}});var l=n?n.getBoundingClientRect().width:0,c=s+i,u=a+c+l+(n?r:0);return Math.round(u)}return 0},WOe=["axisLine","width","height","className","hide","ticks","axisType"];function qOe(t,e){if(t==null)return{};var n,r,s=GOe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function GOe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function hh(){return hh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},hh.apply(null,arguments)}function t$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Hn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?t$(Object(n),!0).forEach(function(r){KOe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function KOe(t,e,n){return(e=YOe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function YOe(t){var e=QOe(t,"string");return typeof e=="symbol"?e:e+""}function QOe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Nl={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:Ws.axis};function XOe(t){var{x:e,y:n,width:r,height:s,orientation:i,mirror:a,axisLine:l,otherSvgProps:c}=t;if(!l)return null;var u=Hn(Hn(Hn({},c),Mo(l)),{},{fill:"none"});if(i==="top"||i==="bottom"){var d=+(i==="top"&&!a||i==="bottom"&&a);u=Hn(Hn({},u),{},{x1:e,y1:n+d*s,x2:e+r,y2:n+d*s})}else{var h=+(i==="left"&&!a||i==="right"&&a);u=Hn(Hn({},u),{},{x1:e+h*r,y1:n,x2:e+h*r,y2:n+s})}return b.createElement("line",hh({},u,{className:gn("recharts-cartesian-axis-line",xp(l,"className"))}))}function JOe(t,e,n,r,s,i,a,l,c){var u,d,h,f,p,m,g=l?-1:1,y=t.tickSize||a,x=tt(t.tickCoord)?t.tickCoord:t.coordinate;switch(i){case"top":u=d=t.coordinate,f=n+ +!l*s,h=f-g*y,m=h-g*c,p=x;break;case"left":h=f=t.coordinate,d=e+ +!l*r,u=d-g*y,p=u-g*c,m=x;break;case"right":h=f=t.coordinate,d=e+ +l*r,u=d+g*y,p=u+g*c,m=x;break;default:u=d=t.coordinate,f=n+ +l*s,h=f+g*y,m=h+g*c,p=x;break}return{line:{x1:u,y1:h,x2:d,y2:f},tick:{x:p,y:m}}}function ZOe(t,e){switch(t){case"left":return e?"start":"end";case"right":return e?"end":"start";default:return"middle"}}function eDe(t,e){switch(t){case"left":case"right":return"middle";case"top":return e?"start":"end";default:return e?"end":"start"}}function tDe(t){var{option:e,tickProps:n,value:r}=t,s,i=gn(n.className,"recharts-cartesian-axis-tick-value");if(b.isValidElement(e))s=b.cloneElement(e,Hn(Hn({},n),{},{className:i}));else if(typeof e=="function")s=e(Hn(Hn({},n),{},{className:i}));else{var a="recharts-cartesian-axis-tick-value";typeof e!="boolean"&&(a=gn(a,cPe(e))),s=b.createElement(KO,hh({},n,{className:a}),r)}return s}var nDe=b.forwardRef((t,e)=>{var{ticks:n=[],tick:r,tickLine:s,stroke:i,tickFormatter:a,unit:l,padding:c,tickTextProps:u,orientation:d,mirror:h,x:f,y:p,width:m,height:g,tickSize:y,tickMargin:x,fontSize:w,letterSpacing:N,getTicksConfig:S,events:C,axisType:A}=t,j=ZO(Hn(Hn({},S),{},{ticks:n}),w,N),_=ZOe(d,h),E=eDe(d,h),I=Mo(S),T=bP(r),P={};typeof s=="object"&&(P=s);var O=Hn(Hn({},I),{},{fill:"none"},P),H=j.map(L=>Hn({entry:L},JOe(L,f,p,m,g,d,y,h,x))),X=H.map(L=>{var{entry:B,line:$}=L;return b.createElement(Xa,{className:"recharts-cartesian-axis-tick",key:"tick-".concat(B.value,"-").concat(B.coordinate,"-").concat(B.tickCoord)},s&&b.createElement("line",hh({},O,$,{className:gn("recharts-cartesian-axis-tick-line",xp(s,"className"))})))}),se=H.map((L,B)=>{var $,q,{entry:Y,tick:R}=L,G=Hn(Hn(Hn(Hn({verticalAnchor:E},I),{},{textAnchor:_,stroke:"none",fill:i},R),{},{index:B,payload:Y,visibleTicksCount:j.length,tickFormatter:a,padding:c},u),{},{angle:($=(q=u==null?void 0:u.angle)!==null&&q!==void 0?q:I.angle)!==null&&$!==void 0?$:0}),Z=Hn(Hn({},G),T);return b.createElement(Xa,hh({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(Y.value,"-").concat(Y.coordinate,"-").concat(Y.tickCoord)},v8(C,Y,B)),r&&b.createElement(tDe,{option:r,tickProps:Z,value:"".concat(typeof a=="function"?a(Y.value,B):Y.value).concat(l||"")}))});return b.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(A,"-ticks")},se.length>0&&b.createElement(Zl,{zIndex:Ws.label},b.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(A,"-tick-labels"),ref:e},se)),X.length>0&&b.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(A,"-tick-lines")},X))}),rDe=b.forwardRef((t,e)=>{var{axisLine:n,width:r,height:s,className:i,hide:a,ticks:l,axisType:c}=t,u=qOe(t,WOe),[d,h]=b.useState(""),[f,p]=b.useState(""),m=b.useRef(null);b.useImperativeHandle(e,()=>({getCalculatedWidth:()=>{var y;return HOe({ticks:m.current,label:(y=t.labelRef)===null||y===void 0?void 0:y.current,labelGapWithTick:5,tickSize:t.tickSize,tickMargin:t.tickMargin})}}));var g=b.useCallback(y=>{if(y){var x=y.getElementsByClassName("recharts-cartesian-axis-tick-value");m.current=x;var w=x[0];if(w){var N=window.getComputedStyle(w),S=N.fontSize,C=N.letterSpacing;(S!==d||C!==f)&&(h(S),p(C))}}},[d,f]);return a||r!=null&&r<=0||s!=null&&s<=0?null:b.createElement(Zl,{zIndex:t.zIndex},b.createElement(Xa,{className:gn("recharts-cartesian-axis",i)},b.createElement(XOe,{x:t.x,y:t.y,width:r,height:s,orientation:t.orientation,mirror:t.mirror,axisLine:n,otherSvgProps:Mo(t)}),b.createElement(nDe,{ref:g,axisType:c,events:u,fontSize:d,getTicksConfig:t,height:t.height,letterSpacing:f,mirror:t.mirror,orientation:t.orientation,padding:t.padding,stroke:t.stroke,tick:t.tick,tickFormatter:t.tickFormatter,tickLine:t.tickLine,tickMargin:t.tickMargin,tickSize:t.tickSize,tickTextProps:t.tickTextProps,ticks:l,unit:t.unit,width:t.width,x:t.x,y:t.y}),b.createElement(kY,{x:t.x,y:t.y,width:t.width,height:t.height,lowerWidth:t.width,upperWidth:t.width},b.createElement(PY,{label:t.label,labelRef:t.labelRef}),t.children)))}),eD=b.forwardRef((t,e)=>{var n=ei(t,Nl);return b.createElement(rDe,hh({},n,{ref:e}))});eD.displayName="CartesianAxis";var sDe=["x1","y1","x2","y2","key"],iDe=["offset"],aDe=["xAxisId","yAxisId"],oDe=["xAxisId","yAxisId"];function n$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Ps(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n$(Object(n),!0).forEach(function(r){lDe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function lDe(t,e,n){return(e=cDe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function cDe(t){var e=uDe(t,"string");return typeof e=="symbol"?e:e+""}function uDe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function yd(){return yd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},yd.apply(null,arguments)}function I1(t,e){if(t==null)return{};var n,r,s=dDe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function dDe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var hDe=t=>{var{fill:e}=t;if(!e||e==="none")return null;var{fillOpacity:n,x:r,y:s,width:i,height:a,ry:l}=t;return b.createElement("rect",{x:r,y:s,ry:l,width:i,height:a,stroke:"none",fill:e,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function XY(t){var{option:e,lineItemProps:n}=t,r;if(b.isValidElement(e))r=b.cloneElement(e,n);else if(typeof e=="function")r=e(n);else{var s,{x1:i,y1:a,x2:l,y2:c,key:u}=n,d=I1(n,sDe),h=(s=Mo(d))!==null&&s!==void 0?s:{},{offset:f}=h,p=I1(h,iDe);r=b.createElement("line",yd({},p,{x1:i,y1:a,x2:l,y2:c,fill:"none",key:u}))}return r}function fDe(t){var{x:e,width:n,horizontal:r=!0,horizontalPoints:s}=t;if(!r||!s||!s.length)return null;var{xAxisId:i,yAxisId:a}=t,l=I1(t,aDe),c=s.map((u,d)=>{var h=Ps(Ps({},l),{},{x1:e,y1:u,x2:e+n,y2:u,key:"line-".concat(d),index:d});return b.createElement(XY,{key:"line-".concat(d),option:r,lineItemProps:h})});return b.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function pDe(t){var{y:e,height:n,vertical:r=!0,verticalPoints:s}=t;if(!r||!s||!s.length)return null;var{xAxisId:i,yAxisId:a}=t,l=I1(t,oDe),c=s.map((u,d)=>{var h=Ps(Ps({},l),{},{x1:u,y1:e,x2:u,y2:e+n,key:"line-".concat(d),index:d});return b.createElement(XY,{option:r,lineItemProps:h,key:"line-".concat(d)})});return b.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function mDe(t){var{horizontalFill:e,fillOpacity:n,x:r,y:s,width:i,height:a,horizontalPoints:l,horizontal:c=!0}=t;if(!c||!e||!e.length||l==null)return null;var u=l.map(h=>Math.round(h+s-s)).sort((h,f)=>h-f);s!==u[0]&&u.unshift(0);var d=u.map((h,f)=>{var p=u[f+1],m=p==null,g=m?s+a-h:p-h;if(g<=0)return null;var y=f%e.length;return b.createElement("rect",{key:"react-".concat(f),y:h,x:r,height:g,width:i,stroke:"none",fill:e[y],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return b.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},d)}function gDe(t){var{vertical:e=!0,verticalFill:n,fillOpacity:r,x:s,y:i,width:a,height:l,verticalPoints:c}=t;if(!e||!n||!n.length)return null;var u=c.map(h=>Math.round(h+s-s)).sort((h,f)=>h-f);s!==u[0]&&u.unshift(0);var d=u.map((h,f)=>{var p=u[f+1],m=p==null,g=m?s+a-h:p-h;if(g<=0)return null;var y=f%n.length;return b.createElement("rect",{key:"react-".concat(f),x:h,y:i,width:g,height:l,stroke:"none",fill:n[y],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return b.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},d)}var yDe=(t,e)=>{var{xAxis:n,width:r,height:s,offset:i}=t;return _G(ZO(Ps(Ps(Ps({},Nl),n),{},{ticks:jG(n),viewBox:{x:0,y:0,width:r,height:s}})),i.left,i.left+i.width,e)},vDe=(t,e)=>{var{yAxis:n,width:r,height:s,offset:i}=t;return _G(ZO(Ps(Ps(Ps({},Nl),n),{},{ticks:jG(n),viewBox:{x:0,y:0,width:r,height:s}})),i.top,i.top+i.height,e)},xDe={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0,syncWithTicks:!1,zIndex:Ws.grid};function JY(t){var e=LG(),n=FG(),r=MG(),s=Ps(Ps({},ei(t,xDe)),{},{x:tt(t.x)?t.x:r.left,y:tt(t.y)?t.y:r.top,width:tt(t.width)?t.width:r.width,height:tt(t.height)?t.height:r.height}),{xAxisId:i,yAxisId:a,x:l,y:c,width:u,height:d,syncWithTicks:h,horizontalValues:f,verticalValues:p}=s,m=ti(),g=Ze(E=>a4(E,"xAxis",i,m)),y=Ze(E=>a4(E,"yAxis",a,m));if(!Lo(u)||!Lo(d)||!tt(l)||!tt(c))return null;var x=s.verticalCoordinatesGenerator||yDe,w=s.horizontalCoordinatesGenerator||vDe,{horizontalPoints:N,verticalPoints:S}=s;if((!N||!N.length)&&typeof w=="function"){var C=f&&f.length,A=w({yAxis:y?Ps(Ps({},y),{},{ticks:C?f:y.ticks}):void 0,width:e??u,height:n??d,offset:r},C?!0:h);r1(Array.isArray(A),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof A,"]")),Array.isArray(A)&&(N=A)}if((!S||!S.length)&&typeof x=="function"){var j=p&&p.length,_=x({xAxis:g?Ps(Ps({},g),{},{ticks:j?p:g.ticks}):void 0,width:e??u,height:n??d,offset:r},j?!0:h);r1(Array.isArray(_),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof _,"]")),Array.isArray(_)&&(S=_)}return b.createElement(Zl,{zIndex:s.zIndex},b.createElement("g",{className:"recharts-cartesian-grid"},b.createElement(hDe,{fill:s.fill,fillOpacity:s.fillOpacity,x:s.x,y:s.y,width:s.width,height:s.height,ry:s.ry}),b.createElement(mDe,yd({},s,{horizontalPoints:N})),b.createElement(gDe,yd({},s,{verticalPoints:S})),b.createElement(fDe,yd({},s,{offset:r,horizontalPoints:N,xAxis:g,yAxis:y})),b.createElement(pDe,yd({},s,{offset:r,verticalPoints:S,xAxis:g,yAxis:y}))))}JY.displayName="CartesianGrid";var bDe={},ZY=_i({name:"errorBars",initialState:bDe,reducers:{addErrorBar:(t,e)=>{var{itemId:n,errorBar:r}=e.payload;t[n]||(t[n]=[]),t[n].push(r)},replaceErrorBar:(t,e)=>{var{itemId:n,prev:r,next:s}=e.payload;t[n]&&(t[n]=t[n].map(i=>i.dataKey===r.dataKey&&i.direction===r.direction?s:i))},removeErrorBar:(t,e)=>{var{itemId:n,errorBar:r}=e.payload;t[n]&&(t[n]=t[n].filter(s=>s.dataKey!==r.dataKey||s.direction!==r.direction))}}}),{addErrorBar:LMe,replaceErrorBar:FMe,removeErrorBar:BMe}=ZY.actions,wDe=ZY.reducer,NDe=["children"];function SDe(t,e){if(t==null)return{};var n,r,s=_De(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function _De(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var jDe={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},EDe=b.createContext(jDe);function CDe(t){var{children:e}=t,n=SDe(t,NDe);return b.createElement(EDe.Provider,{value:n},e)}function eQ(t,e){var n,r,s=Ze(u=>Uo(u,t)),i=Ze(u=>zo(u,e)),a=(n=s==null?void 0:s.allowDataOverflow)!==null&&n!==void 0?n:Pr.allowDataOverflow,l=(r=i==null?void 0:i.allowDataOverflow)!==null&&r!==void 0?r:Or.allowDataOverflow,c=a||l;return{needClip:c,needClipX:a,needClipY:l}}function TDe(t){var{xAxisId:e,yAxisId:n,clipPathId:r}=t,s=WY(),{needClipX:i,needClipY:a,needClip:l}=eQ(e,n);if(!l||!s)return null;var{x:c,y:u,width:d,height:h}=s;return b.createElement("clipPath",{id:"clipPath-".concat(r)},b.createElement("rect",{x:i?c:c-d/2,y:a?u:u-h/2,width:i?d:d*2,height:a?h:h*2}))}var ADe={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv=b;function kDe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var IDe=typeof Object.is=="function"?Object.is:kDe,PDe=Qv.useSyncExternalStore,ODe=Qv.useRef,DDe=Qv.useEffect,RDe=Qv.useMemo,MDe=Qv.useDebugValue;ADe.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var i=ODe(null);if(i.current===null){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=RDe(function(){function c(p){if(!u){if(u=!0,d=p,p=r(p),s!==void 0&&a.hasValue){var m=a.value;if(s(m,p))return h=m}return h=p}if(m=h,IDe(d,p))return m;var g=r(p);return s!==void 0&&s(m,g)?(d=p,m):(d=p,h=g)}var u=!1,d,h,f=n===void 0?null:n;return[function(){return c(e())},f===null?void 0:function(){return c(f())}]},[e,n,r,s]);var l=PDe(t,i[0],i[1]);return DDe(function(){a.hasValue=!0,a.value=l},[l]),MDe(l),l};function LDe(t){t()}function FDe(){let t=null,e=null;return{clear(){t=null,e=null},notify(){LDe(()=>{let n=t;for(;n;)n.callback(),n=n.next})},get(){const n=[];let r=t;for(;r;)n.push(r),r=r.next;return n},subscribe(n){let r=!0;const s=e={callback:n,next:null,prev:e};return s.prev?s.prev.next=s:t=s,function(){!r||t===null||(r=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:t=s.next)}}}}var r$={notify(){},get:()=>[]};function BDe(t,e){let n,r=r$,s=0,i=!1;function a(g){d();const y=r.subscribe(g);let x=!1;return()=>{x||(x=!0,y(),h())}}function l(){r.notify()}function c(){m.onStateChange&&m.onStateChange()}function u(){return i}function d(){s++,n||(n=t.subscribe(c),r=FDe())}function h(){s--,n&&s===0&&(n(),n=void 0,r.clear(),r=r$)}function f(){i||(i=!0,d())}function p(){i&&(i=!1,h())}const m={addNestedSub:a,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:u,trySubscribe:f,tryUnsubscribe:p,getListeners:()=>r};return m}var VDe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$De=VDe(),UDe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",zDe=UDe(),HDe=()=>$De||zDe?b.useLayoutEffect:b.useEffect,WDe=HDe();function s$(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function qDe(t,e){if(s$(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(!Object.prototype.hasOwnProperty.call(e,n[s])||!s$(t[n[s]],e[n[s]]))return!1;return!0}var Xj=Symbol.for("react-redux-context"),Jj=typeof globalThis<"u"?globalThis:{};function GDe(){if(!b.createContext)return{};const t=Jj[Xj]??(Jj[Xj]=new Map);let e=t.get(b.createContext);return e||(e=b.createContext(null),t.set(b.createContext,e)),e}var KDe=GDe();function YDe(t){const{children:e,context:n,serverState:r,store:s}=t,i=b.useMemo(()=>{const c=BDe(s);return{store:s,subscription:c,getServerState:r?()=>r:void 0}},[s,r]),a=b.useMemo(()=>s.getState(),[s]);WDe(()=>{const{subscription:c}=i;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),a!==s.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[i,a]);const l=n||KDe;return b.createElement(l.Provider,{value:i},e)}var QDe=YDe,XDe=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle","radius"]);function JDe(t,e){return t==null&&e==null?!0:typeof t=="number"&&typeof e=="number"?t===e||t!==t&&e!==e:t===e}function tD(t,e){var n=new Set([...Object.keys(t),...Object.keys(e)]);for(var r of n)if(XDe.has(r)){if(t[r]==null&&e[r]==null)continue;if(!qDe(t[r],e[r]))return!1}else if(!JDe(t[r],e[r]))return!1;return!0}var ZDe=["option","isActive"];function Mg(){return Mg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Mg.apply(null,arguments)}function e2e(t,e){if(t==null)return{};var n,r,s=t2e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function t2e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function n2e(t){var{option:e,isActive:n}=t,r=e2e(t,ZDe);return typeof e=="string"?b.createElement(K4,Mg({option:b.createElement(jP,Mg({type:e},r)),isActive:n,shapeType:"symbols"},r)):b.createElement(K4,Mg({option:e,isActive:n,shapeType:"symbols"},r))}var r2e=(t,e,n,r,s,i,a)=>z7(t,"xAxis",e,a),s2e=(t,e,n,r,s,i,a)=>U7(t,"xAxis",e,a),i2e=(t,e,n,r,s,i,a)=>z7(t,"yAxis",n,a),a2e=(t,e,n,r,s,i,a)=>U7(t,"yAxis",n,a),o2e=(t,e,n,r)=>$Te(t,"zAxis",r,!1),l2e=(t,e,n,r,s)=>s,c2e=(t,e,n,r,s,i)=>i,u2e=(t,e,n,r,s,i,a)=>xO(t,void 0,void 0,a),d2e=ce([d7,l2e],(t,e)=>t.filter(n=>n.type==="scatter").find(n=>n.id===e)),h2e=ce([u2e,r2e,s2e,i2e,a2e,o2e,d2e,c2e],(t,e,n,r,s,i,a,l)=>{var{chartData:c,dataStartIndex:u,dataEndIndex:d}=t;if(a!=null){var h;if((a==null?void 0:a.data)!=null&&a.data.length>0?h=a.data:h=c==null?void 0:c.slice(u,d+1),!(h==null||e==null||r==null||n==null||s==null||(n==null?void 0:n.length)===0||(s==null?void 0:s.length)===0))return E2e({displayedData:h,xAxis:e,yAxis:r,zAxis:i,scatterSettings:a,xAxisTicks:n,yAxisTicks:s,cells:l})}}),f2e=["id"],p2e=["onMouseEnter","onClick","onMouseLeave"],m2e=["animationBegin","animationDuration","animationEasing","hide","isAnimationActive","legendType","lineJointType","lineType","shape","xAxisId","yAxisId","zAxisId"];function ZT(t,e){if(t==null)return{};var n,r,s=g2e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function g2e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function fh(){return fh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},fh.apply(null,arguments)}function i$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function yi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i$(Object(n),!0).forEach(function(r){y2e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function y2e(t,e,n){return(e=v2e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v2e(t){var e=x2e(t,"string");return typeof e=="symbol"?e:e+""}function x2e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var b2e=t=>{var{dataKey:e,name:n,fill:r,legendType:s,hide:i}=t;return[{inactive:i,dataKey:e,type:s,color:r,value:EG(n,e),payload:t}]},w2e=b.memo(t=>{var{dataKey:e,points:n,stroke:r,strokeWidth:s,fill:i,name:a,hide:l,tooltipType:c,id:u}=t,d={dataDefinedOnItem:n==null?void 0:n.map(h=>h.tooltipPayload),getPosition:h=>{var f;return n==null||(f=n[Number(h)])===null||f===void 0?void 0:f.tooltipPosition},settings:{stroke:r,strokeWidth:s,fill:i,nameKey:void 0,dataKey:e,name:EG(a,e),hide:l,type:c,color:i,unit:"",graphicalItemId:u}};return b.createElement(MPe,{tooltipEntrySettings:d})});function N2e(t){var{points:e,props:n}=t,{line:r,lineType:s,lineJointType:i}=n;if(!r)return null;var a=Mo(n),l=bP(r),c,u;if(s==="joint")c=e.map(y=>{var x,w;return{x:(x=y.cx)!==null&&x!==void 0?x:null,y:(w=y.cy)!==null&&w!==void 0?w:null}});else if(s==="fitting"){var{xmin:d,xmax:h,a:f,b:p}=Cwe(e),m=y=>f*y+p;c=[{x:d,y:m(d)},{x:h,y:m(h)}]}var g=yi(yi(yi({},a),{},{fill:"none",stroke:a&&a.fill},l),{},{points:c});return b.isValidElement(r)?u=b.cloneElement(r,g):typeof r=="function"?u=r(g):u=b.createElement(GP,fh({},g,{type:i})),b.createElement(Xa,{className:"recharts-scatter-line",key:"recharts-scatter-line"},u)}function S2e(t){var{showLabels:e,points:n,children:r}=t,s=Yp(),i=b.useMemo(()=>n==null?void 0:n.map(a=>{var l,c,u={x:(l=a.x)!==null&&l!==void 0?l:0,y:(c=a.y)!==null&&c!==void 0?c:0,width:a.width,height:a.height,lowerWidth:a.width,upperWidth:a.width};return yi(yi({},u),{},{value:void 0,payload:a.payload,viewBox:u,parentViewBox:s,fill:void 0})}),[s,n]);return b.createElement(rPe,{value:e?i:void 0},r)}function _2e(t){var{points:e,allOtherScatterProps:n}=t,{shape:r,activeShape:s,dataKey:i}=n,{id:a}=n,l=ZT(n,f2e),c=Ze(Hy),{onMouseEnter:u,onClick:d,onMouseLeave:h}=n,f=ZT(n,p2e),p=OPe(u,i,a),m=DPe(h),g=RPe(d,i,a);if(!Vwe(e))return null;var y=Mo(l);return b.createElement(b.Fragment,null,b.createElement(N2e,{points:e,props:l}),e.map((x,w)=>{var N=s!=null&&s!==!1,S=N&&c===String(w),C=N&&S?s:r,A=yi(yi(yi({},y),x),{},{index:w,[TG]:String(a)});return b.createElement(Zl,{key:"symbol-".concat(x==null?void 0:x.cx,"-").concat(x==null?void 0:x.cy,"-").concat(x==null?void 0:x.size,"-").concat(w),zIndex:S?Ws.activeDot:void 0},b.createElement(Xa,fh({className:"recharts-scatter-symbol"},v8(f,x,w),{onMouseEnter:p(x,w),onMouseLeave:m(x,w),onClick:g(x,w)}),b.createElement(n2e,fh({option:C,isActive:S},A))))}))}function j2e(t){var{previousPointsRef:e,props:n}=t,{points:r,isAnimationActive:s,animationBegin:i,animationDuration:a,animationEasing:l}=n,c=e.current,u=YP(n,"recharts-scatter-"),[d,h]=b.useState(!1),f=b.useCallback(()=>{h(!1)},[]),p=b.useCallback(()=>{h(!0)},[]),m=!d;return b.createElement(S2e,{showLabels:m,points:r},n.children,b.createElement(KP,{animationId:u,begin:i,duration:a,isActive:s,easing:l,onAnimationEnd:f,onAnimationStart:p,key:u},g=>{var y=g===1?r:r==null?void 0:r.map((x,w)=>{var N=c&&c[w];return N?yi(yi({},x),{},{cx:x.cx==null?void 0:Oi(N.cx,x.cx,g),cy:x.cy==null?void 0:Oi(N.cy,x.cy,g),size:Oi(N.size,x.size,g)}):yi(yi({},x),{},{size:Oi(0,x.size,g)})});return g>0&&(e.current=y),b.createElement(Xa,null,b.createElement(_2e,{points:y,allOtherScatterProps:n,showLabels:m}))}),b.createElement(aPe,{label:n.label}))}function E2e(t){var{displayedData:e,xAxis:n,yAxis:r,zAxis:s,scatterSettings:i,xAxisTicks:a,yAxisTicks:l,cells:c}=t,u=dr(n.dataKey)?i.dataKey:n.dataKey,d=dr(r.dataKey)?i.dataKey:r.dataKey,h=s&&s.dataKey,f=s?s.range:l7.range,p=f&&f[0],m=n.scale.bandwidth?n.scale.bandwidth():0,g=r.scale.bandwidth?r.scale.bandwidth():0;return e.map((y,x)=>{var w=Er(y,u),N=Er(y,d),S=!dr(h)&&Er(y,h)||"-",C=[{name:dr(n.dataKey)?i.name:n.name||String(n.dataKey),unit:n.unit||"",value:w,payload:y,dataKey:u,type:i.tooltipType},{name:dr(r.dataKey)?i.name:r.name||String(r.dataKey),unit:r.unit||"",value:N,payload:y,dataKey:d,type:i.tooltipType}];S!=="-"&&s!=null&&C.push({name:s.name||s.dataKey,unit:s.unit||"",value:S,payload:y,dataKey:h,type:i.tooltipType});var A=pB({axis:n,ticks:a,bandSize:m,entry:y,index:x,dataKey:u}),j=pB({axis:r,ticks:l,bandSize:g,entry:y,index:x,dataKey:d}),_=S!=="-"&&s!=null?s.scale.map(S):p,E=_==null?0:Math.sqrt(Math.max(_,0)/Math.PI);return yi(yi({},y),{},{cx:A,cy:j,x:A==null?void 0:A-E,y:j==null?void 0:j-E,width:2*E,height:2*E,size:_,node:{x:w,y:N,z:S},tooltipPayload:C,tooltipPosition:{x:A,y:j},payload:y},c&&c[x]&&c[x].props)})}var C2e=(t,e,n)=>({x:t.cx,y:t.cy,value:Number(n==="x"?t.node.x:t.node.y),errorVal:Er(t,e)});function T2e(t){var{hide:e,points:n,className:r,needClip:s,xAxisId:i,yAxisId:a,id:l}=t,c=b.useRef(null);if(e)return null;var u=gn("recharts-scatter",r),d=l;return b.createElement(Zl,{zIndex:t.zIndex},b.createElement(Xa,{className:u,clipPath:s?"url(#clipPath-".concat(d,")"):void 0,id:l},s&&b.createElement("defs",null,b.createElement(TDe,{clipPathId:d,xAxisId:i,yAxisId:a})),b.createElement(CDe,{xAxisId:i,yAxisId:a,data:n,dataPointFormatter:C2e,errorBarOffset:0},b.createElement(Xa,{key:"recharts-scatter-symbols"},b.createElement(j2e,{props:t,previousPointsRef:c})))))}var tQ={xAxisId:0,yAxisId:0,zAxisId:0,label:!1,line:!1,legendType:"circle",lineType:"joint",lineJointType:"linear",shape:"circle",hide:!1,isAnimationActive:"auto",animationBegin:0,animationDuration:400,animationEasing:"linear",zIndex:Ws.scatter};function A2e(t){var e=ei(t,tQ),{animationBegin:n,animationDuration:r,animationEasing:s,hide:i,isAnimationActive:a,legendType:l,lineJointType:c,lineType:u,shape:d,xAxisId:h,yAxisId:f,zAxisId:p}=e,m=ZT(e,m2e),{needClip:g}=eQ(h,f),y=b.useMemo(()=>gPe(t.children,bY),[t.children]),x=ti(),w=Ze(N=>h2e(N,h,f,p,t.id,y,x));return g==null||w==null?null:b.createElement(b.Fragment,null,b.createElement(w2e,{dataKey:t.dataKey,points:w,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,tooltipType:t.tooltipType,id:t.id}),b.createElement(T2e,fh({},m,{xAxisId:h,yAxisId:f,zAxisId:p,lineType:u,lineJointType:c,legendType:l,shape:d,hide:i,isAnimationActive:a,animationBegin:n,animationDuration:r,animationEasing:s,points:w,needClip:g})))}function k2e(t){var e=ei(t,tQ),n=ti();return b.createElement(UPe,{id:e.id,type:"scatter"},r=>b.createElement(b.Fragment,null,b.createElement(LPe,{legendPayload:b2e(e)}),b.createElement(YPe,{type:"scatter",id:r,data:e.data,xAxisId:e.xAxisId,yAxisId:e.yAxisId,zAxisId:e.zAxisId,dataKey:e.dataKey,hide:e.hide,name:e.name,tooltipType:e.tooltipType,isPanorama:n}),b.createElement(A2e,fh({},e,{id:r}))))}var nQ=b.memo(k2e,tD);nQ.displayName="Scatter";var I2e=["domain","range"],P2e=["domain","range"];function a$(t,e){if(t==null)return{};var n,r,s=O2e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function O2e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function o$(t,e){return t===e?!0:Array.isArray(t)&&t.length===2&&Array.isArray(e)&&e.length===2?t[0]===e[0]&&t[1]===e[1]:!1}function rQ(t,e){if(t===e)return!0;var{domain:n,range:r}=t,s=a$(t,I2e),{domain:i,range:a}=e,l=a$(e,P2e);return!o$(n,i)||!o$(r,a)?!1:tD(s,l)}var D2e=["type"],R2e=["dangerouslySetInnerHTML","ticks","scale"],M2e=["id","scale"];function eA(){return eA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},eA.apply(null,arguments)}function l$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function c$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l$(Object(n),!0).forEach(function(r){L2e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function L2e(t,e,n){return(e=F2e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function F2e(t){var e=B2e(t,"string");return typeof e=="symbol"?e:e+""}function B2e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function tA(t,e){if(t==null)return{};var n,r,s=V2e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function V2e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function $2e(t){var e=Xn(),n=b.useRef(null),r=BG(),{type:s}=t,i=tA(t,D2e),a=PS(r,"xAxis",s),l=b.useMemo(()=>{if(a!=null)return c$(c$({},i),{},{type:a})},[i,a]);return b.useLayoutEffect(()=>{l!=null&&(n.current===null?e(eOe(l)):n.current!==l&&e(tOe({prev:n.current,next:l})),n.current=l)},[l,e]),b.useLayoutEffect(()=>()=>{n.current&&(e(nOe(n.current)),n.current=null)},[e]),null}var U2e=t=>{var{xAxisId:e,className:n}=t,r=Ze(AG),s=ti(),i="xAxis",a=Ze(x=>$7(x,i,e,s)),l=Ze(x=>TTe(x,e)),c=Ze(x=>DTe(x,e)),u=Ze(x=>a7(x,e));if(l==null||c==null||u==null)return null;var{dangerouslySetInnerHTML:d,ticks:h,scale:f}=t,p=tA(t,R2e),{id:m,scale:g}=u,y=tA(u,M2e);return b.createElement(eD,eA({},p,y,{x:c.x,y:c.y,width:l.width,height:l.height,className:gn("recharts-".concat(i," ").concat(i),n),viewBox:r,ticks:a,axisType:i}))},z2e={allowDataOverflow:Pr.allowDataOverflow,allowDecimals:Pr.allowDecimals,allowDuplicatedCategory:Pr.allowDuplicatedCategory,angle:Pr.angle,axisLine:Nl.axisLine,height:Pr.height,hide:!1,includeHidden:Pr.includeHidden,interval:Pr.interval,label:!1,minTickGap:Pr.minTickGap,mirror:Pr.mirror,orientation:Pr.orientation,padding:Pr.padding,reversed:Pr.reversed,scale:Pr.scale,tick:Pr.tick,tickCount:Pr.tickCount,tickLine:Nl.tickLine,tickSize:Nl.tickSize,type:Pr.type,xAxisId:0},H2e=t=>{var e=ei(t,z2e);return b.createElement(b.Fragment,null,b.createElement($2e,{allowDataOverflow:e.allowDataOverflow,allowDecimals:e.allowDecimals,allowDuplicatedCategory:e.allowDuplicatedCategory,angle:e.angle,dataKey:e.dataKey,domain:e.domain,height:e.height,hide:e.hide,id:e.xAxisId,includeHidden:e.includeHidden,interval:e.interval,minTickGap:e.minTickGap,mirror:e.mirror,name:e.name,orientation:e.orientation,padding:e.padding,reversed:e.reversed,scale:e.scale,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit}),b.createElement(U2e,e))},sQ=b.memo(H2e,rQ);sQ.displayName="XAxis";var W2e=["type"],q2e=["dangerouslySetInnerHTML","ticks","scale"],G2e=["id","scale"];function nA(){return nA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},nA.apply(null,arguments)}function u$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function d$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?u$(Object(n),!0).forEach(function(r){K2e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function K2e(t,e,n){return(e=Y2e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Y2e(t){var e=Q2e(t,"string");return typeof e=="symbol"?e:e+""}function Q2e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function rA(t,e){if(t==null)return{};var n,r,s=X2e(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function X2e(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function J2e(t){var e=Xn(),n=b.useRef(null),r=BG(),{type:s}=t,i=rA(t,W2e),a=PS(r,"yAxis",s),l=b.useMemo(()=>{if(a!=null)return d$(d$({},i),{},{type:a})},[a,i]);return b.useLayoutEffect(()=>{l!=null&&(n.current===null?e(rOe(l)):n.current!==l&&e(sOe({prev:n.current,next:l})),n.current=l)},[l,e]),b.useLayoutEffect(()=>()=>{n.current&&(e(iOe(n.current)),n.current=null)},[e]),null}function Z2e(t){var{yAxisId:e,className:n,width:r,label:s}=t,i=b.useRef(null),a=b.useRef(null),l=Ze(AG),c=ti(),u=Xn(),d="yAxis",h=Ze(A=>LTe(A,e)),f=Ze(A=>MTe(A,e)),p=Ze(A=>$7(A,d,e,c)),m=Ze(A=>o7(A,e));if(b.useLayoutEffect(()=>{if(!(r!=="auto"||!h||YO(s)||b.isValidElement(s)||m==null)){var A=i.current;if(A){var j=A.getCalculatedWidth();Math.round(h.width)!==Math.round(j)&&u(aOe({id:e,width:j}))}}},[p,h,u,s,e,r,m]),h==null||f==null||m==null)return null;var{dangerouslySetInnerHTML:g,ticks:y,scale:x}=t,w=rA(t,q2e),{id:N,scale:S}=m,C=rA(m,G2e);return b.createElement(eD,nA({},w,C,{ref:i,labelRef:a,x:f.x,y:f.y,tickTextProps:r==="auto"?{width:void 0}:{width:r},width:h.width,height:h.height,className:gn("recharts-".concat(d," ").concat(d),n),viewBox:l,ticks:p,axisType:d}))}var eRe={allowDataOverflow:Or.allowDataOverflow,allowDecimals:Or.allowDecimals,allowDuplicatedCategory:Or.allowDuplicatedCategory,angle:Or.angle,axisLine:Nl.axisLine,hide:!1,includeHidden:Or.includeHidden,interval:Or.interval,label:!1,minTickGap:Or.minTickGap,mirror:Or.mirror,orientation:Or.orientation,padding:Or.padding,reversed:Or.reversed,scale:Or.scale,tick:Or.tick,tickCount:Or.tickCount,tickLine:Nl.tickLine,tickSize:Nl.tickSize,type:Or.type,width:Or.width,yAxisId:0},tRe=t=>{var e=ei(t,eRe);return b.createElement(b.Fragment,null,b.createElement(J2e,{interval:e.interval,id:e.yAxisId,scale:e.scale,type:e.type,domain:e.domain,allowDataOverflow:e.allowDataOverflow,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,padding:e.padding,includeHidden:e.includeHidden,reversed:e.reversed,ticks:e.ticks,width:e.width,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:e.angle,minTickGap:e.minTickGap,tick:e.tick,tickFormatter:e.tickFormatter}),b.createElement(Z2e,e))},iQ=b.memo(tRe,rQ);iQ.displayName="YAxis";var nRe=(t,e)=>e,nD=ce([nRe,sr,r7,Xr,aY,Jl,ZAe,xs],ake),rD=t=>{var e=t.currentTarget.getBoundingClientRect(),n=e.width/t.currentTarget.offsetWidth,r=e.height/t.currentTarget.offsetHeight;return{chartX:Math.round((t.clientX-e.left)/n),chartY:Math.round((t.clientY-e.top)/r)}},aQ=Aa("mouseClick"),oQ=Rv();oQ.startListening({actionCreator:aQ,effect:(t,e)=>{var n=t.payload,r=nD(e.getState(),rD(n));(r==null?void 0:r.activeIndex)!=null&&e.dispatch(JTe({activeIndex:r.activeIndex,activeDataKey:void 0,activeCoordinate:r.activeCoordinate}))}});var sA=Aa("mouseMove"),lQ=Rv(),m0=null;lQ.startListening({actionCreator:sA,effect:(t,e)=>{var n=t.payload;m0!==null&&cancelAnimationFrame(m0);var r=rD(n);m0=requestAnimationFrame(()=>{var s=e.getState(),i=FO(s,s.tooltip.settings.shared);if(i==="axis"){var a=nD(s,r);(a==null?void 0:a.activeIndex)!=null?e.dispatch(X7({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate})):e.dispatch(Q7())}m0=null})}});function rRe(t,e){return e instanceof HTMLElement?"HTMLElement <".concat(e.tagName,' class="').concat(e.className,'">'):e===window?"global.window":t==="children"&&typeof e=="object"&&e!==null?"<<CHILDREN>>":e}var h$={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},cQ=_i({name:"rootProps",initialState:h$,reducers:{updateOptions:(t,e)=>{var n;t.accessibilityLayer=e.payload.accessibilityLayer,t.barCategoryGap=e.payload.barCategoryGap,t.barGap=(n=e.payload.barGap)!==null&&n!==void 0?n:h$.barGap,t.barSize=e.payload.barSize,t.maxBarSize=e.payload.maxBarSize,t.stackOffset=e.payload.stackOffset,t.syncId=e.payload.syncId,t.syncMethod=e.payload.syncMethod,t.className=e.payload.className,t.baseValue=e.payload.baseValue,t.reverseStackOrder=e.payload.reverseStackOrder}}}),sRe=cQ.reducer,{updateOptions:iRe}=cQ.actions,aRe=null,oRe={updatePolarOptions:(t,e)=>e.payload},uQ=_i({name:"polarOptions",initialState:aRe,reducers:oRe}),{updatePolarOptions:VMe}=uQ.actions,lRe=uQ.reducer,dQ=Aa("keyDown"),hQ=Aa("focus"),sD=Rv();sD.startListening({actionCreator:dQ,effect:(t,e)=>{var n=e.getState(),r=n.rootProps.accessibilityLayer!==!1;if(r){var{keyboardInteraction:s}=n.tooltip,i=t.payload;if(!(i!=="ArrowRight"&&i!=="ArrowLeft"&&i!=="Enter")){var a=BO(s,sm(n),qv(n),Kv(n)),l=a==null?-1:Number(a);if(!(!Number.isFinite(l)||l<0)){var c=Jl(n);if(i==="Enter"){var u=E1(n,"axis","hover",String(s.index));e.dispatch(YT({active:!s.active,activeIndex:s.index,activeCoordinate:u}));return}var d=UTe(n),h=d==="left-to-right"?1:-1,f=i==="ArrowRight"?1:-1,p=l+f*h;if(!(c==null||p>=c.length||p<0)){var m=E1(n,"axis","hover",String(p));e.dispatch(YT({active:!0,activeIndex:p.toString(),activeCoordinate:m}))}}}}}});sD.startListening({actionCreator:hQ,effect:(t,e)=>{var n=e.getState(),r=n.rootProps.accessibilityLayer!==!1;if(r){var{keyboardInteraction:s}=n.tooltip;if(!s.active&&s.index==null){var i="0",a=E1(n,"axis","hover",String(i));e.dispatch(YT({active:!0,activeIndex:i,activeCoordinate:a}))}}}});var ca=Aa("externalEvent"),fQ=Rv(),Zj=new Map;fQ.startListening({actionCreator:ca,effect:(t,e)=>{var{handler:n,reactEvent:r}=t.payload;if(n!=null){r.persist();var s=r.type,i=Zj.get(s);i!==void 0&&cancelAnimationFrame(i);var a=requestAnimationFrame(()=>{try{var l=e.getState(),c={activeCoordinate:FAe(l),activeDataKey:MAe(l),activeIndex:Hy(l),activeLabel:cY(l),activeTooltipIndex:Hy(l),isTooltipActive:BAe(l)};n(c,r)}finally{Zj.delete(s)}});Zj.set(s,a)}}});var cRe=ce([nm],t=>t.tooltipItemPayloads),uRe=ce([cRe,(t,e)=>e,(t,e,n)=>n],(t,e,n)=>{if(e!=null){var r=t.find(i=>i.settings.graphicalItemId===n);if(r!=null){var{getPosition:s}=r;if(s!=null)return s(e)}}}),pQ=Aa("touchMove"),mQ=Rv();mQ.startListening({actionCreator:pQ,effect:(t,e)=>{var n=t.payload;if(!(n.touches==null||n.touches.length===0)){var r=e.getState(),s=FO(r,r.tooltip.settings.shared);if(s==="axis"){var i=n.touches[0];if(i==null)return;var a=nD(r,rD({clientX:i.clientX,clientY:i.clientY,currentTarget:n.currentTarget}));(a==null?void 0:a.activeIndex)!=null&&e.dispatch(X7({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}else if(s==="item"){var l,c=n.touches[0];if(document.elementFromPoint==null||c==null)return;var u=document.elementFromPoint(c.clientX,c.clientY);if(!u||!u.getAttribute)return;var d=u.getAttribute(zNe),h=(l=u.getAttribute(TG))!==null&&l!==void 0?l:void 0,f=rm(r).find(g=>g.id===h);if(d==null||f==null||h==null)return;var{dataKey:p}=f,m=uRe(r,d,h);e.dispatch(Y7({activeDataKey:p,activeIndex:d,activeCoordinate:m,activeGraphicalItemId:h}))}}}});var dRe=Y8({brush:dOe,cartesianAxis:oOe,chartData:Lke,errorBars:wDe,graphicalItems:GPe,layout:TNe,legend:ISe,options:Pke,polarAxis:lPe,polarOptions:lRe,referenceElements:xOe,rootProps:sRe,tooltip:ZTe,zIndex:bke}),hRe=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return Z1e({reducer:dRe,preloadedState:e,middleware:r=>{var s;return r({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes((s="es6")!==null&&s!==void 0?s:"")}).concat([oQ.middleware,lQ.middleware,sD.middleware,fQ.middleware,mQ.middleware])},enhancers:r=>{var s=r;return typeof r=="function"&&(s=r()),s.concat(uG({type:"raf"}))},devTools:{serialize:{replacer:rRe},name:"recharts-".concat(n)}})};function fRe(t){var{preloadedState:e,children:n,reduxStoreName:r}=t,s=ti(),i=b.useRef(null);if(s)return n;i.current==null&&(i.current=hRe(e,r));var a=DP;return b.createElement(QDe,{context:a,store:i.current},n)}function pRe(t){var{layout:e,margin:n}=t,r=Xn(),s=ti();return b.useEffect(()=>{s||(r(jNe(e)),r(_Ne(n)))},[r,s,e,n]),null}var mRe=b.memo(pRe,tD);function gRe(t){var e=Xn();return b.useEffect(()=>{e(iRe(t))},[e,t]),null}function f$(t){var{zIndex:e,isPanorama:n}=t,r=b.useRef(null),s=Xn();return b.useLayoutEffect(()=>(r.current&&s(vke({zIndex:e,element:r.current,isPanorama:n})),()=>{s(xke({zIndex:e,isPanorama:n}))}),[s,e,n]),b.createElement("g",{tabIndex:-1,ref:r})}function p$(t){var{children:e,isPanorama:n}=t,r=Ze(lke);if(!r||r.length===0)return e;var s=r.filter(a=>a<0),i=r.filter(a=>a>0);return b.createElement(b.Fragment,null,s.map(a=>b.createElement(f$,{key:a,zIndex:a,isPanorama:n})),e,i.map(a=>b.createElement(f$,{key:a,zIndex:a,isPanorama:n})))}var yRe=["children"];function vRe(t,e){if(t==null)return{};var n,r,s=xRe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function xRe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function P1(){return P1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},P1.apply(null,arguments)}var bRe={width:"100%",height:"100%",display:"block"},wRe=b.forwardRef((t,e)=>{var n=LG(),r=FG(),s=KG();if(!Lo(n)||!Lo(r))return null;var{children:i,otherAttributes:a,title:l,desc:c}=t,u,d;return a!=null&&(typeof a.tabIndex=="number"?u=a.tabIndex:u=s?0:void 0,typeof a.role=="string"?d=a.role:d=s?"application":void 0),b.createElement(Y9,P1({},a,{title:l,desc:c,role:d,tabIndex:u,width:n,height:r,style:bRe,ref:e}),i)}),NRe=t=>{var{children:e}=t,n=Ze(xS);if(!n)return null;var{width:r,height:s,y:i,x:a}=n;return b.createElement(Y9,{width:r,height:s,x:a,y:i},e)},m$=b.forwardRef((t,e)=>{var{children:n}=t,r=vRe(t,yRe),s=ti();return s?b.createElement(NRe,null,b.createElement(p$,{isPanorama:!0},n)):b.createElement(wRe,P1({ref:e},r),b.createElement(p$,{isPanorama:!1},n))});function SRe(){var t=Xn(),[e,n]=b.useState(null),r=Ze(UNe);return b.useEffect(()=>{if(e!=null){var s=e.getBoundingClientRect(),i=s.width/e.offsetWidth;Ct(i)&&i!==r&&t(CNe(i))}},[e,t,r]),n}function g$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function _Re(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?g$(Object(n),!0).forEach(function(r){jRe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function jRe(t,e,n){return(e=ERe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ERe(t){var e=CRe(t,"string");return typeof e=="symbol"?e:e+""}function CRe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function tu(){return tu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tu.apply(null,arguments)}var TRe=()=>(qke(),null);function O1(t){if(typeof t=="number")return t;if(typeof t=="string"){var e=parseFloat(t);if(!Number.isNaN(e))return e}return 0}var ARe=b.forwardRef((t,e)=>{var n,r,s=b.useRef(null),[i,a]=b.useState({containerWidth:O1((n=t.style)===null||n===void 0?void 0:n.width),containerHeight:O1((r=t.style)===null||r===void 0?void 0:r.height)}),l=b.useCallback((u,d)=>{a(h=>{var f=Math.round(u),p=Math.round(d);return h.containerWidth===f&&h.containerHeight===p?h:{containerWidth:f,containerHeight:p}})},[]),c=b.useCallback(u=>{if(typeof e=="function"&&e(u),u!=null&&typeof ResizeObserver<"u"){var{width:d,height:h}=u.getBoundingClientRect();l(d,h);var f=m=>{var g=m[0];if(g!=null){var{width:y,height:x}=g.contentRect;l(y,x)}},p=new ResizeObserver(f);p.observe(u),s.current=p}},[e,l]);return b.useEffect(()=>()=>{var u=s.current;u!=null&&u.disconnect()},[l]),b.createElement(b.Fragment,null,b.createElement(Fv,{width:i.containerWidth,height:i.containerHeight}),b.createElement("div",tu({ref:c},t)))}),kRe=b.forwardRef((t,e)=>{var{width:n,height:r}=t,[s,i]=b.useState({containerWidth:O1(n),containerHeight:O1(r)}),a=b.useCallback((c,u)=>{i(d=>{var h=Math.round(c),f=Math.round(u);return d.containerWidth===h&&d.containerHeight===f?d:{containerWidth:h,containerHeight:f}})},[]),l=b.useCallback(c=>{if(typeof e=="function"&&e(c),c!=null){var{width:u,height:d}=c.getBoundingClientRect();a(u,d)}},[e,a]);return b.createElement(b.Fragment,null,b.createElement(Fv,{width:s.containerWidth,height:s.containerHeight}),b.createElement("div",tu({ref:l},t)))}),IRe=b.forwardRef((t,e)=>{var{width:n,height:r}=t;return b.createElement(b.Fragment,null,b.createElement(Fv,{width:n,height:r}),b.createElement("div",tu({ref:e},t)))}),PRe=b.forwardRef((t,e)=>{var{width:n,height:r}=t;return typeof n=="string"||typeof r=="string"?b.createElement(kRe,tu({},t,{ref:e})):typeof n=="number"&&typeof r=="number"?b.createElement(IRe,tu({},t,{width:n,height:r,ref:e})):b.createElement(b.Fragment,null,b.createElement(Fv,{width:n,height:r}),b.createElement("div",tu({ref:e},t)))});function ORe(t){return t?ARe:PRe}var DRe=b.forwardRef((t,e)=>{var{children:n,className:r,height:s,onClick:i,onContextMenu:a,onDoubleClick:l,onMouseDown:c,onMouseEnter:u,onMouseLeave:d,onMouseMove:h,onMouseUp:f,onTouchEnd:p,onTouchMove:m,onTouchStart:g,style:y,width:x,responsive:w,dispatchTouchEvents:N=!0}=t,S=b.useRef(null),C=Xn(),[A,j]=b.useState(null),[_,E]=b.useState(null),I=SRe(),T=zP(),P=(T==null?void 0:T.width)>0?T.width:x,O=(T==null?void 0:T.height)>0?T.height:s,H=b.useCallback(J=>{I(J),typeof e=="function"&&e(J),j(J),E(J),J!=null&&(S.current=J)},[I,e,j,E]),X=b.useCallback(J=>{C(aQ(J)),C(ca({handler:i,reactEvent:J}))},[C,i]),se=b.useCallback(J=>{C(sA(J)),C(ca({handler:u,reactEvent:J}))},[C,u]),L=b.useCallback(J=>{C(Q7()),C(ca({handler:d,reactEvent:J}))},[C,d]),B=b.useCallback(J=>{C(sA(J)),C(ca({handler:h,reactEvent:J}))},[C,h]),$=b.useCallback(()=>{C(hQ())},[C]),q=b.useCallback(J=>{C(dQ(J.key))},[C]),Y=b.useCallback(J=>{C(ca({handler:a,reactEvent:J}))},[C,a]),R=b.useCallback(J=>{C(ca({handler:l,reactEvent:J}))},[C,l]),G=b.useCallback(J=>{C(ca({handler:c,reactEvent:J}))},[C,c]),Z=b.useCallback(J=>{C(ca({handler:f,reactEvent:J}))},[C,f]),W=b.useCallback(J=>{C(ca({handler:g,reactEvent:J}))},[C,g]),Q=b.useCallback(J=>{N&&C(pQ(J)),C(ca({handler:m,reactEvent:J}))},[C,N,m]),U=b.useCallback(J=>{C(ca({handler:p,reactEvent:J}))},[C,p]),pe=ORe(w);return b.createElement(gY.Provider,{value:A},b.createElement(Hbe.Provider,{value:_},b.createElement(pe,{width:P??(y==null?void 0:y.width),height:O??(y==null?void 0:y.height),className:gn("recharts-wrapper",r),style:_Re({position:"relative",cursor:"default",width:P,height:O},y),onClick:X,onContextMenu:Y,onDoubleClick:R,onFocus:$,onKeyDown:q,onMouseDown:G,onMouseEnter:se,onMouseLeave:L,onMouseMove:B,onMouseUp:Z,onTouchEnd:U,onTouchMove:Q,onTouchStart:W,ref:H},b.createElement(TRe,null),n)))}),RRe=["width","height","responsive","children","className","style","compact","title","desc"];function MRe(t,e){if(t==null)return{};var n,r,s=LRe(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function LRe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}var FRe=b.forwardRef((t,e)=>{var{width:n,height:r,responsive:s,children:i,className:a,style:l,compact:c,title:u,desc:d}=t,h=MRe(t,RRe),f=Mo(h);return c?b.createElement(b.Fragment,null,b.createElement(Fv,{width:n,height:r}),b.createElement(m$,{otherAttributes:f,title:u,desc:d},i)):b.createElement(DRe,{className:a,style:l,width:n,height:r,responsive:s??!1,onClick:t.onClick,onMouseLeave:t.onMouseLeave,onMouseEnter:t.onMouseEnter,onMouseMove:t.onMouseMove,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onContextMenu:t.onContextMenu,onDoubleClick:t.onDoubleClick,onTouchStart:t.onTouchStart,onTouchMove:t.onTouchMove,onTouchEnd:t.onTouchEnd},b.createElement(m$,{otherAttributes:f,title:u,desc:d,ref:e},b.createElement(bOe,null,i)))});function iA(){return iA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},iA.apply(null,arguments)}var BRe={top:5,right:5,bottom:5,left:5},VRe={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,layout:"horizontal",margin:BRe,responsive:!1,reverseStackOrder:!1,stackOffset:"none",syncMethod:"index"},$Re=b.forwardRef(function(e,n){var r,s=ei(e.categoricalChartProps,VRe),{chartName:i,defaultTooltipEventType:a,validateTooltipEventTypes:l,tooltipPayloadSearcher:c,categoricalChartProps:u}=e,d={chartName:i,defaultTooltipEventType:a,validateTooltipEventTypes:l,tooltipPayloadSearcher:c,eventEmitter:void 0};return b.createElement(fRe,{preloadedState:{options:d},reduxStoreName:(r=u.id)!==null&&r!==void 0?r:i},b.createElement(uOe,{chartData:u.data}),b.createElement(mRe,{layout:s.layout,margin:s.margin}),b.createElement(gRe,{baseValue:s.baseValue,accessibilityLayer:s.accessibilityLayer,barCategoryGap:s.barCategoryGap,maxBarSize:s.maxBarSize,stackOffset:s.stackOffset,barGap:s.barGap,barSize:s.barSize,syncId:s.syncId,syncMethod:s.syncMethod,className:s.className,reverseStackOrder:s.reverseStackOrder}),b.createElement(FRe,iA({},s,{ref:n})))}),URe=["item"],zRe=b.forwardRef((t,e)=>b.createElement($Re,{chartName:"ScatterChart",defaultTooltipEventType:"item",validateTooltipEventTypes:URe,tooltipPayloadSearcher:kke,categoricalChartProps:t,ref:e}));function Cp(t){return!t||t.length===0?0:t.reduce((e,n)=>e+n,0)/t.length}function gQ(t){if(!t||t.length<2)return 0;const e=Cp(t),n=t.map(s=>Math.pow(s-e,2)),r=Cp(n);return Math.sqrt(r)}function Lf(t,e){if(!t||t.length===0)return 0;if(t.length===1)return t[0];const n=[...t].sort((l,c)=>l-c),r=e/100*(n.length-1),s=Math.floor(r),i=Math.ceil(r);if(s===i)return n[s];const a=r-s;return n[s]*(1-a)+n[i]*a}function HRe(t){if(!t||t.length<2)return{slope:0,intercept:0,rSquared:0};const e=t.length;let n=0,r=0,s=0,i=0;t.forEach(({x:p,y:m})=>{n+=p,r+=m,s+=p*m,i+=p*p});const a=e*i-n*n;if(a===0)return{slope:0,intercept:Cp(t.map(p=>p.y)),rSquared:0};const l=(e*s-n*r)/a,c=(r-l*n)/e,u=r/e;let d=0,h=0;t.forEach(({x:p,y:m})=>{const g=l*p+c;d+=Math.pow(m-u,2),h+=Math.pow(m-g,2)});const f=d===0?0:1-h/d;return{slope:l,intercept:c,rSquared:Math.max(0,f)}}function WRe(t,e){if(!t||t.length===0)return[];const n=t.map(i=>i.x),r=Math.min(...n),s=Math.max(...n);return[{x:r,y:e.slope*r+e.intercept},{x:s,y:e.slope*s+e.intercept}]}function qRe(t,e,n){const r=Math.min(1,(t-2)/18),s=e,i=Math.max(0,1-n*2),a=r*.3+s*.4+i*.3;let l;return a>=.7?l="high":a>=.4?l="medium":l="low",{level:l,score:a}}const y$=[{value:"totalHours",label:"Total Hours"},{value:"year",label:"Year"},{value:"saleDate",label:"Sale Date"}],GRe=[{value:"none",label:"No Segmentation"},{value:"region",label:"By Region"},{value:"condition",label:"By Condition"},{value:"source",label:"By Source"}];function KRe({data:t,onPointClick:e,showTrendLine:n=!0,height:r=500}){const[s,i]=b.useState("totalHours"),[a,l]=b.useState("region"),[c,u]=b.useState(!0),d=b.useMemo(()=>t.filter(w=>!(!c&&w.isOutlier||!w.priceUSD||w.priceUSD<=0||s==="totalHours"&&(!w.totalHours||w.totalHours<=0)||s==="year"&&!w.year||s==="saleDate"&&!w.saleDate)).map(w=>{var S;let N;return s==="totalHours"?N=w.totalHours:s==="year"?N=w.year:s==="saleDate"&&(N=((S=w.saleDate)!=null&&S.toDate?w.saleDate.toDate():new Date(w.saleDate)).getTime()),{...w,x:N,y:w.priceUSD,segment:a!=="none"?w[a]:"all"}}),[t,s,a,c]),h=b.useMemo(()=>{const w={};return d.forEach(N=>{const S=N.segment||"other";w[S]||(w[S]=[]),w[S].push(N)}),w},[d]),f=b.useMemo(()=>{if(!n||d.length<3)return null;const w=d.map(S=>({x:S.x,y:S.y})),N=HRe(w);return N.rSquared<.01?null:{...N,points:WRe(w,N)}},[d,n]),p=w=>a==="region"?fd.regions[w]||"#999":a==="condition"?fd.conditions[w]||"#999":a==="source"?fd.sources[w]||"#999":"#0066cc",m=({active:w,payload:N})=>{if(!w||!N||!N.length)return null;const S=N[0].payload;return o.jsxs("div",{className:"chart-tooltip",children:[o.jsxs("div",{className:"tooltip-title",children:[S.year," ",S.manufacturer," ",S.model]}),o.jsxs("div",{className:"tooltip-row",children:[o.jsx("span",{children:"Price:"}),o.jsx("span",{className:"tooltip-value",children:On(S.priceUSD,"USD")})]}),S.totalHours&&o.jsxs("div",{className:"tooltip-row",children:[o.jsx("span",{children:"Hours:"}),o.jsx("span",{className:"tooltip-value",children:S.totalHours.toLocaleString()})]}),o.jsxs("div",{className:"tooltip-row",children:[o.jsx("span",{children:"Region:"}),o.jsx("span",{className:"tooltip-value",children:yp(S.region)})]}),o.jsxs("div",{className:"tooltip-row",children:[o.jsx("span",{children:"Condition:"}),o.jsx("span",{className:"tooltip-value",children:vp(S.condition)})]}),S.isOutlier&&o.jsx("div",{className:"tooltip-warning",children:"Flagged as outlier"}),o.jsx("div",{className:"tooltip-hint",children:"Click to view details"})]})},g=w=>s==="saleDate"?new Date(w).toLocaleDateString("en-GB",{month:"short",year:"2-digit"}):s==="totalHours"?w.toLocaleString():w,y=w=>w>=1e6?`$${(w/1e6).toFixed(1)}M`:w>=1e3?`$${(w/1e3).toFixed(0)}K`:`$${w}`,x=()=>{const w=y$.find(N=>N.value===s);return(w==null?void 0:w.label)||s};return o.jsxs("div",{className:"pricing-scatter-chart",children:[o.jsxs("div",{className:"chart-controls",children:[o.jsxs("div",{className:"control-group",children:[o.jsx("label",{children:"X-Axis"}),o.jsx("select",{value:s,onChange:w=>i(w.target.value),children:y$.map(w=>o.jsx("option",{value:w.value,children:w.label},w.value))})]}),o.jsxs("div",{className:"control-group",children:[o.jsx("label",{children:"Segment By"}),o.jsx("select",{value:a,onChange:w=>l(w.target.value),children:GRe.map(w=>o.jsx("option",{value:w.value,children:w.label},w.value))})]}),o.jsx("div",{className:"control-group checkbox",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:n,onChange:w=>{},disabled:!0}),"Show Trend Line"]})}),o.jsx("div",{className:"control-group checkbox",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:c,onChange:w=>u(w.target.checked)}),"Show Outliers"]})})]}),o.jsxs("div",{className:"chart-stats",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Data Points"}),o.jsx("span",{className:"stat-value",children:d.length})]}),f&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"R"}),o.jsxs("span",{className:"stat-value",children:[(f.rSquared*100).toFixed(1),"%"]})]}),s==="totalHours"&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Price/Hour"}),o.jsxs("span",{className:"stat-value",children:[f.slope<0?"-":"+","$",Math.abs(f.slope).toFixed(0)]})]})]})]}),o.jsx("div",{className:"chart-container",style:{height:r},children:d.length===0?o.jsxs("div",{className:"chart-empty",children:[o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M3 3v18h18"}),o.jsx("circle",{cx:"9",cy:"9",r:"2"}),o.jsx("circle",{cx:"19",cy:"19",r:"2"}),o.jsx("circle",{cx:"14",cy:"6",r:"2"})]}),o.jsx("p",{children:"No data to display"}),o.jsx("p",{className:"hint",children:"Adjust your filters or add more sale records"})]}):o.jsx(fSe,{width:"100%",height:"100%",children:o.jsxs(zRe,{margin:{top:20,right:30,bottom:40,left:60},children:[o.jsx(JY,{strokeDasharray:"3 3",stroke:"#e5e5e5"}),o.jsx(sQ,{dataKey:"x",type:"number",name:x(),tickFormatter:g,domain:["dataMin","dataMax"],stroke:"#666",fontSize:12}),o.jsx(iQ,{dataKey:"y",type:"number",name:"Price (USD)",tickFormatter:y,domain:["auto","auto"],stroke:"#666",fontSize:12}),o.jsx(eIe,{content:o.jsx(m,{})}),Object.entries(h).map(([w,N])=>o.jsx(nQ,{name:w,data:N,fill:p(w),fillOpacity:.7,onClick:S=>e==null?void 0:e(S),cursor:"pointer"},w)),f&&f.points.length===2&&o.jsx(YY,{segment:f.points.map(w=>({x:w.x,y:w.y})),stroke:"#333",strokeDasharray:"5 5",strokeWidth:2})]})})}),a!=="none"&&Object.keys(h).length>0&&o.jsx("div",{className:"chart-legend",children:Object.entries(h).map(([w,N])=>o.jsxs("div",{className:"legend-item",children:[o.jsx("span",{className:"legend-color",style:{backgroundColor:p(w)}}),o.jsxs("span",{className:"legend-label",children:[a==="region"&&yp(w),a==="condition"&&vp(w),a==="source"&&w,a==="none"&&"All"]}),o.jsxs("span",{className:"legend-count",children:["(",N.length,")"]})]},w))})]})}const YRe={manufacturer:"",model:"",yearRange:{min:"",max:""},priceRange:{min:"",max:""},regions:[],conditions:[],sources:[],hoursRange:{min:"",max:""}};function QRe(){var f;const{can:t,PERMISSIONS:e}=Js(),{data:n,loading:r}=pn("pricing_sales",[qr("saleDate","desc")]),[s,i]=b.useState(YRe),[a,l]=b.useState(null),c=b.useMemo(()=>n.filter(p=>p.reviewStatus==="approved"),[n]),u=b.useMemo(()=>{var m,g,y,x,w,N,S,C,A;let p=[...c];return s.manufacturer&&(p=p.filter(j=>j.manufacturer===s.manufacturer)),s.model&&(p=p.filter(j=>j.model===s.model)),(m=s.yearRange)!=null&&m.min&&(p=p.filter(j=>j.year>=parseInt(s.yearRange.min))),(g=s.yearRange)!=null&&g.max&&(p=p.filter(j=>j.year<=parseInt(s.yearRange.max))),(y=s.priceRange)!=null&&y.min&&(p=p.filter(j=>j.priceUSD>=parseInt(s.priceRange.min))),(x=s.priceRange)!=null&&x.max&&(p=p.filter(j=>j.priceUSD<=parseInt(s.priceRange.max))),(w=s.hoursRange)!=null&&w.min&&(p=p.filter(j=>j.totalHours>=parseInt(s.hoursRange.min))),(N=s.hoursRange)!=null&&N.max&&(p=p.filter(j=>j.totalHours<=parseInt(s.hoursRange.max))),((S=s.regions)==null?void 0:S.length)>0&&(p=p.filter(j=>s.regions.includes(j.region))),((C=s.conditions)==null?void 0:C.length)>0&&(p=p.filter(j=>s.conditions.includes(j.condition))),((A=s.sources)==null?void 0:A.length)>0&&(p=p.filter(j=>s.sources.includes(j.source))),p},[c,s]),d=b.useMemo(()=>{if(u.length===0)return{count:0,avgPrice:0,medianPrice:0,minPrice:0,maxPrice:0,stdDev:0,avgHours:0};const p=u.map(g=>g.priceUSD),m=u.map(g=>g.totalHours).filter(Boolean);return{count:u.length,avgPrice:Math.round(Cp(p)),medianPrice:Math.round(Lf(p,50)),minPrice:Math.min(...p),maxPrice:Math.max(...p),stdDev:Math.round(gQ(p)),avgHours:Math.round(Cp(m))}},[u]),h=p=>{l(p)};return r?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"pricing-dashboard",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Pricing Intelligence"}),o.jsx("p",{className:"page-subtitle",children:"Analyze historical sales data and market trends"})]}),o.jsxs("div",{className:"page-header-actions",children:[t(e.PRICING_ESTIMATE)&&o.jsx(at,{to:"/pricing/estimate",children:o.jsxs(K,{variant:"secondary",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Price Estimator"]})}),o.jsx(at,{to:"/pricing/data",children:o.jsxs(K,{children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),o.jsx("polyline",{points:"14 2 14 8 20 8"}),o.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),o.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Manage Data"]})})]})]}),o.jsxs("div",{className:"pricing-stats-overview",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 3v18h18"}),o.jsx("circle",{cx:"9",cy:"9",r:"2"}),o.jsx("circle",{cx:"19",cy:"19",r:"2"}),o.jsx("circle",{cx:"14",cy:"6",r:"2"})]})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:d.count}),o.jsx("div",{className:"stat-label",children:"Data Points"})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:On(d.avgPrice,"USD")}),o.jsx("div",{className:"stat-label",children:"Average Price"})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M18 20V10"}),o.jsx("path",{d:"M12 20V4"}),o.jsx("path",{d:"M6 20v-6"})]})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:On(d.medianPrice,"USD")}),o.jsx("div",{className:"stat-label",children:"Median Price"})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-icon",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),o.jsxs("div",{className:"stat-content",children:[o.jsx("div",{className:"stat-value",children:d.avgHours.toLocaleString()}),o.jsx("div",{className:"stat-label",children:"Avg. Hours"})]})]})]}),o.jsxs("div",{className:"pricing-dashboard-content",children:[o.jsx(Dbe,{filters:s,onFilterChange:i,salesData:c}),o.jsxs("div",{className:"pricing-chart-section",children:[o.jsxs("div",{className:"chart-header",children:[o.jsx("h2",{children:"Price Distribution"}),s.manufacturer&&o.jsxs("span",{className:"chart-subtitle",children:[s.manufacturer," ",s.model||"All Models"]})]}),o.jsx(KRe,{data:u,onPointClick:h,height:450})]}),u.length>0&&o.jsx("div",{className:"price-range-summary",children:o.jsxs("div",{className:"range-bar",children:[o.jsxs("div",{className:"range-min",children:[o.jsx("span",{className:"range-label",children:"Min"}),o.jsx("span",{className:"range-value",children:On(d.minPrice,"USD")})]}),o.jsxs("div",{className:"range-middle",children:[o.jsxs("div",{className:"range-track",children:[o.jsx("div",{className:"range-fill",style:{left:"25%",width:"50%"}}),o.jsx("div",{className:"range-marker median",style:{left:`${(d.medianPrice-d.minPrice)/(d.maxPrice-d.minPrice)*100}%`},title:`Median: ${On(d.medianPrice,"USD")}`})]}),o.jsxs("div",{className:"range-labels",children:[o.jsxs("span",{children:["25th: ",On(Lf(u.map(p=>p.priceUSD),25),"USD")]}),o.jsxs("span",{children:["75th: ",On(Lf(u.map(p=>p.priceUSD),75),"USD")]})]})]}),o.jsxs("div",{className:"range-max",children:[o.jsx("span",{className:"range-label",children:"Max"}),o.jsx("span",{className:"range-value",children:On(d.maxPrice,"USD")})]})]})})]}),o.jsx(ut,{isOpen:!!a,onClose:()=>l(null),title:"Sale Record Details",size:"medium",footer:o.jsx(K,{variant:"secondary",onClick:()=>l(null),children:"Close"}),children:a&&o.jsx("div",{className:"sale-record-detail",children:o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Aircraft"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Aircraft"}),o.jsxs("span",{className:"detail-value",children:[a.year," ",a.manufacturer," ",a.model]})]}),a.registration&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Registration"}),o.jsx("span",{className:"detail-value",children:a.registration})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Condition"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total Hours"}),o.jsx("span",{className:"detail-value",children:(f=a.totalHours)==null?void 0:f.toLocaleString()})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Condition"}),o.jsx("span",{className:"detail-value",children:vp(a.condition)})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Pricing"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Sale Price"}),o.jsx("span",{className:"detail-value highlight",children:On(a.priceUSD,"USD")})]}),a.askingPrice&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Asking Price"}),o.jsx("span",{className:"detail-value",children:On(a.askingPrice,a.currency)})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Sale Context"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Sale Date"}),o.jsx("span",{className:"detail-value",children:ky(a.saleDate)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Region"}),o.jsx("span",{className:"detail-value",children:yp(a.region)})]})]})]})})})]})}const XRe=[25,50,100];function JRe({data:t,onRowClick:e,onEdit:n,onDelete:r,canEdit:s=!1,canDelete:i=!1,showReviewStatus:a=!1}){const[l,c]=b.useState(1),[u,d]=b.useState(25),[h,f]=b.useState("saleDate"),[p,m]=b.useState("desc"),[g,y]=b.useState(""),x=b.useMemo(()=>{let _=[...t];if(g){const E=g.toLowerCase();_=_.filter(I=>{var T,P,O,H;return((T=I.manufacturer)==null?void 0:T.toLowerCase().includes(E))||((P=I.model)==null?void 0:P.toLowerCase().includes(E))||((O=I.registration)==null?void 0:O.toLowerCase().includes(E))||((H=I.serialNumber)==null?void 0:H.toLowerCase().includes(E))})}return _.sort((E,I)=>{let T=E[h],P=I[h];return h==="saleDate"&&(T=T!=null&&T.toMillis?T.toMillis():new Date(T).getTime(),P=P!=null&&P.toMillis?P.toMillis():new Date(P).getTime()),typeof T=="string"&&(T=T.toLowerCase(),P=(P==null?void 0:P.toLowerCase())||""),T<P?p==="asc"?-1:1:T>P?p==="asc"?1:-1:0}),_},[t,g,h,p]),w=Math.ceil(x.length/u),N=(l-1)*u,S=x.slice(N,N+u),C=_=>{h===_?m(E=>E==="asc"?"desc":"asc"):(f(_),m("desc"))},A=_=>{c(Math.max(1,Math.min(_,w)))},j=({field:_})=>h!==_?o.jsx("span",{className:"sort-icon",children:""}):o.jsx("span",{className:"sort-icon active",children:p==="asc"?"":""});return o.jsxs("div",{className:"sale-record-table-container",children:[o.jsxs("div",{className:"table-toolbar",children:[o.jsxs("div",{className:"table-search",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),o.jsx("input",{type:"text",placeholder:"Search by manufacturer, model, registration...",value:g,onChange:_=>{y(_.target.value),c(1)}}),g&&o.jsx("button",{className:"search-clear",onClick:()=>y(""),children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsxs("div",{className:"table-info",children:[x.length," records",g&&` (filtered from ${t.length})`]})]}),o.jsx("div",{className:"table-wrapper",children:o.jsxs("table",{className:"data-table pricing-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsxs("th",{onClick:()=>C("saleDate"),className:"sortable",children:["Sale Date ",o.jsx(j,{field:"saleDate"})]}),o.jsxs("th",{onClick:()=>C("manufacturer"),className:"sortable",children:["Aircraft ",o.jsx(j,{field:"manufacturer"})]}),o.jsxs("th",{onClick:()=>C("year"),className:"sortable",children:["Year ",o.jsx(j,{field:"year"})]}),o.jsxs("th",{onClick:()=>C("totalHours"),className:"sortable",children:["Hours ",o.jsx(j,{field:"totalHours"})]}),o.jsxs("th",{onClick:()=>C("condition"),className:"sortable",children:["Condition ",o.jsx(j,{field:"condition"})]}),o.jsxs("th",{onClick:()=>C("priceUSD"),className:"sortable",children:["Price (USD) ",o.jsx(j,{field:"priceUSD"})]}),o.jsxs("th",{onClick:()=>C("region"),className:"sortable",children:["Region ",o.jsx(j,{field:"region"})]}),o.jsxs("th",{onClick:()=>C("source"),className:"sortable",children:["Source ",o.jsx(j,{field:"source"})]}),a&&o.jsxs("th",{onClick:()=>C("reviewStatus"),className:"sortable",children:["Status ",o.jsx(j,{field:"reviewStatus"})]}),(s||i)&&o.jsx("th",{className:"actions-column",children:"Actions"})]})}),o.jsx("tbody",{children:S.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:a?10:9,className:"empty-row",children:g?"No records match your search":"No sale records yet"})}):S.map(_=>{var E;return o.jsxs("tr",{onClick:()=>e==null?void 0:e(_),className:`
                    ${e?"clickable":""}
                    ${_.isOutlier?"outlier-row":""}
                    ${_.reviewStatus==="rejected"?"rejected-row":""}
                  `,children:[o.jsx("td",{children:ky(_.saleDate)}),o.jsx("td",{children:o.jsxs("div",{className:"aircraft-cell",children:[o.jsxs("span",{className:"aircraft-name",children:[_.manufacturer," ",_.model]}),_.registration&&o.jsx("span",{className:"aircraft-reg",children:_.registration})]})}),o.jsx("td",{children:_.year}),o.jsx("td",{children:((E=_.totalHours)==null?void 0:E.toLocaleString())||"-"}),o.jsx("td",{children:o.jsx("span",{className:"condition-badge",style:{backgroundColor:fd.conditions[_.condition]+"20",color:fd.conditions[_.condition]},children:vp(_.condition)})}),o.jsx("td",{className:"price-cell",children:On(_.priceUSD,"USD")}),o.jsx("td",{children:o.jsx("span",{className:"region-badge",style:{backgroundColor:fd.regions[_.region]+"20",color:fd.regions[_.region]},children:yp(_.region)})}),o.jsx("td",{children:o.jsx("span",{className:"source-badge",children:Tbe(_.source)})}),a&&o.jsx("td",{children:o.jsx("span",{className:`status-badge status-${_.reviewStatus}`,children:kbe(_.reviewStatus)})}),(s||i)&&o.jsxs("td",{className:"actions-cell",onClick:I=>I.stopPropagation(),children:[s&&o.jsx("button",{className:"action-btn edit-btn",onClick:()=>n==null?void 0:n(_),title:"Edit",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),i&&o.jsx("button",{className:"action-btn delete-btn",onClick:()=>r==null?void 0:r(_),title:"Delete",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},_.id)})})]})}),w>1&&o.jsxs("div",{className:"table-pagination",children:[o.jsxs("div",{className:"pagination-info",children:["Showing ",N+1,"",Math.min(N+u,x.length)," of ",x.length]}),o.jsxs("div",{className:"pagination-controls",children:[o.jsxs("div",{className:"pagination-per-page",children:[o.jsx("span",{children:"Show:"}),o.jsx("select",{value:u,onChange:_=>{d(Number(_.target.value)),c(1)},className:"form-select",children:XRe.map(_=>o.jsx("option",{value:_,children:_},_))})]}),o.jsxs("div",{className:"pagination-buttons",children:[o.jsx("button",{className:"pagination-btn",onClick:()=>A(1),disabled:l===1,children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"11 17 6 12 11 7"}),o.jsx("polyline",{points:"18 17 13 12 18 7"})]})}),o.jsx("button",{className:"pagination-btn",onClick:()=>A(l-1),disabled:l===1,children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsxs("span",{className:"pagination-page",children:["Page ",l," of ",w]}),o.jsx("button",{className:"pagination-btn",onClick:()=>A(l+1),disabled:l===w,children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("polyline",{points:"9 18 15 12 9 6"})})}),o.jsx("button",{className:"pagination-btn",onClick:()=>A(w),disabled:l===w,children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("polyline",{points:"13 17 18 12 13 7"}),o.jsx("polyline",{points:"6 17 11 12 6 7"})]})})]})]})]})]})}const v$={manufacturer:"",model:"",year:"",serialNumber:"",registration:"",totalHours:"",engineHours:"",condition:"good",askingPrice:"",salePrice:"",currency:"GBP",saleDate:new Date().toISOString().split("T")[0],daysOnMarket:"",region:"UK",country:"",source:"manual_entry",sourceDetails:"",equipment:[],avionics:[],notes:""};function ZRe({isOpen:t,onClose:e,onSuccess:n}){var S,C;const{success:r,error:s}=qt(),{createSaleRecord:i,loading:a}=IN(),{manufacturers:l,getModelsForManufacturer:c,loading:u}=Pu(),[d,h]=b.useState(v$),[f,p]=b.useState([]),[m,g]=b.useState({});b.useEffect(()=>{t&&(h(v$),g({}))},[t]),b.useEffect(()=>{if(d.manufacturer){const A=c(d.manufacturer);p(A)}else p([])},[d.manufacturer,c]);const y=A=>{const{name:j,value:_}=A.target;h(j==="manufacturer"?E=>({...E,manufacturer:_,model:""}):E=>({...E,[j]:_})),m[j]&&g(E=>({...E,[j]:null}))},x=()=>{const A={};return["manufacturer","model","year","totalHours","condition","salePrice","currency","saleDate","region","source"].forEach(_=>{let E=d[_];["year","totalHours","engineHours","salePrice","askingPrice","daysOnMarket"].includes(_)&&(E=E?parseInt(E):null);const I=lW(_,E);I&&(A[_]=I)}),g(A),Object.keys(A).length===0},w=async A=>{if(A.preventDefault(),!x()){s("Please fix the errors before submitting");return}try{(await i({...d,year:parseInt(d.year),totalHours:parseInt(d.totalHours),engineHours:d.engineHours?parseInt(d.engineHours):null,salePrice:parseInt(d.salePrice),askingPrice:d.askingPrice?parseInt(d.askingPrice):null,daysOnMarket:d.daysOnMarket?parseInt(d.daysOnMarket):null,saleDate:new Date(d.saleDate)})).isOutlier?r("Sale record added (flagged for review due to unusual price)"):r("Sale record added successfully"),n==null||n(),e()}catch(j){s(j.message||"Failed to add sale record")}},N=o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:e,disabled:a,children:"Cancel"}),o.jsx(K,{onClick:w,loading:a,children:"Add Sale Record"})]});return o.jsx(ut,{isOpen:t,onClose:e,title:"Add Sale Record",size:"large",footer:N,children:o.jsxs("form",{onSubmit:w,className:"pricing-sale-form",children:[o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Aircraft Details"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Manufacturer *"}),o.jsxs("select",{name:"manufacturer",value:d.manufacturer,onChange:y,className:`form-select ${m.manufacturer?"form-input-error":""}`,disabled:u,children:[o.jsx("option",{value:"",children:"Select manufacturer"}),l.map(A=>o.jsx("option",{value:A,children:A},A))]}),m.manufacturer&&o.jsx("span",{className:"form-error",children:m.manufacturer})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Model *"}),o.jsxs("select",{name:"model",value:d.model,onChange:y,className:`form-select ${m.model?"form-input-error":""}`,disabled:!d.manufacturer,children:[o.jsx("option",{value:"",children:"Select model"}),f.map(A=>o.jsx("option",{value:A,children:A},A))]}),m.model&&o.jsx("span",{className:"form-error",children:m.model})]}),o.jsx(ye,{label:"Year *",name:"year",type:"number",value:d.year,onChange:y,error:m.year,min:"1950",max:new Date().getFullYear()+1}),o.jsx(ye,{label:"Registration",name:"registration",value:d.registration,onChange:y,placeholder:"e.g., G-ABCD"}),o.jsx(ye,{label:"Serial Number",name:"serialNumber",value:d.serialNumber,onChange:y})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Condition & Hours"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Total Hours *",name:"totalHours",type:"number",value:d.totalHours,onChange:y,error:m.totalHours,min:"0"}),o.jsx(ye,{label:"Engine Hours",name:"engineHours",type:"number",value:d.engineHours,onChange:y,min:"0"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Condition *"}),o.jsx("select",{name:"condition",value:d.condition,onChange:y,className:`form-select ${m.condition?"form-input-error":""}`,children:gp.map(A=>o.jsx("option",{value:A.value,children:A.label},A.value))}),m.condition&&o.jsx("span",{className:"form-error",children:m.condition})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Pricing"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Currency *"}),o.jsx("select",{name:"currency",value:d.currency,onChange:y,className:"form-select",children:vP.map(A=>o.jsx("option",{value:A.value,children:A.label},A.value))})]}),o.jsx(ye,{label:"Asking Price",name:"askingPrice",type:"number",value:d.askingPrice,onChange:y,placeholder:"Original asking price",min:"0",step:"1"}),o.jsx(ye,{label:"Sale Price *",name:"salePrice",type:"number",value:d.salePrice,onChange:y,error:m.salePrice,placeholder:"Actual sale price",min:"0",step:"1"}),d.salePrice&&d.askingPrice&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Discount"}),o.jsxs("div",{className:"price-discount",children:[Math.round((1-d.salePrice/d.askingPrice)*100),"%"]})]})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Sale Context"}),o.jsxs("div",{className:"form-grid",children:[o.jsx(ye,{label:"Sale Date *",name:"saleDate",type:"date",value:d.saleDate,onChange:y,error:m.saleDate,max:new Date().toISOString().split("T")[0]}),o.jsx(ye,{label:"Days on Market",name:"daysOnMarket",type:"number",value:d.daysOnMarket,onChange:y,min:"0"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Region *"}),o.jsx("select",{name:"region",value:d.region,onChange:y,className:`form-select ${m.region?"form-input-error":""}`,children:ih.map(A=>o.jsx("option",{value:A.value,children:A.label},A.value))}),m.region&&o.jsx("span",{className:"form-error",children:m.region})]}),o.jsx(ye,{label:"Country",name:"country",value:d.country,onChange:y,placeholder:"e.g., United Kingdom"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Data Source"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Source *"}),o.jsx("select",{name:"source",value:d.source,onChange:y,className:`form-select ${m.source?"form-input-error":""}`,children:Iv.map(A=>o.jsx("option",{value:A.value,children:A.label},A.value))}),m.source&&o.jsx("span",{className:"form-error",children:m.source})]}),o.jsx(ye,{label:"Source Details",name:"sourceDetails",value:d.sourceDetails,onChange:y,placeholder:"e.g., Controller.com, Trade show"})]})]}),o.jsxs("div",{className:"form-section",children:[o.jsx("h4",{children:"Notes"}),o.jsx("div",{className:"form-group",children:o.jsx("textarea",{name:"notes",value:d.notes,onChange:y,className:"form-textarea",rows:3,placeholder:"Any additional notes about this sale..."})})]}),d.manufacturer&&d.model&&d.salePrice&&o.jsxs("div",{className:"form-section sale-preview",children:[o.jsx("h4",{children:"Preview"}),o.jsxs("div",{className:"sale-preview-content",children:[o.jsxs("strong",{children:[d.year," ",d.manufacturer," ",d.model]}),o.jsx("span",{className:"sale-preview-price",children:On(parseInt(d.salePrice),d.currency)}),o.jsxs("span",{className:"sale-preview-details",children:[d.totalHours," hours  ",(S=gp.find(A=>A.value===d.condition))==null?void 0:S.label,"  ",(C=ih.find(A=>A.value===d.region))==null?void 0:C.label]})]})]})]})})}const aA={manufacturer:["manufacturer","make","brand","oem"],model:["model","aircraft_model","type"],year:["year","manufacture_year","built","yom"],serialNumber:["serial","serial_number","sn","s/n"],registration:["registration","reg","n_number","tail"],totalHours:["hours","total_hours","tt","ttsn","airframe_hours"],engineHours:["engine_hours","engine_tt","smoh"],condition:["condition","aircraft_condition"],askingPrice:["asking_price","list_price","asking"],salePrice:["sale_price","sold_price","price","amount"],currency:["currency","curr","ccy"],saleDate:["sale_date","sold_date","date","transaction_date"],region:["region","area","market"],country:["country","location"],source:["source","data_source"],sourceDetails:["source_details","notes"],notes:["notes","comments","remarks"]},x$=["manufacturer","model","year","salePrice","saleDate"];function eMe(t){const e=t.split(/\r\n|\r|\n/).filter(s=>s.trim());if(e.length<2)return{headers:[],rows:[]};const n=b$(e[0]),r=[];for(let s=1;s<e.length;s++){const i=b$(e[s]);if(i.length===n.length){const a={};n.forEach((l,c)=>{a[l]=i[c]}),r.push(a)}}return{headers:n,rows:r}}function b$(t){const e=[];let n="",r=!1;for(let s=0;s<t.length;s++){const i=t[s];i==='"'?r&&t[s+1]==='"'?(n+='"',s++):r=!r:i===","&&!r?(e.push(n.trim()),n=""):n+=i}return e.push(n.trim()),e}function tMe(t){const e={};return t.forEach(n=>{const r=n.toLowerCase().replace(/[^a-z0-9]/g,"_");for(const[s,i]of Object.entries(aA))i.some(a=>r.includes(a)||a.includes(r))&&(e[s]||(e[s]=n))}),e}function nMe(t,e){if(!e||e==="")return null;switch(t){case"year":case"totalHours":case"engineHours":case"askingPrice":case"salePrice":case"daysOnMarket":return parseInt(e.toString().replace(/[^0-9.-]/g,""))||null;case"saleDate":const n=new Date(e);return isNaN(n.getTime())?null:n;case"currency":const r=e.toUpperCase();return vP.find(l=>l.value===r)?r:"GBP";case"region":const s=e.toUpperCase();return ih.find(l=>l.value===s)?s:"Other";case"condition":const i=e.toLowerCase();return gp.find(l=>l.value===i)?i:"good";case"source":const a=e.toLowerCase().replace(/\s/g,"_");return Iv.find(l=>l.value===a)?a:"manual_entry";case"registration":return e.toUpperCase();default:return e.toString().trim()}}function rMe({isOpen:t,onClose:e,onSuccess:n}){const{success:r,error:s}=qt(),{bulkImport:i,loading:a}=IN(),l=b.useRef(null),[c,u]=b.useState(1),[d,h]=b.useState(null),[f,p]=b.useState({headers:[],rows:[]}),[m,g]=b.useState({}),[y,x]=b.useState([]),[w,N]=b.useState([]),[S,C]=b.useState({current:0,total:0,success:0,failed:0}),[A,j]=b.useState(null),[_,E]=b.useState(!1),I=()=>{u(1),h(null),p({headers:[],rows:[]}),g({}),x([]),N([]),C({current:0,total:0,success:0,failed:0}),j(null),e()},T=b.useCallback(G=>{if(!G||!G.name.endsWith(".csv")){s("Please select a CSV file");return}h(G);const Z=new FileReader;Z.onload=W=>{const Q=W.target.result,U=eMe(Q);if(U.rows.length===0){s("CSV file is empty or invalid");return}p(U),g(tMe(U.headers)),u(2)},Z.onerror=()=>{s("Failed to read file")},Z.readAsText(G)},[s]),P=G=>{G.preventDefault(),E(!0)},O=G=>{G.preventDefault(),E(!1)},H=G=>{G.preventDefault(),E(!1);const Z=G.dataTransfer.files[0];T(Z)},X=(G,Z)=>{g(W=>({...W,[G]:Z||null}))},se=()=>{const G=x$.filter(Q=>!m[Q]);if(G.length>0){s(`Please map required fields: ${G.join(", ")}`);return}const Z=f.rows.map((Q,U)=>{const pe={_rowIndex:U+2};for(const[J,ge]of Object.entries(m))ge&&(pe[J]=nMe(J,Q[ge]));return pe}),W=[];Z.forEach((Q,U)=>{const{isValid:pe,errors:J}=cW(Q);pe||W.push({row:Q._rowIndex,errors:J})}),x(Z),N(W),u(3)},L=async()=>{const G=y.filter((W,Q)=>!w.some(U=>U.row===W._rowIndex));if(G.length===0){s("No valid records to import");return}u(4),C({current:0,total:G.length,success:0,failed:0});const Z=await i(G.map(W=>{const{_rowIndex:Q,...U}=W;return U}));j(Z),C({current:G.length,total:G.length,success:Z.success.length,failed:Z.failed.length}),Z.success.length>0&&(r(`Successfully imported ${Z.success.length} records`),n==null||n()),Z.failed.length>0&&s(`${Z.failed.length} records failed to import`)},B=()=>{const Z=`Row,Errors
`+w.map(pe=>({row:pe.row,errors:Object.entries(pe.errors).map(([J,ge])=>`${J}: ${ge}`).join("; ")})).map(pe=>`${pe.row},"${pe.errors}"`).join(`
`),W=new Blob([Z],{type:"text/csv"}),Q=URL.createObjectURL(W),U=document.createElement("a");U.href=Q,U.download="import_errors.csv",U.click(),URL.revokeObjectURL(Q)},$=()=>{const W=Object.keys(aA).join(",")+`
`+"Robinson,R44 Raven II,2018,12345,G-HELI,1500,1500,good,350000,320000,GBP,2024-01-15,UK,United Kingdom,market_data,Controller.com,Good condition",Q=new Blob([W],{type:"text/csv"}),U=URL.createObjectURL(Q),pe=document.createElement("a");pe.href=U,pe.download="pricing_import_template.csv",pe.click(),URL.revokeObjectURL(U)},q=()=>{switch(c){case 1:return o.jsxs("div",{className:"csv-upload-step",children:[o.jsxs("div",{className:`csv-dropzone ${_?"dragging":""}`,onDragOver:P,onDragLeave:O,onDrop:H,onClick:()=>{var Z;return(Z=l.current)==null?void 0:Z.click()},children:[o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("p",{className:"dropzone-text",children:"Drag and drop a CSV file here, or click to browse"}),o.jsx("p",{className:"dropzone-hint",children:"Maximum 1000 records per import"}),o.jsx("input",{ref:l,type:"file",accept:".csv",onChange:Z=>T(Z.target.files[0]),style:{display:"none"}})]}),o.jsx("div",{className:"csv-template-link",children:o.jsx("button",{onClick:$,className:"link-button",children:"Download CSV template"})})]});case 2:return o.jsxs("div",{className:"csv-mapping-step",children:[o.jsxs("div",{className:"mapping-info",children:[o.jsxs("p",{children:[o.jsx("strong",{children:f.rows.length})," rows found in ",o.jsx("strong",{children:d==null?void 0:d.name})]}),o.jsx("p",{className:"mapping-hint",children:"Map your CSV columns to the fields below. Fields marked with * are required."})]}),o.jsx("div",{className:"mapping-grid",children:Object.entries(aA).map(([Z,W])=>{const Q=x$.includes(Z);return o.jsxs("div",{className:"mapping-row",children:[o.jsxs("label",{className:Q?"required":"",children:[Z.replace(/([A-Z])/g," $1").trim(),Q&&" *"]}),o.jsxs("select",{value:m[Z]||"",onChange:U=>X(Z,U.target.value),className:Q&&!m[Z]?"missing-required":"",children:[o.jsx("option",{value:"",children:"-- Select column --"}),f.headers.map(U=>o.jsx("option",{value:U,children:U},U))]})]},Z)})})]});case 3:const G=y.length-w.length;return o.jsxs("div",{className:"csv-preview-step",children:[o.jsxs("div",{className:"preview-summary",children:[o.jsxs("div",{className:"summary-stat",children:[o.jsx("span",{className:"stat-number",children:y.length}),o.jsx("span",{className:"stat-label",children:"Total Rows"})]}),o.jsxs("div",{className:"summary-stat valid",children:[o.jsx("span",{className:"stat-number",children:G}),o.jsx("span",{className:"stat-label",children:"Valid"})]}),o.jsxs("div",{className:"summary-stat errors",children:[o.jsx("span",{className:"stat-number",children:w.length}),o.jsx("span",{className:"stat-label",children:"Errors"})]})]}),w.length>0&&o.jsxs("div",{className:"validation-errors",children:[o.jsxs("div",{className:"errors-header",children:[o.jsx("span",{children:"Validation Errors"}),o.jsx("button",{onClick:B,className:"link-button",children:"Download error report"})]}),o.jsxs("div",{className:"errors-list",children:[w.slice(0,10).map((Z,W)=>o.jsxs("div",{className:"error-item",children:[o.jsxs("span",{className:"error-row",children:["Row ",Z.row]}),o.jsx("span",{className:"error-messages",children:Object.entries(Z.errors).map(([Q,U])=>o.jsxs("span",{className:"error-message",children:[Q,": ",U]},Q))})]},W)),w.length>10&&o.jsxs("div",{className:"error-more",children:["+ ",w.length-10," more errors"]})]})]}),o.jsxs("div",{className:"preview-table-container",children:[o.jsxs("table",{className:"preview-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Row"}),o.jsx("th",{children:"Manufacturer"}),o.jsx("th",{children:"Model"}),o.jsx("th",{children:"Year"}),o.jsx("th",{children:"Sale Price"}),o.jsx("th",{children:"Date"}),o.jsx("th",{children:"Status"})]})}),o.jsx("tbody",{children:y.slice(0,20).map((Z,W)=>{var U,pe;const Q=w.some(J=>J.row===Z._rowIndex);return o.jsxs("tr",{className:Q?"has-error":"",children:[o.jsx("td",{children:Z._rowIndex}),o.jsx("td",{children:Z.manufacturer||"-"}),o.jsx("td",{children:Z.model||"-"}),o.jsx("td",{children:Z.year||"-"}),o.jsx("td",{children:((U=Z.salePrice)==null?void 0:U.toLocaleString())||"-"}),o.jsx("td",{children:((pe=Z.saleDate)==null?void 0:pe.toLocaleDateString())||"-"}),o.jsx("td",{children:o.jsx("span",{className:`preview-status ${Q?"error":"valid"}`,children:Q?"Error":"Valid"})})]},W)})})]}),y.length>20&&o.jsxs("div",{className:"preview-more",children:["Showing first 20 of ",y.length," rows"]})]})]});case 4:return o.jsxs("div",{className:"csv-import-step",children:[o.jsxs("div",{className:"import-progress",children:[o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-fill",style:{width:`${S.current/S.total*100}%`}})}),o.jsx("div",{className:"progress-text",children:A?o.jsxs(o.Fragment,{children:["Import complete: ",S.success," successful, ",S.failed," failed"]}):o.jsxs(o.Fragment,{children:["Importing ",S.current," of ",S.total,"..."]})})]}),A&&A.failed.length>0&&o.jsxs("div",{className:"import-failures",children:[o.jsx("h4",{children:"Failed Records"}),o.jsxs("div",{className:"failures-list",children:[A.failed.slice(0,5).map((Z,W)=>o.jsxs("div",{className:"failure-item",children:[o.jsxs("span",{children:[Z.record.manufacturer," ",Z.record.model]}),o.jsx("span",{className:"failure-error",children:Z.error})]},W)),A.failed.length>5&&o.jsxs("div",{className:"failure-more",children:["+ ",A.failed.length-5," more failures"]})]})]})]});default:return null}},Y=()=>{switch(c){case 1:return o.jsx(K,{variant:"secondary",onClick:I,children:"Cancel"});case 2:return o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>u(1),children:"Back"}),o.jsx(K,{onClick:se,children:"Preview Import"})]});case 3:const G=y.length-w.length;return o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>u(2),children:"Back"}),o.jsxs(K,{onClick:L,disabled:G===0,loading:a,children:["Import ",G," Records"]})]});case 4:return o.jsx(K,{onClick:I,children:A?"Close":"Cancel"});default:return null}},R={1:"Upload CSV File",2:"Map Columns",3:"Preview & Validate",4:"Importing..."};return o.jsx(ut,{isOpen:t,onClose:I,title:R[c],size:"large",footer:Y(),children:o.jsxs("div",{className:"csv-import-modal",children:[o.jsx("div",{className:"csv-steps",children:[1,2,3,4].map(G=>o.jsxs("div",{className:`csv-step ${c===G?"active":""} ${c>G?"completed":""}`,children:[o.jsx("div",{className:"step-number",children:c>G?"":G}),o.jsxs("div",{className:"step-label",children:[G===1&&"Upload",G===2&&"Map",G===3&&"Preview",G===4&&"Import"]})]},G))}),q()]})})}function sMe(){var L,B,$;const{can:t,PERMISSIONS:e}=Js(),{success:n,error:r}=qt(),{deleteSaleRecord:s,approveRecord:i,rejectRecord:a,syncExistingSales:l,loading:c}=IN(),[u,d]=b.useState(!1),{data:h,loading:f}=pn("pricing_sales",[qr("saleDate","desc")]),[p,m]=b.useState(!1),[g,y]=b.useState(!1),[x,w]=b.useState(null),[N,S]=b.useState(!1),[C,A]=b.useState(null),[j,_]=b.useState("all"),E=b.useMemo(()=>j==="all"?h:h.filter(q=>q.reviewStatus===j),[h,j]),I=b.useMemo(()=>{const q=h.length,Y=h.filter(Q=>Q.reviewStatus==="pending").length,R=h.filter(Q=>Q.reviewStatus==="approved").length,G=h.filter(Q=>Q.reviewStatus==="rejected").length,Z=h.filter(Q=>Q.source==="internal").length,W=h.filter(Q=>Q.source==="manual_entry").length;return{total:q,pending:Y,approved:R,rejected:G,internal:Z,manual:W}},[h]),T=q=>{w(q)},P=q=>{A(q),S(!0)},O=async()=>{if(C)try{await s(C.id,`${C.year} ${C.manufacturer} ${C.model}`),n("Sale record deleted"),S(!1),A(null)}catch{r("Failed to delete record")}},H=async q=>{try{await i(q.id),n("Record approved"),w(null)}catch{r("Failed to approve record")}},X=async q=>{try{await a(q.id),n("Record rejected"),w(null)}catch{r("Failed to reject record")}},se=async()=>{d(!0);try{const q=await l();q.synced>0?n(`Synced ${q.synced} sales from sold aircraft`):q.skipped>0?n(`All ${q.skipped} sold aircraft already synced`):r("No sold aircraft found to sync"),q.failed>0&&r(`Failed to sync ${q.failed} records`)}catch{r("Failed to sync existing sales")}d(!1)};return f?o.jsx(Qn,{fullScreen:!0}):o.jsxs("div",{className:"pricing-data-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Pricing Data"}),o.jsx("p",{className:"page-subtitle",children:"Manage historical sale records for pricing intelligence"})]}),o.jsxs("div",{className:"page-header-actions",children:[t(e.PRICING_DATA_IMPORT)&&o.jsxs(K,{variant:"secondary",onClick:se,loading:u,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M23 4v6h-6"}),o.jsx("path",{d:"M1 20v-6h6"}),o.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),u?"Syncing...":"Sync Existing Sales"]}),t(e.PRICING_DATA_IMPORT)&&o.jsxs(K,{variant:"secondary",onClick:()=>y(!0),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),"Import CSV"]}),t(e.PRICING_DATA_ADD)&&o.jsxs(K,{onClick:()=>m(!0),children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),o.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Sale Record"]})]})]}),o.jsxs("div",{className:"pricing-stats-grid",children:[o.jsxs("div",{className:"stat-card",onClick:()=>_("all"),children:[o.jsx("div",{className:"stat-value",children:I.total}),o.jsx("div",{className:"stat-label",children:"Total Records"})]}),o.jsxs("div",{className:"stat-card",onClick:()=>_("approved"),children:[o.jsx("div",{className:"stat-value stat-approved",children:I.approved}),o.jsx("div",{className:"stat-label",children:"Approved"})]}),o.jsxs("div",{className:"stat-card",onClick:()=>_("pending"),children:[o.jsx("div",{className:"stat-value stat-pending",children:I.pending}),o.jsx("div",{className:"stat-label",children:"Pending Review"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:I.internal}),o.jsx("div",{className:"stat-label",children:"Internal Sales"})]})]}),o.jsxs("div",{className:"pricing-view-tabs",children:[o.jsx("button",{className:`view-tab ${j==="all"?"active":""}`,onClick:()=>_("all"),children:"All Records"}),o.jsx("button",{className:`view-tab ${j==="approved"?"active":""}`,onClick:()=>_("approved"),children:"Approved"}),o.jsxs("button",{className:`view-tab ${j==="pending"?"active":""}`,onClick:()=>_("pending"),children:["Pending Review ",I.pending>0&&o.jsx("span",{className:"badge",children:I.pending})]}),o.jsx("button",{className:`view-tab ${j==="rejected"?"active":""}`,onClick:()=>_("rejected"),children:"Rejected"})]}),o.jsx(JRe,{data:E,onRowClick:T,onDelete:t(e.PRICING_DATA_DELETE)?P:null,canEdit:t(e.PRICING_DATA_EDIT),canDelete:t(e.PRICING_DATA_DELETE),showReviewStatus:!0}),o.jsx(ZRe,{isOpen:p,onClose:()=>m(!1),onSuccess:()=>m(!1)}),o.jsx(rMe,{isOpen:g,onClose:()=>y(!1),onSuccess:()=>y(!1)}),o.jsx(ut,{isOpen:!!x,onClose:()=>w(null),title:"Sale Record Details",size:"medium",footer:o.jsxs(o.Fragment,{children:[(x==null?void 0:x.reviewStatus)==="pending"&&t(e.PRICING_REVIEW)&&o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"danger",onClick:()=>X(x),disabled:c,children:"Reject"}),o.jsx(K,{onClick:()=>H(x),disabled:c,children:"Approve"})]}),o.jsx(K,{variant:"secondary",onClick:()=>w(null),children:"Close"})]}),children:x&&o.jsxs("div",{className:"sale-record-detail",children:[x.isOutlier&&o.jsxs("div",{className:"outlier-warning",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),o.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),o.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),o.jsxs("div",{children:[o.jsx("strong",{children:"Outlier Detected"}),o.jsx("p",{children:x.outlierReason})]})]}),o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Aircraft"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Aircraft"}),o.jsxs("span",{className:"detail-value",children:[x.year," ",x.manufacturer," ",x.model]})]}),x.registration&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Registration"}),o.jsx("span",{className:"detail-value",children:x.registration})]}),x.serialNumber&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Serial Number"}),o.jsx("span",{className:"detail-value",children:x.serialNumber})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Condition"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total Hours"}),o.jsx("span",{className:"detail-value",children:(L=x.totalHours)==null?void 0:L.toLocaleString()})]}),x.engineHours&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Engine Hours"}),o.jsx("span",{className:"detail-value",children:x.engineHours.toLocaleString()})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Condition"}),o.jsx("span",{className:"detail-value",children:x.condition})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Pricing"}),x.askingPrice&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Asking Price"}),o.jsx("span",{className:"detail-value",children:On(x.askingPrice,x.currency)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Sale Price"}),o.jsx("span",{className:"detail-value highlight",children:On(x.salePrice,x.currency)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Price (USD)"}),o.jsx("span",{className:"detail-value",children:On(x.priceUSD,"USD")})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Sale Context"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Sale Date"}),o.jsx("span",{className:"detail-value",children:ky(x.saleDate)})]}),x.daysOnMarket&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Days on Market"}),o.jsx("span",{className:"detail-value",children:x.daysOnMarket})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Region"}),o.jsx("span",{className:"detail-value",children:(B=ih.find(q=>q.value===x.region))==null?void 0:B.label})]}),x.country&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Country"}),o.jsx("span",{className:"detail-value",children:x.country})]})]}),o.jsxs("div",{className:"detail-section",children:[o.jsx("h4",{children:"Source"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Source"}),o.jsx("span",{className:"detail-value",children:($=Iv.find(q=>q.value===x.source))==null?void 0:$.label})]}),x.sourceDetails&&o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Details"}),o.jsx("span",{className:"detail-value",children:x.sourceDetails})]})]}),x.notes&&o.jsxs("div",{className:"detail-section full-width",children:[o.jsx("h4",{children:"Notes"}),o.jsx("p",{className:"detail-notes",children:x.notes})]})]})]})}),o.jsxs(ut,{isOpen:N,onClose:()=>{S(!1),A(null)},title:"Delete Sale Record",size:"small",footer:o.jsxs(o.Fragment,{children:[o.jsx(K,{variant:"secondary",onClick:()=>{S(!1),A(null)},children:"Cancel"}),o.jsx(K,{variant:"danger",onClick:O,loading:c,children:"Delete"})]}),children:[o.jsx("p",{children:"Are you sure you want to delete this sale record?"}),C&&o.jsxs("p",{className:"delete-record-info",children:[o.jsxs("strong",{children:[C.year," ",C.manufacturer," ",C.model]}),o.jsx("br",{}),On(C.salePrice,C.currency),"  ",ky(C.saleDate)]}),o.jsx("p",{className:"text-muted",children:"This action cannot be undone."})]})]})}const iMe="pricing_sales",zh={year:.2,hours:.25,condition:.2,region:.1,equipment:.15,recency:.1};function w$(t,e){var f;const n=Math.abs(t.year-e.year),r=Math.max(0,1-n/10),s=Math.abs((t.totalHours||0)-(e.totalHours||0)),i=Math.max(0,1-s/2e3),a=Ibe(t.condition,e.condition),l=t.region===e.region?1:.7,c=Pbe(t.equipment||[],e.equipment||[],t.avionics||[],e.avionics||[]),u=(f=e.saleDate)!=null&&f.toDate?e.saleDate.toDate():new Date(e.saleDate),d=(Date.now()-u.getTime())/(1e3*60*60*24),h=Math.max(0,1-d/730);return r*zh.year+i*zh.hours+a*zh.condition+l*zh.region+c*zh.equipment+h*zh.recency}function aMe(){const[t,e]=b.useState(!1),[n,r]=b.useState(null),[s,i]=b.useState(null),a=b.useCallback(async(u,d)=>{try{const h=Wi(fr(ke,iMe),ba("manufacturer","==",u),ba("model","==",d),ba("reviewStatus","==","approved"));return(await Io(h)).docs.map(p=>({id:p.id,...p.data()}))}catch(h){return console.error("Error fetching comparables:",h),[]}},[]),l=b.useCallback(async u=>{e(!0),i(null),r(null);try{if(!u.manufacturer||!u.model)throw new Error("Manufacturer and model are required");const h=(await a(u.manufacturer,u.model)).filter(_=>!_.isOutlier&&_.priceUSD>0);if(h.length<3){r({error:"INSUFFICIENT_DATA",message:`Only ${h.length} comparable sales found. Need at least 3 for a reliable estimate.`,comparablesFound:h.length,comparables:h.map(_=>({..._,score:w$(u,_)})).sort((_,E)=>E.score-_.score)}),e(!1);return}const f=h.map(_=>({sale:_,score:w$(u,_),adjustment:Obe(u.equipment||[],_.equipment||[])})).sort((_,E)=>E.score-_.score).slice(0,20),p=f.reduce((_,E)=>_+E.score,0),g=f.map(_=>(_.sale.priceUSD+_.adjustment)*_.score).reduce((_,E)=>_+E,0)/p,y=f.map(_=>_.sale.priceUSD+_.adjustment),x=Lf(y,25),w=Lf(y,75),N=p/f.length,S=gQ(y),C=S/g,A=qRe(f.length,N,C),j={lowEstimate:Math.round(x),midEstimate:Math.round(g),highEstimate:Math.round(w),confidence:A.level,confidenceScore:A.score,comparablesUsed:f.length,comparables:f.map(_=>({id:_.sale.id,year:_.sale.year,manufacturer:_.sale.manufacturer,model:_.sale.model,totalHours:_.sale.totalHours,condition:_.sale.condition,region:_.sale.region,priceUSD:_.sale.priceUSD,adjustedPrice:_.sale.priceUSD+_.adjustment,saleDate:_.sale.saleDate,score:_.score,adjustment:_.adjustment})),statistics:{mean:Math.round(Cp(y)),median:Math.round(Lf(y,50)),stdDev:Math.round(S),min:Math.round(Math.min(...y)),max:Math.round(Math.max(...y))},input:{manufacturer:u.manufacturer,model:u.model,year:u.year,totalHours:u.totalHours,condition:u.condition,region:u.region}};return r(j),e(!1),j}catch(d){throw i(d.message),e(!1),d}},[a]),c=b.useCallback(()=>{r(null),i(null)},[]);return{loading:t,result:n,error:s,calculateEstimate:l,clearResult:c}}function oMe(){var m;Js();const{manufacturers:t,getModelsForManufacturer:e,loading:n}=Pu(),{loading:r,result:s,error:i,calculateEstimate:a,clearResult:l}=aMe(),[c,u]=b.useState({manufacturer:"",model:"",year:new Date().getFullYear()-5,totalHours:"",condition:"good",region:"UK",equipment:[],avionics:[]}),d=b.useMemo(()=>c.manufacturer?e(c.manufacturer):[],[c.manufacturer,e]),h=g=>{const{name:y,value:x}=g.target;y==="manufacturer"?(u(w=>({...w,manufacturer:x,model:""})),l()):u(w=>({...w,[y]:x}))},f=async g=>{g.preventDefault(),!(!c.manufacturer||!c.model)&&await a({...c,year:parseInt(c.year),totalHours:c.totalHours?parseInt(c.totalHours):0})},p=g=>{switch(g){case"high":return"var(--color-success)";case"medium":return"var(--color-warning)";case"low":return"var(--color-danger)";default:return"var(--color-text-muted)"}};return o.jsxs("div",{className:"price-estimator-page",children:[o.jsxs("div",{className:"page-header",children:[o.jsxs("div",{children:[o.jsx("h1",{children:"Price Estimator"}),o.jsx("p",{className:"page-subtitle",children:"Get data-driven price guidance based on historical sales"})]}),o.jsx("div",{className:"page-header-actions",children:o.jsx(at,{to:"/pricing",children:o.jsxs(K,{variant:"secondary",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("path",{d:"M3 3v18h18"}),o.jsx("circle",{cx:"9",cy:"9",r:"2"}),o.jsx("circle",{cx:"19",cy:"19",r:"2"})]}),"View Dashboard"]})})})]}),o.jsxs("div",{className:"estimator-content",children:[o.jsxs("div",{className:"estimator-form-section",children:[o.jsx("h2",{children:"Aircraft Details"}),o.jsxs("form",{onSubmit:f,className:"estimator-form",children:[o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Manufacturer *"}),o.jsxs("select",{name:"manufacturer",value:c.manufacturer,onChange:h,className:"form-select",disabled:n,children:[o.jsx("option",{value:"",children:"Select manufacturer"}),t.map(g=>o.jsx("option",{value:g,children:g},g))]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Model *"}),o.jsxs("select",{name:"model",value:c.model,onChange:h,className:"form-select",disabled:!c.manufacturer,children:[o.jsx("option",{value:"",children:"Select model"}),d.map(g=>o.jsx("option",{value:g,children:g},g))]})]}),o.jsx(ye,{label:"Year",name:"year",type:"number",value:c.year,onChange:h,min:"1950",max:new Date().getFullYear()+1}),o.jsx(ye,{label:"Total Hours",name:"totalHours",type:"number",value:c.totalHours,onChange:h,placeholder:"e.g., 1500",min:"0"}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Condition"}),o.jsx("select",{name:"condition",value:c.condition,onChange:h,className:"form-select",children:gp.map(g=>o.jsx("option",{value:g.value,children:g.label},g.value))})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Region"}),o.jsx("select",{name:"region",value:c.region,onChange:h,className:"form-select",children:ih.map(g=>o.jsx("option",{value:g.value,children:g.label},g.value))})]})]}),o.jsx("div",{className:"form-actions",children:o.jsxs(K,{type:"submit",loading:r,disabled:!c.manufacturer||!c.model,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:6},children:[o.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),o.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Calculate Estimate"]})})]})]}),r&&o.jsxs("div",{className:"estimator-loading",children:[o.jsx(Qn,{}),o.jsx("p",{children:"Analyzing comparable sales..."})]}),i&&o.jsxs("div",{className:"estimator-error",children:[o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),o.jsx("p",{children:i})]}),s&&!r&&o.jsx("div",{className:"estimator-results",children:s.error==="INSUFFICIENT_DATA"?o.jsxs("div",{className:"insufficient-data",children:[o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),o.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),o.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),o.jsx("h3",{children:"Insufficient Data"}),o.jsx("p",{children:s.message}),o.jsx(at,{to:"/pricing/data",children:o.jsx(K,{variant:"secondary",children:"Add Sale Records"})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"estimate-card",children:[o.jsxs("div",{className:"estimate-header",children:[o.jsx("h2",{children:"Estimated Value"}),o.jsxs("div",{className:"confidence-badge",style:{backgroundColor:p(s.confidence)+"20",color:p(s.confidence)},children:[s.confidence," confidence"]})]}),o.jsxs("div",{className:"estimate-range",children:[o.jsxs("div",{className:"range-endpoint",children:[o.jsx("span",{className:"range-label",children:"Low"}),o.jsx("span",{className:"range-value",children:On(s.lowEstimate,"USD")})]}),o.jsxs("div",{className:"range-middle",children:[o.jsxs("div",{className:"range-bar",children:[o.jsx("div",{className:"range-fill"}),o.jsx("div",{className:"range-marker",style:{left:"50%"}})]}),o.jsxs("div",{className:"mid-estimate",children:[o.jsx("span",{className:"mid-label",children:"Recommended"}),o.jsx("span",{className:"mid-value",children:On(s.midEstimate,"USD")})]})]}),o.jsxs("div",{className:"range-endpoint",children:[o.jsx("span",{className:"range-label",children:"High"}),o.jsx("span",{className:"range-value",children:On(s.highEstimate,"USD")})]})]}),o.jsxs("div",{className:"estimate-stats",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Comparables Used"}),o.jsx("span",{className:"stat-value",children:s.comparablesUsed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Market Avg"}),o.jsx("span",{className:"stat-value",children:On(s.statistics.mean,"USD")})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Std Deviation"}),o.jsx("span",{className:"stat-value",children:On(s.statistics.stdDev,"USD")})]})]})]}),o.jsxs("div",{className:"input-summary",children:[o.jsx("h3",{children:"Your Aircraft"}),o.jsxs("div",{className:"summary-grid",children:[o.jsxs("div",{className:"summary-item",children:[o.jsx("span",{className:"summary-label",children:"Aircraft"}),o.jsxs("span",{className:"summary-value",children:[s.input.year," ",s.input.manufacturer," ",s.input.model]})]}),o.jsxs("div",{className:"summary-item",children:[o.jsx("span",{className:"summary-label",children:"Hours"}),o.jsx("span",{className:"summary-value",children:((m=s.input.totalHours)==null?void 0:m.toLocaleString())||"Not specified"})]}),o.jsxs("div",{className:"summary-item",children:[o.jsx("span",{className:"summary-label",children:"Condition"}),o.jsx("span",{className:"summary-value",children:vp(s.input.condition)})]}),o.jsxs("div",{className:"summary-item",children:[o.jsx("span",{className:"summary-label",children:"Region"}),o.jsx("span",{className:"summary-value",children:yp(s.input.region)})]})]})]}),o.jsxs("div",{className:"comparables-section",children:[o.jsxs("h3",{children:["Comparable Sales (",s.comparables.length,")"]}),o.jsx("div",{className:"comparables-list",children:s.comparables.slice(0,10).map((g,y)=>{var x;return o.jsxs("div",{className:"comparable-item",children:[o.jsxs("div",{className:"comparable-rank",children:["#",y+1]}),o.jsxs("div",{className:"comparable-info",children:[o.jsxs("div",{className:"comparable-title",children:[g.year," ",g.manufacturer," ",g.model]}),o.jsxs("div",{className:"comparable-details",children:[(x=g.totalHours)==null?void 0:x.toLocaleString()," hrs  ",vp(g.condition),"  ",yp(g.region)]}),o.jsxs("div",{className:"comparable-date",children:["Sold ",ky(g.saleDate)]})]}),o.jsxs("div",{className:"comparable-price",children:[o.jsx("span",{className:"price-value",children:On(g.priceUSD,"USD")}),g.adjustment!==0&&o.jsxs("span",{className:"price-adjustment",children:[g.adjustment>0?"+":"",On(g.adjustment,"USD")," adj."]})]}),o.jsxs("div",{className:"comparable-score",children:[o.jsx("div",{className:"score-bar",style:{width:`${g.score*100}%`,backgroundColor:g.score>.7?"var(--color-success)":g.score>.4?"var(--color-warning)":"var(--color-text-muted)"}}),o.jsxs("span",{className:"score-value",children:[Math.round(g.score*100),"%"]})]})]},g.id)})}),s.comparables.length>10&&o.jsxs("p",{className:"comparables-more",children:["+ ",s.comparables.length-10," more comparables"]})]})]})})]})]})}function lMe(){const{user:t,loading:e}=Xi();return e?o.jsx("div",{className:"loading-fullscreen",children:o.jsx("div",{className:"spinner spinner-large"})}):o.jsxs(zZ,{children:[o.jsxs(Yt,{element:o.jsx(Xce,{}),children:[o.jsx(Yt,{path:"/login",element:t?o.jsx(jf,{to:"/dashboard",replace:!0}):o.jsx(eue,{})}),o.jsx(Yt,{path:"/accept-invite",element:o.jsx(sue,{})})]}),o.jsxs(Yt,{element:o.jsx(Us,{children:o.jsx(Qce,{})}),children:[o.jsx(Yt,{index:!0,element:o.jsx(jf,{to:"/dashboard",replace:!0})}),o.jsx(Yt,{path:"/dashboard",element:o.jsx($de,{})}),o.jsx(Yt,{path:"/listings",element:o.jsx(Gde,{})}),o.jsx(Yt,{path:"/listings/new",element:o.jsx(Us,{requiredPermission:Be.LISTINGS_CREATE,children:o.jsx(Kde,{})})}),o.jsx(Yt,{path:"/listings/:id/edit",element:o.jsx(Us,{requiredPermission:Be.LISTINGS_EDIT,children:o.jsx(nhe,{})})}),o.jsx(Yt,{path:"/blog",element:o.jsx(she,{})}),o.jsx(Yt,{path:"/blog/new",element:o.jsx(Us,{requiredPermission:Be.BLOGS_CREATE,children:o.jsx(W0e,{})})}),o.jsx(Yt,{path:"/blog/:id/edit",element:o.jsx(Us,{requiredPermission:Be.BLOGS_EDIT,children:o.jsx(q0e,{})})}),o.jsx(Yt,{path:"/social",element:o.jsx(Z0e,{})}),o.jsx(Yt,{path:"/social/new",element:o.jsx(Us,{requiredPermission:Be.SOCIAL_CREATE,children:o.jsx(rbe,{})})}),o.jsx(Yt,{path:"/social/:id/edit",element:o.jsx(Us,{requiredPermission:Be.SOCIAL_EDIT,children:o.jsx(sbe,{})})}),o.jsx(Yt,{path:"/enquiries",element:o.jsx(ibe,{})}),o.jsx(Yt,{path:"/enquiries/:id",element:o.jsx(obe,{})}),o.jsx(Yt,{path:"/contacts",element:o.jsx(cbe,{})}),o.jsx(Yt,{path:"/contacts/new",element:o.jsx(Us,{requiredPermission:Be.CONTACTS_CREATE,children:o.jsx(ube,{})})}),o.jsx(Yt,{path:"/contacts/:id",element:o.jsx(pbe,{})}),o.jsx(Yt,{path:"/contacts/:id/edit",element:o.jsx(Us,{requiredPermission:Be.CONTACTS_EDIT,children:o.jsx(mbe,{})})}),o.jsx(Yt,{path:"/pricing",element:o.jsx(Us,{requiredPermission:Be.PRICING_VIEW,children:o.jsx(QRe,{})})}),o.jsx(Yt,{path:"/pricing/data",element:o.jsx(Us,{requiredPermission:Be.PRICING_VIEW,children:o.jsx(sMe,{})})}),o.jsx(Yt,{path:"/pricing/estimate",element:o.jsx(Us,{requiredPermission:Be.PRICING_ESTIMATE,children:o.jsx(oMe,{})})}),o.jsx(Yt,{path:"/media",element:o.jsx(gbe,{})}),o.jsx(Yt,{path:"/users",element:o.jsx(Us,{requiredPermission:Be.USERS_INVITE,children:o.jsx(Nbe,{})})}),o.jsx(Yt,{path:"/audit",element:o.jsx(Us,{requiredPermission:Be.AUDIT_VIEW,children:o.jsx(jbe,{})})}),o.jsx(Yt,{path:"/settings",element:o.jsx(Us,{requiredPermission:Be.SETTINGS_MANAGE,children:o.jsx(Ebe,{})})})]}),o.jsx(Yt,{path:"*",element:o.jsx(jf,{to:"/dashboard",replace:!0})})]})}eE.createRoot(document.getElementById("root")).render(o.jsx(Fr.StrictMode,{children:o.jsx(JZ,{basename:"/admin",children:o.jsx(qce,{children:o.jsx(Jce,{children:o.jsx(lMe,{})})})})}));
